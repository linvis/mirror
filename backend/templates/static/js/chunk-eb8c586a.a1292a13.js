(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-eb8c586a"],{"0159":function(e,t,n){const i=n("bbfd"),r=(e,t,n,r)=>{"string"===typeof n&&(r=n,n=void 0);try{return new i(e,n).inc(t,r).version}catch(a){return null}};e.exports=r},"0982":function(e,t,n){const i=n("3fce"),r=(e,t)=>{try{return new i(e,t).range||"*"}catch(n){return null}};e.exports=r},"0a67":function(e,t,n){const i=n("bbfd"),r=n("a236"),{re:a,t:o}=n("8cb5"),s=(e,t)=>{if(e instanceof i)return e;if("number"===typeof e&&(e=String(e)),"string"!==typeof e)return null;t=t||{};let n=null;if(t.rtl){let t;while((t=a[o.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length))n&&t.index+t[0].length===n.index+n[0].length||(n=t),a[o.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;a[o.COERCERTL].lastIndex=-1}else n=e.match(a[o.COERCE]);return null===n?null:r(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)};e.exports=s},"13af":function(e,t,n){const i=n("bbfd"),r=n("3fce"),a=(e,t,n)=>{let a=null,o=null,s=null;try{s=new r(t,n)}catch(u){return null}return e.forEach(e=>{s.test(e)&&(a&&-1!==o.compare(e)||(a=e,o=new i(a,n)))}),a};e.exports=a},"1cc6":function(e,t,n){const i=n("bbfd"),r=(e,t,n)=>{const r=new i(e,n),a=new i(t,n);return r.compare(a)||r.compareBuild(a)};e.exports=r},2410:function(e,t,n){(function(t){var n=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var n,i,r;try{n=Map}catch(f){n=function(){}}try{i=Set}catch(f){i=function(){}}try{r=Promise}catch(f){r=function(){}}function a(o,s,u,c,f){"object"===typeof s&&(u=s.depth,c=s.prototype,f=s.includeNonEnumerable,s=s.circular);var d=[],h=[],p="undefined"!=typeof t;function g(o,u){if(null===o)return null;if(0===u)return o;var m,v;if("object"!=typeof o)return o;if(e(o,n))m=new n;else if(e(o,i))m=new i;else if(e(o,r))m=new r((function(e,t){o.then((function(t){e(g(t,u-1))}),(function(e){t(g(e,u-1))}))}));else if(a.__isArray(o))m=[];else if(a.__isRegExp(o))m=new RegExp(o.source,l(o)),o.lastIndex&&(m.lastIndex=o.lastIndex);else if(a.__isDate(o))m=new Date(o.getTime());else{if(p&&t.isBuffer(o))return m=t.allocUnsafe?t.allocUnsafe(o.length):new t(o.length),o.copy(m),m;e(o,Error)?m=Object.create(o):"undefined"==typeof c?(v=Object.getPrototypeOf(o),m=Object.create(v)):(m=Object.create(c),v=c)}if(s){var b=d.indexOf(o);if(-1!=b)return h[b];d.push(o),h.push(m)}for(var y in e(o,n)&&o.forEach((function(e,t){var n=g(t,u-1),i=g(e,u-1);m.set(n,i)})),e(o,i)&&o.forEach((function(e){var t=g(e,u-1);m.add(t)})),o){var x;v&&(x=Object.getOwnPropertyDescriptor(v,y)),x&&null==x.set||(m[y]=g(o[y],u-1))}if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(o);for(y=0;y<O.length;y++){var w=O[y],j=Object.getOwnPropertyDescriptor(o,w);(!j||j.enumerable||f)&&(m[w]=g(o[w],u-1),j.enumerable||Object.defineProperty(m,w,{enumerable:!1}))}}if(f){var k=Object.getOwnPropertyNames(o);for(y=0;y<k.length;y++){var _=k[y];j=Object.getOwnPropertyDescriptor(o,_);j&&j.enumerable||(m[_]=g(o[_],u-1),Object.defineProperty(m,_,{enumerable:!1}))}}return m}return"undefined"==typeof s&&(s=!0),"undefined"==typeof u&&(u=1/0),g(o,u)}function o(e){return Object.prototype.toString.call(e)}function s(e){return"object"===typeof e&&"[object Date]"===o(e)}function u(e){return"object"===typeof e&&"[object Array]"===o(e)}function c(e){return"object"===typeof e&&"[object RegExp]"===o(e)}function l(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return a.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},a.__objToStr=o,a.__isDate=s,a.__isArray=u,a.__isRegExp=c,a.__getRegExpFlags=l,a}();e.exports&&(e.exports=n)}).call(this,n("b639").Buffer)},"276f":function(e,t,n){"use strict";var i=function(e,t,n){return e.fields=t||[],e.fname=n,e};function r(e){return null==e?null:e.fname}function a(e){return null==e?null:e.fields}var o=function(e){throw Error(e)},s=function(e){var t,n,i,r=[],a=null,s=0,u=e.length,c="";function l(){r.push(c+e.substring(t,n)),c="",t=n+1}for(e+="",t=n=0;n<u;++n)if(i=e[n],"\\"===i)c+=e.substring(t,n),c+=e.substring(++n,++n),t=n;else if(i===a)l(),a=null,s=-1;else{if(a)continue;t===s&&'"'===i||t===s&&"'"===i?(t=n+1,a=i):"."!==i||s?"["===i?(n>t&&l(),s=t=n+1):"]"===i&&(s||o("Access path missing open bracket: "+e),s>0&&l(),s=0,t=n+1):n>t?l():t=n+1}return s&&o("Access path missing closing bracket: "+e),a&&o("Access path missing closing quote: "+e),n>t&&(n++,l()),r},u=Array.isArray,c=function(e){return e===Object(e)},l=function(e){return"string"===typeof e};function f(e){return u(e)?"["+e.map(f)+"]":c(e)||l(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var d=function(e,t){var n=s(e),r="return _["+n.map(f).join("][")+"];";return i(Function("_",r),[e=1===n.length?n[0]:e],t||e)},h=[],p=d("id"),g=i((function(e){return e}),h,"identity"),m=i((function(){return 0}),h,"zero"),v=i((function(){return 1}),h,"one"),b=i((function(){return!0}),h,"true"),y=i((function(){return!1}),h,"false");function x(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var O=0,w=1,j=2,k=3,_=4,A=function(e,t){var n=e||O;return{level:function(e){return arguments.length?(n=+e,this):n},error:function(){return n>=w&&x(t||"error","ERROR",arguments),this},warn:function(){return n>=j&&x(t||"warn","WARN",arguments),this},info:function(){return n>=k&&x(t||"log","INFO",arguments),this},debug:function(){return n>=_&&x(t||"log","DEBUG",arguments),this}}};function E(...e){return e.reduce((e,t)=>{for(var n in t)if("signals"===n)e.signals=S(e.signals,t.signals);else{var i="legend"===n?{layout:1}:"style"===n||null;D(e,n,t[n],i)}return e},{})}function D(e,t,n,i){var r,a;if(c(n)&&!u(n))for(r in a=c(e[t])?e[t]:e[t]={},n)i&&(!0===i||i[r])?D(a,r,n[r]):a[r]=n[r];else e[t]=n}function S(e,t){if(null==e)return t;const n={},i=[];function r(e){n[e.name]||(n[e.name]=1,i.push(e))}return t.forEach(r),e.forEach(r),i}var C=function(e){return e[e.length-1]},F=function(e){return null==e||""===e?null:+e};function $(e){return function(t){return e*Math.exp(t)}}function M(e){return function(t){return Math.log(e*t)}}function N(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function R(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function z(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function T(e,t,n,i){var r=n(e[0]),a=n(C(e)),o=(a-r)*t;return[i(r-o),i(a-o)]}function L(e,t){return T(e,t,F,g)}function P(e,t){var n=Math.sign(e[0]);return T(e,t,M(n),$(n))}function B(e,t,n){return T(e,t,z(n),z(1/n))}function I(e,t,n){return T(e,t,N(n),R(n))}function U(e,t,n,i,r){var a=i(e[0]),o=i(C(e)),s=null!=t?i(t):(a+o)/2;return[r(s+(a-s)*n),r(s+(o-s)*n)]}function q(e,t,n){return U(e,t,n,F,g)}function W(e,t,n){var i=Math.sign(e[0]);return U(e,t,n,M(i),$(i))}function H(e,t,n,i){return U(e,t,n,z(i),z(1/i))}function G(e,t,n,i){return U(e,t,n,N(i),R(i))}function V(e){return 1+~~(new Date(e).getMonth()/3)}function Z(e){return 1+~~(new Date(e).getUTCMonth()/3)}var Y=function(e){return null!=e?u(e)?e:[e]:[]},X=function(e,t,n){var i,r=e[0],a=e[1];return a<r&&(i=a,a=r,r=i),i=a-r,i>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-i),r+i]},J=function(e){return"function"===typeof e},Q=function(e,t){var n,r,o,u,c,l,d,h,p,g=[],m=(e=Y(e)).map((function(e,t){return null==e?null:(g.push(t),J(e)?e:s(e).map(f).join("]["))})),v=g.length-1,b=Y(t),y="var u,v;return ";if(v<0)return null;for(r=0;r<=v;++r)n=g[r],o=m[n],J(o)?(l="f"+n,u="(u=this."+l+"(a))",c="(v=this."+l+"(b))",(d=d||{})[l]=o):(u="(u=a["+o+"])",c="(v=b["+o+"])"),l="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))","descending"!==b[n]?(p=1,h=-1):(p=-1,h=1),y+="("+u+"<"+c+"||u==null)&&v!=null?"+h+":(u>v||v==null)&&u!=null?"+p+":"+l+"!==u&&v===v?"+h+":v!==v&&u===u?"+p+(n<v?":":":0");return o=Function("a","b",y+";"),d&&(o=o.bind(d)),e=e.reduce((function(e,t){return J(t)?(a(t)||[]).forEach((function(t){e[t]=1})):null!=t&&(e[t+""]=1),e}),{}),i(o,Object.keys(e))},K=function(e){return J(e)?e:function(){return e}},ee=function(e,t){var n,i;function r(){t(i),n=i=null}return function(t){i=t,n&&clearTimeout(n),n=setTimeout(r,e)}},te=function(e){for(var t,n,i=1,r=arguments.length;i<r;++i)for(n in t=arguments[i],t)e[n]=t[n];return e},ne=function(e,t){var n,i,r,a,o=0;if(e&&(n=e.length))if(null==t){for(i=e[o];o<n&&(null==i||i!==i);i=e[++o]);for(r=a=i;o<n;++o)i=e[o],null!=i&&(i<r&&(r=i),i>a&&(a=i))}else{for(i=t(e[o]);o<n&&(null==i||i!==i);i=t(e[++o]));for(r=a=i;o<n;++o)i=t(e[o]),null!=i&&(i<r&&(r=i),i>a&&(a=i))}return[r,a]},ie=function(e,t){var n,i,r,a,o,s=-1,u=e.length;if(null==t){while(++s<u)if(i=e[s],null!=i&&i>=i){n=r=i;break}if(s===u)return[-1,-1];a=o=s;while(++s<u)i=e[s],null!=i&&(n>i&&(n=i,a=s),r<i&&(r=i,o=s))}else{while(++s<u)if(i=t(e[s],s,e),null!=i&&i>=i){n=r=i;break}if(s===u)return[-1,-1];a=o=s;while(++s<u)i=t(e[s],s,e),null!=i&&(n>i&&(n=i,a=s),r<i&&(r=i,o=s))}return[a,o]};const re=Object.prototype.hasOwnProperty;var ae=function(e,t){return re.call(e,t)},oe={},se=function(e){var t,n,i={};function r(e){return ae(i,e)&&i[e]!==oe}return t={size:0,empty:0,object:i,has:r,get:function(e){return r(e)?i[e]:void 0},set:function(e,n){return r(e)||(++t.size,i[e]===oe&&--t.empty),i[e]=n,this},delete:function(e){return r(e)&&(--t.size,++t.empty,i[e]=oe),this},clear:function(){t.size=t.empty=0,t.object=i={}},test:function(e){return arguments.length?(n=e,t):n},clean:function(){var e,r,a={},o=0;for(e in i)r=i[e],r===oe||n&&n(r)||(a[e]=r,++o);t.size=o,t.empty=0,t.object=i=a}},e&&Object.keys(e).forEach((function(n){t.set(n,e[n])})),t},ue=function(e,t,n,i,r,a){if(!n&&0!==n)return a;var o,s,u=e[0],c=C(e),l=+n;return c<u&&(o=u,u=c,c=o),o=Math.abs(t-u),s=Math.abs(c-t),o<s&&o<=l?i:s<=l?r:a},ce=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},le=function(e,t,n,i){var r,a=t[0],o=t[t.length-1];return a>o&&(r=a,a=o,o=r),n=void 0===n||n,i=void 0===i||i,(n?a<=e:a<e)&&(i?e<=o:e<o)},fe=function(e){return"boolean"===typeof e},de=function(e){return"[object Date]"===Object.prototype.toString.call(e)},he=function(e){return"number"===typeof e},pe=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},ge=function(e,t){e&&(e=t?Y(e).map((function(e){return e.replace(/\\(.)/g,"$1")})):Y(e));var n=e&&e.length?Function("_","return ''+"+e.map((function(e){return"_["+(t?f(e):s(e).map(f).join("]["))+"]"})).join("+'|'+")+";"):function(){return""};return i(n,e,"key")},me=function(e,t){const n=e[0],i=C(e),r=+t;return r?1===r?i:n+r*(i-n):n};const ve=1e4;var be=function(e){let t,n,i;e=+e||ve;const r=()=>{t={},n={},i=0},a=(r,a)=>(++i>e&&(n=t,t={},i=1),t[r]=a);return r(),{clear:r,has:e=>ae(t,e)||ae(n,e),get:e=>ae(t,e)?t[e]:ae(n,e)?a(e,n[e]):void 0,set:(e,n)=>ae(t,e)?t[e]=n:a(e,n)}},ye=function(e,t,n,i){var r=t.length,a=n.length;if(!a)return t;if(!r)return n;for(var o=i||new t.constructor(r+a),s=0,u=0,c=0;s<r&&u<a;++c)o[c]=e(t[s],n[u])>0?n[u++]:t[s++];for(;s<r;++s,++c)o[c]=t[s];for(;u<a;++u,++c)o[c]=n[u];return o},xe=function(e,t){var n="";while(--t>=0)n+=e;return n},Oe=function(e,t,n,i){var r=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===i?xe(r,o)+a:"center"===i?xe(r,~~(o/2))+a+xe(r,Math.ceil(o/2)):a+xe(r,o)},we=function(e){return e&&C(e)-e[0]||0},je=function(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e)&&!!e};function ke(e){return he(e)||de(e)?e:Date.parse(e)}var _e=function(e,t){return t=t||ke,null==e||""===e?null:t(e)},Ae=function(e){return null==e||""===e?null:e+""},Ee=function(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t},De=function(e,t,n,i){var r=null!=i?i:"…",a=e+"",o=a.length,s=Math.max(0,t-r.length);return o<=t?a:"left"===n?r+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+r+a.slice(o-~~(s/2)):a.slice(0,s)+r},Se=function(e,t,n){if(e){var i,r=0,a=e.length;if(t)for(;r<a;++r)(i=t(e[r]))&&n(i,r,e);else e.forEach(n)}};n.d(t,"f",(function(){return i})),n.d(t,"h",(function(){return r})),n.d(t,"g",(function(){return a})),n.d(t,"w",(function(){return p})),n.d(t,"x",(function(){return g})),n.d(t,"kb",(function(){return m})),n.d(t,"O",(function(){return v})),n.d(t,"gb",(function(){return b})),n.d(t,"r",(function(){return y})),n.d(t,"K",(function(){return A})),n.d(t,"d",(function(){return O})),n.d(t,"b",(function(){return w})),n.d(t,"e",(function(){return j})),n.d(t,"c",(function(){return k})),n.d(t,"a",(function(){return _})),n.d(t,"N",(function(){return E})),n.d(t,"jb",(function(){return D})),n.d(t,"Q",(function(){return L})),n.d(t,"R",(function(){return P})),n.d(t,"S",(function(){return B})),n.d(t,"T",(function(){return I})),n.d(t,"lb",(function(){return q})),n.d(t,"mb",(function(){return W})),n.d(t,"nb",(function(){return H})),n.d(t,"ob",(function(){return G})),n.d(t,"V",(function(){return V})),n.d(t,"hb",(function(){return Z})),n.d(t,"i",(function(){return Y})),n.d(t,"j",(function(){return X})),n.d(t,"k",(function(){return Q})),n.d(t,"l",(function(){return K})),n.d(t,"m",(function(){return ee})),n.d(t,"n",(function(){return o})),n.d(t,"o",(function(){return te})),n.d(t,"p",(function(){return ne})),n.d(t,"q",(function(){return ie})),n.d(t,"s",(function(){return se})),n.d(t,"t",(function(){return d})),n.d(t,"u",(function(){return ue})),n.d(t,"v",(function(){return ae})),n.d(t,"y",(function(){return ce})),n.d(t,"z",(function(){return le})),n.d(t,"A",(function(){return u})),n.d(t,"B",(function(){return fe})),n.d(t,"C",(function(){return de})),n.d(t,"D",(function(){return J})),n.d(t,"E",(function(){return he})),n.d(t,"F",(function(){return c})),n.d(t,"G",(function(){return pe})),n.d(t,"H",(function(){return l})),n.d(t,"I",(function(){return ge})),n.d(t,"J",(function(){return me})),n.d(t,"L",(function(){return be})),n.d(t,"M",(function(){return ye})),n.d(t,"P",(function(){return Oe})),n.d(t,"U",(function(){return C})),n.d(t,"W",(function(){return xe})),n.d(t,"X",(function(){return we})),n.d(t,"Y",(function(){return s})),n.d(t,"Z",(function(){return f})),n.d(t,"ab",(function(){return je})),n.d(t,"bb",(function(){return _e})),n.d(t,"cb",(function(){return F})),n.d(t,"eb",(function(){return Ae})),n.d(t,"db",(function(){return Ee})),n.d(t,"fb",(function(){return De})),n.d(t,"ib",(function(){return Se}))},"2a2e":function(e,t,n){const i=n("1cc6"),r=(e,t)=>e.sort((e,n)=>i(e,n,t));e.exports=r},"2a86":function(e,t,n){const i=n("3fce"),r=(e,t,n)=>{try{t=new i(t,n)}catch(r){return!1}return t.test(e)};e.exports=r},"2cdf":function(e,t){const n=/^[0-9]+$/,i=(e,t)=>{const i=n.test(e),r=n.test(t);return i&&r&&(e=+e,t=+t),e===t?0:i&&!r?-1:r&&!i?1:e<t?-1:1},r=(e,t)=>i(t,e);e.exports={compareIdentifiers:i,rcompareIdentifiers:r}},3034:function(e,t,n){const i=n("bbfd"),r=(e,t,n)=>new i(e,n).compare(new i(t,n));e.exports=r},"38cb":function(e,t,n){const i=n("bbfd"),r=n("6d43"),{ANY:a}=r,o=n("3fce"),s=n("2a86"),u=n("bac4"),c=n("38fa"),l=n("68d3"),f=n("a2a3"),d=(e,t,n,d)=>{let h,p,g,m,v;switch(e=new i(e,d),t=new o(t,d),n){case">":h=u,p=l,g=c,m=">",v=">=";break;case"<":h=c,p=f,g=u,m="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,t,d))return!1;for(let i=0;i<t.set.length;++i){const n=t.set[i];let o=null,s=null;if(n.forEach(e=>{e.semver===a&&(e=new r(">=0.0.0")),o=o||e,s=s||e,h(e.semver,o.semver,d)?o=e:g(e.semver,s.semver,d)&&(s=e)}),o.operator===m||o.operator===v)return!1;if((!s.operator||s.operator===m)&&p(e,s.semver))return!1;if(s.operator===v&&g(e,s.semver))return!1}return!0};e.exports=d},"38fa":function(e,t,n){const i=n("3034"),r=(e,t,n)=>i(e,t,n)<0;e.exports=r},"3fce":function(e,t,n){class i{constructor(e,t){if(t&&"object"===typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof i)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new i(e.raw,t);if(e instanceof r)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const t=this.options.loose;e=e.trim();const n=t?s[u.HYPHENRANGELOOSE]:s[u.HYPHENRANGE];e=e.replace(n,w),a("hyphen replace",e),e=e.replace(s[u.COMPARATORTRIM],c),a("comparator trim",e,s[u.COMPARATORTRIM]),e=e.replace(s[u.TILDETRIM],l),e=e.replace(s[u.CARETTRIM],f),e=e.split(/\s+/).join(" ");const i=t?s[u.COMPARATORLOOSE]:s[u.COMPARATOR];return e.split(" ").map(e=>h(e,this.options)).join(" ").split(/\s+/).filter(this.options.loose?e=>!!e.match(i):()=>!0).map(e=>new r(e,this.options))}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Range is required");return this.set.some(n=>d(n,t)&&e.set.some(e=>d(e,t)&&n.every(n=>e.every(e=>n.intersects(e,t)))))}test(e){if(!e)return!1;if("string"===typeof e)try{e=new o(e,this.options)}catch(t){return!1}for(let n=0;n<this.set.length;n++)if(j(this.set[n],e,this.options))return!0;return!1}}e.exports=i;const r=n("6d43"),a=n("b802"),o=n("bbfd"),{re:s,t:u,comparatorTrimReplace:c,tildeTrimReplace:l,caretTrimReplace:f}=n("8cb5"),d=(e,t)=>{let n=!0;const i=e.slice();let r=i.pop();while(n&&i.length)n=i.every(e=>r.intersects(e,t)),r=i.pop();return n},h=(e,t)=>(a("comp",e,t),e=v(e,t),a("caret",e),e=g(e,t),a("tildes",e),e=y(e,t),a("xrange",e),e=O(e,t),a("stars",e),e),p=e=>!e||"x"===e.toLowerCase()||"*"===e,g=(e,t)=>e.trim().split(/\s+/).map(e=>m(e,t)).join(" "),m=(e,t)=>{const n=t.loose?s[u.TILDELOOSE]:s[u.TILDE];return e.replace(n,(t,n,i,r,o)=>{let s;return a("tilde",e,t,n,i,r,o),p(n)?s="":p(i)?s=`>=${n}.0.0 <${+n+1}.0.0`:p(r)?s=`>=${n}.${i}.0 <${n}.${+i+1}.0`:o?(a("replaceTilde pr",o),s=`>=${n}.${i}.${r}-${o} <${n}.${+i+1}.0`):s=`>=${n}.${i}.${r} <${n}.${+i+1}.0`,a("tilde return",s),s})},v=(e,t)=>e.trim().split(/\s+/).map(e=>b(e,t)).join(" "),b=(e,t)=>{a("caret",e,t);const n=t.loose?s[u.CARETLOOSE]:s[u.CARET];return e.replace(n,(t,n,i,r,o)=>{let s;return a("caret",e,t,n,i,r,o),p(n)?s="":p(i)?s=`>=${n}.0.0 <${+n+1}.0.0`:p(r)?s="0"===n?`>=${n}.${i}.0 <${n}.${+i+1}.0`:`>=${n}.${i}.0 <${+n+1}.0.0`:o?(a("replaceCaret pr",o),s="0"===n?"0"===i?`>=${n}.${i}.${r}-${o} <${n}.${i}.${+r+1}`:`>=${n}.${i}.${r}-${o} <${n}.${+i+1}.0`:`>=${n}.${i}.${r}-${o} <${+n+1}.0.0`):(a("no pr"),s="0"===n?"0"===i?`>=${n}.${i}.${r} <${n}.${i}.${+r+1}`:`>=${n}.${i}.${r} <${n}.${+i+1}.0`:`>=${n}.${i}.${r} <${+n+1}.0.0`),a("caret return",s),s})},y=(e,t)=>(a("replaceXRanges",e,t),e.split(/\s+/).map(e=>x(e,t)).join(" ")),x=(e,t)=>{e=e.trim();const n=t.loose?s[u.XRANGELOOSE]:s[u.XRANGE];return e.replace(n,(n,i,r,o,s,u)=>{a("xRange",e,n,i,r,o,s,u);const c=p(r),l=c||p(o),f=l||p(s),d=f;return"="===i&&d&&(i=""),u=t.includePrerelease?"-0":"",c?n=">"===i||"<"===i?"<0.0.0-0":"*":i&&d?(l&&(o=0),s=0,">"===i?(i=">=",l?(r=+r+1,o=0,s=0):(o=+o+1,s=0)):"<="===i&&(i="<",l?r=+r+1:o=+o+1),n=`${i+r}.${o}.${s}${u}`):l?n=`>=${r}.0.0${u} <${+r+1}.0.0${u}`:f&&(n=`>=${r}.${o}.0${u} <${r}.${+o+1}.0${u}`),a("xRange return",n),n})},O=(e,t)=>(a("replaceStars",e,t),e.trim().replace(s[u.STAR],"")),w=(e,t,n,i,r,a,o,s,u,c,l,f,d)=>(t=p(n)?"":p(i)?`>=${n}.0.0`:p(r)?`>=${n}.${i}.0`:`>=${t}`,s=p(u)?"":p(c)?`<${+u+1}.0.0`:p(l)?`<${u}.${+c+1}.0`:f?`<=${u}.${c}.${l}-${f}`:`<=${s}`,`${t} ${s}`.trim()),j=(e,t,n)=>{for(let i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(a(e[n].semver),e[n].semver!==r.ANY&&e[n].semver.prerelease.length>0){const i=e[n].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}},4392:function(e,t,n){const i=n("3034"),r=(e,t,n)=>0===i(e,t,n);e.exports=r},"4ca4":function(e,t,n){const i=n("bbfd"),r=(e,t)=>new i(e,t).patch;e.exports=r},"4d89":function(e,t,n){const i=n("8cb5");e.exports={re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:n("b15c").SEMVER_SPEC_VERSION,SemVer:n("bbfd"),compareIdentifiers:n("2cdf").compareIdentifiers,rcompareIdentifiers:n("2cdf").rcompareIdentifiers,parse:n("a236"),valid:n("acef"),clean:n("d2ef"),inc:n("0159"),diff:n("6b78"),major:n("4e14"),minor:n("c2d5"),patch:n("4ca4"),prerelease:n("8970"),compare:n("3034"),rcompare:n("b805"),compareLoose:n("b00b"),compareBuild:n("1cc6"),sort:n("2a2e"),rsort:n("6fa7"),gt:n("bac4"),lt:n("38fa"),eq:n("4392"),neq:n("f195"),gte:n("a2a3"),lte:n("68d3"),cmp:n("c4be"),coerce:n("0a67"),Comparator:n("6d43"),Range:n("3fce"),satisfies:n("2a86"),toComparators:n("7d63"),maxSatisfying:n("13af"),minSatisfying:n("fd907"),minVersion:n("86d4"),validRange:n("0982"),outside:n("38cb"),gtr:n("8bd6"),ltr:n("9b6c"),intersects:n("5237")}},"4e14":function(e,t,n){const i=n("bbfd"),r=(e,t)=>new i(e,t).major;e.exports=r},5237:function(e,t,n){const i=n("3fce"),r=(e,t,n)=>(e=new i(e,n),t=new i(t,n),e.intersects(t));e.exports=r},6582:function(e,t,n){"use strict";var i=/("(?:[^\\"]|\\.)*")|[:,]/g;e.exports=function(e,t){var n,r,a;return t=t||{},n=JSON.stringify([1],void 0,void 0===t.indent?2:t.indent).slice(2,-3),r=""===n?1/0:void 0===t.maxLength?80:t.maxLength,a=t.replacer,function e(t,o,s){var u,c,l,f,d,h,p,g,m,v,b,y;if(t&&"function"===typeof t.toJSON&&(t=t.toJSON()),b=JSON.stringify(t,a),void 0===b)return b;if(p=r-o.length-s,b.length<=p&&(m=b.replace(i,(function(e,t){return t||e+" "})),m.length<=p))return m;if(null!=a&&(t=JSON.parse(b),a=void 0),"object"===typeof t&&null!==t){if(g=o+n,l=[],c=0,Array.isArray(t))for(v="[",u="]",p=t.length;c<p;c++)l.push(e(t[c],g,c===p-1?0:1)||"null");else for(v="{",u="}",h=Object.keys(t),p=h.length;c<p;c++)f=h[c],d=JSON.stringify(f)+": ",y=e(t[f],g,d.length+(c===p-1?0:1)),void 0!==y&&l.push(d+y);if(l.length>0)return[v,n+l.join(",\n"+g),u].join("\n"+o)}return b}(e,"",0)}},"68d3":function(e,t,n){const i=n("3034"),r=(e,t,n)=>i(e,t,n)<=0;e.exports=r},"694b":function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,r,a;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;0!==r--;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(a=Object.keys(t),i=a.length,i!==Object.keys(n).length)return!1;for(r=i;0!==r--;)if(!Object.prototype.hasOwnProperty.call(n,a[r]))return!1;for(r=i;0!==r--;){var o=a[r];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n}},"6b78":function(e,t,n){const i=n("a236"),r=n("4392"),a=(e,t)=>{if(r(e,t))return null;{const n=i(e),r=i(t),a=n.prerelease.length||r.prerelease.length,o=a?"pre":"",s=a?"prerelease":"";for(const e in n)if(("major"===e||"minor"===e||"patch"===e)&&n[e]!==r[e])return o+e;return s}};e.exports=a},"6d43":function(e,t,n){const i=Symbol("SemVer ANY");class r{static get ANY(){return i}constructor(e,t){if(t&&"object"===typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}u("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===i?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){const t=this.options.loose?a[o.COMPARATORLOOSE]:a[o.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new c(n[2],this.options.loose):this.semver=i}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===i||e===i)return!0;if("string"===typeof e)try{e=new c(e,this.options)}catch(t){return!1}return s(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");if(t&&"object"===typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new l(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new l(this.value,t).test(e.semver);const n=(">="===this.operator||">"===this.operator)&&(">="===e.operator||">"===e.operator),i=("<="===this.operator||"<"===this.operator)&&("<="===e.operator||"<"===e.operator),a=this.semver.version===e.semver.version,o=(">="===this.operator||"<="===this.operator)&&(">="===e.operator||"<="===e.operator),u=s(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=s(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||i||a&&o||u||c}}e.exports=r;const{re:a,t:o}=n("8cb5"),s=n("c4be"),u=n("b802"),c=n("bbfd"),l=n("3fce")},"6fa7":function(e,t,n){const i=n("1cc6"),r=(e,t)=>e.sort((e,n)=>i(n,e,t));e.exports=r},"7ad3":function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"JsonPatchError",(function(){return $})),n.d(i,"deepClone",(function(){return M})),n.d(i,"getValueByPointer",(function(){return z})),n.d(i,"applyOperation",(function(){return T})),n.d(i,"applyPatch",(function(){return L})),n.d(i,"applyReducer",(function(){return P})),n.d(i,"validator",(function(){return B})),n.d(i,"validate",(function(){return I})),n.d(i,"_areEquals",(function(){return U}));var r={};n.r(r),n.d(r,"unobserve",(function(){return Y})),n.d(r,"observe",(function(){return X})),n.d(r,"generate",(function(){return J})),n.d(r,"compare",(function(){return K}));var a={};n.r(a),n.d(a,"aggregate",(function(){return Xi})),n.d(a,"bin",(function(){return Ki})),n.d(a,"collect",(function(){return nr})),n.d(a,"compare",(function(){return rr})),n.d(a,"countpattern",(function(){return or})),n.d(a,"cross",(function(){return cr})),n.d(a,"density",(function(){return vr})),n.d(a,"dotbin",(function(){return _r})),n.d(a,"expression",(function(){return Dr})),n.d(a,"extent",(function(){return Cr})),n.d(a,"facet",(function(){return Nr})),n.d(a,"field",(function(){return zr})),n.d(a,"filter",(function(){return Lr})),n.d(a,"flatten",(function(){return Br})),n.d(a,"fold",(function(){return Ur})),n.d(a,"formula",(function(){return Wr})),n.d(a,"generate",(function(){return Gr})),n.d(a,"impute",(function(){return Jr})),n.d(a,"joinaggregate",(function(){return na})),n.d(a,"kde",(function(){return ra})),n.d(a,"key",(function(){return oa})),n.d(a,"load",(function(){return ua})),n.d(a,"lookup",(function(){return da})),n.d(a,"multiextent",(function(){return pa})),n.d(a,"multivalues",(function(){return ma})),n.d(a,"params",(function(){return ba})),n.d(a,"pivot",(function(){return ya})),n.d(a,"prefacet",(function(){return ka})),n.d(a,"project",(function(){return Aa})),n.d(a,"proxy",(function(){return Sa})),n.d(a,"quantile",(function(){return $a})),n.d(a,"relay",(function(){return Ra})),n.d(a,"sample",(function(){return Ta})),n.d(a,"sequence",(function(){return Pa})),n.d(a,"sieve",(function(){return Ia})),n.d(a,"subflow",(function(){return $r})),n.d(a,"timeunit",(function(){return bs})),n.d(a,"tupleindex",(function(){return Os})),n.d(a,"values",(function(){return js})),n.d(a,"window",(function(){return $s}));var o={};n.r(o),n.d(o,"bound",(function(){return gp})),n.d(o,"identifier",(function(){return yp})),n.d(o,"mark",(function(){return wp})),n.d(o,"overlap",(function(){return _p})),n.d(o,"render",(function(){return Np})),n.d(o,"viewlayout",(function(){return fg}));var s={};n.r(s),n.d(s,"axisticks",(function(){return Kv})),n.d(s,"datajoin",(function(){return tb})),n.d(s,"encode",(function(){return ab})),n.d(s,"legendentries",(function(){return _b})),n.d(s,"linkpath",(function(){return $b})),n.d(s,"pie",(function(){return Vb})),n.d(s,"scale",(function(){return Kb})),n.d(s,"sortitems",(function(){return hy})),n.d(s,"stack",(function(){return yy})),n.d(s,"validTicks",(function(){return Gv}));var u={};n.r(u),n.d(u,"contour",(function(){return Xy})),n.d(u,"geojson",(function(){return tx})),n.d(u,"geopath",(function(){return Ix})),n.d(u,"geopoint",(function(){return Wx})),n.d(u,"geoshape",(function(){return Gx})),n.d(u,"graticule",(function(){return Xx})),n.d(u,"heatmap",(function(){return Kx})),n.d(u,"isocontour",(function(){return Ry})),n.d(u,"kde2d",(function(){return Hy})),n.d(u,"projection",(function(){return aO}));var c={};n.r(c),n.d(c,"force",(function(){return TO}));var l={};n.r(l),n.d(l,"nest",(function(){return VO})),n.d(l,"pack",(function(){return rw})),n.d(l,"partition",(function(){return uw})),n.d(l,"stratify",(function(){return fw})),n.d(l,"tree",(function(){return vw})),n.d(l,"treelinks",(function(){return yw})),n.d(l,"treemap",(function(){return Cw}));var f={};n.r(f),n.d(f,"loess",(function(){return Mw})),n.d(f,"regression",(function(){return Tw}));var d={};n.r(d),n.d(d,"voronoi",(function(){return fj}));var h={};n.r(h),n.d(h,"wordcloud",(function(){return Cj}));var p={};n.r(p),n.d(p,"crossfilter",(function(){return qj})),n.d(p,"resolvefilter",(function(){return Hj}));var g={};n.r(g),n.d(g,"version",(function(){return Vj["a"]})),n.d(g,"accessor",(function(){return ie["f"]})),n.d(g,"accessorName",(function(){return ie["h"]})),n.d(g,"accessorFields",(function(){return ie["g"]})),n.d(g,"id",(function(){return ie["w"]})),n.d(g,"identity",(function(){return ie["x"]})),n.d(g,"zero",(function(){return ie["kb"]})),n.d(g,"one",(function(){return ie["O"]})),n.d(g,"truthy",(function(){return ie["gb"]})),n.d(g,"falsy",(function(){return ie["r"]})),n.d(g,"logger",(function(){return ie["K"]})),n.d(g,"None",(function(){return ie["d"]})),n.d(g,"Error",(function(){return ie["b"]})),n.d(g,"Warn",(function(){return ie["e"]})),n.d(g,"Info",(function(){return ie["c"]})),n.d(g,"Debug",(function(){return ie["a"]})),n.d(g,"mergeConfig",(function(){return ie["N"]})),n.d(g,"writeConfig",(function(){return ie["jb"]})),n.d(g,"panLinear",(function(){return ie["Q"]})),n.d(g,"panLog",(function(){return ie["R"]})),n.d(g,"panPow",(function(){return ie["S"]})),n.d(g,"panSymlog",(function(){return ie["T"]})),n.d(g,"zoomLinear",(function(){return ie["lb"]})),n.d(g,"zoomLog",(function(){return ie["mb"]})),n.d(g,"zoomPow",(function(){return ie["nb"]})),n.d(g,"zoomSymlog",(function(){return ie["ob"]})),n.d(g,"quarter",(function(){return ie["V"]})),n.d(g,"utcquarter",(function(){return ie["hb"]})),n.d(g,"array",(function(){return ie["i"]})),n.d(g,"clampRange",(function(){return ie["j"]})),n.d(g,"compare",(function(){return ie["k"]})),n.d(g,"constant",(function(){return ie["l"]})),n.d(g,"debounce",(function(){return ie["m"]})),n.d(g,"error",(function(){return ie["n"]})),n.d(g,"extend",(function(){return ie["o"]})),n.d(g,"extent",(function(){return ie["p"]})),n.d(g,"extentIndex",(function(){return ie["q"]})),n.d(g,"fastmap",(function(){return ie["s"]})),n.d(g,"field",(function(){return ie["t"]})),n.d(g,"flush",(function(){return ie["u"]})),n.d(g,"hasOwnProperty",(function(){return ie["v"]})),n.d(g,"inherits",(function(){return ie["y"]})),n.d(g,"inrange",(function(){return ie["z"]})),n.d(g,"isArray",(function(){return ie["A"]})),n.d(g,"isBoolean",(function(){return ie["B"]})),n.d(g,"isDate",(function(){return ie["C"]})),n.d(g,"isFunction",(function(){return ie["D"]})),n.d(g,"isNumber",(function(){return ie["E"]})),n.d(g,"isObject",(function(){return ie["F"]})),n.d(g,"isRegExp",(function(){return ie["G"]})),n.d(g,"isString",(function(){return ie["H"]})),n.d(g,"key",(function(){return ie["I"]})),n.d(g,"lerp",(function(){return ie["J"]})),n.d(g,"lruCache",(function(){return ie["L"]})),n.d(g,"merge",(function(){return ie["M"]})),n.d(g,"pad",(function(){return ie["P"]})),n.d(g,"peek",(function(){return ie["U"]})),n.d(g,"repeat",(function(){return ie["W"]})),n.d(g,"span",(function(){return ie["X"]})),n.d(g,"splitAccessPath",(function(){return ie["Y"]})),n.d(g,"stringValue",(function(){return ie["Z"]})),n.d(g,"toBoolean",(function(){return ie["ab"]})),n.d(g,"toDate",(function(){return ie["bb"]})),n.d(g,"toNumber",(function(){return ie["cb"]})),n.d(g,"toString",(function(){return ie["eb"]})),n.d(g,"toSet",(function(){return ie["db"]})),n.d(g,"truncate",(function(){return ie["fb"]})),n.d(g,"visitArray",(function(){return ie["ib"]})),n.d(g,"Dataflow",(function(){return bn})),n.d(g,"EventStream",(function(){return $e})),n.d(g,"Parameters",(function(){return ye})),n.d(g,"Pulse",(function(){return Yt})),n.d(g,"MultiPulse",(function(){return en})),n.d(g,"Operator",(function(){return Ae})),n.d(g,"Transform",(function(){return On})),n.d(g,"changeset",(function(){return ve})),n.d(g,"ingest",(function(){return fe})),n.d(g,"isTuple",(function(){return ue})),n.d(g,"definition",(function(){return kn})),n.d(g,"transform",(function(){return _n})),n.d(g,"transforms",(function(){return jn})),n.d(g,"tupleid",(function(){return ce})),n.d(g,"scale",(function(){return wv})),n.d(g,"scheme",(function(){return Wv})),n.d(g,"interpolate",(function(){return Tv})),n.d(g,"interpolateColors",(function(){return Nv})),n.d(g,"interpolateRange",(function(){return Mv})),n.d(g,"quantizeInterpolator",(function(){return Rv})),n.d(g,"projection",(function(){return Tx})),n.d(g,"View",(function(){return GS})),n.d(g,"expressionFunction",(function(){return UD})),n.d(g,"formatLocale",(function(){return HD["c"]})),n.d(g,"timeFormatLocale",(function(){return GD["d"]})),n.d(g,"parse",(function(){return vR})),n.d(g,"runtime",(function(){return bS})),n.d(g,"runtimeContext",(function(){return wS})),n.d(g,"bandwidthNRD",(function(){return Xn})),n.d(g,"bin",(function(){return Jn})),n.d(g,"bootstrapCI",(function(){return ei})),n.d(g,"dotbin",(function(){return ti})),n.d(g,"quantiles",(function(){return Gn})),n.d(g,"quartiles",(function(){return Vn})),n.d(g,"random",(function(){return Qn})),n.d(g,"setRandom",(function(){return Kn})),n.d(g,"randomLCG",(function(){return ii})),n.d(g,"randomInteger",(function(){return ri})),n.d(g,"randomKDE",(function(){return pi})),n.d(g,"randomLogNormal",(function(){return yi})),n.d(g,"sampleLogNormal",(function(){return gi})),n.d(g,"densityLogNormal",(function(){return mi})),n.d(g,"cumulativeLogNormal",(function(){return vi})),n.d(g,"quantileLogNormal",(function(){return bi})),n.d(g,"randomMixture",(function(){return xi})),n.d(g,"randomNormal",(function(){return hi})),n.d(g,"sampleNormal",(function(){return ui})),n.d(g,"densityNormal",(function(){return ci})),n.d(g,"cumulativeNormal",(function(){return li})),n.d(g,"quantileNormal",(function(){return fi})),n.d(g,"randomUniform",(function(){return _i})),n.d(g,"sampleUniform",(function(){return Oi})),n.d(g,"densityUniform",(function(){return wi})),n.d(g,"cumulativeUniform",(function(){return ji})),n.d(g,"quantileUniform",(function(){return ki})),n.d(g,"regressionLinear",(function(){return Ci})),n.d(g,"regressionLog",(function(){return Fi})),n.d(g,"regressionExp",(function(){return $i})),n.d(g,"regressionPow",(function(){return Mi})),n.d(g,"regressionQuad",(function(){return Ni})),n.d(g,"regressionPoly",(function(){return Ri})),n.d(g,"regressionLoess",(function(){return Ii})),n.d(g,"sampleCurve",(function(){return Gi})),n.d(g,"timeUnits",(function(){return eo})),n.d(g,"timeFloor",(function(){return ho})),n.d(g,"utcFloor",(function(){return bo})),n.d(g,"timeUnitSpecifier",(function(){return Uo})),n.d(g,"timeFormat",(function(){return qo})),n.d(g,"utcFormat",(function(){return Wo})),n.d(g,"timeInterval",(function(){return Mo})),n.d(g,"timeOffset",(function(){return zo})),n.d(g,"timeSequence",(function(){return Po})),n.d(g,"utcInterval",(function(){return No})),n.d(g,"utcOffset",(function(){return To})),n.d(g,"utcSequence",(function(){return Bo})),n.d(g,"timeBin",(function(){return vs})),n.d(g,"loader",(function(){return _t})),n.d(g,"read",(function(){return jt})),n.d(g,"inferType",(function(){return Xe})),n.d(g,"inferTypes",(function(){return Je})),n.d(g,"typeParsers",(function(){return Ve})),n.d(g,"format",(function(){return yt})),n.d(g,"formats",(function(){return xt})),n.d(g,"responseType",(function(){return Ot})),n.d(g,"Bounds",(function(){return xu})),n.d(g,"Gradient",(function(){return Eu})),n.d(g,"GroupItem",(function(){return Su})),n.d(g,"ResourceLoader",(function(){return $u})),n.d(g,"Item",(function(){return Du})),n.d(g,"Scenegraph",(function(){return Id})),n.d(g,"Handler",(function(){return Jd})),n.d(g,"Renderer",(function(){return eh})),n.d(g,"CanvasHandler",(function(){return oh})),n.d(g,"CanvasRenderer",(function(){return hh})),n.d(g,"SVGHandler",(function(){return xh})),n.d(g,"SVGRenderer",(function(){return Sh})),n.d(g,"SVGStringRenderer",(function(){return Wh})),n.d(g,"RenderType",(function(){return tp})),n.d(g,"renderModule",(function(){return ip})),n.d(g,"intersect",(function(){return rp})),n.d(g,"Marks",(function(){return Md})),n.d(g,"boundClip",(function(){return lp})),n.d(g,"boundContext",(function(){return jl})),n.d(g,"boundStroke",(function(){return vl})),n.d(g,"boundItem",(function(){return Nd})),n.d(g,"boundMark",(function(){return zd})),n.d(g,"pathCurves",(function(){return Qu})),n.d(g,"pathSymbols",(function(){return bc})),n.d(g,"pathRectangle",(function(){return Sc})),n.d(g,"pathTrail",(function(){return Cc})),n.d(g,"pathParse",(function(){return tc})),n.d(g,"pathRender",(function(){return pc})),n.d(g,"point",(function(){return Yd})),n.d(g,"domCreate",(function(){return Wd})),n.d(g,"domFind",(function(){return Hd})),n.d(g,"domChild",(function(){return Gd})),n.d(g,"domClear",(function(){return Vd})),n.d(g,"openTag",(function(){return jh})),n.d(g,"closeTag",(function(){return kh})),n.d(g,"font",(function(){return Od})),n.d(g,"fontFamily",(function(){return xd})),n.d(g,"fontSize",(function(){return dd})),n.d(g,"lineHeight",(function(){return hd})),n.d(g,"multiLineOffset",(function(){return md})),n.d(g,"textMetrics",(function(){return od})),n.d(g,"resetSVGClipId",(function(){return vf})),n.d(g,"sceneEqual",(function(){return dp})),n.d(g,"pathEqual",(function(){return hp})),n.d(g,"sceneToJSON",(function(){return Ld})),n.d(g,"sceneFromJSON",(function(){return Pd})),n.d(g,"intersectPath",(function(){return Nl})),n.d(g,"intersectPoint",(function(){return Rl})),n.d(g,"intersectRule",(function(){return Tl})),n.d(g,"intersectBoxLine",(function(){return Ll})),n.d(g,"sceneZOrder",(function(){return Gl})),n.d(g,"sceneVisit",(function(){return Vl})),n.d(g,"scenePickVisit",(function(){return Zl}));var m={};n.r(m),n.d(m,"invalidSpec",(function(){return WL})),n.d(m,"FIT_NON_SINGLE",(function(){return HL})),n.d(m,"containerSizeNonSingle",(function(){return GL})),n.d(m,"containerSizeNotCompatibleWithAutosize",(function(){return VL})),n.d(m,"droppingFit",(function(){return ZL})),n.d(m,"cannotProjectOnChannelWithoutField",(function(){return YL})),n.d(m,"cannotProjectAggregate",(function(){return XL})),n.d(m,"nearestNotSupportForContinuous",(function(){return JL})),n.d(m,"selectionNotSupported",(function(){return QL})),n.d(m,"selectionNotFound",(function(){return KL})),n.d(m,"SCALE_BINDINGS_CONTINUOUS",(function(){return eP})),n.d(m,"LEGEND_BINDINGS_PROJECT_LENGTH",(function(){return tP})),n.d(m,"noSameUnitLookup",(function(){return nP})),n.d(m,"noSuchRepeatedValue",(function(){return iP})),n.d(m,"columnsNotSupportByRowCol",(function(){return rP})),n.d(m,"CONCAT_CANNOT_SHARE_AXIS",(function(){return aP})),n.d(m,"REPEAT_CANNOT_SHARE_AXIS",(function(){return oP})),n.d(m,"unrecognizedParse",(function(){return sP})),n.d(m,"differentParse",(function(){return uP})),n.d(m,"invalidTransformIgnored",(function(){return cP})),n.d(m,"NO_FIELDS_NEEDS_AS",(function(){return lP})),n.d(m,"encodingOverridden",(function(){return fP})),n.d(m,"projectionOverridden",(function(){return dP})),n.d(m,"primitiveChannelDef",(function(){return hP})),n.d(m,"invalidFieldType",(function(){return pP})),n.d(m,"nonZeroScaleUsedWithLengthMark",(function(){return gP})),n.d(m,"invalidFieldTypeForCountAggregate",(function(){return mP})),n.d(m,"invalidAggregate",(function(){return vP})),n.d(m,"missingFieldType",(function(){return bP})),n.d(m,"droppingColor",(function(){return yP})),n.d(m,"emptyFieldDef",(function(){return xP})),n.d(m,"latLongDeprecated",(function(){return OP})),n.d(m,"LINE_WITH_VARYING_SIZE",(function(){return wP})),n.d(m,"incompatibleChannel",(function(){return jP})),n.d(m,"invalidEncodingChannel",(function(){return kP})),n.d(m,"facetChannelShouldBeDiscrete",(function(){return _P})),n.d(m,"facetChannelDropped",(function(){return AP})),n.d(m,"discreteChannelCannotEncode",(function(){return EP})),n.d(m,"lineWithRange",(function(){return DP})),n.d(m,"orientOverridden",(function(){return SP})),n.d(m,"CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN",(function(){return CP})),n.d(m,"RANGE_STEP_DEPRECATED",(function(){return FP})),n.d(m,"cannotUseScalePropertyWithNonColor",(function(){return $P})),n.d(m,"unaggregateDomainHasNoEffectForRawField",(function(){return MP})),n.d(m,"unaggregateDomainWithNonSharedDomainOp",(function(){return NP})),n.d(m,"unaggregatedDomainWithLogScale",(function(){return RP})),n.d(m,"cannotApplySizeToNonOrientedMark",(function(){return zP})),n.d(m,"scaleTypeNotWorkWithChannel",(function(){return TP})),n.d(m,"scaleTypeNotWorkWithFieldDef",(function(){return LP})),n.d(m,"scalePropertyNotWorkWithScaleType",(function(){return PP})),n.d(m,"scaleTypeNotWorkWithMark",(function(){return BP})),n.d(m,"stepDropped",(function(){return IP})),n.d(m,"mergeConflictingProperty",(function(){return UP})),n.d(m,"mergeConflictingDomainProperty",(function(){return qP})),n.d(m,"independentScaleMeansIndependentGuide",(function(){return WP})),n.d(m,"domainSortDropped",(function(){return HP})),n.d(m,"UNABLE_TO_MERGE_DOMAINS",(function(){return GP})),n.d(m,"MORE_THAN_ONE_SORT",(function(){return VP})),n.d(m,"INVALID_CHANNEL_FOR_AXIS",(function(){return ZP})),n.d(m,"cannotStackRangedMark",(function(){return YP})),n.d(m,"cannotStackNonLinearScale",(function(){return XP})),n.d(m,"stackNonSummativeAggregate",(function(){return JP})),n.d(m,"invalidTimeUnit",(function(){return QP})),n.d(m,"dayReplacedWithDate",(function(){return KP})),n.d(m,"droppedDay",(function(){return eB})),n.d(m,"errorBarCenterAndExtentAreNotNeeded",(function(){return tB})),n.d(m,"errorBarCenterIsUsedWithWrongExtent",(function(){return nB})),n.d(m,"errorBarContinuousAxisHasCustomizedAggregate",(function(){return iB})),n.d(m,"errorBarCenterIsNotNeeded",(function(){return rB})),n.d(m,"errorBand1DNotSupport",(function(){return aB})),n.d(m,"channelRequiredForBinned",(function(){return oB})),n.d(m,"domainRequiredForThresholdScale",(function(){return sB}));var v={};n.r(v),n.d(v,"symbols",(function(){return NY})),n.d(v,"gradient",(function(){return RY})),n.d(v,"labels",(function(){return zY})),n.d(v,"entries",(function(){return TY})),n.d(v,"getFirstConditionValue",(function(){return PY}));var b={};n.r(b),n.d(b,"compile",(function(){return a0})),n.d(b,"extractTransforms",(function(){return l0})),n.d(b,"normalize",(function(){return SH})),n.d(b,"version",(function(){return f0}));var y={};n.r(y),n.d(y,"dark",(function(){return b0})),n.d(y,"excel",(function(){return O0})),n.d(y,"fivethirtyeight",(function(){return S0})),n.d(y,"ggplot2",(function(){return $0})),n.d(y,"latimes",(function(){return W0})),n.d(y,"quartz",(function(){return Z0})),n.d(y,"vox",(function(){return J0})),n.d(y,"urbaninstitute",(function(){return u1})),n.d(y,"googlecharts",(function(){return h1})),n.d(y,"version",(function(){return p1}));function x(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function o(e){try{u(i.next(e))}catch(t){a(t)}}function s(e){try{u(i["throw"](e))}catch(t){a(t)}}function u(e){e.done?n(e.value):r(e.value).then(o,s)}u((i=i.apply(e,t||[])).next())}))}
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var O=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),w=Object.prototype.hasOwnProperty;function j(e,t){return w.call(e,t)}function k(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var i in e)j(e,i)&&t.push(i);return t}function _(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function A(e){var t,n=0,i=e.length;while(n<i){if(t=e.charCodeAt(n),!(t>=48&&t<=57))return!1;n++}return!0}function E(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function D(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function S(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(S(e[t]))return!0}else if("object"===typeof e){var i=k(e),r=i.length;for(t=0;t<r;t++)if(S(e[i[t]]))return!0}return!1}function C(e,t){var n=[e];for(var i in t){var r="object"===typeof t[i]?JSON.stringify(t[i],null,2):t[i];"undefined"!==typeof r&&n.push(i+": "+r)}return n.join("\n")}var F=function(e){function t(t,n,i,r,a){var o=this.constructor,s=e.call(this,C(t,{name:n,index:i,operation:r,tree:a}))||this;return s.name=n,s.index=i,s.operation=r,s.tree=a,Object.setPrototypeOf(s,o.prototype),s.message=C(t,{name:n,index:i,operation:r,tree:a}),s}return O(t,e),t}(Error),$=F,M=_,N={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=z(n,this.path);i&&(i=_(i));var r=T(n,{op:"remove",path:this.from}).removed;return T(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=z(n,this.from);return T(n,{op:"add",path:this.path,value:_(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:U(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},R={add:function(e,t,n){return A(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:N.move,copy:N.copy,test:N.test,_get:N._get};function z(e,t){if(""==t)return e;var n={op:"_get",path:t};return T(e,n),n.value}function T(e,t,n,i,r,a){if(void 0===n&&(n=!1),void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):B(t,0)),""===t.path){var o={newDocument:e};if("add"===t.op)return o.newDocument=t.value,o;if("replace"===t.op)return o.newDocument=t.value,o.removed=e,o;if("move"===t.op||"copy"===t.op)return o.newDocument=z(e,t.from),"move"===t.op&&(o.removed=e),o;if("test"===t.op){if(o.test=U(e,t.value),!1===o.test)throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}if("remove"===t.op)return o.removed=e,o.newDocument=null,o;if("_get"===t.op)return t.value=e,o;if(n)throw new $("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}i||(e=_(e));var s=t.path||"",u=s.split("/"),c=e,l=1,f=u.length,d=void 0,h=void 0,p=void 0;p="function"==typeof n?n:B;while(1){if(h=u[l],r&&"__proto__"==h)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===d&&(void 0===c[h]?d=u.slice(0,l).join("/"):l==f-1&&(d=t.path),void 0!==d&&p(t,0,e,d)),l++,Array.isArray(c)){if("-"===h)h=c.length;else{if(n&&!A(h))throw new $("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);A(h)&&(h=~~h)}if(l>=f){if(n&&"add"===t.op&&h>c.length)throw new $("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);o=R[t.op].call(t,c,h,e);if(!1===o.test)throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(h&&-1!=h.indexOf("~")&&(h=D(h)),l>=f){o=N[t.op].call(t,c,h,e);if(!1===o.test)throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}c=c[h]}}function L(e,t,n,i,r){if(void 0===i&&(i=!0),void 0===r&&(r=!0),n&&!Array.isArray(t))throw new $("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=_(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=T(e,t[o],n,!0,r,o),e=a[o].newDocument;return a.newDocument=e,a}function P(e,t,n){var i=T(e,t);if(!1===i.test)throw new $("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function B(e,t,n,i){if("object"!==typeof e||null===e||Array.isArray(e))throw new $("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!N[e.op])throw new $("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!==typeof e.path)throw new $("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new $('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!==typeof e.from)throw new $("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new $("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&S(e.value))throw new $("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var r=e.path.split("/").length,a=i.split("/").length;if(r!==a+1&&r!==a)throw new $("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==i)throw new $("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var o={op:"_get",path:e.from,value:void 0},s=I([o],n);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new $("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function I(e,t,n){try{if(!Array.isArray(e))throw new $("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)L(_(t),_(e),n||!0);else{n=n||B;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof $)return r;throw r}}function U(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,i,r,a=Array.isArray(e),o=Array.isArray(t);if(a&&o){if(i=e.length,i!=t.length)return!1;for(n=i;0!==n--;)if(!U(e[n],t[n]))return!1;return!0}if(a!=o)return!1;var s=Object.keys(e);if(i=s.length,i!==Object.keys(t).length)return!1;for(n=i;0!==n--;)if(!t.hasOwnProperty(s[n]))return!1;for(n=i;0!==n--;)if(r=s[n],!U(e[r],t[r]))return!1;return!0}return e!==e&&t!==t}
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var q=new WeakMap,W=function(){function e(e){this.observers=new Map,this.obj=e}return e}(),H=function(){function e(e,t){this.callback=e,this.observer=t}return e}();function G(e){return q.get(e)}function V(e,t){return e.observers.get(t)}function Z(e,t){e.observers.delete(t.callback)}function Y(e,t){t.unobserve()}function X(e,t){var n,i=[],r=G(e);if(r){var a=V(r,t);n=a&&a.observer}else r=new W(e),q.set(e,r);if(n)return n;if(n={},r.value=_(e),t){n.callback=t,n.next=null;var o=function(){J(n)},s=function(){clearTimeout(n.next),n.next=setTimeout(o)};"undefined"!==typeof window&&(window.addEventListener("mouseup",s),window.addEventListener("keyup",s),window.addEventListener("mousedown",s),window.addEventListener("keydown",s),window.addEventListener("change",s))}return n.patches=i,n.object=e,n.unobserve=function(){J(n),clearTimeout(n.next),Z(r,n),"undefined"!==typeof window&&(window.removeEventListener("mouseup",s),window.removeEventListener("keyup",s),window.removeEventListener("mousedown",s),window.removeEventListener("keydown",s),window.removeEventListener("change",s))},r.observers.set(t,new H(t,n)),n}function J(e,t){void 0===t&&(t=!1);var n=q.get(e.object);Q(n.value,e.object,e.patches,"",t),e.patches.length&&L(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function Q(e,t,n,i,r){if(t!==e){"function"===typeof t.toJSON&&(t=t.toJSON());for(var a=k(t),o=k(e),s=!1,u=o.length-1;u>=0;u--){var c=o[u],l=e[c];if(!j(t,c)||void 0===t[c]&&void 0!==l&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+E(c),value:_(l)}),n.push({op:"remove",path:i+"/"+E(c)}),s=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}),!0);else{var f=t[c];"object"==typeof l&&null!=l&&"object"==typeof f&&null!=f?Q(l,f,n,i+"/"+E(c),r):l!==f&&(!0,r&&n.push({op:"test",path:i+"/"+E(c),value:_(l)}),n.push({op:"replace",path:i+"/"+E(c),value:_(f)}))}}if(s||a.length!=o.length)for(u=0;u<a.length;u++){c=a[u];j(e,c)||void 0===t[c]||n.push({op:"add",path:i+"/"+E(c),value:_(t[c])})}}}function K(e,t,n){void 0===n&&(n=!1);var i=[];return Q(e,t,i,"",n),i}Object.assign({},i,r,{JsonPatchError:F,deepClone:_,escapePathComponent:E,unescapePathComponent:D});var ee=n("6582"),te=n.n(ee),ne=n("4d89"),ie=n("276f");function re(e){var t=e||ie["x"],n=[],i={};return n.add=function(e){var r=t(e);return i[r]||(i[r]=1,n.push(e)),n},n.remove=function(e){var r,a=t(e);return i[a]&&(i[a]=0,(r=n.indexOf(e))>=0&&n.splice(r,1)),n},n}var ae=async function(e,t){try{await t(e)}catch(n){e.error(n)}},oe=Symbol("vega_id"),se=1;function ue(e){return!(!e||!ce(e))}function ce(e){return e[oe]}function le(e,t){return e[oe]=t,e}function fe(e){var t=e===Object(e)?e:{data:e};return ce(t)?t:le(t,se++)}function de(e){return he(e,fe({}))}function he(e,t){for(var n in e)t[n]=e[n];return t}function pe(e,t){return le(t,ce(e))}function ge(e,t){return e?t?(n,i)=>e(n,i)||ce(t(n))-ce(t(i)):(t,n)=>e(t,n)||ce(t)-ce(n):null}function me(e){return e&&e.constructor===ve}function ve(){var e=[],t=[],n=[],i=[],r=[],a=!1;return{constructor:ve,insert:function(t){for(var n=Object(ie["i"])(t),i=0,r=n.length;i<r;++i)e.push(n[i]);return this},remove:function(e){for(var n=Object(ie["D"])(e)?i:t,r=Object(ie["i"])(e),a=0,o=r.length;a<o;++a)n.push(r[a]);return this},modify:function(e,t,i){var a={field:t,value:Object(ie["l"])(i)};return Object(ie["D"])(e)?(a.filter=e,r.push(a)):(a.tuple=e,n.push(a)),this},encode:function(e,t){return Object(ie["D"])(e)?r.push({filter:e,field:t}):n.push({tuple:e,field:t}),this},reflow:function(){return a=!0,this},pulse:function(o,s){var u,c,l,f,d,h,p={},g={};for(u=0,c=s.length;u<c;++u)p[ce(s[u])]=1;for(u=0,c=t.length;u<c;++u)d=t[u],p[ce(d)]=-1;for(u=0,c=i.length;u<c;++u)f=i[u],s.forEach((function(e){f(e)&&(p[ce(e)]=-1)}));for(u=0,c=e.length;u<c;++u)d=e[u],h=ce(d),p[h]?p[h]=1:o.add.push(fe(e[u]));for(u=0,c=s.length;u<c;++u)d=s[u],p[ce(d)]<0&&o.rem.push(d);function m(e,t,n){n?e[t]=n(e):o.encode=t,a||(g[ce(e)]=e)}for(u=0,c=n.length;u<c;++u)l=n[u],d=l.tuple,f=l.field,h=p[ce(d)],h>0&&(m(d,f,l.value),o.modifies(f));for(u=0,c=r.length;u<c;++u)l=r[u],f=l.filter,s.forEach((function(e){f(e)&&p[ce(e)]>0&&m(e,l.field,l.value)})),o.modifies(l.field);if(a)o.mod=t.length||i.length?s.filter((function(e){return p[ce(e)]>0})):s.slice();else for(h in g)o.mod.push(g[h]);return o}}}var be="_:mod:_";function ye(){Object.defineProperty(this,be,{writable:!0,value:{}})}var xe=ye.prototype;xe.set=function(e,t,n,i){var r=this,a=r[e],o=r[be];return null!=t&&t>=0?(a[t]!==n||i)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||i)&&(r[e]=n,o[e]=Object(ie["A"])(n)?1+n.length:-1),r},xe.modified=function(e,t){var n,i=this[be];if(!arguments.length){for(n in i)if(i[n])return!0;return!1}if(Object(ie["A"])(e)){for(n=0;n<e.length;++n)if(i[e[n]])return!0;return!1}return null!=t&&t>=0?t+1<i[e]||!!i[t+":"+e]:!!i[e]},xe.clear=function(){return this[be]={},this};var Oe=0,we="pulse",je=new ye,ke=1,_e=2;function Ae(e,t,n,i){this.id=++Oe,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}var Ee=Ae.prototype;function De(e){return function(t){var n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Ee.targets=function(){return this._targets||(this._targets=re(ie["w"]))},Ee.set=function(e){return this.value!==e?(this.value=e,1):0},Ee.skip=De(ke),Ee.modified=De(_e),Ee.parameters=function(e,t,n){t=!1!==t;var i,r,a,o,s=this,u=s._argval=s._argval||new ye,c=s._argops=s._argops||[],l=[];function f(e,n,i){i instanceof Ae?(i!==s&&(t&&i.targets().add(s),l.push(i)),c.push({op:i,name:e,index:n})):u.set(e,n,i)}for(i in e)if(r=e[i],i===we)Object(ie["i"])(r).forEach((function(e){e instanceof Ae?e!==s&&(e.targets().add(s),l.push(e)):Object(ie["n"])("Pulse parameters must be operator instances.")})),s.source=r;else if(Object(ie["A"])(r))for(u.set(i,-1,Array(a=r.length)),o=0;o<a;++o)f(i,o,r[o]);else f(i,-1,r);return this.marshall().clear(),n&&(c.initonly=!0),l},Ee.marshall=function(e){var t,n,i,r,a,o=this._argval||je,s=this._argops;if(s){for(n=0,i=s.length;n<i;++n)t=s[n],r=t.op,a=r.modified()&&r.stamp===e,o.set(t.name,t.index,r.value,a);if(s.initonly){for(n=0;n<i;++n)t=s[n],t.op.targets().remove(this);this._argops=null,this._update=null}}return o},Ee.evaluate=function(e){var t=this._update;if(t){var n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},Ee.run=function(e){return e.stamp<this.stamp?e.StopPropagation:(this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e);var t};var Se=function(e,t,n,i){var r,a=1;return e instanceof Ae?r=e:e&&e.prototype instanceof Ae?r=new e:Object(ie["D"])(e)?r=new Ae(null,e):(a=0,r=new Ae(e,t)),this.rank(r),a&&(i=n,n=t),n&&this.connect(r,r.parameters(n,i)),this.touch(r),r},Ce=function(e,t){var n,i,r=e.rank;for(n=0,i=t.length;n<i;++n)if(r<t[n].rank)return void this.rerank(e)},Fe=0;function $e(e,t,n){this.id=++Fe,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Me(e,t,n){return new $e(e,t,n)}var Ne=$e.prototype;Ne._filter=ie["gb"],Ne._apply=ie["x"],Ne.targets=function(){return this._targets||(this._targets=re(ie["w"]))},Ne.consume=function(e){return arguments.length?(this._consume=!!e,this):!!this._consume},Ne.receive=function(e){if(this._filter(e)){for(var t=this.value=this._apply(e),n=this._targets,i=n?n.length:0,r=0;r<i;++r)n[r].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},Ne.filter=function(e){var t=Me(e);return this.targets().add(t),t},Ne.apply=function(e){var t=Me(null,e);return this.targets().add(t),t},Ne.merge=function(){var e=Me();this.targets().add(e);for(var t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},Ne.throttle=function(e){var t=-1;return this.filter((function(){var n=Date.now();return n-t>e?(t=n,1):0}))},Ne.debounce=function(e){var t=Me();return this.targets().add(Me(null,null,Object(ie["m"])(e,(function(e){var n=e.dataflow;t.receive(e),n&&n.run&&n.run()})))),t},Ne.between=function(e,t){var n=!1;return e.targets().add(Me(null,null,(function(){n=!0}))),t.targets().add(Me(null,null,(function(){n=!1}))),this.filter((function(){return n}))};var Re=function(e,t,n,i){var r,a=this,o=Me(n,i),s=function(e){e.dataflow=a;try{o.receive(e)}catch(t){a.error(t)}finally{a.run()}};r="string"===typeof e&&"undefined"!==typeof document?document.querySelectorAll(e):Object(ie["i"])(e);for(var u=0,c=r.length;u<c;++u)r[u].addEventListener(t,s);return o};const ze=/^([A-Za-z]+:)?\/\//,Te=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Le=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,Pe="file://";var Be=function(e,t){return function(n){return{options:n||{},sanitize:Ue,load:Ie,fileAccess:!!t,file:qe(t),http:He(e)}}};async function Ie(e,t){const n=await this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)}async function Ue(e,t){t=Object(ie["o"])({},this.options,t);const n=this.fileAccess,i={href:null};let r,a,o;const s=Te.test(e.replace(Le,""));null!=e&&"string"===typeof e&&s||Object(ie["n"])("Sanitize failure, invalid URI: "+Object(ie["Z"])(e));const u=ze.test(e);return(o=t.baseURL)&&!u&&(e.startsWith("/")||"/"===o[o.length-1]||(e="/"+e),e=o+e),a=(r=e.startsWith(Pe))||"file"===t.mode||"http"!==t.mode&&!u&&n,r?e=e.slice(Pe.length):e.startsWith("//")&&("file"===t.defaultProtocol?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!a}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),i}function qe(e){return e?function(t){return new Promise((function(n,i){e.readFile(t,(function(e,t){e?i(e):n(t)}))}))}:We}async function We(){Object(ie["n"])("No file system access.")}function He(e){return e?async function(t,n){const i=Object(ie["o"])({},this.options.http,n),r=n&&n.response,a=await e(t,i);return a.ok?Object(ie["D"])(a[r])?a[r]():a.text():Object(ie["n"])(a.status+""+a.statusText)}:Ge}async function Ge(){Object(ie["n"])("No HTTP fetch method available.")}var Ve={boolean:ie["ab"],integer:ie["cb"],number:ie["cb"],date:ie["bb"],string:ie["eb"],unknown:ie["x"]},Ze=[Ke,nt,tt,et],Ye=["boolean","integer","number","date"];function Xe(e,t){if(!e||!e.length)return"unknown";var n,i,r,a=0,o=e.length,s=Ze.length,u=Ze.map((function(e,t){return t+1}));for(i=0,o=e.length;i<o;++i)for(n=t?e[i][t]:e[i],r=0;r<s;++r)if(u[r]&&Qe(n)&&!Ze[r](n)&&(u[r]=0,++a,a===Ze.length))return"string";return a=u.reduce((function(e,t){return 0===e?t:e}),0)-1,Ye[a]}function Je(e,t){return t.reduce((function(t,n){return t[n]=Xe(e,n),t}),{})}function Qe(e){return null!=e&&e===e}function Ke(e){return"true"===e||"false"===e||!0===e||!1===e}function et(e){return!Number.isNaN(Date.parse(e))}function tt(e){return!Number.isNaN(+e)&&!(e instanceof Date)}function nt(e){return tt(e)&&Number.isInteger(+e)}var it=n("3512");function rt(e){const t=function(t,n){const i={delimiter:e};return at(t,n?Object(ie["o"])(n,i):i)};return t.responseType="text",t}function at(e,t){return t.header&&(e=t.header.map(ie["Z"]).join(t.delimiter)+"\n"+e),Object(it["a"])(t.delimiter).parse(e+"")}at.responseType="text";var ot=n("9b0d"),st=function(e){return e},ut=function(e){if(null==e)return st;var t,n,i=e.scale[0],r=e.scale[1],a=e.translate[0],o=e.translate[1];return function(e,s){s||(t=n=0);var u=2,c=e.length,l=new Array(c);l[0]=(t+=e[0])*i+a,l[1]=(n+=e[1])*r+o;while(u<c)l[u]=e[u],++u;return l}},ct=function(e,t){var n,i=e.length,r=i-t;while(r<--i)n=e[r],e[r++]=e[i],e[i]=n},lt=function(e,t){return"string"===typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return ft(e,t)}))}:ft(e,t)};function ft(e,t){var n=t.id,i=t.bbox,r=null==t.properties?{}:t.properties,a=dt(e,t);return null==n&&null==i?{type:"Feature",properties:r,geometry:a}:null==i?{type:"Feature",id:n,properties:r,geometry:a}:{type:"Feature",id:n,bbox:i,properties:r,geometry:a}}function dt(e,t){var n=ut(e.transform),i=e.arcs;function r(e,t){t.length&&t.pop();for(var r=i[e<0?~e:e],a=0,o=r.length;a<o;++a)t.push(n(r[a],a));e<0&&ct(t,o)}function a(e){return n(e)}function o(e){for(var t=[],n=0,i=e.length;n<i;++n)r(e[n],t);return t.length<2&&t.push(t[0]),t}function s(e){var t=o(e);while(t.length<4)t.push(t[0]);return t}function u(e){return e.map(s)}function c(e){var t,n=e.type;switch(n){case"GeometryCollection":return{type:n,geometries:e.geometries.map(c)};case"Point":t=a(e.coordinates);break;case"MultiPoint":t=e.coordinates.map(a);break;case"LineString":t=o(e.arcs);break;case"MultiLineString":t=e.arcs.map(o);break;case"Polygon":t=u(e.arcs);break;case"MultiPolygon":t=e.arcs.map(u);break;default:return null}return{type:n,coordinates:t}}return c(t)}var ht=function(e,t){var n={},i={},r={},a=[],o=-1;function s(t){var n,i=e.arcs[t<0?~t:t],r=i[0];return e.transform?(n=[0,0],i.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=i[i.length-1],t<0?[n,r]:[r,n]}function u(e,t){for(var i in e){var r=e[i];delete t[r.start],delete r.start,delete r.end,r.forEach((function(e){n[e<0?~e:e]=1})),a.push(r)}}return t.forEach((function(n,i){var r,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(r=t[++o],t[o]=n,t[i]=r)})),t.forEach((function(e){var t,n,a=s(e),o=a[0],u=a[1];if(t=r[o])if(delete r[t.end],t.push(e),t.end=u,n=i[u]){delete i[n.start];var c=n===t?t:t.concat(n);i[c.start=t.start]=r[c.end=n.end]=c}else i[t.start]=r[t.end]=t;else if(t=i[u])if(delete i[t.start],t.unshift(e),t.start=o,n=r[o]){delete r[n.end];var l=n===t?t:n.concat(t);i[l.start=n.start]=r[l.end=t.end]=l}else i[t.start]=r[t.end]=t;else t=[e],i[t.start=o]=r[t.end=u]=t})),u(r,i),u(i,r),t.forEach((function(e){n[e<0?~e:e]||a.push([e])})),a},pt=function(e){return dt(e,gt.apply(this,arguments))};function gt(e,t,n){var i,r,a;if(arguments.length>1)i=mt(e,t,n);else for(r=0,i=new Array(a=e.arcs.length);r<a;++r)i[r]=r;return{type:"MultiLineString",arcs:ht(e,i)}}function mt(e,t,n){var i,r=[],a=[];function o(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:i})}function s(e){e.forEach(o)}function u(e){e.forEach(s)}function c(e){e.forEach(u)}function l(e){switch(i=e,e.type){case"GeometryCollection":e.geometries.forEach(l);break;case"LineString":s(e.arcs);break;case"MultiLineString":case"Polygon":u(e.arcs);break;case"MultiPolygon":c(e.arcs);break}}return l(t),a.forEach(null==n?function(e){r.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&r.push(e[0].i)}),r}const vt={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function bt(e,t){let n,i,r,a;return e=Object(ot["a"])(e,t),t&&t.feature?(n=lt,r=t.feature):t&&t.mesh?(n=pt,r=t.mesh,a=vt[t.filter]):Object(ie["n"])("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,a):Object(ie["n"])("Invalid TopoJSON object: "+r),i&&i.features||[i]}bt.responseType="json";const yt={dsv:at,csv:rt(","),tsv:rt("\t"),json:ot["a"],topojson:bt};function xt(e,t){return arguments.length>1?(yt[e]=t,this):Object(ie["v"])(yt,e)?yt[e]:null}function Ot(e){const t=xt(e);return t&&t.responseType||"text"}var wt=n("4c23"),jt=function(e,t,n){t=t||{};const i=xt(t.type||"json");return i||Object(ie["n"])("Unknown data format type: "+t.type),e=i(e,t),t.parse&&kt(e,t.parse,n),Object(ie["v"])(e,"columns")&&delete e.columns,e};function kt(e,t,n){if(e.length){n=n||wt["c"];var i,r,a,o,s,u,c,l=e.columns||Object.keys(e[0]);for("auto"===t&&(t=Je(e,l)),l=Object.keys(t),i=l.map((function(e){var i,r,a=t[e];if(a&&(0===a.indexOf("date:")||0===a.indexOf("utc:")))return i=a.split(/:(.+)?/,2),r=i[1],("'"===r[0]&&"'"===r[r.length-1]||'"'===r[0]&&'"'===r[r.length-1])&&(r=r.slice(1,-1)),"utc"===i[0]?Object(wt["e"])(r):n(r);if(!Ve[a])throw Error("Illegal format pattern: "+e+":"+a);return Ve[a]})),o=0,u=e.length,c=l.length;o<u;++o)for(r=e[o],s=0;s<c;++s)a=l[s],r[a]=i[s](r[a])}}var _t=Be("undefined"!==typeof fetch&&fetch,null);const At=jt;function Et(e,t,n){return this.pulse(e,this.changeset().insert(At(t,n)))}async function Dt(e,t){const n=this;let i,r=0;try{i=await n.loader().load(e,{context:"dataflow",response:Ot(t&&t.type)});try{i=At(i,t)}catch(a){r=-2,n.warn("Data ingestion failed",e,a)}}catch(a){r=-1,n.warn("Loading failed",e,a)}return{data:i,status:r}}async function St(e,t,n){const i=this,r=i._pending||Ct(i);r.requests+=1;const a=await i.request(t,n);return i.pulse(e,i.changeset().remove(ie["gb"]).insert(a.data||[])),r.done(),a}function Ct(e){var t,n=new Promise((function(e){t=e}));return n.requests=0,n.done=function(){0===--n.requests&&(e._pending=null,t(e))},e._pending=n}var Ft={skip:!0},$t=function(e,t,n,i,r){var a=e instanceof Ae?Nt:Mt;return a(this,e,t,n,i,r),this};function Mt(e,t,n,i,r,a){var o,s,u=Object(ie["o"])({},a,Ft);Object(ie["D"])(n)||(n=Object(ie["l"])(n)),void 0===i?o=t=>e.touch(n(t)):Object(ie["D"])(i)?(s=new Ae(null,i,r,!1),o=t=>{s.evaluate(t);const i=n(t),r=s.value;me(r)?e.pulse(i,r,a):e.update(i,r,u)}):o=t=>e.update(n(t),i,u),t.apply(o)}function Nt(e,t,n,i,r,a){if(void 0===i)t.targets().add(n);else{const o=a||{},s=new Ae(null,Rt(n,i),r,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}function Rt(e,t){return t=Object(ie["D"])(t)?t:Object(ie["l"])(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}function zt(e){e.rank=++this._rank}function Tt(e){var t,n,i,r=[e];while(r.length)if(this.rank(t=r.pop()),n=t._targets)for(i=n.length;--i>=0;)r.push(t=n[i]),t===e&&Object(ie["n"])("Cycle detected in dataflow graph.")}var Lt={},Pt=1,Bt=2,It=4,Ut=Pt|Bt,qt=Pt|It,Wt=Pt|Bt|It,Ht=8,Gt=16,Vt=32,Zt=64;function Yt(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}var Xt=Yt.prototype;function Jt(e,t){return e?function(n,i){return e(n,i)&&t(n,i)}:t}function Qt(e,t){var n=[];return Object(ie["ib"])(e,t,(function(e){n.push(e)})),n}function Kt(e,t){var n={};return e.visit(t,(function(e){n[ce(e)]=1})),function(e){return n[ce(e)]?null:e}}function en(e,t,n,i){var r,a,o,s,u,c=this,l=0;for(this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n,o=0,s=n.length;o<s;++o)if(r=n[o],r.stamp===t){if(r.fields)for(u in a=c.fields||(c.fields={}),r.fields)a[u]=1;r.changed(c.ADD)&&(l|=c.ADD),r.changed(c.REM)&&(l|=c.REM),r.changed(c.MOD)&&(l|=c.MOD)}this.changes=l}Xt.StopPropagation=Lt,Xt.ADD=Pt,Xt.REM=Bt,Xt.MOD=It,Xt.ADD_REM=Ut,Xt.ADD_MOD=qt,Xt.ALL=Wt,Xt.REFLOW=Ht,Xt.SOURCE=Gt,Xt.NO_SOURCE=Vt,Xt.NO_FIELDS=Zt,Xt.fork=function(e){return new Yt(this.dataflow).init(this,e)},Xt.clone=function(){var e=this.fork(Wt);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(Wt|Gt)},Xt.addAll=function(){var e=this;return this.source&&this.source.length!==this.add.length?(e=new Yt(this.dataflow).init(this),e.add=e.source,e):e},Xt.init=function(e,t){var n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||t&Zt||(n.fields=e.fields),t&Pt?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&Bt?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&It?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&Vt?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source),n},Xt.runAfter=function(e){this.dataflow.runAfter(e)},Xt.changed=function(e){var t=e||Wt;return t&Pt&&this.add.length||t&Bt&&this.rem.length||t&It&&this.mod.length},Xt.reflow=function(e){if(e)return this.fork(Wt).reflow();var t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(It,Kt(this,Pt))),this},Xt.modifies=function(e){var t=this.fields||(this.fields={});return Object(ie["A"])(e)?e.forEach(e=>t[e]=!0):t[e]=!0,this},Xt.modified=function(e,t){var n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?Object(ie["A"])(e)?e.some((function(e){return n[e]})):n[e]:!!n)},Xt.filter=function(e,t){var n=this;return e&Pt&&(n.addF=Jt(n.addF,t)),e&Bt&&(n.remF=Jt(n.remF,t)),e&It&&(n.modF=Jt(n.modF,t)),e&Gt&&(n.srcF=Jt(n.srcF,t)),n},Xt.materialize=function(e){e=e||Wt;var t=this;return e&Pt&&t.addF&&(t.add=Qt(t.add,t.addF),t.addF=null),e&Bt&&t.remF&&(t.rem=Qt(t.rem,t.remF),t.remF=null),e&It&&t.modF&&(t.mod=Qt(t.mod,t.modF),t.modF=null),e&Gt&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},Xt.visit=function(e,t){var n,i,r=this,a=t;return e&Gt?(Object(ie["ib"])(r.source,r.srcF,a),r):(e&Pt&&Object(ie["ib"])(r.add,r.addF,a),e&Bt&&Object(ie["ib"])(r.rem,r.remF,a),e&It&&Object(ie["ib"])(r.mod,r.modF,a),e&Ht&&(n=r.source)&&(i=r.add.length+r.mod.length,i===n.length||(i?Object(ie["ib"])(n,Kt(r,qt),a):Object(ie["ib"])(n,r.srcF,a))),r)};var tn=Object(ie["y"])(en,Yt);async function nn(e,t,n){const i=this,r=i.logLevel(),a=[];if(i._pulse)return sn(i);if(i._pending&&await i._pending,t&&await ae(i,t),!i._touched.length)return i.info("Dataflow invoked, but nothing to do."),i;let o,s,u,c,l=++i._clock,f=0;i._pulse=new Yt(i,l,e),r>=ie["c"]&&(u=Date.now(),i.debug("-- START PROPAGATION ("+l+") -----")),i._touched.forEach(e=>i._enqueue(e,!0)),i._touched=re(ie["w"]);try{while(i._heap.size()>0)o=i._heap.pop(),o.rank===o.qrank?(s=o.run(i._getPulse(o,e)),s.then?s=await s:s.async&&(a.push(s.async),s=Lt),r>=ie["a"]&&i.debug(o.id,s===Lt?"STOP":s,o),s!==Lt&&o._targets&&o._targets.forEach(e=>i._enqueue(e)),++f):i._enqueue(o,!0)}catch(d){i._heap.clear(),c=d}if(i._input={},i._pulse=null,r>=ie["c"]&&(u=Date.now()-u,i.info("> Pulse "+l+": "+f+" operators; "+u+"ms")),c&&(i._postrun=[],i.error(c)),i._postrun.length){const e=i._postrun.sort((e,t)=>t.priority-e.priority);i._postrun=[];for(let t=0;t<e.length;++t)await ae(i,e[t].callback)}return n&&await ae(i,n),a.length&&Promise.all(a).then(e=>i.runAsync(null,()=>{e.forEach(e=>{try{e(i)}catch(d){i.error(d)}})})),i}async function rn(e,t,n){while(this._running)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running}function an(e,t,n){return this._pulse?sn(this):(this.evaluate(e,t,n),this)}function on(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}}function sn(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function un(e,t){var n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function cn(e,t){var n=e.source,i=this._clock;return n&&Object(ie["A"])(n)?new en(this,i,n.map(e=>e.pulse),t):this._input[e.id]||ln(this._pulse,n&&n.pulse)}function ln(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==Lt&&(e.source=t.source),e)}tn.fork=function(e){var t=new Yt(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,(function(e){return t.add.push(e)})),e&t.REM&&this.visit(t.REM,(function(e){return t.rem.push(e)})),e&t.MOD&&this.visit(t.MOD,(function(e){return t.mod.push(e)}))),t},tn.changed=function(e){return this.changes&e},tn.modified=function(e){var t=this,n=t.fields;return n&&t.changes&t.MOD?Object(ie["A"])(e)?e.some((function(e){return n[e]})):n[e]:0},tn.filter=function(){Object(ie["n"])("MultiPulse does not support filtering.")},tn.materialize=function(){Object(ie["n"])("MultiPulse does not support materialization.")},tn.visit=function(e,t){var n=this,i=n.pulses,r=i.length,a=0;if(e&n.SOURCE)for(;a<r;++a)i[a].visit(e,t);else for(;a<r;++a)i[a].stamp===n.stamp&&i[a].visit(e,t);return n};var fn={skip:!1,force:!1};function dn(e,t){var n=t||fn;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function hn(e,t,n){var i=n||fn;return(e.set(t)||i.force)&&this.touch(e,i),this}function pn(e,t,n){this.touch(e,n||fn);var i=new Yt(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this}function gn(e){var t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),mn(t,0,t.length-1,e)),pop:()=>{var n,i=t.pop();return t.length?(n=t[0],t[0]=i,vn(t,0,e)):n=i,n}}}function mn(e,t,n,i){var r,a,o;r=e[n];while(n>t){if(o=n-1>>1,a=e[o],!(i(r,a)<0))break;e[n]=a,n=o}return e[n]=r}function vn(e,t,n){var i,r=t,a=e.length,o=e[t],s=1+(t<<1);while(s<a)i=s+1,i<a&&n(e[s],e[i])>=0&&(s=i),e[t]=e[s],t=s,s=1+(t<<1);return e[t]=o,mn(e,r,t,n)}function bn(){this.logger(Object(ie["K"])()),this.logLevel(ie["b"]),this._clock=0,this._rank=0;try{this._loader=_t()}catch(e){}this._touched=re(ie["w"]),this._input={},this._pulse=null,this._heap=gn((e,t)=>e.qrank-t.qrank),this._postrun=[]}var yn=bn.prototype;function xn(e){return function(){return this._log[e].apply(this,arguments)}}function On(e,t){Ae.call(this,e,null,t)}yn.stamp=function(){return this._clock},yn.loader=function(e){return arguments.length?(this._loader=e,this):this._loader},yn.cleanThreshold=1e4,yn.add=Se,yn.connect=Ce,yn.rank=zt,yn.rerank=Tt,yn.pulse=pn,yn.touch=dn,yn.update=hn,yn.changeset=ve,yn.ingest=Et,yn.parse=At,yn.preload=St,yn.request=Dt,yn.events=Re,yn.on=$t,yn.evaluate=nn,yn.run=an,yn.runAsync=rn,yn.runAfter=on,yn._enqueue=un,yn._getPulse=cn,yn.logger=function(e){return arguments.length?(this._log=e,this):this._log},yn.error=xn("error"),yn.warn=xn("warn"),yn.info=xn("info"),yn.debug=xn("debug"),yn.logLevel=xn("level");var wn=Object(ie["y"])(On,Ae);wn.run=function(e){return e.stamp<this.stamp?e.StopPropagation:(this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(e=>this.pulse=e):t!==e.StopPropagation&&(this.pulse=t),t);var t},wn.evaluate=function(e){var t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},wn.transform=function(){};var jn={};function kn(e){var t=_n(e);return t&&t.Definition||null}function _n(e){return e=e&&e.toLowerCase(),Object(ie["v"])(jn,e)?jn[e]:null}function An(e){return function(t){for(var n=e.length,i=1,r=String(e[0](t));i<n;++i)r+="|"+e[i](t);return r}}function En(e){return e&&e.length?1===e.length?e[0]:An(e):function(){return""}}function Dn(e,t,n){return n||e+(t?"_"+t:"")}var Sn={values:$n({name:"values",init:"cell.store = true;",set:"cell.data.values()",idx:-1}),count:$n({name:"count",set:"cell.num"}),__count__:$n({name:"count",set:"this.missing + this.valid"}),missing:$n({name:"missing",set:"this.missing"}),valid:$n({name:"valid",set:"this.valid"}),sum:$n({name:"sum",init:"this.sum = 0;",add:"this.sum += +v;",rem:"this.sum -= v;",set:"this.sum"}),mean:$n({name:"mean",init:"this.mean = 0;",add:"var d = v - this.mean; this.mean += d / this.valid;",rem:"var d = v - this.mean; this.mean -= this.valid ? d / this.valid : this.mean;",set:"this.valid ? this.mean : undefined"}),average:$n({name:"average",set:"this.valid ? this.mean : undefined",req:["mean"],idx:1}),variance:$n({name:"variance",init:"this.dev = 0;",add:"this.dev += d * (v - this.mean);",rem:"this.dev -= d * (v - this.mean);",set:"this.valid > 1 ? this.dev / (this.valid-1) : undefined",req:["mean"],idx:1}),variancep:$n({name:"variancep",set:"this.valid > 1 ? this.dev / this.valid : undefined",req:["variance"],idx:2}),stdev:$n({name:"stdev",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid-1)) : undefined",req:["variance"],idx:2}),stdevp:$n({name:"stdevp",set:"this.valid > 1 ? Math.sqrt(this.dev / this.valid) : undefined",req:["variance"],idx:2}),stderr:$n({name:"stderr",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid * (this.valid-1))) : undefined",req:["variance"],idx:2}),distinct:$n({name:"distinct",set:"cell.data.distinct(this.get)",req:["values"],idx:3}),ci0:$n({name:"ci0",set:"cell.data.ci0(this.get)",req:["values"],idx:3}),ci1:$n({name:"ci1",set:"cell.data.ci1(this.get)",req:["values"],idx:3}),median:$n({name:"median",set:"cell.data.q2(this.get)",req:["values"],idx:3}),q1:$n({name:"q1",set:"cell.data.q1(this.get)",req:["values"],idx:3}),q3:$n({name:"q3",set:"cell.data.q3(this.get)",req:["values"],idx:3}),argmin:$n({name:"argmin",init:"this.argmin = undefined;",add:"if (v < this.min) this.argmin = t;",rem:"if (v <= this.min) this.argmin = undefined;",set:"this.argmin || cell.data.argmin(this.get)",req:["min"],str:["values"],idx:3}),argmax:$n({name:"argmax",init:"this.argmax = undefined;",add:"if (v > this.max) this.argmax = t;",rem:"if (v >= this.max) this.argmax = undefined;",set:"this.argmax || cell.data.argmax(this.get)",req:["max"],str:["values"],idx:3}),min:$n({name:"min",init:"this.min = undefined;",add:"if (v < this.min || this.min === undefined) this.min = v;",rem:"if (v <= this.min) this.min = NaN;",set:"this.min = (Number.isNaN(this.min) ? cell.data.min(this.get) : this.min)",str:["values"],idx:4}),max:$n({name:"max",init:"this.max = undefined;",add:"if (v > this.max || this.max === undefined) this.max = v;",rem:"if (v >= this.max) this.max = NaN;",set:"this.max = (Number.isNaN(this.max) ? cell.data.max(this.get) : this.max)",str:["values"],idx:4})},Cn=Object.keys(Sn);function Fn(e,t){return Sn[e](t)}function $n(e){return function(t){var n=Object(ie["o"])({init:"",add:"",rem:"",idx:0},e);return n.out=t||e.name,n}}function Mn(e,t){return e.idx-t.idx}function Nn(e,t){function n(e,i){function r(t){e[t]||n(e,e[t]=Sn[t]())}return i.req&&i.req.forEach(r),t&&i.str&&i.str.forEach(r),e}var i,r=e.reduce(n,e.reduce((function(e,t){return e[t.name]=t,e}),{})),a=[];for(i in r)a.push(r[i]);return a.sort(Mn)}function Rn(e,t){var n=t||ie["x"],i=Nn(e,!0),r="var cell = this.cell; this.valid = 0; this.missing = 0;",a="this.cell = cell; this.init();",o="if(v==null){++this.missing; return;} if(v!==v) return; ++this.valid;",s="if(v==null){--this.missing; return;} if(v!==v) return; --this.valid;",u="var cell = this.cell;";return i.forEach((function(e){r+=e.init,o+=e.add,s+=e.rem})),e.slice().sort(Mn).forEach((function(e){u+="t["+Object(ie["Z"])(e.out)+"]="+e.set+";"})),u+="return t;",a=Function("cell",a),a.prototype.init=Function(r),a.prototype.add=Function("v","t",o),a.prototype.rem=Function("v","t",s),a.prototype.set=Function("t",u),a.prototype.get=n,a.fields=e.map((function(e){return e.out})),a}var zn=function*(e,t){if(void 0===t)for(let n of e)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)null!=(i=t(i,++n,e))&&(i=+i)>=i&&(yield i)}},Tn=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN};function Ln(e,t){let n;if(void 0===t)for(const i of e)null!=i&&(n<i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function Pn(e,t){let n;if(void 0===t)for(const i of e)null!=i&&(n>i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}function Bn(e,t,n=0,i=e.length-1,r=Tn){while(i>n){if(i-n>600){const a=i-n+1,o=t-n+1,s=Math.log(a),u=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*u*(a-u)/a)*(o-a/2<0?-1:1),l=Math.max(n,Math.floor(t-o*u/a+c)),f=Math.min(i,Math.floor(t+(a-o)*u/a+c));Bn(e,t,l,f,r)}const a=e[t];let o=n,s=i;In(e,n,t),r(e[i],a)>0&&In(e,n,i);while(o<s){In(e,o,s),++o,--s;while(r(e[o],a)<0)++o;while(r(e[s],a)>0)--s}0===r(e[n],a)?In(e,n,s):(++s,In(e,s,i)),s<=t&&(n=s+1),t<=s&&(i=s-1)}return e}function In(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}var Un=function(e){return null===e?NaN:+e};function*qn(e,t){if(void 0===t)for(let n of e)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)null!=(i=t(i,++n,e))&&(i=+i)>=i&&(yield i)}}function Wn(e,t,n){if(e=Float64Array.from(qn(e,n)),i=e.length){if((t=+t)<=0||i<2)return Pn(e);if(t>=1)return Ln(e);var i,r=(i-1)*t,a=Math.floor(r),o=Ln(Bn(e,a).subarray(0,a+1)),s=Pn(e.subarray(a+1));return o+(s-o)*(r-a)}}function Hn(e,t,n=Un){if(i=e.length){if((t=+t)<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,a=Math.floor(r),o=+n(e[a],a,e),s=+n(e[a+1],a+1,e);return o+(s-o)*(r-a)}}var Gn=function(e,t,n){var i=Float64Array.from(zn(e,n));return i.sort(Tn),t.map(e=>Hn(i,e))},Vn=function(e,t){return Gn(e,[.25,.5,.75],t)};function Zn(e,t){let n,i=0,r=0,a=0;if(void 0===t)for(let o of e)null!=o&&(o=+o)>=o&&(n=o-r,r+=n/++i,a+=n*(o-r));else{let o=-1;for(let s of e)null!=(s=t(s,++o,e))&&(s=+s)>=s&&(n=s-r,r+=n/++i,a+=n*(s-r))}if(i>1)return a/(i-1)}function Yn(e,t){const n=Zn(e,t);return n?Math.sqrt(n):n}var Xn=function(e,t){var n=e.length,i=Yn(e,t),r=Vn(e,t),a=(r[2]-r[0])/1.34;return i=Math.min(i,a)||i||Math.abs(r[0])||1,1.06*i*Math.pow(n,-.2)},Jn=function(e){var t,n,i,r,a,o,s,u,c=e.maxbins||20,l=e.base||10,f=Math.log(l),d=e.divide||[5,2],h=e.extent[0],p=e.extent[1],g=e.span||p-h||Math.abs(h)||1;if(e.step)t=e.step;else if(e.steps){for(a=g/c,o=0,s=e.steps.length;o<s&&e.steps[o]<a;++o);t=e.steps[Math.max(0,o-1)]}else{n=Math.ceil(Math.log(c)/f),i=e.minstep||0,t=Math.max(i,Math.pow(l,Math.round(Math.log(g)/f)-n));while(Math.ceil(g/t)>c)t*=l;for(o=0,s=d.length;o<s;++o)a=t/d[o],a>=i&&g/a<=c&&(t=a)}return a=Math.log(t),r=a>=0?0:1+~~(-a/f),u=Math.pow(l,-r-1),(e.nice||void 0===e.nice)&&(a=Math.floor(h/t+u)*t,h=h<a?a-t:a,p=Math.ceil(p/t)*t),{start:h,stop:p===h?h+t:p,step:t}},Qn=Math.random;function Kn(e){Qn=e}var ei=function(e,t,n,i){if(!e.length)return[void 0,void 0];var r,a,o,s,u=Float64Array.from(zn(e,i)),c=u.length,l=t;for(o=0,s=Array(l);o<l;++o){for(r=0,a=0;a<c;++a)r+=u[~~(Qn()*c)];s[o]=r/c}return s.sort(Tn),[Wn(s,n/2),Wn(s,1-n/2)]},ti=function(e,t,n,i){i=i||(e=>e);let r,a=0,o=1,s=e.length,u=new Float64Array(s),c=i(e[0]),l=c,f=c+t;for(;o<s;++o){if(r=i(e[o]),r>=f){for(l=(c+l)/2;a<o;++a)u[a]=l;f=r+t,c=r}l=r}for(l=(c+l)/2;a<o;++a)u[a]=l;return n?ni(u,t+t/4):u};function ni(e,t){let n,i,r=e.length,a=0,o=1;while(e[a]===e[o])++o;while(o<r){n=o+1;while(e[o]===e[n])++n;if(e[o]-e[o-1]<t){i=o+(a+n-o-o>>1);while(i<o)e[i++]=e[o];while(i>o)e[i--]=e[a]}a=o,o=n}return e}var ii=function(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}},ri=function(e,t){null==t&&(t=e,e=0);var n,i,r,a={};return a.min=function(e){return arguments.length?(n=e||0,r=i-n,a):n},a.max=function(e){return arguments.length?(i=e||0,r=i-n,a):i},a.sample=function(){return n+Math.floor(r*Qn())},a.pdf=function(e){return e===Math.floor(e)&&e>=n&&e<i?1/r:0},a.cdf=function(e){var t=Math.floor(e);return t<n?0:t>=i?1:(t-n+1)/r},a.icdf=function(e){return e>=0&&e<=1?n-1+Math.floor(e*r):NaN},a.min(e).max(t)};const ai=Math.sqrt(2*Math.PI),oi=Math.SQRT2;let si=NaN;function ui(e,t){e=e||0,t=null==t?1:t;let n,i,r=0,a=0;if(si===si)r=si,si=NaN;else{do{r=2*Qn()-1,a=2*Qn()-1,n=r*r+a*a}while(0===n||n>1);i=Math.sqrt(-2*Math.log(n)/n),r*=i,si=a*i}return e+r*t}function ci(e,t,n){n=null==n?1:n;const i=(e-(t||0))/n;return Math.exp(-.5*i*i)/(n*ai)}function li(e,t,n){t=t||0,n=null==n?1:n;let i,r=(e-t)/n,a=Math.abs(r);if(a>37)i=0;else{let e,t=Math.exp(-a*a/2);a<7.07106781186547?(e=.0352624965998911*a+.700383064443688,e=e*a+6.37396220353165,e=e*a+33.912866078383,e=e*a+112.079291497871,e=e*a+221.213596169931,e=e*a+220.206867912376,i=t*e,e=.0883883476483184*a+1.75566716318264,e=e*a+16.064177579207,e=e*a+86.7807322029461,e=e*a+296.564248779674,e=e*a+637.333633378831,e=e*a+793.826512519948,e=e*a+440.413735824752,i/=e):(e=a+.65,e=a+4/e,e=a+3/e,e=a+2/e,e=a+1/e,i=t/e/2.506628274631)}return r>0?1-i:i}function fi(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*oi*di(2*e-1)}function di(e){let t,n=-Math.log((1-e)*(1+e));return n<6.25?(n-=3.125,t=-364441206401782e-35,t=t*n-16850591381820166e-35,t=128584807152564e-32+t*n,t=11157877678025181e-33+t*n,t=t*n-1333171662854621e-31,t=20972767875968562e-33+t*n,t=6637638134358324e-30+t*n,t=t*n-4054566272975207e-29,t=t*n-8151934197605472e-29,t=26335093153082323e-28+t*n,t=t*n-12975133253453532e-27,t=t*n-5415412054294628e-26,t=1.0512122733215323e-9+t*n,t=t*n-4.112633980346984e-9,t=t*n-2.9070369957882005e-8,t=4.2347877827932404e-7+t*n,t=t*n-13654692000834679e-22,t=t*n-13882523362786469e-21,t=.00018673420803405714+t*n,t=t*n-.000740702534166267,t=t*n-.006033670871430149,t=.24015818242558962+t*n,t=1.6536545626831027+t*n):n<16?(n=Math.sqrt(n)-3.25,t=2.2137376921775787e-9,t=9.075656193888539e-8+t*n,t=t*n-2.7517406297064545e-7,t=1.8239629214389228e-8+t*n,t=15027403968909828e-22+t*n,t=t*n-4013867526981546e-21,t=29234449089955446e-22+t*n,t=12475304481671779e-21+t*n,t=t*n-47318229009055734e-21,t=6828485145957318e-20+t*n,t=24031110387097894e-21+t*n,t=t*n-.0003550375203628475,t=.0009532893797373805+t*n,t=t*n-.0016882755560235047,t=.002491442096107851+t*n,t=t*n-.003751208507569241,t=.005370914553590064+t*n,t=1.0052589676941592+t*n,t=3.0838856104922208+t*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,t=-27109920616438573e-27,t=t*n-2.555641816996525e-10,t=1.5076572693500548e-9+t*n,t=t*n-3.789465440126737e-9,t=7.61570120807834e-9+t*n,t=t*n-1.496002662714924e-8,t=2.914795345090108e-8+t*n,t=t*n-6.771199775845234e-8,t=2.2900482228026655e-7+t*n,t=t*n-9.9298272942317e-7,t=4526062597223154e-21+t*n,t=t*n-1968177810553167e-20,t=7599527703001776e-20+t*n,t=t*n-.00021503011930044477,t=t*n-.00013871931833623122,t=1.0103004648645344+t*n,t=4.849906401408584+t*n):t=1/0,t*e}var hi=function(e,t){var n,i,r={mean:function(e){return arguments.length?(n=e||0,r):n},stdev:function(e){return arguments.length?(i=null==e?1:e,r):i},sample:()=>ui(n,i),pdf:e=>ci(e,n,i),cdf:e=>li(e,n,i),icdf:e=>fi(e,n,i)};return r.mean(e).stdev(t)},pi=function(e,t){var n=hi(),i={},r=0;return i.data=function(n){return arguments.length?(e=n,r=n?n.length:0,i.bandwidth(t)):e},i.bandwidth=function(n){return arguments.length?(t=n,!t&&e&&(t=Xn(e)),i):t},i.sample=function(){return e[~~(Qn()*r)]+t*n.sample()},i.pdf=function(i){for(var a=0,o=0;o<r;++o)a+=n.pdf((i-e[o])/t);return a/t/r},i.cdf=function(i){for(var a=0,o=0;o<r;++o)a+=n.cdf((i-e[o])/t);return a/r},i.icdf=function(){throw Error("KDE icdf not supported.")},i.data(e)};function gi(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+ui()*t)}function mi(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*ai*e)}function vi(e,t,n){return li(Math.log(e),t,n)}function bi(e,t,n){return Math.exp(fi(e,t,n))}var yi=function(e,t){var n,i,r={mean:function(e){return arguments.length?(n=e||0,r):n},stdev:function(e){return arguments.length?(i=null==e?1:e,r):i},sample:()=>gi(n,i),pdf:e=>mi(e,n,i),cdf:e=>vi(e,n,i),icdf:e=>bi(e,n,i)};return r.mean(e).stdev(t)},xi=function(e,t){var n,i={},r=0;function a(e){var t,n=[],i=0;for(t=0;t<r;++t)i+=n[t]=null==e[t]?1:+e[t];for(t=0;t<r;++t)n[t]/=i;return n}return i.weights=function(e){return arguments.length?(n=a(t=e||[]),i):t},i.distributions=function(n){return arguments.length?(n?(r=n.length,e=n):(r=0,e=[]),i.weights(t)):e},i.sample=function(){for(var t=Qn(),i=e[r-1],a=n[0],o=0;o<r-1;a+=n[++o])if(t<a){i=e[o];break}return i.sample()},i.pdf=function(t){for(var i=0,a=0;a<r;++a)i+=n[a]*e[a].pdf(t);return i},i.cdf=function(t){for(var i=0,a=0;a<r;++a)i+=n[a]*e[a].cdf(t);return i},i.icdf=function(){throw Error("Mixture icdf not supported.")},i.distributions(e).weights(t)};function Oi(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*Qn()}function wi(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function ji(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function ki(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}var _i=function(e,t){var n,i,r={min:function(e){return arguments.length?(n=e||0,r):n},max:function(e){return arguments.length?(i=null==e?1:e,r):i},sample:()=>Oi(n,i),pdf:e=>wi(e,n,i),cdf:e=>ji(e,n,i),icdf:e=>ki(e,n,i)};return null==t&&(t=null==e?1:e,e=0),r.min(e).max(t)},Ai=function(e,t,n,i){const r=i-e*e,a=Math.abs(r)<1e-24?0:(n-e*t)/r,o=t-a*e;return[o,a]};function Ei(e,t,n,i){e=e.filter(e=>{let i=t(e),r=n(e);return null!=i&&(i=+i)>=i&&null!=r&&(r=+r)>=r}),i&&e.sort((e,n)=>t(e)-t(n));const r=e.length,a=new Float64Array(r),o=new Float64Array(r);let s,u,c,l=0,f=0,d=0;for(c of e)a[l]=s=+t(c),o[l]=u=+n(c),++l,f+=(s-f)/l,d+=(u-d)/l;for(l=0;l<r;++l)a[l]-=f,o[l]-=d;return[a,o,f,d]}function Di(e,t,n,i){let r,a,o=-1;for(let s of e)r=t(s),a=n(s),null!=r&&(r=+r)>=r&&null!=a&&(a=+a)>=a&&i(r,a,++o)}var Si=function(e,t,n,i,r){let a=0,o=0;return Di(e,t,n,(e,t)=>{const n=t-r(e),s=t-i;a+=n*n,o+=s*s}),1-a/o},Ci=function(e,t,n){let i=0,r=0,a=0,o=0,s=0;Di(e,t,n,(e,t)=>{++s,i+=(e-i)/s,r+=(t-r)/s,a+=(e*t-a)/s,o+=(e*e-o)/s});const u=Ai(i,r,a,o),c=e=>u[0]+u[1]*e;return{coef:u,predict:c,rSquared:Si(e,t,n,r,c)}},Fi=function(e,t,n){let i=0,r=0,a=0,o=0,s=0;Di(e,t,n,(e,t)=>{++s,e=Math.log(e),i+=(e-i)/s,r+=(t-r)/s,a+=(e*t-a)/s,o+=(e*e-o)/s});const u=Ai(i,r,a,o),c=e=>u[0]+u[1]*Math.log(e);return{coef:u,predict:c,rSquared:Si(e,t,n,r,c)}},$i=function(e,t,n){const[i,r,a,o]=Ei(e,t,n);let s,u,c,l=0,f=0,d=0,h=0,p=0;Di(e,t,n,(e,t)=>{s=i[p++],u=Math.log(t),c=s*t,l+=(t*u-l)/p,f+=(c-f)/p,d+=(c*u-d)/p,h+=(s*c-h)/p});const[g,m]=Ai(f/o,l/o,d/o,h/o),v=e=>Math.exp(g+m*(e-a));return{coef:[Math.exp(g-m*a),m],predict:v,rSquared:Si(e,t,n,o,v)}},Mi=function(e,t,n){let i=0,r=0,a=0,o=0,s=0,u=0;Di(e,t,n,(e,t)=>{const n=Math.log(e),c=Math.log(t);++u,i+=(n-i)/u,r+=(c-r)/u,a+=(n*c-a)/u,o+=(n*n-o)/u,s+=(t-s)/u});const c=Ai(i,r,a,o),l=e=>c[0]*Math.pow(e,c[1]);return c[0]=Math.exp(c[0]),{coef:c,predict:l,rSquared:Si(e,t,n,s,l)}},Ni=function(e,t,n){const[i,r,a,o]=Ei(e,t,n),s=i.length;let u,c,l,f,d=0,h=0,p=0,g=0,m=0;for(u=0;u<s;)c=i[u],l=r[u++],f=c*c,d+=(f-d)/u,h+=(f*c-h)/u,p+=(f*f-p)/u,g+=(c*l-g)/u,m+=(f*l-m)/u;const v=p-d*d,b=d*v-h*h,y=(m*d-g*h)/b,x=(g*v-m*h)/b,O=-y*d,w=e=>(e-=a,y*e*e+x*e+O+o);return{coef:[O-x*a+y*a*a+o,x-2*y*a,y],predict:w,rSquared:Si(e,t,n,o,w)}},Ri=function(e,t,n,i){if(1===i)return Ci(e,t,n);if(2===i)return Ni(e,t,n);const[r,a,o,s]=Ei(e,t,n),u=r.length,c=[],l=[],f=i+1;let d,h,p,g,m;for(d=0;d<f;++d){for(p=0,g=0;p<u;++p)g+=Math.pow(r[p],d)*a[p];for(c.push(g),m=new Float64Array(f),h=0;h<f;++h){for(p=0,g=0;p<u;++p)g+=Math.pow(r[p],d+h);m[h]=g}l.push(m)}l.push(c);const v=Ti(l),b=e=>{e-=o;let t=s+v[0]+v[1]*e+v[2]*e*e;for(d=3;d<f;++d)t+=v[d]*Math.pow(e,d);return t};return{coef:zi(f,v,-o,s),predict:b,rSquared:Si(e,t,n,s,b)}};function zi(e,t,n,i){const r=Array(e);let a,o,s,u;for(a=0;a<e;++a)r[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],u=1,r[a]+=s,o=1;o<=a;++o)u*=(a+1-o)/o,r[a-o]+=s*Math.pow(n,o)*u;return r[0]+=i,r}function Ti(e){const t=e.length-1,n=[];let i,r,a,o,s;for(i=0;i<t;++i){for(o=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][o])&&(o=r);for(a=i;a<t+1;++a)s=e[a][i],e[a][i]=e[a][o],e[a][o]=s;for(r=i+1;r<t;++r)for(a=t;a>=i;a--)e[a][r]-=e[a][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(s=0,a=r+1;a<t;++a)s+=e[a][r]*n[a];n[r]=(e[t][r]-s)/e[r][r]}return n}var Li=function(e,t){return Wn(e,.5,t)};const Pi=2,Bi=1e-12;var Ii=function(e,t,n,i){const[r,a,o,s]=Ei(e,t,n,!0),u=r.length,c=Math.max(2,~~(i*u)),l=new Float64Array(u),f=new Float64Array(u),d=new Float64Array(u).fill(1);for(let h=-1;++h<=Pi;){const e=[0,c-1];for(let n=0;n<u;++n){const t=r[n],i=e[0],o=e[1],s=t-r[i]>r[o]-t?i:o;let u=0,c=0,h=0,p=0,g=0,m=1/Math.abs(r[s]-t||1);for(let e=i;e<=o;++e){const n=r[e],i=a[e],o=Ui(Math.abs(t-n)*m)*d[e],s=n*o;u+=o,c+=s,h+=i*o,p+=i*s,g+=n*s}const[v,b]=Ai(c/u,h/u,p/u,g/u);l[n]=v+b*t,f[n]=Math.abs(a[n]-l[n]),qi(r,n+1,e)}if(h===Pi)break;const t=Li(f);if(Math.abs(t)<Bi)break;for(let n,i,r=0;r<u;++r)n=f[r]/(6*t),d[r]=n>=1?Bi:(i=1-n*n)*i}return Wi(r,l,o,s)};function Ui(e){return(e=1-e*e*e)*e*e}function qi(e,t,n){let i=e[t],r=n[0],a=n[1]+1;if(!(a>=e.length))while(t>r&&e[a]-i<=i-e[r])n[0]=++r,n[1]=a,++a}function Wi(e,t,n,i){const r=e.length,a=[];let o,s=0,u=0,c=[];for(;s<r;++s)o=e[s]+n,c[0]===o?c[1]+=(t[s]-c[1])/++u:(u=0,c[1]+=i,c=[o,t[s]],a.push(c));return c[1]+=i,a}const Hi=.1*Math.PI/180;var Gi=function(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=t=>[t,e(t)],a=t[0],o=t[1],s=o-a,u=s/i,c=[r(a)],l=[];if(n===i){for(let e=1;e<i;++e)c.push(r(a+e/n*s));return c.push(r(o)),c}l.push(r(o));for(let h=n;--h>0;)l.push(r(a+h/n*s));let f=c[0],d=l[l.length-1];while(d){const e=r((f[0]+d[0])/2);e[0]-f[0]>=u&&Vi(f,e,d)>Hi?l.push(e):(f=d,c.push(d),l.pop()),d=l[l.length-1]}return c};function Vi(e,t,n){const i=Math.atan2(n[1]-e[1],n[0]-e[0]),r=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(i-r)}function Zi(e){this._key=e?Object(ie["t"])(e):ce,this.reset()}var Yi=Zi.prototype;function Xi(e){On.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Yi.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Yi.add=function(e){this._add.push(e)},Yi.rem=function(e){this._rem.push(e)},Yi.values=function(){if(this._get=null,0===this._rem.length)return this._add;var e,t,n,i=this._add,r=this._rem,a=this._key,o=i.length,s=r.length,u=Array(o-s),c={};for(e=0;e<s;++e)c[a(r[e])]=1;for(e=0,t=0;e<o;++e)c[a(n=i[e])]?c[a(n)]=0:u[t++]=n;return this._rem=[],this._add=u},Yi.distinct=function(e){var t,n=this.values(),i=n.length,r={},a=0;while(--i>=0)t=e(n[i])+"",Object(ie["v"])(r,t)||(r[t]=1,++a);return a},Yi.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=Object(ie["q"])(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},Yi.argmin=function(e){return this.extent(e)[0]||{}},Yi.argmax=function(e){return this.extent(e)[1]||{}},Yi.min=function(e){var t=this.extent(e)[0];return null!=t?e(t):void 0},Yi.max=function(e){var t=this.extent(e)[1];return null!=t?e(t):void 0},Yi.quartile=function(e){return this._get===e&&this._q||(this._q=Vn(this.values(),e),this._get=e),this._q},Yi.q1=function(e){return this.quartile(e)[0]},Yi.q2=function(e){return this.quartile(e)[1]},Yi.q3=function(e){return this.quartile(e)[2]},Yi.ci=function(e){return this._get===e&&this._ci||(this._ci=ei(this.values(),1e3,.05,e),this._get=e),this._ci},Yi.ci0=function(e){return this.ci(e)[0]},Yi.ci1=function(e){return this.ci(e)[1]},Xi.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Cn},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};var Ji=Object(ie["y"])(Xi,On);Ji.transform=function(e,t){var n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):{},t.visit(t.SOURCE,e=>n.add(e))):(n.value=n.value||n.init(e),t.visit(t.REM,e=>n.rem(e)),t.visit(t.ADD,e=>n.add(e))),i.modifies(n._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),n.changes(i)},Ji.cross=function(){var e=this,t=e.value,n=e._dnames,i=n.map((function(){return{}})),r=n.length;function a(e){var t,a,o,s;for(t in e)for(o=e[t].tuple,a=0;a<r;++a)i[a][s=o[n[a]]]=s}function o(a,s,u){var c,l,f=n[u],d=i[u++];for(c in d)s[f]=d[c],l=a?a+"|"+c:c,u<r?o(l,s,u):t[l]||e.cell(l,s)}a(e._prev),a(t),o("",{},0)},Ji.init=function(e){var t=this._inputs=[],n=this._outputs=[],i={};function r(e){for(var n,r=Object(ie["i"])(Object(ie["g"])(e)),a=0,o=r.length;a<o;++a)i[n=r[a]]||(i[n]=1,t.push(n))}this._dims=Object(ie["i"])(e.groupby),this._dnames=this._dims.map((function(e){var t=Object(ie["h"])(e);return r(e),n.push(t),t})),this.cellkey=e.key?e.key:En(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var a,o,s,u,c,l,f=e.fields||[null],d=e.ops||["count"],h=e.as||[],p=f.length,g={};for(p!==d.length&&Object(ie["n"])("Unmatched number of fields and aggregate ops."),l=0;l<p;++l)a=f[l],o=d[l],null==a&&"count"!==o&&Object(ie["n"])("Null aggregate field specified."),u=Object(ie["h"])(a),c=Dn(o,u,h[l]),n.push(c),"count"!==o?(s=g[u],s||(r(a),s=g[u]=[],s.field=a,this._measures.push(s)),"count"!==o&&(this._countOnly=!1),s.push(Fn(o,c))):this._counts.push(c);return this._measures=this._measures.map((function(e){return Rn(e,e.field)})),{}},Ji.cellkey=En(),Ji.cell=function(e,t){var n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},Ji.newcell=function(e,t){var n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){var i,r=this._measures,a=r.length;for(n.agg=Array(a),i=0;i<a;++i)n.agg[i]=new r[i](n)}return n.store&&(n.data=new Zi),n},Ji.newtuple=function(e,t){var n,i,r=this._dnames,a=this._dims,o={};for(n=0,i=a.length;n<i;++n)o[r[n]]=a[n](e);return t?pe(t.tuple,o):fe(o)},Ji.add=function(e){var t,n,i,r=this.cellkey(e),a=this.cell(r,e);if(a.num+=1,!this._countOnly)for(a.store&&a.data.add(e),t=a.agg,n=0,i=t.length;n<i;++n)t[n].add(t[n].get(e),e)},Ji.rem=function(e){var t,n,i,r=this.cellkey(e),a=this.cell(r,e);if(a.num-=1,!this._countOnly)for(a.store&&a.data.rem(e),t=a.agg,n=0,i=t.length;n<i;++n)t[n].rem(t[n].get(e),e)},Ji.celltuple=function(e){var t,n,i,r=e.tuple,a=this._counts;for(e.store&&e.data.values(),n=0,i=a.length;n<i;++n)r[a[n]]=e.num;if(!this._countOnly)for(t=e.agg,n=0,i=t.length;n<i;++n)t[n].set(r);return r},Ji.changes=function(e){var t,n,i,r,a=this._adds,o=this._mods,s=this._prev,u=this._drop,c=e.add,l=e.rem,f=e.mod;if(s)for(n in s)t=s[n],u&&!t.num||l.push(t.tuple);for(i=0,r=this._alen;i<r;++i)c.push(this.celltuple(a[i])),a[i]=null;for(i=0,r=this._mlen;i<r;++i)t=o[i],(0===t.num&&u?l:f).push(this.celltuple(t)),o[i]=null;return this._alen=this._mlen=0,this._prev=null,e};const Qi=1e-14;function Ki(e){On.call(this,null,e)}Ki.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};var er=Object(ie["y"])(Ki,On);er.transform=function(e,t){var n,i=!1!==e.interval,r=this._bins(e),a=r.start,o=r.step,s=e.as||["bin0","bin1"],u=s[0],c=s[1];return e.modified()?(t=t.reflow(!0),n=t.SOURCE):n=t.modified(Object(ie["g"])(e.field))?t.ADD_MOD:t.ADD,t.visit(n,i?function(e){var t=r(e);e[u]=t,e[c]=null==t?null:a+o*(1+(t-a)/o)}:function(e){e[u]=r(e)}),t.modifies(i?s:u)},er._bins=function(e){if(this.value&&!e.modified())return this.value;var t,n,i=e.field,r=Jn(e),a=r.step,o=r.start,s=o+Math.ceil((r.stop-o)/a)*a;null!=(t=e.anchor)&&(n=t-(o+a*Math.floor((t-o)/a)),o+=n,s+=n);var u=function(e){var t=i(e);return null==t?null:t<o?-1/0:t>s?1/0:(t=Math.max(o,Math.min(+t,s-a)),o+a*Math.floor(Qi+(t-o)/a))};return u.start=o,u.stop=r.stop,u.step=a,this.value=Object(ie["f"])(u,Object(ie["g"])(i),e.name||"bin_"+Object(ie["h"])(i))};var tr=function(e,t,n){var i=e,r=t||[],a=n||[],o={},s=0;return{add:function(e){a.push(e)},remove:function(e){o[i(e)]=++s},size:function(){return r.length},data:function(e,t){return s&&(r=r.filter((function(e){return!o[i(e)]})),o={},s=0),t&&e&&r.sort(e),a.length&&(r=e?Object(ie["M"])(e,r,a.sort(e)):r.concat(a),a=[]),r}}};function nr(e){On.call(this,[],e)}nr.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};var ir=Object(ie["y"])(nr,On);function rr(e){Ae.call(this,null,ar,e)}function ar(e){return this.value&&!e.modified()?this.value:Object(ie["k"])(e.fields,e.orders)}function or(e){On.call(this,null,e)}function sr(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}ir.transform=function(e,t){var n=t.fork(t.ALL),i=tr(ce,this.value,n.materialize(n.ADD).add),r=e.sort,a=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(a),this.value=n.source=i.data(ge(r),a),t.source&&t.source.root&&(this.value.root=t.source.root),n},Object(ie["y"])(rr,Ae),or.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};var ur=Object(ie["y"])(or,On);function cr(e){On.call(this,null,e)}ur.transform=function(e,t){function n(t){return function(n){for(var i,r=sr(s(n),e.case,a)||[],u=0,c=r.length;u<c;++u)o.test(i=r[u])||t(i)}}var i=this._parameterCheck(e,t),r=this._counts,a=this._match,o=this._stop,s=e.field,u=e.as||["text","count"],c=n((function(e){r[e]=1+(r[e]||0)})),l=n((function(e){r[e]-=1}));return i?t.visit(t.SOURCE,c):(t.visit(t.ADD,c),t.visit(t.REM,l)),this._finish(t,u)},ur._parameterCheck=function(e,t){var n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},ur._finish=function(e,t){var n,i,r,a=this._counts,o=this._tuples||(this._tuples={}),s=t[0],u=t[1],c=e.fork(e.NO_SOURCE|e.NO_FIELDS);for(n in a)i=o[n],r=a[n]||0,!i&&r?(o[n]=i=fe({}),i[s]=n,i[u]=r,c.add.push(i)):0===r?(i&&c.rem.push(i),a[n]=null,o[n]=null):i[u]!==r&&(i[u]=r,c.mod.push(i));return c.modifies(t)},cr.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};var lr=Object(ie["y"])(cr,On);function fr(e,t,n,i){for(var r,a,o=[],s={},u=e.length,c=0;c<u;++c)for(s[t]=a=e[c],r=0;r<u;++r)s[n]=e[r],i(s)&&(o.push(fe(s)),s={},s[t]=a);return o}lr.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=this.value,r=e.as||["a","b"],a=r[0],o=r[1],s=!i||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");return s?(i&&(n.rem=i),i=t.materialize(t.SOURCE).source,n.add=this.value=fr(i,a,o,e.filter||ie["gb"])):n.mod=i,n.source=this.value,n.modifies(r)};var dr={kde:pi,mixture:xi,normal:hi,lognormal:yi,uniform:_i},hr="distributions",pr="function",gr="field";function mr(e,t){var n=e[pr];Object(ie["v"])(dr,n)||Object(ie["n"])("Unknown distribution function: "+n);var i=dr[n]();for(var r in e)r===gr?i.data((e.from||t()).map(e[r])):r===hr?i[r](e[r].map((function(e){return mr(e,t)}))):typeof i[r]===pr&&i[r](e[r]);return i}function vr(e){On.call(this,null,e)}var br=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],yr={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:br},{name:"weights",type:"number",array:!0}]};vr.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:br.concat(yr)},{name:"as",type:"string",array:!0,default:["value","density"]}]};var xr=Object(ie["y"])(vr,On);function Or(e){return function(){return e.materialize(e.SOURCE).source}}function wr(e,t){return e?e.map((function(e,n){return t[n]||Object(ie["h"])(e)})):null}function jr(e,t,n){var i,r,a,o,s,u,c=[],l=function(e){return e(o)};if(null==t)c.push(e.map(n));else for(i={},r=0,a=e.length;r<a;++r)o=e[r],s=t.map(l),u=i[s],u||(i[s]=u=[],u.dims=s,c.push(u)),u.push(n(o));return c}xr.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var i=mr(e.distribution,Or(t)),r=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200,o=e.method||"pdf";"pdf"!==o&&"cdf"!==o&&Object(ie["n"])("Invalid density method: "+o),e.extent||i.data||Object(ie["n"])("Missing density extent parameter."),o=i[o];var s=e.as||["value","density"],u=e.extent||Object(ie["p"])(i.data()),c=Gi(o,u,r,a).map(e=>{var t={};return t[s[0]]=e[0],t[s[1]]=e[1],fe(t)});this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n};const kr="bin";function _r(e){On.call(this,null,e)}_r.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:kr}]};const Ar=Object(ie["y"])(_r,On);function Er(e,t){return Object(ie["X"])(Object(ie["p"])(e,t))/30}function Dr(e){Ae.call(this,null,Sr,e),this.modified(!0)}function Sr(e){var t=e.expr;return this.value&&!e.modified("expr")?this.value:Object(ie["f"])(n=>t(n,e),Object(ie["g"])(t),Object(ie["h"])(t))}function Cr(e){On.call(this,[void 0,void 0],e)}Ar.transform=function(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,i=jr(t.source,e.groupby,ie["x"]),r=e.smooth||!1,a=e.field,o=e.step||Er(n,a),s=ge((e,t)=>a(e)-a(t)),u=e.as||kr,c=i.length;let l,f=1/0,d=-1/0,h=0;for(;h<c;++h){const e=i[h].sort(s);l=-1;for(const t of ti(e,o,r,a))t<f&&(f=t),t>d&&(d=t),e[++l][u]=t}return this.value={start:f,stop:d,step:o},t.reflow(!0).modifies(u)},Object(ie["y"])(Dr,Ae),Cr.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};var Fr=Object(ie["y"])(Cr,On);function $r(e,t){Ae.call(this,e),this.parent=t}Fr.transform=function(e,t){var n,i=this.value,r=e.field,a=i[0],o=i[1];if(n=t.changed()||t.modified(r.fields)||e.modified("field"),(n||null==a)&&(a=1/0,o=-1/0),t.visit(n?t.SOURCE:t.ADD,(function(e){var t=r(e);null!=t&&(t=+t,t<a&&(a=t),t>o&&(o=t))})),!Number.isFinite(a)||!Number.isFinite(o)){let e=Object(ie["h"])(r);e&&(e=` for field "${e}"`),t.dataflow.warn(`Infinite extent${e}: [${a}, ${o}]`),a=o=void 0}this.value=[a,o]};var Mr=Object(ie["y"])($r,Ae);function Nr(e){On.call(this,{},e),this._keys=Object(ie["s"])();var t=this._targets=[];t.active=0,t.forEach=function(e){for(var n=0,i=t.active;n<i;++n)e(t[n],n,t)}}Mr.connect=function(e){return this.targets().add(e),e.source=this},Mr.add=function(e){this.value.add.push(e)},Mr.rem=function(e){this.value.rem.push(e)},Mr.mod=function(e){this.value.mod.push(e)},Mr.init=function(e){this.value.init(e,e.NO_SOURCE)},Mr.evaluate=function(){return this.value};var Rr=Object(ie["y"])(Nr,On);function zr(e){Ae.call(this,null,Tr,e)}function Tr(e){return this.value&&!e.modified()?this.value:Object(ie["A"])(e.name)?Object(ie["i"])(e.name).map((function(e){return Object(ie["t"])(e)})):Object(ie["t"])(e.name,e.as)}function Lr(e){On.call(this,Object(ie["s"])(),e)}Rr.activate=function(e){this._targets[this._targets.active++]=e},Rr.subflow=function(e,t,n,i){var r,a,o=this.value,s=Object(ie["v"])(o,e)&&o[e];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(a=i||(a=this._group[e])&&a.tuple,r=n.dataflow,s=r.add(new $r(n.fork(n.NO_SOURCE),this)).connect(t(r,e,a)),o[e]=s,this.activate(s)),s},Rr.transform=function(e,t){var n=t.dataflow,i=this,r=e.key,a=e.subflow,o=this._keys,s=e.modified("key");function u(e){return i.subflow(e,a,t)}return this._group=e.group||{},this._targets.active=0,t.visit(t.REM,(function(e){var t=ce(e),n=o.get(t);void 0!==n&&(o.delete(t),u(n).rem(e))})),t.visit(t.ADD,(function(e){var t=r(e);o.set(ce(e),t),u(t).add(e)})),s||t.modified(r.fields)?t.visit(t.MOD,(function(e){var t=ce(e),n=o.get(t),i=r(e);n===i?u(i).mod(e):(o.set(t,i),u(n).rem(e),u(i).add(e))})):t.changed(t.MOD)&&t.visit(t.MOD,(function(e){u(o.get(ce(e))).mod(e)})),s&&t.visit(t.REFLOW,(function(e){var t=ce(e),n=o.get(t),i=r(e);n!==i&&(o.set(t,i),u(n).rem(e),u(i).add(e))})),o.empty>n.cleanThreshold&&n.runAfter(o.clean),t},Object(ie["y"])(zr,Ae),Lr.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};var Pr=Object(ie["y"])(Lr,On);function Br(e){On.call(this,[],e)}Pr.transform=function(e,t){var n=t.dataflow,i=this.value,r=t.fork(),a=r.add,o=r.rem,s=r.mod,u=e.expr,c=!0;function l(t){var n=ce(t),r=u(t,e),l=i.get(n);r&&l?(i.delete(n),a.push(t)):r||l?c&&r&&!l&&s.push(t):(i.set(n,1),o.push(t))}return t.visit(t.REM,(function(e){var t=ce(e);i.has(t)?i.delete(t):o.push(e)})),t.visit(t.ADD,(function(t){u(t,e)?a.push(t):i.set(ce(t),1)})),t.visit(t.MOD,l),e.modified()&&(c=!1,t.visit(t.REFLOW,l)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r},Br.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};var Ir=Object(ie["y"])(Br,On);function Ur(e){On.call(this,[],e)}Ir.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.fields,r=wr(i,e.as||[]),a=e.index||null,o=r.length;return n.rem=this.value,t.visit(t.SOURCE,(function(e){for(var t,s,u,c=i.map(t=>t(e)),l=c.reduce((e,t)=>Math.max(e,t.length),0),f=0;f<l;++f){for(s=de(e),t=0;t<o;++t)s[r[t]]=null==(u=c[t][f])?null:u;a&&(s[a]=f),n.add.push(s)}})),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(r)},Ur.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};var qr=Object(ie["y"])(Ur,On);function Wr(e){On.call(this,null,e)}qr.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(ie["h"]),a=e.as||["key","value"],o=a[0],s=a[1],u=i.length;return n.rem=this.value,t.visit(t.SOURCE,(function(e){for(var t,a=0;a<u;++a)t=de(e),t[o]=r[a],t[s]=i[a](e),n.add.push(t)})),this.value=n.source=n.add,n.modifies(a)},Wr.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};var Hr=Object(ie["y"])(Wr,On);function Gr(e){On.call(this,[],e)}Hr.transform=function(e,t){var n=e.expr,i=e.as,r=e.modified(),a=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(a,t=>t[i]=n(t,e))};var Vr=Object(ie["y"])(Gr,On);function Zr(e,t){let n=0,i=0;if(void 0===t)for(let r of e)null!=r&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let a of e)null!=(a=t(a,++r,e))&&(a=+a)>=a&&(++n,i+=a)}if(n)return i/n}Vr.transform=function(e,t){var n,i,r,a=this.value,o=t.fork(t.ALL),s=e.size-a.length,u=e.generator;if(s>0){for(n=[];--s>=0;)n.push(r=fe(u(e))),a.push(r);o.add=o.add.length?o.materialize(o.ADD).add.concat(n):n}else i=a.slice(0,-s),o.rem=o.rem.length?o.materialize(o.REM).rem.concat(i):i,a=a.slice(-s);return o.source=this.value=a,o};var Yr={value:"value",median:Li,mean:Zr,min:Pn,max:Ln},Xr=[];function Jr(e){On.call(this,[],e)}Jr.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};var Qr=Object(ie["y"])(Jr,On);function Kr(e){var t,n=e.method||Yr.value;if(null!=Yr[n])return n===Yr.value?(t=void 0!==e.value?e.value:0,function(){return t}):Yr[n];Object(ie["n"])("Unrecognized imputation method: "+n)}function ea(e){var t=e.field;return function(e){return e?t(e):NaN}}function ta(e,t,n,i){var r,a,o,s,u,c,l,f,d=function(e){return e(f)},h=[],p=i?i.slice():[],g={},m={};for(p.forEach((function(e,t){g[e]=t+1})),s=0,l=e.length;s<l;++s)f=e[s],c=n(f),u=g[c]||(g[c]=p.push(c)),a=(r=t?t.map(d):Xr)+"",(o=m[a])||(o=m[a]=[],h.push(o),o.values=r),o[u-1]=f;return h.domain=p,h}function na(e){Xi.call(this,e)}Qr.transform=function(e,t){var n,i,r,a,o,s,u,c,l,f,d=t.fork(t.ALL),h=Kr(e),p=ea(e),g=Object(ie["h"])(e.field),m=Object(ie["h"])(e.key),v=(e.groupby||[]).map(ie["h"]),b=ta(t.source,e.groupby,e.key,e.keyvals),y=[],x=this.value,O=b.domain.length;for(o=0,c=b.length;o<c;++o)for(n=b[o],r=n.values,i=NaN,u=0;u<O;++u)if(null==n[u]){for(a=b.domain[u],f={_impute:!0},s=0,l=r.length;s<l;++s)f[v[s]]=r[s];f[m]=a,f[g]=Number.isNaN(i)?i=h(n,p):i,y.push(fe(f))}return y.length&&(d.add=d.materialize(d.ADD).add.concat(y)),x.length&&(d.rem=d.materialize(d.REM).rem.concat(x)),this.value=y,d},na.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Cn},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};var ia=Object(ie["y"])(na,Xi);function ra(e){On.call(this,null,e)}ia.transform=function(e,t){var n,i=this,r=e.modified();return i.value&&(r||t.modified(i._inputs,!0))?(n=i.value=r?i.init(e):{},t.visit(t.SOURCE,(function(e){i.add(e)}))):(n=i.value=i.value||this.init(e),t.visit(t.REM,(function(e){i.rem(e)})),t.visit(t.ADD,(function(e){i.add(e)}))),i.changes(),t.visit(t.SOURCE,(function(e){Object(ie["o"])(e,n[i.cellkey(e)].tuple)})),t.reflow(r).modifies(this._outputs)},ia.changes=function(){var e,t,n=this._adds,i=this._mods;for(e=0,t=this._alen;e<t;++e)this.celltuple(n[e]),n[e]=null;for(e=0,t=this._mlen;e<t;++e)this.celltuple(i[e]),i[e]=null;this._alen=this._mlen=0},ra.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};var aa=Object(ie["y"])(ra,On);function oa(e){Ae.call(this,null,sa,e)}function sa(e){return this.value&&!e.modified()?this.value:Object(ie["I"])(e.fields,e.flat)}function ua(e){On.call(this,[],e),this._pending=null}aa.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=jr(i,e.groupby,e.field),a=(e.groupby||[]).map(ie["h"]),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],c=[];let l=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;"pdf"!==s&&"cdf"!==s&&Object(ie["n"])("Invalid density method: "+s),"shared"===e.resolve&&(l||(l=Object(ie["p"])(i,e.field)),f=d=e.steps||d),r.forEach(t=>{const n=pi(t,o)[s],i=e.counts?t.length:1,r=l||Object(ie["p"])(t);Gi(n,r,f,d).forEach(e=>{const n={};for(let i=0;i<a.length;++i)n[a[i]]=t.dims[i];n[u[0]]=e[0],n[u[1]]=e[1]*i,c.push(fe(n))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n},Object(ie["y"])(oa,Ae);var ca=Object(ie["y"])(ua,On);function la(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function fa(e,t,n){n.forEach(fe);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i}function da(e){On.call(this,{},e)}ca.transform=function(e,t){const n=t.dataflow;if(this._pending)return fa(this,t,this._pending);if(la(e))return t.StopPropagation;if(e.values)return fa(this,t,n.parse(e.values,e.format));if(e.async){const t=n.request(e.url,e.format).then(e=>(this._pending=Object(ie["i"])(e.data),e=>e.touch(this)));return{async:t}}return n.request(e.url,e.format).then(e=>fa(this,t,Object(ie["i"])(e.data)))},da.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};var ha=Object(ie["y"])(da,On);function pa(e){Ae.call(this,null,ga,e)}function ga(e){if(this.value&&!e.modified())return this.value;var t,n,i,r=1/0,a=-1/0,o=e.extents;for(t=0,n=o.length;t<n;++t)i=o[t],i[0]<r&&(r=i[0]),i[1]>a&&(a=i[1]);return[r,a]}function ma(e){Ae.call(this,null,va,e)}function va(e){return this.value&&!e.modified()?this.value:e.values.reduce((function(e,t){return e.concat(t)}),[])}function ba(e){On.call(this,null,e)}function ya(e){Xi.call(this,e)}ha.transform=function(e,t){var n,i,r,a=t,o=e.as,s=e.fields,u=e.index,c=e.values,l=null==e.default?null:e.default,f=e.modified(),d=f?t.SOURCE:t.ADD,h=s.length;return c?(i=c.length,h>1&&!o&&Object(ie["n"])('Multi-field lookup requires explicit "as" parameter.'),o&&o.length!==h*i&&Object(ie["n"])('The "as" parameter has too few output field names.'),o=o||c.map(ie["h"]),n=function(e){for(var t,n,r=0,a=0;r<h;++r)if(n=u.get(s[r](e)),null==n)for(t=0;t<i;++t,++a)e[o[a]]=l;else for(t=0;t<i;++t,++a)e[o[a]]=c[t](n)}):(o||Object(ie["n"])("Missing output field names."),n=function(e){for(var t,n=0;n<h;++n)t=u.get(s[n](e)),e[o[n]]=null==t?l:t}),f?a=t.reflow(!0):(r=s.some((function(e){return t.modified(e.fields)})),d|=r?t.MOD:0),t.visit(d,n),a.modifies(o)},Object(ie["y"])(pa,Ae),Object(ie["y"])(ma,Ae),Object(ie["y"])(ba,On),ba.prototype.transform=function(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)},ya.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Cn,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var xa=Object(ie["y"])(ya,Xi);function Oa(e,t){var n=e.field,i=e.value,r=("count"===e.op?"__count__":e.op)||"sum",a=Object(ie["g"])(n).concat(Object(ie["g"])(i)),o=ja(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map((function(){return r})),fields:o.map((function(e){return wa(e,n,i,a)})),as:o.map((function(e){return e+""})),modified:e.modified.bind(e)}}function wa(e,t,n,i){return Object(ie["f"])((function(i){return t(i)===e?n(i):NaN}),i,e+"")}function ja(e,t,n){var i={},r=[];return n.visit(n.SOURCE,(function(t){var n=e(t);i[n]||(i[n]=1,r.push(n))})),r.sort((function(e,t){return(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0)})),t?r.slice(0,t):r}function ka(e){Nr.call(this,e)}xa._transform=xa.transform,xa.transform=function(e,t){return this._transform(Oa(e,t),t)};var _a=Object(ie["y"])(ka,Nr);function Aa(e){On.call(this,null,e)}_a.transform=function(e,t){var n=this,i=e.subflow,r=e.field;return(e.modified("field")||r&&t.modified(Object(ie["g"])(r)))&&Object(ie["n"])("PreFacet does not support field modification."),this._targets.active=0,t.visit(t.MOD,(function(e){var a=n.subflow(ce(e),i,t,e);r?r(e).forEach((function(e){a.mod(e)})):a.mod(e)})),t.visit(t.ADD,(function(e){var a=n.subflow(ce(e),i,t,e);r?r(e).forEach((function(e){a.add(fe(e))})):a.add(e)})),t.visit(t.REM,(function(e){var a=n.subflow(ce(e),i,t,e);r?r(e).forEach((function(e){a.rem(e)})):a.rem(e)})),t},Aa.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};var Ea=Object(ie["y"])(Aa,On);function Da(e,t,n,i){for(var r=0,a=n.length;r<a;++r)t[i[r]]=n[r](e);return t}function Sa(e){On.call(this,null,e)}Ea.transform=function(e,t){var n,i,r=e.fields,a=wr(e.fields,e.as||[]),o=r?function(e,t){return Da(e,t,r,a)}:he;return this.value?i=this.value:(t=t.addAll(),i=this.value={}),n=t.fork(t.NO_SOURCE),t.visit(t.REM,(function(e){var t=ce(e);n.rem.push(i[t]),i[t]=null})),t.visit(t.ADD,(function(e){var t=o(e,fe({}));i[ce(e)]=t,n.add.push(t)})),t.visit(t.MOD,(function(e){n.mod.push(o(e,i[ce(e)]))})),n};var Ca=Object(ie["y"])(Sa,On);Ca.transform=function(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};var Fa=function(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;var i=-1,r=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(r);while(++i<r)a[i]=e+i*n;return a};function $a(e){On.call(this,null,e)}$a.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};var Ma=Object(ie["y"])($a,On),Na=1e-14;function Ra(e){On.call(this,null,e)}Ma.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const r=t.materialize(t.SOURCE).source,a=jr(r,e.groupby,e.field),o=(e.groupby||[]).map(ie["h"]),s=[],u=e.step||.01,c=e.probs||Fa(u/2,1-Na,u),l=c.length;return a.forEach(e=>{const t=Gn(e,c);for(let n=0;n<l;++n){const r={};for(let t=0;t<o.length;++t)r[o[t]]=e.dims[t];r[i[0]]=c[n],r[i[1]]=t[n],s.push(fe(r))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=s,n};var za=Object(ie["y"])(Ra,On);function Ta(e){On.call(this,[],e),this.count=0}za.transform=function(e,t){var n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,e=>{var t=ce(e);n.rem.push(i[t]),i[t]=null}),t.visit(t.ADD,e=>{var t=de(e);i[ce(e)]=t,n.add.push(t)}),t.visit(t.MOD,e=>{var t,r=i[ce(e)];for(t in e)r[t]=e[t],n.modifies(t);n.mod.push(r)})),n},Ta.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};var La=Object(ie["y"])(Ta,On);function Pa(e){On.call(this,null,e)}La.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,a=this.value,o=this.count,s=0,u=a.reduce((function(e,t){return e[ce(t)]=1,e}),{});function c(e){var t,i;a.length<r?a.push(e):(i=~~((o+1)*Qn()),i<a.length&&i>=s&&(t=a[i],u[ce(t)]&&n.rem.push(t),a[i]=e)),++o}if(t.rem.length&&(t.visit(t.REM,(function(e){var t=ce(e);u[t]&&(u[t]=-1,n.rem.push(e)),--o})),a=a.filter((function(e){return-1!==u[ce(e)]}))),(t.rem.length||i)&&a.length<r&&t.source&&(s=o=a.length,t.visit(t.SOURCE,(function(e){u[ce(e)]||c(e)})),s=-1),i&&a.length>r){for(var l=0,f=a.length-r;l<f;++l)u[ce(a[l])]=-1,n.rem.push(a[l]);a=a.slice(f)}return t.mod.length&&t.visit(t.MOD,(function(e){u[ce(e)]&&n.mod.push(e)})),t.add.length&&t.visit(t.ADD,c),(t.add.length||s<0)&&(n.add=a.filter((function(e){return!u[ce(e)]}))),this.count=o,this.value=n.source=a,n},Pa.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};var Ba=Object(ie["y"])(Pa,On);function Ia(e){On.call(this,null,e),this.modified(!0)}Ba.transform=function(e,t){if(!this.value||e.modified()){var n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Fa(e.start,e.stop,e.step||1).map((function(e){var t={};return t[i]=e,fe(t)})),n.add=t.add.concat(this.value),n}};var Ua=Object(ie["y"])(Ia,On);Ua.transform=function(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};const qa="year",Wa="quarter",Ha="month",Ga="week",Va="date",Za="day",Ya="hours",Xa="minutes",Ja="seconds",Qa="milliseconds",Ka=[qa,Wa,Ha,Ga,Va,Za,Ya,Xa,Ja,Qa].reduce((e,t,n)=>(e[t]=1+n,e),{});function eo(e){const t=Object(ie["i"])(e).slice(),n={};return t.length||Object(ie["n"])("Missing time unit."),t.forEach(e=>{Object(ie["v"])(Ka,e)?n[e]=1:Object(ie["n"])(`Invalid time unit: ${e}.`)}),(n[Ga]||n[Za])&&(n[Wa]||n[Ha]||n[Va])&&Object(ie["n"])(`Incompatible time units: ${e}`),t.sort((e,t)=>Ka[e]-Ka[t]),t}var to=n("b14c"),no=n("2739");const io=new Date;function ro(e,t,n,i){const r=t||1,a=Object(ie["U"])(e),o=(e,t,i)=>ao(n[i||e],e===a&&r,t),s=new Date,u=Object(ie["db"])(e),c=u[qa]?o(qa):Object(ie["l"])(2012),l=u[Ha]?o(Ha):u[Wa]?o(Wa):ie["kb"],f=u[Ga]&&u[Za]?o(Za,1,Ga+Za):u[Ga]?o(Ga,1):u[Za]?o(Za,1):u[Va]?o(Va,1):ie["O"],d=u[Ya]?o(Ya):ie["kb"],h=u[Xa]?o(Xa):ie["kb"],p=u[Ja]?o(Ja):ie["kb"],g=u[Qa]?o(Qa):ie["kb"];return function(e){s.setTime(+e);const t=c(s);return i(t,l(s),f(s,t),d(s),h(s),p(s),g(s))}}function ao(e,t,n){return t<=1?e:n?(i,r)=>n+t*Math.floor((e(i,r)-n)/t):(n,i)=>t*Math.floor(e(n,i)/t)}function oo(e,t,n){return t+7*e-(n+6)%7}const so={[qa]:e=>e.getFullYear(),[Wa]:e=>3*~~(e.getMonth()/3),[Ha]:e=>e.getMonth(),[Va]:e=>e.getDate(),[Ya]:e=>e.getHours(),[Xa]:e=>e.getMinutes(),[Ja]:e=>e.getSeconds(),[Qa]:e=>e.getMilliseconds(),[Za]:(e,t)=>oo(1,e.getDay(),lo(t)),[Ga]:(e,t)=>oo(co(e),0,lo(t)),[Ga+Za]:(e,t)=>oo(co(e),e.getDay(),lo(t))};function uo(e){return io.setFullYear(e),io.setMonth(0),io.setDate(1),io.setHours(0,0,0,0),io}function co(e){return to["g"].count(uo(e.getFullYear())-1,e)}function lo(e){return uo(e).getDay()}function fo(e,t,n,i,r,a,o){if(0<=e&&e<100){var s=new Date(-1,t,n,i,r,a,o);return s.setFullYear(e),s}return new Date(e,t,n,i,r,a,o)}function ho(e,t){return ro(e,t||1,so,fo)}const po={[qa]:e=>e.getUTCFullYear(),[Wa]:e=>3*~~(e.getUTCMonth()/3),[Ha]:e=>e.getUTCMonth(),[Va]:e=>e.getUTCDate(),[Ya]:e=>e.getUTCHours(),[Xa]:e=>e.getUTCMinutes(),[Ja]:e=>e.getUTCSeconds(),[Qa]:e=>e.getUTCMilliseconds(),[Za]:(e,t)=>oo(1,e.getUTCDay(),mo(t)),[Ga]:(e,t)=>oo(go(e),0,mo(t)),[Ga+Za]:(e,t)=>oo(go(e),e.getUTCDay(),mo(t))};function go(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return no["g"].count(t-1,e)}function mo(e){return io.setTime(Date.UTC(e,0,1)),io.getUTCDay()}function vo(e,t,n,i,r,a,o){if(0<=e&&e<100){var s=new Date(Date.UTC(-1,t,n,i,r,a,o));return s.setUTCFullYear(n.y),s}return new Date(Date.UTC(e,t,n,i,r,a,o))}function bo(e,t){return ro(e,t||1,po,vo)}var yo=n("a15a"),xo=n("9603"),Oo=n("742c"),wo=n("b3c3"),jo=n("2c38"),ko=n("5edf"),_o=n("1809"),Ao=n("77ae"),Eo=n("55f8"),Do=n("6eb2"),So=n("f623"),Co=n("f8ee");const Fo={[qa]:yo["a"],[Wa]:xo["a"].every(3),[Ha]:xo["a"],[Ga]:to["g"],[Va]:Oo["b"],[Za]:Oo["b"],[Ya]:wo["a"],[Xa]:jo["a"],[Ja]:ko["a"],[Qa]:_o["a"]},$o={[qa]:Ao["a"],[Wa]:Eo["a"].every(3),[Ha]:Eo["a"],[Ga]:no["g"],[Va]:Do["a"],[Za]:Do["a"],[Ya]:So["a"],[Xa]:Co["a"],[Ja]:ko["a"],[Qa]:_o["a"]};function Mo(e){return Fo[e]}function No(e){return $o[e]}function Ro(e,t,n){return e?e.offset(t,n):void 0}function zo(e,t,n){return Ro(Mo(e),t,n)}function To(e,t,n){return Ro(No(e),t,n)}function Lo(e,t,n,i){return e?e.range(t,n,i):void 0}function Po(e,t,n,i){return Lo(Mo(e),t,n,i)}function Bo(e,t,n,i){return Lo(No(e),t,n,i)}const Io={[qa]:"%Y ",[Wa]:"Q%q ",[Ha]:"%b ",[Va]:"%d ",[Ga]:"W%U ",[Za]:"%a ",[Ya]:"%H:00",[Xa]:"00:%M",[Ja]:":%S",[Qa]:".%L",[`${qa}-${Ha}`]:"%Y-%m ",[`${qa}-${Ha}-${Va}`]:"%Y-%m-%d ",[`${Ya}-${Xa}`]:"%H:%M"};function Uo(e,t){const n=Object(ie["o"])({},Io,t),i=eo(e),r=i.length;let a,o,s="",u=0;for(u=0;u<r;)for(a=i.length;a>u;--a)if(o=i.slice(u,a).join("-"),null!=n[o]){s+=n[o],u=a;break}return s.trim()}function qo(e){return Ho(wt["b"],Mo,e)}function Wo(e){return Ho(wt["d"],No,e)}function Ho(e,t,n){return Object(ie["H"])(n)?e(n):Go(e,t,n)}function Go(e,t,n){n=n||{},Object(ie["F"])(n)||Object(ie["n"])(`Invalid time multi-format specifier: ${n}`);const i=t(Ja),r=t(Xa),a=t(Ya),o=t(Va),s=t(Ga),u=t(Ha),c=t(Wa),l=t(qa),f=e(n[Qa]||".%L"),d=e(n[Ja]||":%S"),h=e(n[Xa]||"%I:%M"),p=e(n[Ya]||"%I %p"),g=e(n[Va]||n[Za]||"%a %d"),m=e(n[Ga]||"%b %d"),v=e(n[Ha]||"%B"),b=e(n[Wa]||"%B"),y=e(n[qa]||"%Y");return function(e){return(i(e)<e?f:r(e)<e?d:a(e)<e?h:o(e)<e?p:u(e)<e?s(e)<e?g:m:l(e)<e?c(e)<e?v:b:y)(e)}}var Vo=function(e){return 1===e.length&&(e=Zo(e)),{left:function(t,n,i,r){null==i&&(i=0),null==r&&(r=t.length);while(i<r){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){null==i&&(i=0),null==r&&(r=t.length);while(i<r){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}};function Zo(e){return function(t,n){return Tn(e(t),n)}}var Yo=Math.sqrt(50),Xo=Math.sqrt(10),Jo=Math.sqrt(2),Qo=function(e,t,n){var i,r,a,o,s=-1;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((i=t<e)&&(r=e,e=t,t=r),0===(o=Ko(e,t,n))||!isFinite(o))return[];if(o>0){e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(r=Math.ceil(t-e+1));while(++s<r)a[s]=(e+s)*o}else{e=Math.floor(e*o),t=Math.ceil(t*o),a=new Array(r=Math.ceil(e-t+1));while(++s<r)a[s]=(e-s)/o}return i&&a.reverse(),a};function Ko(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),a=i/Math.pow(10,r);return r>=0?(a>=Yo?10:a>=Xo?5:a>=Jo?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(a>=Yo?10:a>=Xo?5:a>=Jo?2:1)}function es(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),a=i/r;return a>=Yo?r*=10:a>=Xo?r*=5:a>=Jo&&(r*=2),t<e?-r:r}const ts=1e3,ns=60*ts,is=60*ns,rs=24*is,as=7*rs,os=30*rs,ss=365*rs,us=[qa,Ha,Va,Ya,Xa,Ja,Qa],cs=us.slice(0,-1),ls=cs.slice(0,-1),fs=ls.slice(0,-1),ds=fs.slice(0,-1),hs=[qa,Ga],ps=[qa,Ha],gs=[qa],ms=[[cs,1,ts],[cs,5,5*ts],[cs,15,15*ts],[cs,30,30*ts],[ls,1,ns],[ls,5,5*ns],[ls,15,15*ns],[ls,30,30*ns],[fs,1,is],[fs,3,3*is],[fs,6,6*is],[fs,12,12*is],[ds,1,rs],[hs,1,as],[ps,1,os],[ps,3,3*os],[gs,1,ss]];var vs=function(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(Object(ie["X"])(t))/n;let r,a,o=Vo(e=>e[2]).right(ms,i);return o===ms.length?(r=gs,a=es(t[0]/ss,t[1]/ss,n)):o?(o=ms[i/ms[o-1][2]<ms[o][2]/i?o-1:o],r=o[0],a=o[1]):(r=us,a=Math.max(es(t[0],t[1],n),1)),{units:r,step:a}};function bs(e){On.call(this,null,e)}const ys=["unit0","unit1"];bs.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"string",array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:ys}]};var xs=Object(ie["y"])(bs,On);function Os(e){On.call(this,Object(ie["s"])(),e)}xs.transform=function(e,t){var n=e.field,i=!1!==e.interval,r="utc"===e.timezone,a=this._floor(e,t),o=(r?No:Mo)(a.unit).offset,s=e.as||ys,u=s[0],c=s[1],l=a.start||1/0,f=a.stop||-1/0,d=a.step,h=t.ADD;return(e.modified()||t.modified(Object(ie["g"])(n)))&&(t=t.reflow(!0),h=t.SOURCE,l=1/0,f=-1/0),t.visit(h,(function(e){var t,r,s=n(e);null==s?(e[u]=null,i&&(e[c]=null)):(e[u]=t=r=a(s),i&&(e[c]=r=o(t,d)),t<l&&(l=t),r>f&&(f=r))})),a.start=l,a.stop=f,t.modifies(i?s:u)},xs._floor=function(e,t){const n="utc"===e.timezone;let{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:vs({extent:e.extent||Object(ie["p"])(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins});i=eo(i);const a=this.value||{},o=(n?bo:ho)(i,r);return o.unit=Object(ie["U"])(i),o.units=i,o.step=r,o.start=a.start,o.stop=a.stop,this.value=o};var ws=Object(ie["y"])(Os,On);function js(e){On.call(this,null,e)}ws.transform=function(e,t){var n=t.dataflow,i=e.field,r=this.value,a=!0;function o(e){r.set(i(e),e)}return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,o)):t.changed()?(t.visit(t.REM,(function(e){r.delete(i(e))})),t.visit(t.ADD,o)):a=!1,this.modified(a),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()};var ks=Object(ie["y"])(js,On);function _s(e,t,n,i){let r=As[e](t,n);return{init:r.init||ie["kb"],update:function(e,t){t[i]=r.next(e)}}}ks.transform=function(e,t){var n=!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields);n&&(this.value=(e.sort?t.source.slice().sort(ge(e.sort)):t.source).map(e.field))};const As={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{let n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{let n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){let e=As.rank(),t=e.next;return{init:e.init,next:e=>(t(e)-1)/(e.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{let n=t.index,i=t.data,r=t.compare;if(e<n){while(n+1<i.length&&!r(i[n],i[n+1]))++n;e=n}return(1+e)/i.length}}},ntile:function(e,t){t=+t,t>0||Object(ie["n"])("ntile num must be greater than zero.");let n=As.cume_dist(),i=n.next;return{init:n.init,next:e=>Math.ceil(t*i(e))}},lag:function(e,t){return t=+t||1,{next:n=>{let i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{let i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||Object(ie["n"])("nth_value nth must be greater than zero."),{next:n=>{let i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t=null;return{next:n=>{let i=e(n.data[n.index]);return null!=i?t=i:t}}},next_value:function(e){let t=null,n=-1;return{next:i=>{let r=i.data;return i.index<=n?t:(n=Es(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}};function Es(e,t,n){for(let i=t.length;n<i;++n){let i=e(t[n]);if(null!=i)return n}return-1}var Ds=Object.keys(As);function Ss(e){let t=this,n=Object(ie["i"])(e.ops),i=Object(ie["i"])(e.fields),r=Object(ie["i"])(e.params),a=Object(ie["i"])(e.as),o=t.outputs=[],s=t.windows=[],u={},c={},l=!0,f=[],d=[];function h(e){Object(ie["i"])(Object(ie["g"])(e)).forEach(e=>u[e]=1)}h(e.sort),n.forEach((function(e,t){let n=i[t],u=Object(ie["h"])(n),p=Dn(e,u,a[t]);if(h(n),o.push(p),Object(ie["v"])(As,e))s.push(_s(e,i[t],r[t],p));else{if(null==n&&"count"!==e&&Object(ie["n"])("Null aggregate field specified."),"count"===e)return void f.push(p);l=!1;let t=c[u];t||(t=c[u]=[],t.field=n,d.push(t)),t.push(Fn(e,p))}})),(f.length||d.length)&&(t.cell=Fs(d,f,l)),t.inputs=Object.keys(u)}const Cs=Ss.prototype;function Fs(e,t,n){e=e.map(e=>Rn(e,e.field));let i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,a=i.agg=Array(r),o=0;o<r;++o)a[o]=new e[o](i);if(i.store)var s=i.data=new Zi;return i.add=function(e){if(i.num+=1,!n){s&&s.add(e);for(let t=0;t<r;++t)a[t].add(a[t].get(e),e)}},i.rem=function(e){if(i.num-=1,!n){s&&s.rem(e);for(let t=0;t<r;++t)a[t].rem(a[t].get(e),e)}},i.set=function(e){let r,o;for(s&&s.values(),r=0,o=t.length;r<o;++r)e[t[r]]=i.num;if(!n)for(r=0,o=a.length;r<o;++r)a[r].set(e)},i.init=function(){i.num=0,s&&s.reset();for(let e=0;e<r;++e)a[e].init()},i}function $s(e){On.call(this,{},e),this._mlen=0,this._mods=[]}Cs.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},Cs.update=function(e,t){let n,i=this,r=i.cell,a=i.windows,o=e.data,s=a&&a.length;if(r){for(n=e.p0;n<e.i0;++n)r.rem(o[n]);for(n=e.p1;n<e.i1;++n)r.add(o[n]);r.set(t)}for(n=0;n<s;++n)a[n].update(e,t)},$s.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Ds.concat(Cn)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};var Ms=Object(ie["y"])($s,On);function Ns(e,t,n,i){var r=i.sort,a=r&&!i.ignorePeers,o=i.frame||[null,0],s=e.data(n),u=s.length,c=0,l=a?Vo(r):null,f={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:r||Object(ie["l"])(-1)};for(t.init();c<u;++c)Rs(f,o,c,u),a&&zs(f,l),t.update(f,s[c])}function Rs(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function zs(e,t){var n=e.i0,i=e.i1-1,r=e.compare,a=e.data,o=a.length-1;n>0&&!r(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),i<o&&!r(a[i],a[i+1])&&(e.i1=t.right(a,a[i]))}Ms.transform=function(e,t){var n,i,r=this,a=r.state,o=e.modified(),s=ge(e.sort);this.stamp=t.stamp,a&&!o||(a=r.state=new Ss(e));var u=En(e.groupby);function c(e){return r.group(u(e))}for(o||t.modified(a.inputs)?(r.value={},t.visit(t.SOURCE,(function(e){c(e).add(e)}))):(t.visit(t.REM,(function(e){c(e).remove(e)})),t.visit(t.ADD,(function(e){c(e).add(e)}))),n=0,i=r._mlen;n<i;++n)Ns(r._mods[n],a,s,e);return r._mlen=0,r._mods=[],t.reflow(o).modifies(a.outputs)},Ms.group=function(e){var t=this,n=t.value[e];return n||(n=t.value[e]=tr(ce),n.stamp=-1),n.stamp<t.stamp&&(n.stamp=t.stamp,t._mods[t._mlen++]=n),n};const Ts="top",Ls="left",Ps="right",Bs="bottom",Is="top-left",Us="top-right",qs="bottom-left",Ws="bottom-right",Hs="start",Gs="middle",Vs="end",Zs="x",Ys="y",Xs="group",Js="axis",Qs="title",Ks="frame",eu="scope",tu="legend",nu="row-header",iu="row-footer",ru="row-title",au="column-header",ou="column-footer",su="column-title",uu="padding",cu="symbol",lu="fit",fu="fit-x",du="fit-y",hu="pad",pu="none",gu="all",mu="each",vu="flush",bu="column",yu="row";function xu(e){this.clear(),e&&this.union(e)}var Ou=xu.prototype;Ou.clone=function(){return new xu(this)},Ou.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},Ou.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},Ou.equals=function(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},Ou.set=function(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},Ou.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},Ou.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},Ou.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},Ou.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},Ou.rotate=function(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},Ou.rotatedPoints=function(e,t,n){var{x1:i,y1:r,x2:a,y2:o}=this,s=Math.cos(e),u=Math.sin(e),c=t-t*s+n*u,l=n-t*u-n*s;return[s*i-u*r+c,u*i+s*r+l,s*i-u*o+c,u*i+s*o+l,s*a-u*r+c,u*a+s*r+l,s*a-u*o+c,u*a+s*o+l]},Ou.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},Ou.intersect=function(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},Ou.encloses=function(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},Ou.alignsWith=function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},Ou.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},Ou.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},Ou.width=function(){return this.x2-this.x1},Ou.height=function(){return this.y2-this.y1};var wu=0;const ju="p_";function ku(e){return e&&e.gradient}function _u(e,t,n){let i=e.id,r=e.gradient,a="radial"===r?ju:"";return i||(i=e.id="gradient_"+wu++,"radial"===r?(e.x1=Au(e.x1,.5),e.y1=Au(e.y1,.5),e.r1=Au(e.r1,0),e.x2=Au(e.x2,.5),e.y2=Au(e.y2,.5),e.r2=Au(e.r2,.5),a=ju):(e.x1=Au(e.x1,0),e.y1=Au(e.y1,0),e.x2=Au(e.x2,1),e.y2=Au(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function Au(e,t){return null!=e?e:t}var Eu=function(e,t){var n,i=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:i,stop:function(e,t){return i.push({offset:e,color:t}),n}}};function Du(e){this.mark=e,this.bounds=this.bounds||new xu}function Su(e){Du.call(this,e),this.items=this.items||[]}function Cu(e,t){if("undefined"!==typeof document&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}function Fu(){return"undefined"!==typeof Image?Image:null}function $u(e){this._pending=0,this._loader=e||_t()}Object(ie["y"])(Su,Du);var Mu=$u.prototype;function Nu(e){e._pending+=1}function Ru(e){e._pending-=1}Mu.pending=function(){return this._pending},Mu.sanitizeURL=function(e){var t=this;return Nu(t),t._loader.sanitize(e,{context:"href"}).then((function(e){return Ru(t),e})).catch((function(){return Ru(t),null}))},Mu.loadImage=function(e){var t=this,n=Fu();return Nu(t),t._loader.sanitize(e,{context:"image"}).then((function(e){var i=e.href;if(!i||!n)throw{url:i};var r=new n;return r.onload=function(){Ru(t)},r.onerror=function(){Ru(t)},r.src=i,r})).catch((function(e){return Ru(t),{complete:!1,width:0,height:0,src:e&&e.url||""}}))},Mu.ready=function(){var e=this;return new Promise((function(t){function n(i){e.pending()?setTimeout((function(){n(!0)}),10):t(i)}n(!1)}))};var zu=n("8c80"),Tu=n("9ae6"),Lu=n("d675"),Pu=n("7784"),Bu=n("7792"),Iu=n("b0ad"),Uu=n("3b4d"),qu=n("29c8"),Wu=n("5644"),Hu=n("438d"),Gu=n("4830"),Vu=n("cc3e"),Zu=n("a4bd"),Yu=n("a84d"),Xu=n("7bd6"),Ju={basis:{curve:zu["b"]},"basis-closed":{curve:Tu["a"]},"basis-open":{curve:Lu["a"]},bundle:{curve:Pu["a"],tension:"beta",value:.85},cardinal:{curve:Bu["b"],tension:"tension",value:0},"cardinal-open":{curve:Iu["b"],tension:"tension",value:0},"cardinal-closed":{curve:Uu["b"],tension:"tension",value:0},"catmull-rom":{curve:qu["a"],tension:"alpha",value:.5},"catmull-rom-closed":{curve:Wu["a"],tension:"alpha",value:.5},"catmull-rom-open":{curve:Hu["a"],tension:"alpha",value:.5},linear:{curve:Gu["a"]},"linear-closed":{curve:Vu["a"]},monotone:{horizontal:Zu["b"],vertical:Zu["a"]},natural:{curve:Yu["a"]},step:{curve:Xu["a"]},"step-after":{curve:Xu["b"]},"step-before":{curve:Xu["c"]}};function Qu(e,t,n){var i=Object(ie["v"])(Ju,e)&&Ju[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&null!=n&&(r=r[i.tension](n))),r}var Ku={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},ec=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/],tc=function(e){var t,n,i,r,a,o,s,u,c,l,f,d=[];for(t=e.slice().replace(ec[0],"###$1").split(ec[1]).slice(1),u=0,l=t.length;u<l;++u){for(n=t[u],i=n.slice(1).trim().replace(ec[2],"$1###$2").split(ec[3]),o=n.charAt(0),r=[o],c=0,f=i.length;c<f;++c)(a=+i[c])===a&&r.push(a);if(s=Ku[o.toLowerCase()],r.length-1>s)for(c=1,f=r.length;c<f;c+=s)d.push([o].concat(r.slice(c,c+s)));else d.push(r)}return d};const nc=Math.PI/180,ic=1e-14,rc=Math.PI/2,ac=2*Math.PI,oc=Math.sqrt(3)/2;var sc={},uc={},cc=[].join;function lc(e,t,n,i,r,a,o,s,u){var c=cc.call(arguments);if(sc[c])return sc[c];var l=o*nc,f=Math.sin(l),d=Math.cos(l);n=Math.abs(n),i=Math.abs(i);var h=d*(s-e)*.5+f*(u-t)*.5,p=d*(u-t)*.5-f*(s-e)*.5,g=h*h/(n*n)+p*p/(i*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);var m=d/n,v=f/n,b=-f/i,y=d/i,x=m*s+v*u,O=b*s+y*u,w=m*e+v*t,j=b*e+y*t,k=(w-x)*(w-x)+(j-O)*(j-O),_=1/k-.25;_<0&&(_=0);var A=Math.sqrt(_);a==r&&(A=-A);var E=.5*(x+w)-A*(j-O),D=.5*(O+j)+A*(w-x),S=Math.atan2(O-D,x-E),C=Math.atan2(j-D,w-E),F=C-S;F<0&&1===a?F+=ac:F>0&&0===a&&(F-=ac);for(var $=Math.ceil(Math.abs(F/(rc+.001))),M=[],N=0;N<$;++N){var R=S+N*F/$,z=S+(N+1)*F/$;M[N]=[E,D,R,z,n,i,f,d]}return sc[c]=M}function fc(e){var t=cc.call(e);if(uc[t])return uc[t];var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],l=c*o,f=-u*s,d=u*o,h=c*s,p=Math.cos(r),g=Math.sin(r),m=Math.cos(a),v=Math.sin(a),b=.5*(a-r),y=Math.sin(.5*b),x=8/3*y*y/Math.sin(b),O=n+p-x*g,w=i+g+x*p,j=n+m,k=i+v,_=j+x*v,A=k-x*m;return uc[t]=[l*O+f*w,d*O+h*w,l*_+f*A,d*_+h*A,l*j+f*k,d*j+h*k]}var dc=["l",0,0,0,0,0,0,0];function hc(e,t,n){var i=dc[0]=e[0];if("a"===i||"A"===i)dc[1]=t*e[1],dc[2]=n*e[2],dc[3]=e[3],dc[4]=e[4],dc[5]=e[5],dc[6]=t*e[6],dc[7]=n*e[7];else if("h"===i||"H"===i)dc[1]=t*e[1];else if("v"===i||"V"===i)dc[1]=n*e[1];else for(var r=1,a=e.length;r<a;++r)dc[r]=(r%2==1?t:n)*e[r];return dc}var pc=function(e,t,n,i,r,a){var o,s,u,c,l,f=null,d=0,h=0,p=0,g=0;null==n&&(n=0),null==i&&(i=0),null==r&&(r=1),null==a&&(a=r),e.beginPath&&e.beginPath();for(var m=0,v=t.length;m<v;++m){switch(o=t[m],1===r&&1===a||(o=hc(o,r,a)),o[0]){case"l":d+=o[1],h+=o[2],e.lineTo(d+n,h+i);break;case"L":d=o[1],h=o[2],e.lineTo(d+n,h+i);break;case"h":d+=o[1],e.lineTo(d+n,h+i);break;case"H":d=o[1],e.lineTo(d+n,h+i);break;case"v":h+=o[1],e.lineTo(d+n,h+i);break;case"V":h=o[1],e.lineTo(d+n,h+i);break;case"m":d+=o[1],h+=o[2],e.moveTo(d+n,h+i);break;case"M":d=o[1],h=o[2],e.moveTo(d+n,h+i);break;case"c":s=d+o[5],u=h+o[6],p=d+o[3],g=h+o[4],e.bezierCurveTo(d+o[1]+n,h+o[2]+i,p+n,g+i,s+n,u+i),d=s,h=u;break;case"C":d=o[5],h=o[6],p=o[3],g=o[4],e.bezierCurveTo(o[1]+n,o[2]+i,p+n,g+i,d+n,h+i);break;case"s":s=d+o[3],u=h+o[4],p=2*d-p,g=2*h-g,e.bezierCurveTo(p+n,g+i,d+o[1]+n,h+o[2]+i,s+n,u+i),p=d+o[1],g=h+o[2],d=s,h=u;break;case"S":s=o[3],u=o[4],p=2*d-p,g=2*h-g,e.bezierCurveTo(p+n,g+i,o[1]+n,o[2]+i,s+n,u+i),d=s,h=u,p=o[1],g=o[2];break;case"q":s=d+o[3],u=h+o[4],p=d+o[1],g=h+o[2],e.quadraticCurveTo(p+n,g+i,s+n,u+i),d=s,h=u;break;case"Q":s=o[3],u=o[4],e.quadraticCurveTo(o[1]+n,o[2]+i,s+n,u+i),d=s,h=u,p=o[1],g=o[2];break;case"t":s=d+o[1],u=h+o[2],null===f[0].match(/[QqTt]/)?(p=d,g=h):"t"===f[0]?(p=2*d-c,g=2*h-l):"q"===f[0]&&(p=2*d-p,g=2*h-g),c=p,l=g,e.quadraticCurveTo(p+n,g+i,s+n,u+i),d=s,h=u,p=d+o[1],g=h+o[2];break;case"T":s=o[1],u=o[2],p=2*d-p,g=2*h-g,e.quadraticCurveTo(p+n,g+i,s+n,u+i),d=s,h=u;break;case"a":gc(e,d+n,h+i,[o[1],o[2],o[3],o[4],o[5],o[6]+d+n,o[7]+h+i]),d+=o[6],h+=o[7];break;case"A":gc(e,d+n,h+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),d=o[6],h=o[7];break;case"z":case"Z":e.closePath();break}f=o}};function gc(e,t,n,i){for(var r=lc(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n),a=0;a<r.length;++a){var o=fc(r[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var mc=.5773502691896257,vc={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,ac)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,a=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-a),e.lineTo(r,-a),e.lineTo(0,-n),e.lineTo(-r,-a),e.lineTo(-i,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=oc*n,r=i-n*mc,a=n/4;e.moveTo(0,-i-r),e.lineTo(-a,i-r),e.lineTo(a,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=oc*n,r=i-n*mc;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=oc*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=oc*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=oc*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=oc*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function bc(e){return Object(ie["v"])(vc,e)?vc[e]:xc(e)}var yc={};function xc(e){if(!Object(ie["v"])(yc,e)){var t=tc(e);yc[e]={draw:function(e,n){pc(e,t,0,0,Math.sqrt(n)/2)}}}return yc[e]}var Oc=n("eadc");const wc=.448084975506;function jc(e){return e.x}function kc(e){return e.y}function _c(e){return e.width}function Ac(e){return e.height}function Ec(e){return"function"===typeof e?e:()=>+e}function Dc(e,t,n){return Math.max(t,Math.min(e,n))}var Sc=function(){var e=jc,t=kc,n=_c,i=Ac,r=Ec(0),a=r,o=r,s=r,u=null;function c(c,l,f){var d,h=null!=l?l:+e.call(this,c),p=null!=f?f:+t.call(this,c),g=+n.call(this,c),m=+i.call(this,c),v=Math.min(g,m)/2,b=Dc(+r.call(this,c),0,v),y=Dc(+a.call(this,c),0,v),x=Dc(+o.call(this,c),0,v),O=Dc(+s.call(this,c),0,v);if(u||(u=d=Object(Oc["a"])()),b<=0&&y<=0&&x<=0&&O<=0)u.rect(h,p,g,m);else{var w=h+g,j=p+m;u.moveTo(h+b,p),u.lineTo(w-y,p),u.bezierCurveTo(w-wc*y,p,w,p+wc*y,w,p+y),u.lineTo(w,j-O),u.bezierCurveTo(w,j-wc*O,w-wc*O,j,w-O,j),u.lineTo(h+x,j),u.bezierCurveTo(h+wc*x,j,h,j-wc*x,h,j-x),u.lineTo(h,p+b),u.bezierCurveTo(h,p+wc*b,h+wc*b,p,h+b,p),u.closePath()}if(d)return u=null,d+""||null}return c.x=function(t){return arguments.length?(e=Ec(t),c):e},c.y=function(e){return arguments.length?(t=Ec(e),c):t},c.width=function(e){return arguments.length?(n=Ec(e),c):n},c.height=function(e){return arguments.length?(i=Ec(e),c):i},c.cornerRadius=function(e,t,n,i){return arguments.length?(r=Ec(e),a=null!=t?Ec(t):r,s=null!=n?Ec(n):r,o=null!=i?Ec(i):a,c):r},c.context=function(e){return arguments.length?(u=null==e?null:e,c):u},c},Cc=function(){var e,t,n,i,r,a,o,s,u=null;function c(e,t,n){var i=n/2;if(r){var c=o-t,l=e-a;if(c||l){var f=Math.sqrt(c*c+l*l),d=(c/=f)*s,h=(l/=f)*s,p=Math.atan2(l,c);u.moveTo(a-d,o-h),u.lineTo(e-c*i,t-l*i),u.arc(e,t,i,p-Math.PI,p),u.lineTo(a+d,o+h),u.arc(a,o,s,p,p+Math.PI)}else u.arc(e,t,i,0,ac);u.closePath()}else r=1;a=e,o=t,s=i}function l(a){var o,s,l,f=a.length,d=!1;for(null==u&&(u=l=Object(Oc["a"])()),o=0;o<=f;++o)!(o<f&&i(s=a[o],o,a))===d&&(d=!d)&&(r=0),d&&c(+e(s,o,a),+t(s,o,a),+n(s,o,a));if(l)return u=null,l+""||null}return l.x=function(t){return arguments.length?(e=t,l):e},l.y=function(e){return arguments.length?(t=e,l):t},l.size=function(e){return arguments.length?(n=e,l):n},l.defined=function(e){return arguments.length?(i=e,l):i},l.context=function(e){return arguments.length?(u=null==e?null:e,l):u},l},Fc=n("650c"),$c=n("e38c"),Mc=n("fae8"),Nc=n("9150");function Rc(e,t){return null!=e?e:t}const zc=e=>e.x||0,Tc=e=>e.y||0,Lc=e=>e.width||0,Pc=e=>e.height||0,Bc=e=>(e.x||0)+(e.width||0),Ic=e=>(e.y||0)+(e.height||0),Uc=e=>e.startAngle||0,qc=e=>e.endAngle||0,Wc=e=>e.padAngle||0,Hc=e=>e.innerRadius||0,Gc=e=>e.outerRadius||0,Vc=e=>e.cornerRadius||0,Zc=e=>Rc(e.cornerRadiusTopLeft,e.cornerRadius)||0,Yc=e=>Rc(e.cornerRadiusTopRight,e.cornerRadius)||0,Xc=e=>Rc(e.cornerRadiusBottomRight,e.cornerRadius)||0,Jc=e=>Rc(e.cornerRadiusBottomLeft,e.cornerRadius)||0,Qc=e=>Rc(e.size,64),Kc=e=>e.size||1,el=e=>!(!1===e.defined),tl=e=>bc(e.shape||"circle"),nl=Object(Fc["a"])().startAngle(Uc).endAngle(qc).padAngle(Wc).innerRadius(Hc).outerRadius(Gc).cornerRadius(Vc),il=Object($c["a"])().x(zc).y1(Tc).y0(Ic).defined(el),rl=Object($c["a"])().y(Tc).x1(zc).x0(Bc).defined(el),al=Object(Mc["a"])().x(zc).y(Tc).defined(el),ol=Sc().x(zc).y(Tc).width(Lc).height(Pc).cornerRadius(Zc,Yc,Xc,Jc),sl=Object(Nc["a"])().type(tl).size(Qc),ul=Cc().x(zc).y(Tc).defined(el).size(Kc);function cl(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function ll(e,t){return nl.context(e)(t)}function fl(e,t){var n=t[0],i=n.interpolate||"linear";return("horizontal"===n.orient?rl:il).curve(Qu(i,n.orient,n.tension)).context(e)(t)}function dl(e,t){var n=t[0],i=n.interpolate||"linear";return al.curve(Qu(i,n.orient,n.tension)).context(e)(t)}function hl(e,t,n,i){return ol.context(e)(t,n,i)}function pl(e,t){return(t.mark.shape||t.shape).context(e)(t)}function gl(e,t){return sl.context(e)(t)}function ml(e,t){return ul.context(e)(t)}var vl=function(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){const i=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(i+(n?bl(t,i):0))}return e};function bl(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}var yl,xl,Ol,wl=ac-1e-8;function jl(e){return yl=e,jl}function kl(){}function _l(e,t){yl.add(e,t)}function Al(e,t){_l(xl=e,Ol=t)}function El(e){_l(e,yl.y1)}function Dl(e){_l(yl.x1,e)}function Sl(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}function Cl(e,t,n,i,r){const a=i-e+3*t-3*n,o=e+n-2*t,s=e-t;let u,c=0,l=0;Math.abs(a)>ic?(u=o*o+s*a,u>=0&&(u=Math.sqrt(u),c=(-o+u)/a,l=(-o-u)/a)):c=.5*s/o,0<c&&c<1&&r(Fl(c,e,t,n,i)),0<l&&l<1&&r(Fl(l,e,t,n,i))}function Fl(e,t,n,i,r){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*i+s*e*r}jl.beginPath=kl,jl.closePath=kl,jl.moveTo=Al,jl.lineTo=Al,jl.rect=function(e,t,n,i){_l(e+n,t+i),Al(e,t)},jl.quadraticCurveTo=function(e,t,n,i){Sl(xl,e,n,El),Sl(Ol,t,i,Dl),Al(n,i)},jl.bezierCurveTo=function(e,t,n,i,r,a){Cl(xl,e,n,r,El),Cl(Ol,t,i,a,Dl),Al(r,a)},jl.arc=function(e,t,n,i,r,a){if(xl=n*Math.cos(r)+e,Ol=n*Math.sin(r)+t,Math.abs(r-i)>wl)_l(e-n,t-n),_l(e+n,t+n);else{const o=i=>_l(n*Math.cos(i)+e,n*Math.sin(i)+t);let s,u;if(o(i),o(r),r!==i)if(i%=ac,i<0&&(i+=ac),r%=ac,r<0&&(r+=ac),r<i&&(a=!a,s=i,i=r,r=s),a)for(r-=ac,s=i-i%rc,u=0;u<4&&s>r;++u,s-=rc)o(s);else for(s=i-i%rc+rc,u=0;u<4&&s<r;++u,s+=rc)o(s)}};var $l=($l=Cu(1,1))?$l.getContext("2d"):null;const Ml=new xu;function Nl(e){return function(t,n){if(!$l)return!0;e($l,t),Ml.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:a,y2:o}=Ml;for(let e=r;e<=o;++e)for(let t=i;t<=a;++t)if($l.isPointInPath(t,e))return!0;return!1}}function Rl(e,t){return t.contains(e.x||0,e.y||0)}function zl(e,t){const n=e.x||0,i=e.y||0,r=e.width||0,a=e.height||0;return t.intersects(Ml.set(n,i,n+r,i+a))}function Tl(e,t){const n=e.x||0,i=e.y||0,r=null!=e.x2?e.x2:n,a=null!=e.y2?e.y2:i;return Ll(t,n,i,r,a)}function Ll(e,t,n,i,r){const{x1:a,y1:o,x2:s,y2:u}=e,c=i-t,l=r-n;let f,d,h,p,g=0,m=1;for(p=0;p<4;++p){if(0===p&&(f=-c,d=-(a-t)),1===p&&(f=c,d=s-t),2===p&&(f=-l,d=-(o-n)),3===p&&(f=l,d=u-n),Math.abs(f)<1e-10&&d<0)return!1;if(h=d/f,f<0){if(h>m)return!1;h>g&&(g=h)}else if(f>0){if(h<g)return!1;h<m&&(m=h)}}return!0}var Pl=function(e,t,n){const i=n.width(),r=n.height(),a=t.stops,o=a.length,s="radial"===t.gradient?e.createRadialGradient(n.x1+Bl(t.x1,.5)*i,n.y1+Bl(t.y1,.5)*r,Math.max(i,r)*Bl(t.r1,0),n.x1+Bl(t.x2,.5)*i,n.y1+Bl(t.y2,.5)*r,Math.max(i,r)*Bl(t.r2,.5)):e.createLinearGradient(n.x1+Bl(t.x1,0)*i,n.y1+Bl(t.y1,0)*r,n.x1+Bl(t.x2,1)*i,n.y1+Bl(t.y2,0)*r);for(let u=0;u<o;++u)s.addColorStop(a[u].offset,a[u].color);return s};function Bl(e,t){return null==e?t:e}var Il=function(e,t,n){return ku(n)?Pl(e,n,t.bounds):n},Ul=function(e,t,n){return n*=null==t.fillOpacity?1:t.fillOpacity,n>0&&(e.globalAlpha=n,e.fillStyle=Il(e,t,t.fill),!0)},ql=[],Wl=function(e,t,n){var i=null!=(i=t.strokeWidth)?i:1;return!(i<=0)&&(n*=null==t.strokeOpacity?1:t.strokeOpacity,n>0&&(e.globalAlpha=n,e.strokeStyle=Il(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||ql),e.lineDashOffset=t.strokeDashOffset||0),!0))};function Hl(e,t){return e.zindex-t.zindex||e.index-t.index}function Gl(e){if(!e.zdirty)return e.zitems;var t,n,i,r=e.items,a=[];for(n=0,i=r.length;n<i;++n)t=r[n],t.index=n,t.zindex&&a.push(t);return e.zdirty=!1,e.zitems=a.sort(Hl)}function Vl(e,t){var n,i,r=e.items;if(r&&r.length){var a=Gl(e);if(a&&a.length){for(n=0,i=r.length;n<i;++n)r[n].zindex||t(r[n]);r=a}for(n=0,i=r.length;n<i;++n)t(r[n])}}function Zl(e,t){var n,i,r=e.items;if(!r||!r.length)return null;var a=Gl(e);for(a&&a.length&&(r=a),i=r.length;--i>=0;)if(n=t(r[i]))return n;if(r===a)for(r=e.items,i=r.length;--i>=0;)if(!r[i].zindex&&(n=t(r[i])))return n;return null}function Yl(e){return function(t,n,i){Vl(n,(function(n){i&&!i.intersects(n.bounds)||Jl(e,t,n,n)}))}}function Xl(e){return function(t,n,i){!n.items.length||i&&!i.intersects(n.bounds)||Jl(e,t,n.items[0],n.items)}}function Jl(e,t,n,i){var r=null==n.opacity?1:n.opacity;0!==r&&(e(t,i)||(n.fill&&Ul(t,n,r)&&t.fill(),n.stroke&&Wl(t,n,r)&&t.stroke()))}function Ql(e){return e=e||ie["gb"],function(t,n,i,r,a,o){return i*=t.pixelRatio,r*=t.pixelRatio,Zl(n,(function(n){var s=n.bounds;if((!s||s.contains(a,o))&&s)return e(t,n,i,r,a,o)?n:void 0}))}}function Kl(e,t){return function(n,i,r,a){var o,s,u=Array.isArray(i)?i[0]:i,c=null==t?u.fill:t,l=u.stroke&&n.isPointInStroke;return l&&(o=u.strokeWidth,s=u.strokeCap,n.lineWidth=null!=o?o:1,n.lineCap=null!=s?s:"butt"),!e(n,i)&&(c&&n.isPointInPath(r,a)||l&&n.isPointInStroke(r,a))}}function ef(e){return Ql(Kl(e))}function tf(e,t){return"translate("+e+","+t+")"}function nf(e){return"rotate("+e+")"}function rf(e,t){return"scale("+e+","+t+")"}function af(e){return tf(e.x||0,e.y||0)}function of(e){return tf(e.x||0,e.y||0)+(e.angle?" "+nf(e.angle):"")+(e.scaleX||e.scaleY?" "+rf(e.scaleX||1,e.scaleY||1):"")}var sf=function(e,t,n){function i(e,n){e("transform",of(n)),e("d",t(null,n))}function r(e,n){var i=n.x||0,r=n.y||0;return t(jl(e),n),vl(e,n).translate(i,r),n.angle&&e.rotate(n.angle*nc,i,r),e}function a(e,n){var i=n.x||0,r=n.y||0,a=n.angle||0;e.translate(i,r),a&&e.rotate(a*=nc),e.beginPath(),t(e,n),a&&e.rotate(-a),e.translate(-i,-r)}return{type:e,tag:"path",nested:!1,attr:i,bound:r,draw:Yl(a),pick:ef(a),isect:n||Nl(a)}},uf=sf("arc",ll);function cf(e,t){var n,i,r="horizontal"===e[0].orient?t[1]:t[0],a="horizontal"===e[0].orient?"y":"x",o=e.length,s=1/0;while(--o>=0)!1!==e[o].defined&&(i=Math.abs(e[o][a]-r),i<s&&(s=i,n=e[o]));return n}function lf(e,t){var n,i,r,a=Math.pow(e[0].strokeWidth||1,2),o=e.length;while(--o>=0)if(!1!==e[o].defined&&(n=e[o].x-t[0],i=e[o].y-t[1],r=n*n+i*i,r<a))return e[o];return null}function ff(e,t){var n,i,r,a=e.length;while(--a>=0)if(!1!==e[a].defined&&(n=e[a].x-t[0],i=e[a].y-t[1],r=n*n+i*i,n=e[a].size||1,r<n*n))return e[a];return null}var df=function(e,t,n){function i(e,n){var i=n.mark.items;i.length&&e("d",t(null,i))}function r(e,n){var i=n.items;return 0===i.length?e:(t(jl(e),i),vl(e,i[0]))}function a(e,n){e.beginPath(),t(e,n)}var o=Kl(a);function s(e,t,n,i,r,a){var s=t.items,u=t.bounds;return!s||!s.length||u&&!u.contains(r,a)?null:(n*=e.pixelRatio,i*=e.pixelRatio,o(e,s,n,i)?s[0]:null)}return{type:e,tag:"path",nested:!0,attr:i,bound:r,draw:Xl(a),pick:s,isect:Rl,tip:n}},hf=df("area",fl,cf),pf=function(e,t){var n=t.clip;e.save(),Object(ie["D"])(n)?(e.beginPath(),n(e),e.clip()):gf(e,t.group)};function gf(e,t){e.beginPath(),cl(t)?hl(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}var mf=1;function vf(){mf=1}var bf=function(e,t,n){var i=t.clip,r=e._defs,a=t.clip_id||(t.clip_id="clip"+mf++),o=r.clipping[a]||(r.clipping[a]={id:a});return Object(ie["D"])(i)?o.path=i(null):cl(n)?o.path=hl(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"};function yf(e){var t=null!=(t=e.strokeWidth)?t:1;return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function xf(e,t){e("transform",af(t))}function Of(e,t){var n=yf(t);e("d",hl(null,t,n,n))}function wf(e,t){e("class","background"),Of(e,t)}function jf(e,t){e("class","foreground"),t.strokeForeground?Of(e,t):e("d","")}function kf(e,t,n){var i=t.clip?bf(n,t,t):null;e("clip-path",i)}function _f(e,t){if(!t.clip&&t.items)for(var n=t.items,i=0,r=n.length;i<r;++i)e.union(n[i].bounds);return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),vl(e,t),e.translate(t.x||0,t.y||0)}function Af(e,t,n,i){var r=yf(t);e.beginPath(),hl(e,t,(n||0)+r,(i||0)+r)}var Ef=Kl(Af),Df=Kl(Af,!1);function Sf(e,t,n){var i=this;Vl(t,(function(t){var r=t.x||0,a=t.y||0,o=t.strokeForeground,s=null==t.opacity?1:t.opacity;(t.stroke||t.fill)&&s&&(Af(e,t,r,a),t.fill&&Ul(e,t,s)&&e.fill(),t.stroke&&!o&&Wl(e,t,s)&&e.stroke()),e.save(),e.translate(r,a),t.clip&&gf(e,t),n&&n.translate(-r,-a),Vl(t,(function(t){i.draw(e,t,n)})),n&&n.translate(r,a),e.restore(),o&&t.stroke&&s&&(Af(e,t,r,a),Wl(e,t,s)&&e.stroke())}))}function Cf(e,t,n,i,r,a){if(t.bounds&&!t.bounds.contains(r,a)||!t.items)return null;var o=this,s=n*e.pixelRatio,u=i*e.pixelRatio;return Zl(t,(function(c){var l,f,d,h,p,g,m,v,b;if(v=c.bounds,(!v||v.contains(r,a))&&(h=c.x||0,p=c.y||0,g=h+(c.width||0),m=p+(c.height||0),b=c.clip,!b||!(r<h||r>g||a<h||a>m)))return e.save(),e.translate(h,p),h=r-h,p=a-p,b&&cl(c)&&!Ef(e,c,s,u)?(e.restore(),null):(f=c.strokeForeground,d=!1!==t.interactive,d&&f&&c.stroke&&Df(e,c,s,u)?(e.restore(),c):(l=Zl(c,(function(e){return Ff(e,h,p)?o.pick(e,n,i,h,p):null})),!l&&d&&(c.fill||!f&&c.stroke)&&Ef(e,c,s,u)&&(l=c),e.restore(),l||null))}))}function Ff(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}var $f={type:"group",tag:"g",nested:!1,attr:xf,bound:_f,draw:Sf,pick:Cf,isect:zl,content:kf,background:wf,foreground:jf};function Mf(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(t=>{e.image=t,e.image.url=e.url})),n}function Nf(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function Rf(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function zf(e,t){return"center"===e?t/2:"right"===e?t:0}function Tf(e,t){return"middle"===e?t/2:"bottom"===e?t:0}function Lf(e,t,n){var i=Mf(t,n),r=t.x||0,a=t.y||0,o=Nf(t,i),s=Rf(t,i),u=!1===t.aspect?"none":"xMidYMid";r-=zf(t.align,o),a-=Tf(t.baseline,s),!i.src&&i.toDataURL?e("href",i.toDataURL(),"http://www.w3.org/1999/xlink","xlink:href"):e("href",i.src||"","http://www.w3.org/1999/xlink","xlink:href"),e("transform",tf(r,a)),e("width",o),e("height",s),e("preserveAspectRatio",u)}function Pf(e,t){var n=t.image,i=t.x||0,r=t.y||0,a=Nf(t,n),o=Rf(t,n);return i-=zf(t.align,a),r-=Tf(t.baseline,o),e.set(i,r,i+a,r+o)}function Bf(e,t,n){var i=this;Vl(t,(function(t){if(!n||n.intersects(t.bounds)){var r,a,o,s,u=Mf(t,i),c=t.x||0,l=t.y||0,f=Nf(t,u),d=Rf(t,u);c-=zf(t.align,f),l-=Tf(t.baseline,d),!1!==t.aspect&&(a=u.width/u.height,o=t.width/t.height,a===a&&o===o&&a!==o&&(o<a?(s=f/a,l+=(d-s)/2,d=s):(s=d*a,c+=(f-s)/2,f=s))),(u.complete||u.toDataURL)&&(e.globalAlpha=null!=(r=t.opacity)?r:1,e.imageSmoothingEnabled=!1!==t.smooth,e.drawImage(u,c,l,f,d))}}))}var If={type:"image",tag:"image",nested:!1,attr:Lf,bound:Pf,draw:Bf,pick:Ql(),isect:ie["gb"],get:Mf,xOffset:zf,yOffset:Tf},Uf=df("line",dl,lf);function qf(e,t){var n=t.scaleX||1,i=t.scaleY||1;1===n&&1===i||e("vector-effect","non-scaling-stroke"),e("transform",of(t)),e("d",t.path)}function Wf(e,t){var n=t.path;if(null==n)return!0;var i=t.x||0,r=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*nc,u=t.pathCache;u&&u.path===n||((t.pathCache=u=tc(n)).path=n),s&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(s),pc(e,u,0,0,a,o),e.rotate(-s),e.translate(-i,-r)):pc(e,u,i,r,a,o)}function Hf(e,t){return Wf(jl(e),t)?e.set(0,0,0,0):vl(e,t,!0),t.angle&&e.rotate(t.angle*nc,t.x||0,t.y||0),e}var Gf={type:"path",tag:"path",nested:!1,attr:qf,bound:Hf,draw:Yl(Wf),pick:ef(Wf),isect:Nl(Wf)};function Vf(e,t){e("d",hl(null,t))}function Zf(e,t){var n,i;return vl(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)}function Yf(e,t){e.beginPath(),hl(e,t)}var Xf={type:"rect",tag:"path",nested:!1,attr:Vf,bound:Zf,draw:Yl(Yf),pick:ef(Yf),isect:zl};function Jf(e,t){e("transform",af(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)}function Qf(e,t){var n,i;return vl(e.set(n=t.x||0,i=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:i),t)}function Kf(e,t,n){var i,r,a,o;return!(!t.stroke||!Wl(e,t,n))&&(i=t.x||0,r=t.y||0,a=null!=t.x2?t.x2:i,o=null!=t.y2?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(a,o),!0)}function ed(e,t,n){Vl(t,(function(t){if(!n||n.intersects(t.bounds)){var i=null==t.opacity?1:t.opacity;i&&Kf(e,t,i)&&e.stroke()}}))}function td(e,t,n,i){return!!e.isPointInStroke&&(Kf(e,t,1)&&e.isPointInStroke(n,i))}var nd={type:"rule",tag:"line",nested:!1,attr:Jf,bound:Qf,draw:ed,pick:Ql(td),isect:Tl},id=sf("shape",pl),rd=sf("symbol",gl,Rl);const ad=Object(ie["L"])();var od={height:dd,measureWidth:ld,estimateWidth:ud,width:ud,canvas:sd};function sd(e){od.width=e&&$l?ld:ud}function ud(e,t){return cd(vd(e,t),dd(e))}function cd(e,t){return~~(.8*e.length*t)}function ld(e,t){return dd(e)<=0||!(t=vd(e,t))?0:fd(t,Od(e))}function fd(e,t){const n=`(${t}) ${e}`;let i=ad.get(n);return void 0===i&&($l.font=t,i=$l.measureText(e).width,ad.set(n,i)),i}function dd(e){return null!=e.fontSize?+e.fontSize||0:11}function hd(e){return null!=e.lineHeight?e.lineHeight:dd(e)+2}function pd(e){return Object(ie["A"])(e)?e.length>1?e:e[0]:e}function gd(e){return pd(e.lineBreak&&e.text&&!Object(ie["A"])(e.text)?e.text.split(e.lineBreak):e.text)}function md(e){const t=gd(e);return(Object(ie["A"])(t)?t.length-1:0)*hd(e)}function vd(e,t){return null==t?"":e.limit>0?yd(e,t):t+""}function bd(e){if(od.width===ld){const t=Od(e);return e=>fd(e,t)}{const t=dd(e);return e=>cd(e,t)}}function yd(e,t){var n=+e.limit,i=t+"",r=bd(e);if(r(i)<n)return i;var a,o=e.ellipsis||"…",s="rtl"===e.dir,u=0,c=i.length;if(n-=r(o),s){while(u<c)a=u+c>>>1,r(i.slice(a))>n?u=a+1:c=a;return o+i.slice(u)}while(u<c)a=1+(u+c>>>1),r(i.slice(0,a))<n?u=a:c=a-1;return i.slice(0,u)+o}function xd(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function Od(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+dd(e)+"px "+xd(e,t)}function wd(e){var t=e.baseline,n=dd(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:0)}sd(!0);var jd={left:"start",center:"middle",right:"end"},kd=new xu;function _d(e){var t,n=e.x||0,i=e.y||0,r=e.radius||0;return r&&(t=(e.theta||0)-rc,n+=r*Math.cos(t),i+=r*Math.sin(t)),kd.x1=n,kd.y1=i,kd}function Ad(e,t){var n,i=t.dx||0,r=(t.dy||0)+wd(t),a=_d(t),o=a.x1,s=a.y1,u=t.angle||0;e("text-anchor",jd[t.align]||"start"),u?(n=tf(o,s)+" "+nf(u),(i||r)&&(n+=" "+tf(i,r))):n=tf(o+i,s+r),e("transform",n)}function Ed(e,t,n){var i,r=od.height(t),a=t.align,o=_d(t),s=o.x1,u=o.y1,c=t.dx||0,l=(t.dy||0)+wd(t)-Math.round(.8*r),f=gd(t);if(Object(ie["A"])(f)?(r+=hd(t)*(f.length-1),i=f.reduce((e,n)=>Math.max(e,od.width(t,n)),0)):i=od.width(t,f),"center"===a?c-=i/2:"right"===a&&(c-=i),e.set(c+=s,l+=u,c+i,l+r),t.angle&&!n)e.rotate(t.angle*nc,s,u);else if(2===n)return e.rotatedPoints(t.angle*nc,s,u);return e}function Dd(e,t,n){Vl(t,(function(t){var i,r,a,o,s,u,c,l=null==t.opacity?1:t.opacity;if(!(n&&!n.intersects(t.bounds)||0===l||t.fontSize<=0||null==t.text||0===t.text.length)){if(e.font=Od(t),e.textAlign=t.align||"left",i=_d(t),r=i.x1,a=i.y1,t.angle&&(e.save(),e.translate(r,a),e.rotate(t.angle*nc),r=a=0),r+=t.dx||0,a+=(t.dy||0)+wd(t),u=gd(t),Object(ie["A"])(u))for(s=hd(t),o=0;o<u.length;++o)c=vd(t,u[o]),t.fill&&Ul(e,t,l)&&e.fillText(c,r,a),t.stroke&&Wl(e,t,l)&&e.strokeText(c,r,a),a+=s;else c=vd(t,u),t.fill&&Ul(e,t,l)&&e.fillText(c,r,a),t.stroke&&Wl(e,t,l)&&e.strokeText(c,r,a);t.angle&&e.restore()}}))}function Sd(e,t,n,i,r,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=_d(t),s=o.x1,u=o.y1,c=Ed(kd,t,1),l=-t.angle*nc,f=Math.cos(l),d=Math.sin(l),h=f*r-d*a+(s-f*s+d*u),p=d*r+f*a+(u-d*s-f*u);return c.contains(h,p)}function Cd(e,t){var n=Ed(kd,e,2);return Ll(t,n[0],n[1],n[2],n[3])||Ll(t,n[0],n[1],n[4],n[5])||Ll(t,n[4],n[5],n[6],n[7])||Ll(t,n[2],n[3],n[6],n[7])}var Fd={type:"text",tag:"text",nested:!1,attr:Ad,bound:Ed,draw:Dd,pick:Ql(Sd),isect:Cd},$d=df("trail",ml,ff),Md={arc:uf,area:hf,group:$f,image:If,line:Uf,path:Gf,rect:Xf,rule:nd,shape:id,symbol:rd,text:Fd,trail:$d},Nd=function(e,t,n){var i=Md[e.mark.marktype],r=t||i.bound;return i.nested&&(e=e.mark),r(e.bounds||(e.bounds=new xu),e,n)},Rd={mark:null},zd=function(e,t,n){var i,r,a,o,s=Md[e.marktype],u=s.bound,c=e.items,l=c&&c.length;if(s.nested)return l?a=c[0]:(Rd.mark=e,a=Rd),o=Nd(a,u,n),t=t&&t.union(o)||o,t;if(t=t||e.bounds&&e.bounds.clear()||new xu,l)for(i=0,r=c.length;i<r;++i)t.union(Nd(c[i],u,n));return e.bounds=t},Td=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant"];function Ld(e,t){return JSON.stringify(e,Td,t)}function Pd(e){var t="string"===typeof e?JSON.parse(e):e;return Bd(t)}function Bd(e){var t,n,i,r=e.marktype,a=e.items;if(a)for(n=0,i=a.length;n<i;++n)t=r?"mark":"group",a[n][t]=e,a[n].zindex&&(a[n][t].zdirty=!0),"group"===(r||t)&&Bd(a[n]);return r&&zd(e),e}function Id(e){arguments.length?this.root=Pd(e):(this.root=qd({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Su(this.root)])}var Ud=Id.prototype;function qd(e,t){return{bounds:new xu,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0}}function Wd(e,t,n){return!e&&"undefined"!==typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Hd(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function Gd(e,t,n,i){var r,a=e.childNodes[t];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(r=a||null,a=Wd(e.ownerDocument,n,i),e.insertBefore(a,r)),a}function Vd(e,t){var n=e.childNodes,i=n.length;while(i>t)e.removeChild(n[--i]);return e}function Zd(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}Ud.toJSON=function(e){return Ld(this.root,e||0)},Ud.mark=function(e,t,n){t=t||this.root.items[0];var i=qd(e,t);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i};var Yd=function(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]},Xd=function(e,t,n,i){var r,a,o=e&&e.mark;if(o&&(r=Md[o.marktype]).tip){a=Yd(t,n),a[0]-=i[0],a[1]-=i[1];while(e=e.mark.group)a[0]-=e.x||0,a[1]-=e.y||0;e=r.tip(o.items,a)}return e};function Jd(e,t){this._active=null,this._handlers={},this._loader=e||_t(),this._tooltip=t||Qd}function Qd(e,t,n,i){e.element().setAttribute("title",i||"")}var Kd=Jd.prototype;function eh(e){this._el=null,this._bgcolor=null,this._loader=new $u(e)}Kd.initialize=function(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},Kd.element=function(){return this._el},Kd.canvas=function(){return this._el&&this._el.firstChild},Kd.origin=function(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},Kd.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},Kd.on=function(){},Kd.off=function(){},Kd._handlerIndex=function(e,t,n){for(var i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},Kd.handlers=function(e){var t,n=this._handlers,i=[];if(e)i.push.apply(i,n[this.eventName(e)]);else for(t in n)i.push.apply(i,n[t]);return i},Kd.eventName=function(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)},Kd.handleHref=function(e,t,n){this._loader.sanitize(n,{context:"href"}).then((function(t){var n=new MouseEvent(e.type,e),i=Wd(null,"a");for(var r in t)i.setAttribute(r,t[r]);i.dispatchEvent(n)})).catch((function(){}))},Kd.handleTooltip=function(e,t,n){if(t&&null!=t.tooltip){t=Xd(t,e,this.canvas(),this._origin);var i=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,i)}},Kd.getItemBoundingClientRect=function(e){if(t=this.canvas()){var t,n=t.getBoundingClientRect(),i=this._origin,r=e.bounds,a=r.x1+i[0]+n.left,o=r.y1+i[1]+n.top,s=r.width(),u=r.height();while(e.mark&&(e=e.mark.group))a+=e.x||0,o+=e.y||0;return{x:a,y:o,width:s,height:u,left:a,top:o,right:a+s,bottom:o+u}}};var th=eh.prototype;th.initialize=function(e,t,n,i,r){return this._el=e,this.resize(t,n,i,r)},th.element=function(){return this._el},th.canvas=function(){return this._el&&this._el.firstChild},th.background=function(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},th.resize=function(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},th.dirty=function(){},th.render=function(e){var t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},th._render=function(){},th.renderAsync=function(e){var t=this.render(e);return this._ready?this._ready.then((function(){return t})):Promise.resolve(t)},th._load=function(e,t){var n=this,i=n._loader[e](t);if(!n._ready){var r=n._call;n._ready=n._loader.ready().then((function(e){e&&r(),n._ready=null}))}return i},th.sanitizeURL=function(e){return this._load("sanitizeURL",e)},th.loadImage=function(e){return this._load("loadImage",e)};var nh=["keydown","keypress","keyup","dragenter","dragleave","dragover","mousedown","mouseup","mousemove","mouseout","mouseover","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],ih="mousemove",rh="mouseout",ah="click";function oh(e,t){Jd.call(this,e,t),this._down=null,this._touch=null,this._first=!0}var sh=Object(ie["y"])(oh,Jd);function uh(e,t,n){return function(i){var r=this._active,a=this.pickEvent(i);a===r||(r&&r.exit||this.fire(n,i),this._active=a,this.fire(t,i)),this.fire(e,i)}}function ch(e){return function(t){this.fire(e,t),this._active=null}}function lh(){return"undefined"!==typeof window&&window.devicePixelRatio||1}sh.initialize=function(e,t,n){var i=this._canvas=e&&Hd(e,"canvas");if(i){var r=this;this.events.forEach((function(e){i.addEventListener(e,(function(t){sh[e]?sh[e].call(r,t):r.fire(e,t)}))}))}return Jd.prototype.initialize.call(this,e,t,n)},sh.canvas=function(){return this._canvas},sh.context=function(){return this._canvas.getContext("2d")},sh.events=nh,sh.DOMMouseScroll=function(e){this.fire("mousewheel",e)},sh.mousemove=uh("mousemove","mouseover","mouseout"),sh.dragover=uh("dragover","dragenter","dragleave"),sh.mouseout=ch("mouseout"),sh.dragleave=ch("dragleave"),sh.mousedown=function(e){this._down=this._active,this.fire("mousedown",e)},sh.click=function(e){this._down===this._active&&(this.fire("click",e),this._down=null)},sh.touchstart=function(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",e,!0)},sh.touchmove=function(e){this.fire("touchmove",e,!0)},sh.touchend=function(e){this.fire("touchend",e,!0),this._touch=null},sh.fire=function(e,t,n){var i,r,a=n?this._touch:this._active,o=this._handlers[e];if(t.vegaType=e,e===ah&&a&&a.href?this.handleHref(t,a,a.href):e!==ih&&e!==rh||this.handleTooltip(t,a,e!==rh),o)for(i=0,r=o.length;i<r;++i)o[i].handler.call(this._obj,t,a)},sh.on=function(e,t){var n=this.eventName(e),i=this._handlers,r=this._handlerIndex(i[n],e,t);return r<0&&(i[n]||(i[n]=[])).push({type:e,handler:t}),this},sh.off=function(e,t){var n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&i.splice(r,1),this},sh.pickEvent=function(e){var t=Yd(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},sh.pick=function(e,t,n,i,r){var a=this.context(),o=Md[e.marktype];return o.pick.call(this,a,e,t,n,i,r)};var fh=lh(),dh=function(e,t,n,i,r,a){var o,s="undefined"!==typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,u=e.getContext("2d"),c=s?fh:r;for(o in e.width=t*c,e.height=n*c,a)u[o]=a[o];return s&&1!==c&&(e.style.width=t+"px",e.style.height=n+"px"),u.pixelRatio=c,u.setTransform(c,0,0,c,c*i[0],c*i[1]),e};function hh(e){eh.call(this,e),this._redraw=!1,this._dirty=new xu}var ph=Object(ie["y"])(hh,eh),gh=eh.prototype,mh=new xu;function vh(e,t,n){return t.expand(1).round(),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}function bh(e,t,n){return mh.set(0,0,t,n).translate(-e[0],-e[1])}function yh(e,t){if(null==t)return e;for(var n=mh.clear().union(e);null!=t;t=t.mark.group)n.translate(t.x||0,t.y||0);return n}function xh(e,t){Jd.call(this,e,t);var n=this;n._hrefHandler=wh(n,(function(e,t){t&&t.href&&n.handleHref(e,t,t.href)})),n._tooltipHandler=wh(n,(function(e,t){n.handleTooltip(e,t,e.type!==rh)}))}ph.initialize=function(e,t,n,i,r,a){return this._options=a,this._canvas=Cu(1,1,a&&a.type),e&&(Vd(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),gh.initialize.call(this,e,t,n,i,r)},ph.resize=function(e,t,n,i){return gh.resize.call(this,e,t,n,i),dh(this._canvas,this._width,this._height,this._origin,this._scale,this._options&&this._options.context),this._redraw=!0,this},ph.canvas=function(){return this._canvas},ph.context=function(){return this._canvas?this._canvas.getContext("2d"):null},ph.dirty=function(e){var t=yh(e.bounds,e.mark.group);this._dirty.union(t)},ph._render=function(e){var t=this.context(),n=this._origin,i=this._width,r=this._height,a=this._dirty;return t.save(),this._redraw||a.empty()?(this._redraw=!1,a=bh(n,i,r).expand(1)):a=vh(t,a.intersect(bh(n,i,r)),n,i,r),this.clear(-n[0],-n[1],i,r),this.draw(t,e,a),t.restore(),this._dirty.clear(),this},ph.draw=function(e,t,n){var i=Md[t.marktype];t.clip&&pf(e,t),i.draw.call(this,e,t,n),t.clip&&e.restore()},ph.clear=function(e,t,n,i){var r=this.context();r.clearRect(e,t,n,i),null!=this._bgcolor&&(r.fillStyle=this._bgcolor,r.fillRect(e,t,n,i))};var Oh=Object(ie["y"])(xh,Jd);function wh(e,t){return function(n){var i=n.target,r=i.__data__;n.vegaType=n.type,r=Array.isArray(r)?r[0]:r,t.call(e._obj,n,r)}}function jh(e,t,n){var i,r,a="<"+e;if(t)for(i in t)r=t[i],null!=r&&(a+=" "+i+'="'+r+'"');return n&&(a+=" "+n),a+">"}function kh(e){return"</"+e+">"}Oh.initialize=function(e,t,n){var i=this._svg;return i&&(i.removeEventListener(ah,this._hrefHandler),i.removeEventListener(ih,this._tooltipHandler),i.removeEventListener(rh,this._tooltipHandler)),this._svg=i=e&&Hd(e,"svg"),i&&(i.addEventListener(ah,this._hrefHandler),i.addEventListener(ih,this._tooltipHandler),i.addEventListener(rh,this._tooltipHandler)),Jd.prototype.initialize.call(this,e,t,n)},Oh.canvas=function(){return this._svg},Oh.on=function(e,t){var n=this.eventName(e),i=this._handlers,r=this._handlerIndex(i[n],e,t);if(r<0){var a={type:e,handler:t,listener:wh(this,t)};(i[n]||(i[n]=[])).push(a),this._svg&&this._svg.addEventListener(n,a.listener)}return this},Oh.off=function(e,t){var n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this};var _h={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},Ah={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},Eh=Object.keys(Ah),Dh=_h.xmlns;function Sh(e){eh.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var Ch=Object(ie["y"])(Sh,eh),Fh=eh.prototype;function $h(e,t,n){var i,r,a;if("radial"===t.gradient){var o=Gd(e,n++,"pattern",Dh);o.setAttribute("id",ju+t.id),o.setAttribute("viewBox","0,0,1,1"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("preserveAspectRatio","xMidYMid slice"),o=Gd(o,0,"rect",Dh),o.setAttribute("width","1"),o.setAttribute("height","1"),o.setAttribute("fill","url("+qh()+"#"+t.id+")"),e=Gd(e,n++,"radialGradient",Dh),e.setAttribute("id",t.id),e.setAttribute("fx",t.x1),e.setAttribute("fy",t.y1),e.setAttribute("fr",t.r1),e.setAttribute("cx",t.x2),e.setAttribute("cy",t.y2),e.setAttribute("r",t.r2)}else e=Gd(e,n++,"linearGradient",Dh),e.setAttribute("id",t.id),e.setAttribute("x1",t.x1),e.setAttribute("x2",t.x2),e.setAttribute("y1",t.y1),e.setAttribute("y2",t.y2);for(i=0,r=t.stops.length;i<r;++i)a=Gd(e,i,"stop",Dh),a.setAttribute("offset",t.stops[i].offset),a.setAttribute("stop-color",t.stops[i].color);return Vd(e,i),n}function Mh(e,t,n){var i;return e=Gd(e,n,"clipPath",Dh),e.setAttribute("id",t.id),t.path?(i=Gd(e,0,"path",Dh),i.setAttribute("d",t.path)):(i=Gd(e,0,"rect",Dh),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",t.width),i.setAttribute("height",t.height)),Vd(e,1),n+1}function Nh(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function Rh(e,t,n){t=t.lastChild.previousSibling;var i,r=0;Vl(n,(function(n){i=e.draw(t,n,i),++r})),Vd(t,1+r)}function zh(e,t,n,i,r){var a,o=e._svg;if(!o&&(a=t.ownerDocument,o=Wd(a,i,Dh),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},"g"===i))){var s=Wd(a,"path",Dh);o.appendChild(s),s.__data__=e;var u=Wd(a,"g",Dh);o.appendChild(u),u.__data__=e;var c=Wd(a,"path",Dh);o.appendChild(c),c.__data__=e,c.__values__={fill:"default"}}return(o.ownerSVGElement!==r||Th(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}function Th(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}Ch.initialize=function(e,t,n,i){return e&&(this._svg=Gd(e,0,"svg",Dh),this._svg.setAttribute("class","marks"),Vd(e,1),this._root=Gd(this._svg,0,"g",Dh),Vd(this._svg,1)),this._defs={gradient:{},clipping:{}},this.background(this._bgcolor),Fh.initialize.call(this,e,t,n,i)},Ch.background=function(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Fh.background.apply(this,arguments)},Ch.resize=function(e,t,n,i){return Fh.resize.call(this,e,t,n,i),this._svg&&(this._svg.setAttribute("width",this._width*this._scale),this._svg.setAttribute("height",this._height*this._scale),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this._dirty=[],this},Ch.canvas=function(){return this._svg},Ch.svg=function(){if(!this._svg)return null;var e={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var t in _h)e[t]=_h[t];var n=this._bgcolor?jh("rect",{width:this._width,height:this._height,style:"fill: "+this._bgcolor+";"})+kh("rect"):"";return jh("svg",e)+n+this._svg.innerHTML+kh("svg")},Ch._render=function(e){return this._dirtyCheck()&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,e),Vd(this._root,1)),this.updateDefs(),this._dirty=[],++this._dirtyID,this},Ch.updateDefs=function(){var e,t=this._svg,n=this._defs,i=n.el,r=0;for(e in n.gradient)i||(n.el=i=Gd(t,0,"defs",Dh)),r=$h(i,n.gradient[e],r);for(e in n.clipping)i||(n.el=i=Gd(t,0,"defs",Dh)),r=Mh(i,n.clipping[e],r);i&&(0===r?(t.removeChild(i),n.el=null):Vd(i,r))},Ch._resetDefs=function(){var e=this._defs;e.gradient={},e.clipping={}},Ch.dirty=function(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},Ch.isDirty=function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},Ch._dirtyCheck=function(){this._dirtyAll=!0;var e=this._dirty;if(!e.length||!this._dirtyID)return!0;var t,n,i,r,a,o,s,u=++this._dirtyID;for(a=0,o=e.length;a<o;++a)t=e[a],n=t.mark,n.marktype!==i&&(i=n.marktype,r=Md[i]),n.zdirty&&n.dirty!==u&&(this._dirtyAll=!1,Nh(t,u),n.items.forEach((function(e){e.dirty=u}))),n.zdirty||(t.exit?(r.nested&&n.items.length?(s=n.items[0],s._svg&&this._update(r,s._svg,s)):t._svg&&(s=t._svg.parentNode,s&&s.removeChild(t._svg)),t._svg=null):(t=r.nested?n.items[0]:t,t._update!==u&&(t._svg&&t._svg.ownerSVGElement?this._update(r,t._svg,t):(this._dirtyAll=!1,Nh(t,u)),t._update=u)));return!this._dirtyAll},Ch.draw=function(e,t,n){if(!this.isDirty(t))return t._svg;var i,r=this,a=this._svg,o=Md[t.marktype],s=!1===t.interactive?"none":null,u="g"===o.tag,c=null,l=0;function f(e){var t=r.isDirty(e),n=zh(e,i,c,o.tag,a);t&&(r._update(o,n,e),u&&Rh(r,n,e)),c=n,++l}return i=zh(t,e,n,"g",a),i.setAttribute("class",Zd(t)),u||i.style.setProperty("pointer-events",s),t.clip?i.setAttribute("clip-path",bf(r,t,t.group)):i.removeAttribute("clip-path"),o.nested?t.items.length&&f(t.items[0]):Vl(t,f),Vd(i,l),i};var Lh=null,Ph=null,Bh={group:function(e,t,n){var i,r;Lh=i=t.childNodes[2],Ph=i.__values__,e.foreground(Uh,n,this),Ph=t.__values__,Lh=t.childNodes[1],e.content(Uh,n,this),Lh=r=t.childNodes[0],e.background(Uh,n,this);var a=!1===n.mark.interactive?"none":null;if(a!==Ph.events&&(i.style.setProperty("pointer-events",a),r.style.setProperty("pointer-events",a),Ph.events=a),n.strokeForeground&&n.stroke){const e=n.fill;i.style.removeProperty("display"),this.style(r,n),r.style.removeProperty("stroke"),e&&(n.fill=null),Ph=i.__values__,this.style(i,n),e&&(n.fill=e),Lh=null}else i.style.setProperty("display","none"),i.style.setProperty("fill","none")},image:function(e,t,n){!1===n.smooth?(Ih(t,"image-rendering","optimizeSpeed"),Ih(t,"image-rendering","pixelated")):Ih(t,"image-rendering",null)},text:function(e,t,n){var i,r,a,o,s=gd(n);Object(ie["A"])(s)?(r=s.map(e=>vd(n,e)),i=r.join("\n"),i!==Ph.text&&(Vd(t,0),a=t.ownerDocument,o=hd(n),r.forEach((e,i)=>{const r=Wd(a,"tspan",Dh);r.__data__=n,r.textContent=e,i&&(r.setAttribute("x",0),r.setAttribute("dy",o)),t.appendChild(r)}),Ph.text=i)):(r=vd(n,s),r!==Ph.text&&(t.textContent=r,Ph.text=r)),Ih(t,"font-family",xd(n)),Ih(t,"font-size",dd(n)+"px"),Ih(t,"font-style",n.fontStyle),Ih(t,"font-variant",n.fontVariant),Ih(t,"font-weight",n.fontWeight)}};function Ih(e,t,n){n!==Ph[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),Ph[t]=n)}function Uh(e,t,n){t!==Ph[e]&&(null!=t?n?Lh.setAttributeNS(n,e,t):Lh.setAttribute(e,t):n?Lh.removeAttributeNS(n,e):Lh.removeAttribute(e),Ph[e]=t)}function qh(){var e;return"undefined"===typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Wh(e){eh.call(this,e),this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}}Ch._update=function(e,t,n){Lh=t,Ph=t.__values__,e.attr(Uh,n,this);var i=Bh[e.type];i&&i.call(this,e,t,n),Lh&&this.style(Lh,n)},Ch.style=function(e,t){var n,i,r,a,o;if(null!=t)for(n=0,i=Eh.length;n<i;++n)r=Eh[n],o=t[r],"font"===r&&(o=xd(t)),o!==Ph[r]&&(a=Ah[r],null==o?"fill"===a?e.style.setProperty(a,"none"):e.style.removeProperty(a):(ku(o)&&(o=_u(o,this._defs.gradient,qh())),e.style.setProperty(a,o+"")),Ph[r]=o)};var Hh,Gh=Object(ie["y"])(Wh,eh),Vh=eh.prototype;function Zh(e,t,n,i){Hh[i||e]=t}function Yh(e,t,n,i){if(null==e)return"";var r,a,o,s,u,c="";for("bgrect"===n&&!1===t.interactive&&(c+="pointer-events: none; "),"bgfore"===n&&(!1===t.interactive&&(c+="pointer-events: none; "),c+="display: none; "),"image"===n&&!1===e.smooth&&(c+="image-rendering: optimizeSpeed; image-rendering: pixelated; "),"text"===n&&(c+="font-family: "+xd(e)+"; ",c+="font-size: "+dd(e)+"px; ",e.fontStyle&&(c+="font-style: "+e.fontStyle+"; "),e.fontVariant&&(c+="font-variant: "+e.fontVariant+"; "),e.fontWeight&&(c+="font-weight: "+e.fontWeight+"; ")),r=0,a=Eh.length;r<a;++r)o=Eh[r],s=Ah[o],u=e[o],null==u?"fill"===s&&(c+="fill: none; "):"transparent"!==u||"fill"!==s&&"stroke"!==s?(ku(u)&&(u=_u(u,i.gradient,"")),c+=s+": "+u+"; "):c+=s+": none; ";return c?'style="'+c.trim()+'"':null}function Xh(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}Gh.resize=function(e,t,n,i){Vh.resize.call(this,e,t,n,i);var r=this._origin,a=this._text,o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var s in _h)o[s]=_h[s];a.head=jh("svg",o);var u=this._bgcolor;return"transparent"!==u&&"none"!==u||(u=null),a.bg=u?jh("rect",{width:this._width,height:this._height,style:"fill: "+u+";"})+kh("rect"):"",a.root=jh("g",{transform:"translate("+r+")"}),a.foot=kh("g")+kh("svg"),this},Gh.background=function(){var e=Vh.background.apply(this,arguments);return arguments.length&&this._text.head&&this.resize(this._width,this._height,this._origin,this._scale),e},Gh.svg=function(){var e=this._text;return e.head+e.bg+e.defs+e.root+e.body+e.foot},Gh._render=function(e){return this._text.body=this.mark(e),this._text.defs=this.buildDefs(),this},Gh.buildDefs=function(){var e,t,n,i,r,a=this._defs,o="";for(t in a.gradient){for(n=a.gradient[t],r=n.stops,"radial"===n.gradient?(o+=jh(i="pattern",{id:ju+t,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),o+=jh("rect",{width:"1",height:"1",fill:"url(#"+t+")"})+kh("rect"),o+=kh(i),o+=jh(i="radialGradient",{id:t,fx:n.x1,fy:n.y1,fr:n.r1,cx:n.x2,cy:n.y2,r:n.r2})):o+=jh(i="linearGradient",{id:t,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2}),e=0;e<r.length;++e)o+=jh("stop",{offset:r[e].offset,"stop-color":r[e].color})+kh("stop");o+=kh(i)}for(t in a.clipping)n=a.clipping[t],o+=jh("clipPath",{id:t}),n.path?o+=jh("path",{d:n.path})+kh("path"):o+=jh("rect",{x:0,y:0,width:n.width,height:n.height})+kh("rect"),o+=kh("clipPath");return o.length>0?jh("defs")+o+kh("defs"):""},Gh.attributes=function(e,t){return Hh={},e(Zh,t,this),Hh},Gh.href=function(e){var t,n=this,i=e.href;if(i){if(t=n._hrefs&&n._hrefs[i])return t;n.sanitizeURL(i).then((function(e){e["xlink:href"]=e.href,e.href=null,(n._hrefs||(n._hrefs={}))[i]=e}))}return null},Gh.mark=function(e){var t,n=this,i=Md[e.marktype],r=i.tag,a=this._defs,o="";function s(s){var u=n.href(s);if(u&&(o+=jh("a",u)),t="g"!==r?Yh(s,e,r,a):null,o+=jh(r,n.attributes(i.attr,s),t),"text"===r){const e=gd(s);if(Object(ie["A"])(e)){const t={x:0,dy:hd(s)};for(let n=0;n<e.length;++n)o+=jh("tspan",n?t:null)+Xh(vd(s,e[n]))+kh("tspan")}else o+=Xh(vd(s,e))}else if("g"===r){const t=s.strokeForeground,r=s.fill,u=s.stroke;t&&u&&(s.stroke=null),o+=jh("path",n.attributes(i.background,s),Yh(s,e,"bgrect",a))+kh("path"),o+=jh("g",n.attributes(i.content,s))+n.markGroup(s)+kh("g"),t&&u?(r&&(s.fill=null),s.stroke=u,o+=jh("path",n.attributes(i.foreground,s),Yh(s,e,"bgrect",a))+kh("path"),r&&(s.fill=r)):o+=jh("path",n.attributes(i.foreground,s),Yh({},e,"bgfore",a))+kh("path")}o+=kh(r),u&&(o+=kh("a"))}return"g"!==r&&!1===e.interactive&&(t='style="pointer-events: none;"'),o+=jh("g",{class:Zd(e),"clip-path":e.clip?bf(n,e,e.group):null},t),i.nested?e.items&&e.items.length&&s(e.items[0]):Vl(e,s),o+kh("g")},Gh.markGroup=function(e){var t=this,n="";return Vl(e,(function(e){n+=t.mark(e)})),n};var Jh="canvas",Qh="png",Kh="svg",ep="none",tp={Canvas:Jh,PNG:Qh,SVG:Kh,None:ep},np={};function ip(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(np[e]=t,this):np[e]}function rp(e,t,n){const i=[],r=(new xu).union(t),a=e.marktype;return a?ap(e,r,n,i):"group"===a?sp(e,r,n,i):Object(ie["n"])("Intersect scene must be mark node or group item.")}function ap(e,t,n,i){if(op(e,t,n)){const r=e.items,a=e.marktype,o=r.length;let s=0;if("group"===a)for(;s<o;++s)sp(r[s],t,n,i);else for(const e=Md[a].isect;s<o;++s){let n=r[s];up(n,t,e)&&i.push(n)}}return i}function op(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}function sp(e,t,n,i){n&&n(e.mark)&&up(e,t,Md.group.isect)&&i.push(e);const r=e.items,a=r&&r.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let e=0;e<a;++e)ap(r[e],t,n,i);t.translate(o,s)}return i}function up(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}np[Jh]=np[Qh]={renderer:hh,headless:hh,handler:oh},np[Kh]={renderer:Sh,headless:Wh,handler:xh},np[ep]={};var cp=new xu,lp=function(e){var t=e.clip;if(Object(ie["D"])(t))t(jl(cp.clear()));else{if(!t)return;cp.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(cp)},fp=1e-9;function dp(e,t,n){return e===t||("path"===n?hp(e,t):e instanceof Date&&t instanceof Date?+e===+t:Object(ie["E"])(e)&&Object(ie["E"])(t)?Math.abs(e-t)<=fp:e&&t&&(Object(ie["F"])(e)||Object(ie["F"])(t))?null!=e&&null!=t&&pp(e,t):e==t)}function hp(e,t){return dp(tc(e),tc(t))}function pp(e,t){var n,i,r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(r.sort(),a.sort(),i=r.length-1;i>=0;i--)if(r[i]!=a[i])return!1;for(i=r.length-1;i>=0;i--)if(n=r[i],!dp(e[n],t[n],n))return!1;return typeof e===typeof t}function gp(e){On.call(this,null,e)}var mp=Object(ie["y"])(gp,On);function vp(e,t,n){return t(e.bounds.clear(),e,n)}mp.transform=function(e,t){var n,i=t.dataflow,r=e.mark,a=r.marktype,o=Md[a],s=o.bound,u=r.bounds;if(o.nested)r.items.length&&i.dirty(r.items[0]),u=vp(r,s),r.items.forEach((function(e){e.bounds.clear().union(u)}));else if(a===Xs||e.modified())switch(t.visit(t.MOD,(function(e){i.dirty(e)})),u.clear(),r.items.forEach((function(e){u.union(vp(e,s))})),r.role){case Js:case tu:case Qs:t.reflow()}else n=t.changed(t.REM),t.visit(t.ADD,(function(e){u.union(vp(e,s))})),t.visit(t.MOD,(function(e){n=n||u.alignsWith(e.bounds),i.dirty(e),u.union(vp(e,s))})),n&&(u.clear(),r.items.forEach((function(e){u.union(e.bounds)})));return lp(r),t.modifies("bounds")};var bp=":vega_identifier:";function yp(e){On.call(this,0,e)}yp.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};var xp=Object(ie["y"])(yp,On);function Op(e){var t=e._signals[bp];return t||(e._signals[bp]=t=e.add(0)),t}function wp(e){On.call(this,null,e)}xp.transform=function(e,t){var n=Op(t.dataflow),i=n.value,r=e.as;return t.visit(t.ADD,(function(e){e[r]||(e[r]=++i)})),n.set(this.value=i),t};var jp=Object(ie["y"])(wp,On);function kp(e){var t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function _p(e){On.call(this,null,e)}jp.transform=function(e,t){var n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,kp(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);var i=n.marktype===Xs?Su:Du;return t.visit(t.ADD,(function(e){i.call(e,n)})),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t};var Ap=Object(ie["y"])(_p,On),Ep={parity:function(e){return e.filter((e,t)=>t%2?e.opacity=0:1)},greedy:function(e,t){var n;return e.filter((e,i)=>i&&Dp(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1))}};function Dp(e,t,n){return n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2)}function Sp(e,t){for(var n,i=1,r=e.length,a=e[0].bounds;i<r;a=n,++i)if(Dp(a,n=e[i].bounds,t))return!0}function Cp(e){var t=e.bounds;return t.width()>1&&t.height()>1}function Fp(e,t,n){var i=e.range(),r=new xu;return t===Ts||t===Bs?r.set(i[0],-1/0,i[1],1/0):r.set(-1/0,i[0],1/0,i[1]),r.expand(n||1),e=>r.encloses(e.bounds)}function $p(e){return e.forEach(e=>e.opacity=1),e}function Mp(e,t){return e.reflow(t.modified()).modifies("opacity")}function Np(e){On.call(this,null,e)}Ap.transform=function(e,t){var n,i,r,a=Ep[e.method]||Ep.parity,o=t.materialize(t.SOURCE).source,s=e.separation||0;if(o&&o.length){if(!e.method)return e.modified("method")&&($p(o),t=Mp(t,e)),t;if(e.sort&&(o=o.slice().sort(e.sort)),o=o.filter(Cp),n=$p(o),t=Mp(t,e),n.length>=3&&Sp(n,s)){do{n=a(n,s)}while(n.length>=3&&Sp(n,s));n.length<3&&!Object(ie["U"])(o).opacity&&(n.length>1&&(Object(ie["U"])(n).opacity=0),Object(ie["U"])(o).opacity=1)}return e.boundScale&&e.boundTolerance>=0&&(i=Fp(e.boundScale,e.boundOrient,+e.boundTolerance),o.forEach(e=>{i(e)||(e.opacity=0)})),r=n[0].mark.bounds.clear(),o.forEach(e=>{e.opacity&&r.union(e.bounds)}),t}};var Rp=Object(ie["y"])(Np,On);Rp.transform=function(e,t){var n=t.dataflow;if(t.visit(t.ALL,(function(e){n.dirty(e)})),t.fields&&t.fields["zindex"]){var i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}};const zp=new xu;function Tp(e,t,n){return e[t]===n?0:(e[t]=n,1)}function Lp(e){var t=e.items[0].datum.orient;return t===Ls||t===Ps}function Pp(e){var t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function Bp(e,t,n,i){var r,a,o=t.items[0],s=o.datum,u=s.orient,c=null!=s.translate?s.translate:.5,l=Pp(s),f=o.range,d=o.offset,h=o.position,p=o.minExtent,g=o.maxExtent,m=s.title&&o.items[l[2]].items[0],v=o.titlePadding,b=o.bounds,y=m&&md(m),x=0,O=0;switch(zp.clear().union(b),b.clear(),(r=l[0])>-1&&b.union(o.items[r].bounds),(r=l[1])>-1&&b.union(o.items[r].bounds),u){case Ts:x=h||0,O=-d,a=Math.max(p,Math.min(g,-b.y1)),m&&(a=Ip(e,m,a,v,y,0,-1,b)),b.add(0,-a).add(f,0);break;case Ls:x=-d,O=h||0,a=Math.max(p,Math.min(g,-b.x1)),m&&(a=Ip(e,m,a,v,y,1,-1,b)),b.add(-a,0).add(0,f);break;case Ps:x=n+d,O=h||0,a=Math.max(p,Math.min(g,b.x2)),m&&(a=Ip(e,m,a,v,y,1,1,b)),b.add(0,0).add(a,f);break;case Bs:x=h||0,O=i+d,a=Math.max(p,Math.min(g,b.y2)),m&&(a=Ip(e,m,a,v,0,0,1,b)),b.add(0,0).add(f,a);break;default:x=o.x,O=o.y}return vl(b.translate(x,O),o),Tp(o,"x",x+c)|Tp(o,"y",O+c)&&(o.bounds=zp,e.dirty(o),o.bounds=b,e.dirty(o)),o.mark.bounds.clear().union(b)}function Ip(e,t,n,i,r,a,o,s){var u=t.bounds,c=0,l=0;return t.auto?(e.dirty(t),n+=i,a?c=(t.x||0)-(t.x=o*(n+r)):l=(t.y||0)-(t.y=o*(n+r)),t.mark.bounds.clear().union(u.translate(-c,-l)),e.dirty(t),a?(s.add(0,u.y1).add(0,u.y2),n+=u.width()):(s.add(u.x1,0).add(u.x2,0),n+=u.height())):s.union(u),n}function Up(e){for(var t,n,i=e.items,r=i.length,a=0,o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};a<r;++a)if(t=i[a],n=t.items,t.marktype===Xs)switch(t.role){case Js:case tu:case Qs:break;case nu:o.rowheaders.push(...n);break;case iu:o.rowfooters.push(...n);break;case au:o.colheaders.push(...n);break;case ou:o.colfooters.push(...n);break;case ru:o.rowtitle=n[0];break;case su:o.coltitle=n[0];break;default:o.marks.push(...n)}return o}function qp(e){return(new xu).set(0,0,e.width||0,e.height||0)}function Wp(e){var t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Hp(e,t,n){var i=Object(ie["F"])(e)?e[t]:e;return null!=i?i:void 0!==n?n:0}function Gp(e){return e<0?Math.ceil(-e):0}function Vp(e,t,n){var i,r,a,o,s,u,c,l,f,d,h,p=!n.nodirty,g=n.bounds===vu?qp:Wp,m=zp.set(0,0,0,0),v=Hp(n.align,bu),b=Hp(n.align,yu),y=Hp(n.padding,bu),x=Hp(n.padding,yu),O=n.columns||t.length,w=O<0?1:Math.ceil(t.length/O),j=t.length,k=Array(j),_=Array(O),A=0,E=Array(j),D=Array(w),S=0,C=Array(j),F=Array(j),$=Array(j);for(r=0;r<O;++r)_[r]=0;for(r=0;r<w;++r)D[r]=0;for(r=0;r<j;++r)u=t[r],s=$[r]=g(u),u.x=u.x||0,C[r]=0,u.y=u.y||0,F[r]=0,a=r%O,o=~~(r/O),A=Math.max(A,c=Math.ceil(s.x2)),S=Math.max(S,l=Math.ceil(s.y2)),_[a]=Math.max(_[a],c),D[o]=Math.max(D[o],l),k[r]=y+Gp(s.x1),E[r]=x+Gp(s.y1),p&&e.dirty(t[r]);for(r=0;r<j;++r)r%O===0&&(k[r]=0),r<O&&(E[r]=0);if(v===mu)for(a=1;a<O;++a){for(h=0,r=a;r<j;r+=O)h<k[r]&&(h=k[r]);for(r=a;r<j;r+=O)k[r]=h+_[a-1]}else if(v===gu){for(h=0,r=0;r<j;++r)r%O&&h<k[r]&&(h=k[r]);for(r=0;r<j;++r)r%O&&(k[r]=h+A)}else for(v=!1,a=1;a<O;++a)for(r=a;r<j;r+=O)k[r]+=_[a-1];if(b===mu)for(o=1;o<w;++o){for(h=0,r=o*O,i=r+O;r<i;++r)h<E[r]&&(h=E[r]);for(r=o*O;r<i;++r)E[r]=h+D[o-1]}else if(b===gu){for(h=0,r=O;r<j;++r)h<E[r]&&(h=E[r]);for(r=O;r<j;++r)E[r]=h+S}else for(b=!1,o=1;o<w;++o)for(r=o*O,i=r+O;r<i;++r)E[r]+=D[o-1];for(f=0,r=0;r<j;++r)f=k[r]+(r%O?f:0),C[r]+=f-t[r].x;for(a=0;a<O;++a)for(d=0,r=a;r<j;r+=O)d+=E[r],F[r]+=d-t[r].y;if(v&&Hp(n.center,bu)&&w>1)for(r=0;r<j;++r)s=v===gu?A:_[r%O],f=s-$[r].x2-t[r].x-C[r],f>0&&(C[r]+=f/2);if(b&&Hp(n.center,yu)&&1!==O)for(r=0;r<j;++r)s=b===gu?S:D[~~(r/O)],d=s-$[r].y2-t[r].y-F[r],d>0&&(F[r]+=d/2);for(r=0;r<j;++r)m.union($[r].translate(C[r],F[r]));switch(f=Hp(n.anchor,Zs),d=Hp(n.anchor,Ys),Hp(n.anchor,bu)){case Vs:f-=m.width();break;case Gs:f-=m.width()/2}switch(Hp(n.anchor,yu)){case Vs:d-=m.height();break;case Gs:d-=m.height()/2}for(f=Math.round(f),d=Math.round(d),m.clear(),r=0;r<j;++r)t[r].mark.bounds.clear();for(r=0;r<j;++r)u=t[r],u.x+=C[r]+=f,u.y+=F[r]+=d,m.union(u.mark.bounds.union(u.bounds.translate(C[r],F[r]))),p&&e.dirty(u);return m}function Zp(e,t,n){var i,r,a,o,s,u,c,l=Up(t),f=l.marks,d=n.bounds===vu?Yp:Xp,h=n.offset,p=n.columns||f.length,g=p<0?1:Math.ceil(f.length/p),m=g*p;const v=Vp(e,f,n);l.rowheaders&&(u=Hp(n.headerBand,yu,null),i=Kp(e,l.rowheaders,f,p,g,-Hp(h,"rowHeader"),Jp,0,d,"x1",0,p,1,u)),l.colheaders&&(u=Hp(n.headerBand,bu,null),r=Kp(e,l.colheaders,f,p,p,-Hp(h,"columnHeader"),Jp,1,d,"y1",0,1,p,u)),l.rowfooters&&(u=Hp(n.footerBand,yu,null),a=Kp(e,l.rowfooters,f,p,g,Hp(h,"rowFooter"),Qp,0,d,"x2",p-1,p,1,u)),l.colfooters&&(u=Hp(n.footerBand,bu,null),o=Kp(e,l.colfooters,f,p,p,Hp(h,"columnFooter"),Qp,1,d,"y2",m-p,1,p,u)),l.rowtitle&&(s=Hp(n.titleAnchor,yu),c=Hp(h,"rowTitle"),c=s===Vs?a+c:i-c,u=Hp(n.titleBand,yu,.5),eg(e,l.rowtitle,c,0,v,u)),l.coltitle&&(s=Hp(n.titleAnchor,bu),c=Hp(h,"columnTitle"),c=s===Vs?o+c:r-c,u=Hp(n.titleBand,bu,.5),eg(e,l.coltitle,c,1,v,u))}function Yp(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function Xp(e,t){return e.bounds[t]}function Jp(e,t){return Math.floor(Math.min(e,t))}function Qp(e,t){return Math.ceil(Math.max(e,t))}function Kp(e,t,n,i,r,a,o,s,u,c,l,f,d,h){var p,g,m,v,b,y,x,O,w,j=n.length,k=0,_=0;if(!j)return k;for(p=l;p<j;p+=f)n[p]&&(k=o(k,u(n[p],c)));if(!t.length)return k;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),k+=a,g=0,v=t.length;g<v;++g)e.dirty(t[g]),t[g].mark.bounds.clear();for(p=l,g=0,v=t.length;g<v;++g,p+=f){for(y=t[g],b=y.mark.bounds,m=p;m>=0&&null==(x=n[m]);m-=d);s?(O=null==h?x.x:Math.round(x.bounds.x1+h*x.bounds.width()),w=k):(O=k,w=null==h?x.y:Math.round(x.bounds.y1+h*x.bounds.height())),b.union(y.bounds.translate(O-(y.x||0),w-(y.y||0))),y.x=O,y.y=w,e.dirty(y),_=o(_,b[c])}return _}function eg(e,t,n,i,r,a){if(t){e.dirty(t);var o=n,s=n;i?o=Math.round(r.x1+a*r.width()):s=Math.round(r.y1+a*r.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}}function tg(e,t){const n=e[t]||{};return(t,i)=>null!=n[t]?n[t]:null!=e[t]?e[t]:i}function ng(e,t){var n=-1/0;return e.forEach(e=>{null!=e.offset&&(n=Math.max(n,e.offset))}),n>-1/0?n:t}function ig(e,t,n,i,r,a,o){const s=tg(n,t),u=ng(e,s("offset",0)),c=s("anchor",Hs),l=c===Vs?1:c===Gs?.5:0,f={align:mu,bounds:s("bounds",vu),columns:"vertical"===s("direction")?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case Ls:f.anchor={x:Math.floor(i.x1)-u,column:Vs,y:l*(o||i.height()+2*i.y1),row:c};break;case Ps:f.anchor={x:Math.ceil(i.x2)+u,y:l*(o||i.height()+2*i.y1),row:c};break;case Ts:f.anchor={y:Math.floor(r.y1)-u,row:Vs,x:l*(a||r.width()+2*r.x1),column:c};break;case Bs:f.anchor={y:Math.ceil(r.y2)+u,x:l*(a||r.width()+2*r.x1),column:c};break;case Is:f.anchor={x:u,y:u};break;case Us:f.anchor={x:a-u,y:u,column:Vs};break;case qs:f.anchor={x:u,y:o-u,row:Vs};break;case Ws:f.anchor={x:a-u,y:o-u,column:Vs,row:Vs};break}return f}function rg(e,t){var n,i,r=t.items[0],a=r.datum,o=r.orient,s=r.bounds,u=r.x,c=r.y;return r._bounds?r._bounds.clear().union(s):r._bounds=s.clone(),s.clear(),og(e,r,r.items[0].items[0]),s=ag(r,s),n=2*r.padding,i=2*r.padding,s.empty()||(n=Math.ceil(s.width()+n),i=Math.ceil(s.height()+i)),a.type===cu&&cg(r.items[0].items[0].items[0].items),o!==pu&&(r.x=u=0,r.y=c=0),r.width=n,r.height=i,vl(s.set(u,c,u+n,c+i),r),r.mark.bounds.clear().union(s),r}function ag(e,t){return e.items.forEach(e=>t.union(e.bounds)),t.x1=e.padding,t.y1=e.padding,t}function og(e,t,n){var i=t.padding,r=i-n.x,a=i-n.y;if(t.datum.title){var o=t.items[1].items[0],s=o.anchor,u=t.titlePadding||0,c=i-o.x,l=i-o.y;switch(o.orient){case Ls:r+=Math.ceil(o.bounds.width())+u;break;case Ps:case Bs:break;default:a+=o.bounds.height()+u}switch((r||a)&&ug(e,n,r,a),o.orient){case Ls:l+=sg(t,n,o,s,1,1);break;case Ps:c+=sg(t,n,o,Vs,0,0)+u,l+=sg(t,n,o,s,1,1);break;case Bs:c+=sg(t,n,o,s,0,0),l+=sg(t,n,o,Vs,-1,0,1)+u;break;default:c+=sg(t,n,o,s,0,0)}(c||l)&&ug(e,o,c,l),(c=Math.round(o.bounds.x1-i))<0&&(ug(e,n,-c,0),ug(e,o,-c,0))}else(r||a)&&ug(e,n,r,a)}function sg(e,t,n,i,r,a,o){const s="symbol"!==e.datum.type,u=n.datum.vgrad,c=!s||!a&&u||o?t:t.items[0],l=c.bounds[r?"y2":"x2"]-e.padding,f=u&&a?l:0,d=u&&a?0:l,h=r<=0?0:md(n);return Math.round(i===Hs?f:i===Vs?d-h:.5*(l-h))}function ug(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function cg(e){var t=e.reduce((function(e,t){return e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e}),{});e.forEach((function(e){e.width=t[e.column],e.height=e.bounds.y2-e.y}))}function lg(e,t,n,i,r){var a,o=t.items[0],s=o.frame,u=o.orient,c=o.anchor,l=o.offset,f=o.padding,d=o.items[0].items[0],h=o.items[1]&&o.items[1].items[0],p=u===Ls||u===Ps?i:n,g=0,m=0,v=0,b=0,y=0;if(s!==Xs?u===Ls?(g=r.y2,p=r.y1):u===Ps?(g=r.y1,p=r.y2):(g=r.x1,p=r.x2):u===Ls&&(g=i,p=0),a=c===Hs?g:c===Vs?p:(g+p)/2,h&&h.text){switch(u){case Ts:case Bs:y=d.bounds.height()+f;break;case Ls:b=d.bounds.width()+f;break;case Ps:b=-d.bounds.width()-f;break}zp.clear().union(h.bounds),zp.translate(b-(h.x||0),y-(h.y||0)),Tp(h,"x",b)|Tp(h,"y",y)&&(e.dirty(h),h.bounds.clear().union(zp),h.mark.bounds.clear().union(zp),e.dirty(h)),zp.clear().union(h.bounds)}else zp.clear();switch(zp.union(d.bounds),u){case Ts:m=a,v=r.y1-zp.height()-l;break;case Ls:m=r.x1-zp.width()-l,v=a;break;case Ps:m=r.x2+zp.width()+l,v=a;break;case Bs:m=a,v=r.y2+l;break;default:m=o.x,v=o.y}return Tp(o,"x",m)|Tp(o,"y",v)&&(zp.translate(m,v),e.dirty(o),o.bounds.clear().union(zp),t.bounds.clear().union(zp),e.dirty(o)),o.bounds}function fg(e){On.call(this,null,e)}var dg=Object(ie["y"])(fg,On);function hg(e,t,n){var i,r,a,o,s,u,c=t.items,l=Math.max(0,t.width||0),f=Math.max(0,t.height||0),d=(new xu).set(0,0,l,f),h=d.clone(),p=d.clone(),g=[];for(s=0,u=c.length;s<u;++s)switch(r=c[s],r.role){case Js:o=Lp(r)?h:p,o.union(Bp(e,r,l,f));break;case Qs:i=r;break;case tu:g.push(rg(e,r));break;case Ks:case eu:case nu:case iu:case ru:case au:case ou:case su:h.union(r.bounds),p.union(r.bounds);break;default:d.union(r.bounds)}if(g.length){const t={};g.forEach(e=>{a=e.orient||Ps,a!==pu&&(t[a]||(t[a]=[])).push(e)});for(let i in t){const r=t[i];Vp(e,r,ig(r,i,n.legends,h,p,l,f))}g.forEach(t=>{const i=t.bounds;if(i.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=i,e.dirty(t)),n.autosize&&n.autosize.type===lu)switch(t.orient){case Ls:case Ps:d.add(i.x1,0).add(i.x2,0);break;case Ts:case Bs:d.add(0,i.y1).add(0,i.y2)}else d.union(i)})}d.union(h).union(p),i&&d.union(lg(e,i,l,f,d)),t.clip&&d.set(0,0,t.width||0,t.height||0),pg(e,t,d,n)}function pg(e,t,n,i){var r=i.autosize||{},a=r.type,o=e._width,s=e._height,u=e.padding();if(!(e._autosize<1)&&a){var c=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),f=Math.max(0,Math.ceil(n.x2-c)),d=Math.max(0,t.height||0),h=Math.max(0,Math.ceil(-n.y1)),p=Math.max(0,Math.ceil(n.y2-d));r.contains===uu&&(o-=u.left+u.right,s-=u.top+u.bottom),a===pu?(l=0,h=0,c=o,d=s):a===lu?(c=Math.max(0,o-l-f),d=Math.max(0,s-h-p)):a===fu?(c=Math.max(0,o-l-f),s=d+h+p):a===du?(o=c+l+f,d=Math.max(0,s-h-p)):a===hu&&(o=c+l+f,s=d+h+p),e._resizeView(o,s,c,d,[l,h],r.resize)}}dg.transform=function(e,t){var n=t.dataflow;return e.mark.items.forEach((function(t){e.layout&&Zp(n,t,e.layout),hg(n,t,e)})),e.modified()&&t.reflow(),t};var gg=function(e,t,n){var i=e-t+2*n;return e?i>0?i:1:0};const mg="identity",vg="linear",bg="log",yg="pow",xg="sqrt",Og="symlog",wg="time",jg="utc",kg="sequential",_g="diverging",Ag="quantile",Eg="quantize",Dg="threshold",Sg="ordinal",Cg="point",Fg="band",$g="bin-ordinal",Mg="continuous",Ng="discrete",Rg="discretizing",zg="interpolating",Tg="temporal";var Lg=function(e){return function(t){var n,i=t[0],r=t[1];return r<i&&(n=i,i=r,r=n),[e.invert(i),e.invert(r)]}},Pg=function(e){return function(t){var n,i,r,a,o=e.range(),s=t[0],u=t[1],c=-1;for(u<s&&(i=s,s=u,u=i),r=0,a=o.length;r<a;++r)o[r]>=s&&o[r]<=u&&(c<0&&(c=r),n=r);if(!(c<0))return s=e.invertExtent(o[c]),u=e.invertExtent(o[n]),[void 0===s[0]?s[1]:s[0],void 0===u[1]?u[0]:u[1]]}},Bg=Vo(Tn),Ig=Bg.right,Ug=Bg.left,qg=Ig;function Wg(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Hg(e,t){switch(arguments.length){case 0:break;case 1:"function"===typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"===typeof t?this.interpolator(t):this.range(t);break}return this}const Gg=Symbol("implicit");function Vg(){var e=new Map,t=[],n=[],i=Gg;function r(r){var a=r+"",o=e.get(a);if(!o){if(i!==Gg)return i;e.set(a,o=t.push(r))}return n[(o-1)%n.length]}return r.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(const i of n){const n=i+"";e.has(n)||e.set(n,t.push(i))}return r},r.range=function(e){return arguments.length?(n=Array.from(e),r):n.slice()},r.unknown=function(e){return arguments.length?(i=e,r):i},r.copy=function(){return Vg(t,n).unknown(i)},Wg.apply(r,arguments),r}function Zg(){var e,t,n=Vg().unknown(void 0),i=n.domain,r=n.range,a=[0,1],o=!1,s=0,u=0,c=.5;function l(){var n=i().length,l=a[1]<a[0],f=a[l-0],d=a[1-l],h=gg(n,s,u);e=(d-f)/(h||1),o&&(e=Math.floor(e)),f+=(d-f-e*(n-s))*c,t=e*(1-s),o&&(f=Math.round(f),t=Math.round(t));var p=Fa(n).map((function(t){return f+e*t}));return r(l?p.reverse():p)}return delete n.unknown,n.domain=function(e){return arguments.length?(i(e),l()):i()},n.range=function(e){return arguments.length?(a=[+e[0],+e[1]],l()):a.slice()},n.rangeRound=function(e){return a=[+e[0],+e[1]],o=!0,l()},n.bandwidth=function(){return t},n.step=function(){return e},n.round=function(e){return arguments.length?(o=!!e,l()):o},n.padding=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),s=u,l()):s},n.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),l()):s},n.paddingOuter=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),l()):u},n.align=function(e){return arguments.length?(c=Math.max(0,Math.min(1,e)),l()):c},n.invertRange=function(e){if(null!=e[0]&&null!=e[1]){var n,o,s,u=+e[0],c=+e[1],l=a[1]<a[0],f=l?r().reverse():r(),d=f.length-1;if(u===u&&c===c&&(c<u&&(s=u,u=c,c=s),!(c<f[0]||u>a[1-l])))return n=Math.max(0,Ig(f,u)-1),o=u===c?n:Ig(f,c)-1,u-f[n]>t+1e-10&&++n,l&&(s=n,n=d-o,o=d-s),n>o?void 0:i().slice(n,o+1)}},n.invert=function(e){var t=n.invertRange([e,e]);return t?t[0]:t},n.copy=function(){return Zg().domain(i()).range(a).round(o).paddingInner(s).paddingOuter(u).align(c)},l()}function Yg(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return Yg(t())},e}function Xg(){return Yg(Zg().paddingInner(1))}var Jg=n("09b8"),Qg=n("d933"),Kg=n("1231"),em=n("d989"),tm=n("dad1"),nm=function(e,t,n,i){var r,a=es(e,t,n);switch(i=Object(Jg["b"])(null==i?",f":i),i.type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=i.precision||isNaN(r=Object(Qg["a"])(a,o))||(i.precision=r),Object(Kg["c"])(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=Object(em["a"])(a,Math.max(Math.abs(e),Math.abs(t))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=Object(tm["a"])(a))||(i.precision=r-2*("%"===i.type));break}return Object(Kg["b"])(i)},im=Array.prototype.map;function rm(e){return im.call(e,(function(e){return+e}))}var am=Array.prototype.slice;function om(){var e=[],t=[];function n(n){return null==n||n!==n?void 0:t[(qg(e,n)-1)%t.length]}return n.domain=function(t){return arguments.length?(e=rm(t),n):e.slice()},n.range=function(e){return arguments.length?(t=am.call(e),n):t.slice()},n.tickFormat=function(t,n){return nm(e[0],Object(ie["U"])(e),null==t?10:t,n)},n.copy=function(){return om().domain(n.domain()).range(n.range())},n}var sm=n("ea1d"),um=n("e317"),cm=n("5857"),lm=function(e){return function(){return e}},fm=function(e){return+e},dm=[0,1];function hm(e){return e}function pm(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:lm(isNaN(t)?NaN:.5)}function gm(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}function mm(e,t,n){var i=e[0],r=e[1],a=t[0],o=t[1];return r<i?(i=pm(r,i),a=n(o,a)):(i=pm(i,r),a=n(a,o)),function(e){return a(i(e))}}function vm(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),a=new Array(i),o=-1;e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());while(++o<i)r[o]=pm(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=qg(e,t,1,i)-1;return a[n](r[n](t))}}function bm(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ym(){var e,t,n,i,r,a,o=dm,s=dm,u=sm["a"],c=hm;function l(){var e=Math.min(o.length,s.length);return c!==hm&&(c=gm(o[0],o[e-1])),i=e>2?vm:mm,r=a=null,f}function f(t){return isNaN(t=+t)?n:(r||(r=i(o.map(e),s,u)))(e(c(t)))}return f.invert=function(n){return c(t((a||(a=i(s,o.map(e),um["a"])))(n)))},f.domain=function(e){return arguments.length?(o=Array.from(e,fm),l()):o.slice()},f.range=function(e){return arguments.length?(s=Array.from(e),l()):s.slice()},f.rangeRound=function(e){return s=Array.from(e),u=cm["a"],l()},f.clamp=function(e){return arguments.length?(c=!!e||hm,l()):c!==hm},f.interpolate=function(e){return arguments.length?(u=e,l()):u},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,i){return e=n,t=i,l()}}function xm(){return ym()(hm,hm)}function Om(e){var t=e.domain;return e.ticks=function(e){var n=t();return Qo(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var i=t();return nm(i[0],i[i.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var i,r=t(),a=0,o=r.length-1,s=r[a],u=r[o];return u<s&&(i=s,s=u,u=i,i=a,a=o,o=i),i=Ko(s,u,n),i>0?(s=Math.floor(s/i)*i,u=Math.ceil(u/i)*i,i=Ko(s,u,n)):i<0&&(s=Math.ceil(s*i)/i,u=Math.floor(u*i)/i,i=Ko(s,u,n)),i>0?(r[a]=Math.floor(s/i)*i,r[o]=Math.ceil(u/i)*i,t(r)):i<0&&(r[a]=Math.ceil(s*i)/i,r[o]=Math.floor(u*i)/i,t(r)),e},e}function wm(){var e=xm();return e.copy=function(){return bm(e,wm())},Wg.apply(e,arguments),Om(e)}function jm(e){var t;function n(e){return isNaN(e=+e)?t:e}return n.invert=n,n.domain=n.range=function(t){return arguments.length?(e=Array.from(t,fm),n):e.slice()},n.unknown=function(e){return arguments.length?(t=e,n):t},n.copy=function(){return jm(e).unknown(t)},e=arguments.length?Array.from(e,fm):[0,1],Om(n)}var km=function(e,t){e=e.slice();var n,i=0,r=e.length-1,a=e[i],o=e[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),e[i]=t.floor(a),e[r]=t.ceil(o),e};function _m(e){return Math.log(e)}function Am(e){return Math.exp(e)}function Em(e){return-Math.log(-e)}function Dm(e){return-Math.exp(-e)}function Sm(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Cm(e){return 10===e?Sm:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function Fm(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function $m(e){return function(t){return-e(-t)}}function Mm(e){var t,n,i=e(_m,Am),r=i.domain,a=10;function o(){return t=Fm(a),n=Cm(a),r()[0]<0?(t=$m(t),n=$m(n),e(Em,Dm)):e(_m,Am),i}return i.base=function(e){return arguments.length?(a=+e,o()):a},i.domain=function(e){return arguments.length?(r(e),o()):r()},i.ticks=function(e){var i,o=r(),s=o[0],u=o[o.length-1];(i=u<s)&&(d=s,s=u,u=d);var c,l,f,d=t(s),h=t(u),p=null==e?10:+e,g=[];if(!(a%1)&&h-d<p){if(d=Math.floor(d),h=Math.ceil(h),s>0){for(;d<=h;++d)for(l=1,c=n(d);l<a;++l)if(f=c*l,!(f<s)){if(f>u)break;g.push(f)}}else for(;d<=h;++d)for(l=a-1,c=n(d);l>=1;--l)if(f=c*l,!(f<s)){if(f>u)break;g.push(f)}2*g.length<p&&(g=Qo(s,u,p))}else g=Qo(d,h,Math.min(h-d,p)).map(n);return i?g.reverse():g},i.tickFormat=function(e,r){if(null==r&&(r=10===a?".0e":","),"function"!==typeof r&&(r=Object(Kg["b"])(r)),e===1/0)return r;null==e&&(e=10);var o=Math.max(1,a*e/i.ticks().length);return function(e){var i=e/n(Math.round(t(e)));return i*a<a-.5&&(i*=a),i<=o?r(e):""}},i.nice=function(){return r(km(r(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},i}function Nm(){var e=Mm(ym()).domain([1,10]);return e.copy=function(){return bm(e,Nm()).base(e.base())},Wg.apply(e,arguments),e}function Rm(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function zm(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Tm(e){return e<0?-e*e:e*e}function Lm(e){var t=e(hm,hm),n=1;function i(){return 1===n?e(hm,hm):.5===n?e(zm,Tm):e(Rm(n),Rm(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,i()):n},Om(t)}function Pm(){var e=Lm(ym());return e.copy=function(){return bm(e,Pm()).exponent(e.exponent())},Wg.apply(e,arguments),e}function Bm(){return Pm.apply(null,arguments).exponent(.5)}function Im(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Um(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function qm(e){var t=1,n=e(Im(t),Um(t));return n.constant=function(n){return arguments.length?e(Im(t=+n),Um(t)):t},Om(n)}function Wm(){var e=qm(ym());return e.copy=function(){return bm(e,Wm()).constant(e.constant())},Wg.apply(e,arguments)}var Hm=1e3,Gm=60*Hm,Vm=60*Gm,Zm=24*Vm,Ym=7*Zm,Xm=30*Zm,Jm=365*Zm;function Qm(e){return new Date(e)}function Km(e){return e instanceof Date?+e:+new Date(+e)}function ev(e,t,n,i,r,a,o,s,u){var c=xm(),l=c.invert,f=c.domain,d=u(".%L"),h=u(":%S"),p=u("%I:%M"),g=u("%I %p"),m=u("%a %d"),v=u("%b %d"),b=u("%B"),y=u("%Y"),x=[[o,1,Hm],[o,5,5*Hm],[o,15,15*Hm],[o,30,30*Hm],[a,1,Gm],[a,5,5*Gm],[a,15,15*Gm],[a,30,30*Gm],[r,1,Vm],[r,3,3*Vm],[r,6,6*Vm],[r,12,12*Vm],[i,1,Zm],[i,2,2*Zm],[n,1,Ym],[t,1,Xm],[t,3,3*Xm],[e,1,Jm]];function O(s){return(o(s)<s?d:a(s)<s?h:r(s)<s?p:i(s)<s?g:t(s)<s?n(s)<s?m:v:e(s)<s?b:y)(s)}function w(t,n,i){if(null==t&&(t=10),"number"===typeof t){var r,a=Math.abs(i-n)/t,o=Vo((function(e){return e[2]})).right(x,a);return o===x.length?(r=es(n/Jm,i/Jm,t),t=e):o?(o=x[a/x[o-1][2]<x[o][2]/a?o-1:o],r=o[1],t=o[0]):(r=Math.max(es(n,i,t),1),t=s),t.every(r)}return t}return c.invert=function(e){return new Date(l(e))},c.domain=function(e){return arguments.length?f(Array.from(e,Km)):f().map(Qm)},c.ticks=function(e){var t,n=f(),i=n[0],r=n[n.length-1],a=r<i;return a&&(t=i,i=r,r=t),t=w(e,i,r),t=t?t.range(i,r+1):[],a?t.reverse():t},c.tickFormat=function(e,t){return null==t?O:u(t)},c.nice=function(e){var t=f();return(e=w(e,t[0],t[t.length-1]))?f(km(t,e)):c},c.copy=function(){return bm(c,ev(e,t,n,i,r,a,o,s,u))},c}var tv=function(){return Wg.apply(ev(yo["a"],xo["a"],to["g"],Oo["b"],wo["a"],jo["a"],ko["a"],_o["a"],wt["b"]).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},nv=function(){return Wg.apply(ev(Ao["a"],Eo["a"],no["g"],Do["a"],So["a"],Co["a"],ko["a"],_o["a"],wt["d"]).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)};function iv(){var e,t,n,i,r,a=0,o=1,s=hm,u=!1;function c(t){return isNaN(t=+t)?r:s(0===n?.5:(t=(i(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}function l(e){return function(t){var n,i;return arguments.length?([n,i]=t,s=e(n,i),c):[s(0),s(1)]}}return c.domain=function(r){return arguments.length?([a,o]=r,e=i(a=+a),t=i(o=+o),n=e===t?0:1/(t-e),c):[a,o]},c.clamp=function(e){return arguments.length?(u=!!e,c):u},c.interpolator=function(e){return arguments.length?(s=e,c):s},c.range=l(sm["a"]),c.rangeRound=l(cm["a"]),c.unknown=function(e){return arguments.length?(r=e,c):r},function(r){return i=r,e=r(a),t=r(o),n=e===t?0:1/(t-e),c}}function rv(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function av(){var e=Om(iv()(hm));return e.copy=function(){return rv(e,av())},Hg.apply(e,arguments)}function ov(){var e=Mm(iv()).domain([1,10]);return e.copy=function(){return rv(e,ov()).base(e.base())},Hg.apply(e,arguments)}function sv(){var e=qm(iv());return e.copy=function(){return rv(e,sv()).constant(e.constant())},Hg.apply(e,arguments)}function uv(){var e=Lm(iv());return e.copy=function(){return rv(e,uv()).exponent(e.exponent())},Hg.apply(e,arguments)}function cv(){return uv.apply(null,arguments).exponent(.5)}var lv=n("ac0c");function fv(){var e,t,n,i,r,a,o,s=0,u=.5,c=1,l=1,f=hm,d=!1;function h(e){return isNaN(e=+e)?o:(e=.5+((e=+a(e))-t)*(l*e<l*t?i:r),f(d?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var n,i,r;return arguments.length?([n,i,r]=t,f=Object(lv["a"])(e,[n,i,r]),h):[f(0),f(.5),f(1)]}}return h.domain=function(o){return arguments.length?([s,u,c]=o,e=a(s=+s),t=a(u=+u),n=a(c=+c),i=e===t?0:.5/(t-e),r=t===n?0:.5/(n-t),l=t<e?-1:1,h):[s,u,c]},h.clamp=function(e){return arguments.length?(d=!!e,h):d},h.interpolator=function(e){return arguments.length?(f=e,h):f},h.range=p(sm["a"]),h.rangeRound=p(cm["a"]),h.unknown=function(e){return arguments.length?(o=e,h):o},function(o){return a=o,e=o(s),t=o(u),n=o(c),i=e===t?0:.5/(t-e),r=t===n?0:.5/(n-t),l=t<e?-1:1,h}}function dv(){var e=Om(fv()(hm));return e.copy=function(){return rv(e,dv())},Hg.apply(e,arguments)}function hv(){var e=Mm(fv()).domain([.1,1,10]);return e.copy=function(){return rv(e,hv()).base(e.base())},Hg.apply(e,arguments)}function pv(){var e=qm(fv());return e.copy=function(){return rv(e,pv()).constant(e.constant())},Hg.apply(e,arguments)}function gv(){var e=Lm(fv());return e.copy=function(){return rv(e,gv()).exponent(e.exponent())},Hg.apply(e,arguments)}function mv(){return gv.apply(null,arguments).exponent(.5)}function vv(){var e,t=[],n=[],i=[];function r(){var e=0,r=Math.max(1,n.length);i=new Array(r-1);while(++e<r)i[e-1]=Wn(t,e/r);return a}function a(t){return isNaN(t=+t)?e:n[qg(i,t)]}return a.invertExtent=function(e){var r=n.indexOf(e);return r<0?[NaN,NaN]:[r>0?i[r-1]:t[0],r<i.length?i[r]:t[t.length-1]]},a.domain=function(e){if(!arguments.length)return t.slice();t=[];for(let n of e)null==n||isNaN(n=+n)||t.push(n);return t.sort(Tn),r()},a.range=function(e){return arguments.length?(n=Array.from(e),r()):n.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return i.slice()},a.copy=function(){return vv().domain(t).range(n).unknown(e)},Wg.apply(a,arguments)}function bv(){var e,t=0,n=1,i=1,r=[.5],a=[0,1];function o(t){return t<=t?a[qg(r,t,0,i)]:e}function s(){var e=-1;r=new Array(i);while(++e<i)r[e]=((e+1)*n-(e-i)*t)/(i+1);return o}return o.domain=function(e){return arguments.length?([t,n]=e,t=+t,n=+n,s()):[t,n]},o.range=function(e){return arguments.length?(i=(a=Array.from(e)).length-1,s()):a.slice()},o.invertExtent=function(e){var o=a.indexOf(e);return o<0?[NaN,NaN]:o<1?[t,r[0]]:o>=i?[r[i-1],n]:[r[o-1],r[o]]},o.unknown=function(t){return arguments.length?(e=t,o):o},o.thresholds=function(){return r.slice()},o.copy=function(){return bv().domain([t,n]).range(a).unknown(e)},Wg.apply(Om(o),arguments)}function yv(){var e,t=[.5],n=[0,1],i=1;function r(r){return r<=r?n[qg(t,r,0,i)]:e}return r.domain=function(e){return arguments.length?(t=Array.from(e),i=Math.min(t.length,n.length-1),r):t.slice()},r.range=function(e){return arguments.length?(n=Array.from(e),i=Math.min(t.length,n.length-1),r):n.slice()},r.invertExtent=function(e){var i=n.indexOf(e);return[t[i-1],t[i]]},r.unknown=function(t){return arguments.length?(e=t,r):e},r.copy=function(){return yv().domain(t).range(n).unknown(e)},Wg.apply(r,arguments)}const xv={};function Ov(e,t,n){const i=function(){var n=t();return n.invertRange||(n.invertRange=n.invert?Lg(n):n.invertExtent?Pg(n):void 0),n.type=e,n};return i.metadata=Object(ie["db"])(Object(ie["i"])(n)),i}function wv(e,t,n){return arguments.length>1?(xv[e]=Ov(e,t,n),this):jv(e)?xv[e]:void 0}function jv(e){return Object(ie["v"])(xv,e)}function kv(e,t){const n=xv[e];return n&&n.metadata[t]}function _v(e){return kv(e,Mg)}function Av(e){return kv(e,Ng)}function Ev(e){return kv(e,Rg)}function Dv(e){return kv(e,bg)}function Sv(e){return kv(e,zg)}function Cv(e){return kv(e,Ag)}wv(mg,jm),wv(vg,wm,Mg),wv(bg,Nm,[Mg,bg]),wv(yg,Pm,Mg),wv(xg,Bm,Mg),wv(Og,Wm,Mg),wv(wg,tv,[Mg,Tg]),wv(jg,nv,[Mg,Tg]),wv(kg,av,[Mg,zg]),wv(`${kg}-${vg}`,av,[Mg,zg]),wv(`${kg}-${bg}`,ov,[Mg,zg,bg]),wv(`${kg}-${yg}`,uv,[Mg,zg]),wv(`${kg}-${xg}`,cv,[Mg,zg]),wv(`${kg}-${Og}`,sv,[Mg,zg]),wv(`${_g}-${vg}`,dv,[Mg,zg]),wv(`${_g}-${bg}`,hv,[Mg,zg,bg]),wv(`${_g}-${yg}`,gv,[Mg,zg]),wv(`${_g}-${xg}`,mv,[Mg,zg]),wv(`${_g}-${Og}`,pv,[Mg,zg]),wv(Ag,vv,[Rg,Ag]),wv(Eg,bv,Rg),wv(Dg,yv,Rg),wv($g,om,[Ng,Rg]),wv(Sg,Vg,Ng),wv(Fg,Zg,Ng),wv(Cg,Xg,Ng);var Fv=n("a43d");const $v=["clamp","base","constant","exponent"];function Mv(e,t){var n=t[0],i=Object(ie["U"])(t)-n;return function(t){return e(n+t*i)}}function Nv(e,t,n){return lv["a"](Tv(t||"rgb",n),e)}function Rv(e,t){for(var n=new Array(t),i=t+1,r=0;r<t;)n[r]=e(++r/i);return n}function zv(e,t,n){var i,r,a,o=n-t;return o&&Number.isFinite(o)?(i=(r=e.type).indexOf("-"),r=i<0?r:r.slice(i+1),a=wv(r)().domain([t,n]).range([0,1]),$v.forEach(t=>e[t]?a[t](e[t]()):0),a):Object(ie["l"])(.5)}function Tv(e,t){var n=Fv[Lv(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function Lv(e){return"interpolate"+e.toLowerCase().split("-").map((function(e){return e[0].toUpperCase()+e.slice(1)})).join("")}const Pv={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},Bv={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function Iv(e){var t=e.length/6|0,n=new Array(t),i=0;while(i<t)n[i]="#"+e.slice(6*i,6*++i);return n}function Uv(e,t){for(let n in e)Wv(n,t(e[n]))}const qv={};function Wv(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(qv[e]=t,this):qv[e]}function Hv(e,t,n){var i;return Object(ie["E"])(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,~~(Object(ie["X"])(e.domain())/n)||1))),Object(ie["F"])(t)&&(i=t.step,t=t.interval),Object(ie["H"])(t)&&(t=e.type===wg?Mo(t):e.type==jg?No(t):Object(ie["n"])("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function Gv(e,t,n){var i=e.range(),r=Math.floor(i[0]),a=Math.ceil(Object(ie["U"])(i));if(r>a&&(i=a,a=r,r=i),t=t.filter((function(t){return t=e(t),r<=t&&t<=a})),n>0&&t.length>1){var o=[t[0],Object(ie["U"])(t)];while(t.length>n&&t.length>=3)t=t.filter((function(e,t){return!(t%2)}));t.length<3&&(t=o)}return t}function Vv(e,t){return e.bins?Gv(e,e.bins):e.ticks?e.ticks(t):e.domain()}function Zv(e,t,n,i,r){var a=e.type,o=a===wg||i===wg?qo(n):a===jg||i===jg?Wo(n):e.tickFormat?e.tickFormat(t,n):n?Object(Kg["b"])(n):String;if(Dv(a)){var s=Xv(n);o=r||e.bins?s:Yv(o,s)}return o}function Yv(e,t){return n=>e(n)?t(n):""}function Xv(e){var t=Object(Jg["b"])(e||",");if(null==t.precision){switch(t.precision=12,t.type){case"%":t.precision-=2;break;case"e":t.precision-=1;break}return Jv(Object(Kg["b"])(t),Object(Kg["b"])(".1f")(1)[1])}return Object(Kg["b"])(t)}function Jv(e,t){return function(n){var i,r,a=e(n),o=a.indexOf(t);if(o<0)return a;i=Qv(a,o),r=i<a.length?a.slice(i):"";while(--i>o)if("0"!==a[i]){++i;break}return a.slice(0,i)+r}}function Qv(e,t){var n,i=e.lastIndexOf("e");if(i>0)return i;for(i=e.length;--i>t;)if(n=e.charCodeAt(i),n>=48&&n<=57)return i+1}function Kv(e){On.call(this,null,e)}Uv(Bv,Iv),Uv(Pv,e=>Nv(Iv(e)));var eb=Object(ie["y"])(Kv,On);function tb(e){On.call(this,null,e)}eb.transform=function(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,r=e.scale,a=null==e.count?e.values?e.values.length:10:e.count,o=Hv(r,a,e.minstep),s=e.format||Zv(r,o,e.formatSpecifier,e.formatType,!!e.values),u=e.values?Gv(r,e.values,o):Vv(r,o);return i&&(n.rem=i),i=u.map((function(e,t){return fe({index:t/(u.length-1||1),value:e,label:s(e)})})),e.extra&&i.length&&i.push(fe({index:-1,extra:{value:i[0].value},label:""})),n.source=i,n.add=i,this.value=i,n};var nb=Object(ie["y"])(tb,On);function ib(){return fe({})}function rb(e){return e.exit}function ab(e){On.call(this,null,e)}nb.transform=function(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||ib,a=e.key||ce,o=this.value;return Object(ie["A"])(i.encode)&&(i.encode=null),o&&(e.modified("key")||t.modified(a))&&Object(ie["n"])("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=Object(ie["s"])().test(rb),o.lookup=function(e){return o.get(a(e))}),t.visit(t.ADD,(function(e){var t=a(e),n=o.get(t);n?n.exit?(o.empty--,i.add.push(n)):i.mod.push(n):(o.set(t,n=r(e)),i.add.push(n)),n.datum=e,n.exit=!1})),t.visit(t.MOD,(function(e){var t=a(e),n=o.get(t);n&&(n.datum=e,i.mod.push(n))})),t.visit(t.REM,(function(e){var t=a(e),n=o.get(t);e!==n.datum||n.exit||(i.rem.push(n),n.exit=!0,++o.empty)})),t.changed(t.ADD_MOD)&&i.modifies("datum"),e.clean&&o.empty>n.cleanThreshold&&n.runAfter(o.clean),i};var ob=Object(ie["y"])(ab,On);ob.transform=function(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,a=t.encode;if(Object(ie["A"])(a)){if(!n.changed()&&!a.every((function(e){return r[e]})))return t.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,s=r.update||ie["r"],u=r.enter||ie["r"],c=r.exit||ie["r"],l=(a&&!o?r[a]:s)||ie["r"];if(t.changed(t.ADD)&&(t.visit(t.ADD,(function(t){u(t,e),s(t,e)})),n.modifies(u.output),n.modifies(s.output),l!==ie["r"]&&l!==s&&(t.visit(t.ADD,(function(t){l(t,e)})),n.modifies(l.output))),t.changed(t.REM)&&c!==ie["r"]&&(t.visit(t.REM,(function(t){c(t,e)})),n.modifies(c.output)),o||l!==ie["r"]){var f=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(f,(function(t){var r=u(t,e)||i;(l(t,e)||r)&&n.mod.push(t)})),n.mod.length&&n.modifies(u.output)):t.visit(f,(function(t){(l(t,e)||i)&&n.mod.push(t)})),n.mod.length&&n.modifies(l.output)}return n.changed()?n:t.StopPropagation};var sb="symbol",ub="discrete",cb="gradient";const lb={[Ag]:"quantiles",[Eg]:"thresholds",[Dg]:"domain"},fb={[Ag]:"quantiles",[Eg]:"domain"};function db(e,t){return e.bins?mb(e.bins):e.type===bg?hb(e,t):lb[e.type]?gb(e[lb[e.type]]()):Vv(e,t)}function hb(e,t){var n=Vv(e,t),i=e.base(),r=Math.log(i),a=Math.max(1,i*t/n.length);return n.filter(e=>{var t=e/Math.pow(i,Math.round(Math.log(e)/r));return t*i<i-.5&&(t*=i),t<=a})}function pb(e,t){var n,i=e[fb[e.type]](),r=i.length,a=r>1?i[1]-i[0]:i[0];for(n=1;n<r;++n)a=Math.min(a,i[n]-i[n-1]);return nm(0,a,30,t)}function gb(e){const t=[-1/0].concat(e);return t.max=1/0,t}function mb(e){const t=e.slice(0,-1);return t.max=Object(ie["U"])(e),t}function vb(e){return lb[e.type]||e.bins}function bb(e,t,n,i,r,a){const o=fb[e.type]&&r!==wg&&r!==jg?pb(e,i):Zv(e,t,i,r,a);return n===sb&&vb(e)?yb(o):n===ub?Ob(o):wb(o)}function yb(e){return function(t,n,i){var r=xb(i[n+1],xb(i.max,1/0)),a=jb(t,e),o=jb(r,e);return a&&o?a+" – "+o:o?"< "+o:"≥ "+a}}function xb(e,t){return null!=e?e:t}function Ob(e){return function(t,n){return n?e(t):null}}function wb(e){return function(t){return e(t)}}function jb(e,t){return Number.isFinite(e)?t(e):null}function kb(e){var t=e.domain(),n=t.length-1,i=+t[0],r=+Object(ie["U"])(t),a=r-i;if(e.type===Dg){var o=n?a/n:.1;i-=o,r+=o,a=r-i}return function(e){return(e-i)/a}}function _b(e){On.call(this,[],e)}var Ab=Object(ie["y"])(_b,On);Ab.transform=function(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var n,i,r,a,o,s=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=this.value,c=e.type||sb,l=e.scale,f=+e.limit,d=Hv(l,null==e.count?5:e.count,e.minstep),h=!!e.values||c===sb,p=e.format||bb(l,d,c,e.formatSpecifier,e.formatType,h),g=e.values||db(l,d,c);return u&&(s.rem=u),c===sb?(f&&g.length>f?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),u=g.slice(0,f-1),o=!0):u=g,Object(ie["D"])(r=e.size)?(e.values||0!==l(u[0])||(u=u.slice(1)),a=u.reduce((function(t,n){return Math.max(t,r(n,e))}),0)):r=Object(ie["l"])(a=r||8),u=u.map((function(t,n){return fe({index:n,label:p(t,n,u),value:t,offset:a,size:r(t,e)})})),o&&(o=g[u.length],u.push(fe({index:u.length,label:`…${g.length-u.length} entries`,value:o,offset:a,size:r(o,e)})))):c===cb?(n=l.domain(),i=zv(l,n[0],Object(ie["U"])(n)),g.length<3&&!e.values&&n[0]!==Object(ie["U"])(n)&&(g=[n[0],Object(ie["U"])(n)]),u=g.map((function(e,t){return fe({index:t,label:p(e,t,g),value:e,perc:i(e)})}))):(r=g.length-1,i=kb(l),u=g.map((function(e,t){return fe({index:t,label:p(e,t,g),value:e,perc:t?i(e):0,perc2:t===r?1:i(g[t+1])})}))),s.source=u,s.add=u,this.value=u,s};var Eb=Object(ie["s"])({line:Nb,"line-radial":Rb,arc:zb,"arc-radial":Tb,curve:Lb,"curve-radial":Pb,"orthogonal-horizontal":Bb,"orthogonal-vertical":Ib,"orthogonal-radial":Ub,"diagonal-horizontal":qb,"diagonal-vertical":Wb,"diagonal-radial":Hb});function Db(e){return e.source.x}function Sb(e){return e.source.y}function Cb(e){return e.target.x}function Fb(e){return e.target.y}function $b(e){On.call(this,{},e)}$b.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};var Mb=Object(ie["y"])($b,On);function Nb(e,t,n,i){return"M"+e+","+t+"L"+n+","+i}function Rb(e,t,n,i){return Nb(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function zb(e,t,n,i){var r=n-e,a=i-t,o=Math.sqrt(r*r+a*a)/2,s=180*Math.atan2(a,r)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+s+" 0 1 "+n+","+i}function Tb(e,t,n,i){return zb(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function Lb(e,t,n,i){var r=n-e,a=i-t,o=.2*(r+a),s=.2*(a-r);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(i-o)+" "+n+","+i}function Pb(e,t,n,i){return Lb(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function Bb(e,t,n,i){return"M"+e+","+t+"V"+i+"H"+n}function Ib(e,t,n,i){return"M"+e+","+t+"H"+n+"V"+i}function Ub(e,t,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),u=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*r+","+t*a+"A"+t+","+t+" 0 0,"+(u?1:0)+" "+t*o+","+t*s+"L"+i*o+","+i*s}function qb(e,t,n,i){var r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i}function Wb(e,t,n,i){var r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i}function Hb(e,t,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),u=(t+i)/2;return"M"+t*r+","+t*a+"C"+u*r+","+u*a+" "+u*o+","+u*s+" "+i*o+","+i*s}function Gb(e,t){let n=0;if(void 0===t)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function Vb(e){On.call(this,null,e)}Mb.transform=function(e,t){var n=e.sourceX||Db,i=e.sourceY||Sb,r=e.targetX||Cb,a=e.targetY||Fb,o=e.as||"path",s=e.orient||"vertical",u=e.shape||"line",c=Eb.get(u+"-"+s)||Eb.get(u);return c||Object(ie["n"])("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,(function(e){e[o]=c(n(e),i(e),r(e),a(e))})),t.reflow(e.modified()).modifies(o)},Vb.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};var Zb=Object(ie["y"])(Vb,On);Zb.transform=function(e,t){var n,i,r,a=e.as||["startAngle","endAngle"],o=a[0],s=a[1],u=e.field||ie["O"],c=e.startAngle||0,l=null!=e.endAngle?e.endAngle:2*Math.PI,f=t.source,d=f.map(u),h=d.length,p=c,g=(l-c)/Gb(d),m=Fa(h);for(e.sort&&m.sort((function(e,t){return d[e]-d[t]})),n=0;n<h;++n)r=d[m[n]],i=f[m[n]],i[o]=p,i[s]=p+=r*g;return this.value=d,t.reflow(e.modified()).modifies(a)};var Yb=5;function Xb(e){const t=e.type;return!e.bins&&(t===vg||t===yg||t===xg)}function Jb(e){return _v(e)&&e!==kg}var Qb=Object(ie["db"])(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Kb(e){On.call(this,null,e),this.modified(!0)}var ey=Object(ie["y"])(Kb,On);function ty(e){var t,n=e.type,i="";return n===kg?kg+"-"+vg:(ny(e)&&(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0,i=2===t?kg+"-":3===t?_g+"-":""),(i+n||vg).toLowerCase())}function ny(e){const t=e.type;return _v(t)&&t!==wg&&t!==jg&&(e.scheme||e.range&&e.range.length&&e.range.every(ie["H"]))}function iy(e,t,n){var i=ry(e,t.domainRaw,n);if(i>-1)return i;var r,a,o=t.domain,s=e.type,u=t.zero||void 0===t.zero&&Xb(e);return o?(Jb(s)&&t.padding&&o[0]!==Object(ie["U"])(o)&&(o=ay(s,o,t.range,t.padding,t.exponent,t.constant)),(u||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(r=(o=o.slice()).length-1||1,u&&(o[0]>0&&(o[0]=0),o[r]<0&&(o[r]=0)),null!=t.domainMin&&(o[0]=t.domainMin),null!=t.domainMax&&(o[r]=t.domainMax),null!=t.domainMid&&(a=t.domainMid,(a<o[0]||a>o[r])&&n.warn("Scale domainMid exceeds domain min or max.",a),o.splice(r,0,a))),e.domain(oy(s,o,n)),s===Sg&&e.unknown(t.domainImplicit?Gg:void 0),t.nice&&e.nice&&e.nice(!0!==t.nice&&Hv(e,t.nice)||null),o.length):0}function ry(e,t,n){return t?(e.domain(oy(e.type,t,n)),t.length):-1}function ay(e,t,n,i,r,a){var o=Math.abs(Object(ie["U"])(n)-n[0]),s=o/(o-2*i),u=e===bg?Object(ie["mb"])(t,null,s):e===xg?Object(ie["nb"])(t,null,s,.5):e===yg?Object(ie["nb"])(t,null,s,r||1):e===Og?Object(ie["ob"])(t,null,s,a||1):Object(ie["lb"])(t,null,s);return t=t.slice(),t[0]=u[0],t[t.length-1]=u[1],t}function oy(e,t,n){if(Dv(e)){var i=Math.abs(t.reduce((function(e,t){return e+(t<0?-1:t>0?1:0)}),0));i!==t.length&&n.warn("Log scale domain includes zero: "+Object(ie["Z"])(t))}return t}function sy(e,t,n){let i=t.bins;if(i&&!Object(ie["A"])(i)){let t=e.domain(),n=t[0],r=Object(ie["U"])(t),a=null==i.start?n:i.start,o=null==i.stop?r:i.stop,s=i.step;s||Object(ie["n"])("Scale bins parameter missing step property."),a<n&&(a=s*Math.ceil(n/s)),o>r&&(o=s*Math.floor(r/s)),i=Fa(a,o+s/2,s)}return i?e.bins=i:e.bins&&delete e.bins,e.type===$g&&(i?t.domain||t.domainRaw||(e.domain(i),n=i.length):e.bins=e.domain()),n}function uy(e,t,n){var i=e.type,r=t.round||!1,a=t.range;if(null!=t.rangeStep)a=cy(i,t,n);else if(t.scheme&&(a=ly(i,t,n),Object(ie["D"])(a))){if(e.interpolator)return e.interpolator(a);Object(ie["n"])(`Scale type ${i} does not support interpolating color schemes.`)}if(a&&Sv(i))return e.interpolator(Nv(dy(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(Tv(t.interpolate,t.interpolateGamma)):Object(ie["D"])(e.round)?e.round(r):Object(ie["D"])(e.rangeRound)&&e.interpolate(r?cm["a"]:sm["a"]),a&&e.range(dy(a,t.reverse))}function cy(e,t,n){e!==Fg&&e!==Cg&&Object(ie["n"])("Only band and point scales support rangeStep.");var i=(null!=t.paddingOuter?t.paddingOuter:t.padding)||0,r=e===Cg?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0;return[0,t.rangeStep*gg(n,r,i)]}function ly(e,t,n){var i,r,a=t.schemeExtent;return Object(ie["A"])(t.scheme)?r=Nv(t.scheme,t.interpolate,t.interpolateGamma):(i=t.scheme.toLowerCase(),r=Wv(i),r||Object(ie["n"])(`Unrecognized scheme name: ${t.scheme}`)),n=e===Dg?n+1:e===$g?n-1:e===Ag||e===Eg?+t.schemeCount||Yb:n,Sv(e)?fy(r,a,t.reverse):Object(ie["D"])(r)?Rv(fy(r,a),n):e===Sg?r:r.slice(0,n)}function fy(e,t,n){return Object(ie["D"])(e)&&(t||n)?Mv(e,dy(t||[0,1],n)):e}function dy(e,t){return t?e.slice().reverse():e}function hy(e){On.call(this,null,e)}ey.transform=function(e,t){var n=t.dataflow,i=this.value,r=ty(e);for(r in i&&r===i.type||(this.value=i=wv(r)()),e)if(!Qb[r]){if("padding"===r&&Jb(i.type))continue;Object(ie["D"])(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return uy(i,e,sy(i,e,iy(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)};var py=Object(ie["y"])(hy,On);py.transform=function(e,t){var n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(ge(e.sort)),this.modified(n),t};var gy="zero",my="center",vy="normalize",by=["y0","y1"];function yy(e){On.call(this,null,e)}yy.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:gy,values:[gy,my,vy]},{name:"as",type:"string",array:!0,length:2,default:by}]};var xy=Object(ie["y"])(yy,On);function Oy(e,t,n,i,r){for(var a,o=(t-e.sum)/2,s=e.length,u=0;u<s;++u)a=e[u],a[i]=o,a[r]=o+=Math.abs(n(a))}function wy(e,t,n,i,r){for(var a,o=1/e.sum,s=0,u=e.length,c=0,l=0;c<u;++c)a=e[c],a[i]=s,a[r]=s=o*(l+=Math.abs(n(a)))}function jy(e,t,n,i,r){for(var a,o,s=0,u=0,c=e.length,l=0;l<c;++l)o=e[l],a=+n(o),a<0?(o[i]=u,o[r]=u+=a):(o[i]=s,o[r]=s+=a)}function ky(e,t,n,i){var r,a,o,s,u,c,l,f,d,h=[],p=function(e){return e(u)};if(null==t)h.push(e.slice());else for(r={},a=0,o=e.length;a<o;++a)u=e[a],c=t.map(p),l=r[c],l||(r[c]=l=[],h.push(l)),l.push(u);for(c=0,d=0,s=h.length;c<s;++c){for(l=h[c],a=0,f=0,o=l.length;a<o;++a)f+=Math.abs(i(l[a]));l.sum=f,f>d&&(d=f),n&&l.sort(n)}return h.max=d,h}function _y(){}xy.transform=function(e,t){var n,i,r,a,o=e.as||by,s=o[0],u=o[1],c=ge(e.sort),l=e.field||ie["O"],f=e.offset===my?Oy:e.offset===vy?wy:jy;for(n=ky(t.source,e.groupby,c,l),i=0,r=n.length,a=n.max;i<r;++i)f(n[i],a,l,s,u);return t.reflow(e.modified()).modifies(o)};const Ay=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];var Ey=function(){var e=1,t=1,n=s;function i(e,t){return t.map(t=>r(e,t))}function r(e,t){var i=[],r=[];return a(e,t,(function(a){n(a,e,t),Dy(a)>0?i.push([a]):r.push(a)})),r.forEach((function(e){for(var t,n=0,r=i.length;n<r;++n)if(-1!==Sy((t=i[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:t,coordinates:i}}function a(n,i,r){var a,s,u,c,l,f,d=new Array,h=new Array;a=s=-1,c=n[0]>=i,Ay[c<<1].forEach(p);while(++a<e-1)u=c,c=n[a+1]>=i,Ay[u|c<<1].forEach(p);Ay[c<<0].forEach(p);while(++s<t-1){a=-1,c=n[s*e+e]>=i,l=n[s*e]>=i,Ay[c<<1|l<<2].forEach(p);while(++a<e-1)u=c,c=n[s*e+e+a+1]>=i,f=l,l=n[s*e+a+1]>=i,Ay[u|c<<1|l<<2|f<<3].forEach(p);Ay[c|l<<3].forEach(p)}a=-1,l=n[s*e]>=i,Ay[l<<2].forEach(p);while(++a<e-1)f=l,l=n[s*e+a+1]>=i,Ay[l<<2|f<<3].forEach(p);function p(e){var t,n,i=[e[0][0]+a,e[0][1]+s],u=[e[1][0]+a,e[1][1]+s],c=o(i),l=o(u);(t=h[c])?(n=d[l])?(delete h[t.end],delete d[n.start],t===n?(t.ring.push(u),r(t.ring)):d[t.start]=h[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete h[t.end],t.ring.push(u),h[t.end=l]=t):(t=d[l])?(n=h[c])?(delete d[t.start],delete h[n.end],t===n?(t.ring.push(u),r(t.ring)):d[n.start]=h[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete d[t.start],t.ring.unshift(i),d[t.start=c]=t):d[c]=h[l]={start:c,end:l,ring:[i,u]}}Ay[l<<3].forEach(p)}function o(t){return 2*t[0]+t[1]*(e+1)*4}function s(n,i,r){n.forEach((function(n){var a,o=n[0],s=n[1],u=0|o,c=0|s,l=i[c*e+u];o>0&&o<e&&u===o&&(a=i[c*e+u-1],n[0]=o+(r-a)/(l-a)-.5),s>0&&s<t&&c===s&&(a=i[(c-1)*e+u],n[1]=s+(r-a)/(l-a)-.5)}))}return i.contour=r,i.size=function(n){if(!arguments.length)return[e,t];var r=Math.ceil(n[0]),a=Math.ceil(n[1]);return r>0&&a>0||Object(ie["n"])("invalid size"),e=r,t=a,i},i.smooth=function(e){return arguments.length?(n=e?s:_y,i):n===s},i};function Dy(e){var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];while(++t<n)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}function Sy(e,t){var n,i=-1,r=t.length;while(++i<r)if(n=Cy(e,t[i]))return n;return 0}function Cy(e,t){for(var n=t[0],i=t[1],r=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var u=e[a],c=u[0],l=u[1],f=e[s],d=f[0],h=f[1];if(Fy(u,f,t))return 0;l>i!==h>i&&n<(d-c)*(i-l)/(h-l)+c&&(r=-r)}return r}function Fy(e,t,n){var i;return $y(e,t,n)&&My(e[i=+(e[0]===t[0])],n[i],t[i])}function $y(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function My(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}var Ny=function(e,t,n){return function(i){var r=Object(ie["p"])(i),a=n?Math.min(r[0],0):r[0],o=r[1],s=o-a,u=t?es(a,o,e):s/(e+1);return Fa(u,o,u)}};function Ry(e){On.call(this,null,e)}Ry.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};var zy=Object(ie["y"])(Ry,On);function Ty(e,t,n){const i=Ny(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?i:i(e.map(e=>Ln(t(e).values)))}function Ly(e,t,n,i){let r=i.scale||t.scale,a=i.translate||t.translate;if(Object(ie["D"])(r)&&(r=r(n,i)),Object(ie["D"])(a)&&(a=a(n,i)),(1===r||null==r)&&!a)return;const o=(Object(ie["E"])(r)?r:r[0])||1,s=(Object(ie["E"])(r)?r:r[1])||1,u=a&&a[0]||0,c=a&&a[1]||0;e.forEach(Py(t,o,s,u,c))}function Py(e,t,n,i,r){const a=e.x1||0,o=e.y1||0,s=t*n<0;function u(e){e.forEach(c)}function c(e){s&&e.reverse(),e.forEach(l)}function l(e){e[0]=(e[0]-a)*t+i,e[1]=(e[1]-o)*n+r}return function(e){return e.coordinates.forEach(u),e}}function By(e,t,n){const i=e>=0?e:Xn(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function Iy(e){return Object(ie["D"])(e)?e:Object(ie["l"])(+e)}zy.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||ie["x"],a=Ey().smooth(!1!==e.smooth),o=e.thresholds||Ty(i,r,e),s=null===e.as?null:e.as||"contour",u=[];return i.forEach(t=>{const n=r(t),i=a.size([n.width,n.height])(n.values,Object(ie["A"])(o)?o:o(n.values));Ly(i,n,t,e),i.forEach(e=>{u.push(he(t,fe(null!=s?{[s]:e}:e)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n};var Uy=function(){var e=e=>e[0],t=e=>e[1],n=ie["O"],i=[-1,-1],r=960,a=500,o=2;function s(s,u){const c=By(i[0],s,e)>>o,l=By(i[1],s,t)>>o,f=c?c+2:0,d=l?l+2:0,h=2*f+(r>>o),p=2*d+(a>>o),g=new Float32Array(h*p),m=new Float32Array(h*p);let v=g;s.forEach(i=>{const r=f+(+e(i)>>o),a=d+(+t(i)>>o);r>=0&&r<h&&a>=0&&a<p&&(g[r+a*h]+=+n(i))}),c>0&&l>0?(qy(h,p,g,m,c),Wy(h,p,m,g,l),qy(h,p,g,m,c),Wy(h,p,m,g,l),qy(h,p,g,m,c),Wy(h,p,m,g,l)):c>0?(qy(h,p,g,m,c),qy(h,p,m,g,c),qy(h,p,g,m,c),v=m):l>0&&(Wy(h,p,g,m,l),Wy(h,p,m,g,l),Wy(h,p,g,m,l),v=m);let b=u?Math.pow(2,-2*o):1/Gb(v);for(let e=0,t=h*p;e<t;++e)v[e]*=b;return{values:v,scale:1<<o,width:h,height:p,x1:f,y1:d,x2:f+(r>>o),y2:d+(a>>o)}}return s.x=function(t){return arguments.length?(e=Iy(t),s):e},s.y=function(e){return arguments.length?(t=Iy(e),s):t},s.weight=function(e){return arguments.length?(n=Iy(e),s):n},s.size=function(e){if(!arguments.length)return[r,a];var t=Math.ceil(e[0]),n=Math.ceil(e[1]);return t>=0||t>=0||Object(ie["n"])("invalid size"),r=t,a=n,s},s.cellSize=function(e){return arguments.length?((e=+e)>=1||Object(ie["n"])("invalid cell size"),o=Math.floor(Math.log(e)/Math.LN2),s):1<<o},s.bandwidth=function(e){return arguments.length?(e=Object(ie["i"])(e),1===e.length&&(e=[+e[0],+e[0]]),2!==e.length&&Object(ie["n"])("invalid bandwidth"),i=e,s):i},s};function qy(e,t,n,i,r){const a=1+(r<<1);for(let o=0;o<t;++o)for(let t=0,s=0;t<e+r;++t)t<e&&(s+=n[t+o*e]),t>=r&&(t>=a&&(s-=n[t-a+o*e]),i[t-r+o*e]=s/Math.min(t+1,e-1+a-t,a))}function Wy(e,t,n,i,r){const a=1+(r<<1);for(let o=0;o<e;++o)for(let s=0,u=0;s<t+r;++s)s<t&&(u+=n[o+s*e]),s>=r&&(s>=a&&(u-=n[o+(s-a)*e]),i[o+(s-r)*e]=u/Math.min(s+1,t-1+a-s,a))}function Hy(e){On.call(this,null,e)}Hy.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};var Gy=Object(ie["y"])(Hy,On);const Vy=["x","y","weight","size","cellSize","bandwidth"];function Zy(e,t){return Vy.forEach(n=>null!=t[n]?e[n](t[n]):0),e}function Yy(e,t){var n,i,r,a,o,s,u=[],c=e=>e(a);if(null==t)u.push(e);else for(n={},i=0,r=e.length;i<r;++i)a=e[i],o=t.map(c),s=n[o],s||(n[o]=s=[],s.dims=o,u.push(s)),s.push(a);return u}function Xy(e){On.call(this,null,e)}Gy.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=Yy(i,e.groupby),a=(e.groupby||[]).map(ie["h"]),o=Zy(Uy(),e),s=e.as||"grid",u=[];function c(e,t){for(let n=0;n<a.length;++n)e[a[n]]=t[n];return e}return u=r.map(t=>fe(c({[s]:o(t,e.counts)},t.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n},Xy.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};var Jy=Object(ie["y"])(Xy,On);Jy.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,i,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=Ey().smooth(!1!==e.smooth),o=e.values,s=e.thresholds||Ny(e.count||10,e.nice,!!o),u=e.size;return o||(o=t.materialize(t.SOURCE).source,n=Zy(Uy(),e)(o,!0),i=Py(n,n.scale||1,n.scale||1,0,0),u=[n.width,n.height],o=n.values),s=Object(ie["A"])(s)?s:s(o),o=a.size(u)(o,s),i&&o.forEach(i),this.value&&(r.rem=this.value),this.value=r.source=r.add=(o||[]).map(fe),r};var Qy="Feature",Ky="FeatureCollection",ex="MultiPoint";function tx(e){On.call(this,null,e)}tx.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};var nx=Object(ie["y"])(tx,On);nx.transform=function(e,t){var n,i=this._features,r=this._points,a=e.fields,o=a&&a[0],s=a&&a[1],u=e.geojson||!a&&ie["x"],c=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(Object(ie["g"])(u))||o&&t.modified(Object(ie["g"])(o))||s&&t.modified(Object(ie["g"])(s)),this.value&&!n||(c=t.SOURCE,this._features=i=[],this._points=r=[]),u&&t.visit(c,(function(e){i.push(u(e))})),o&&s&&(t.visit(c,(function(e){var t=o(e),n=s(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&r.push([t,n])})),i=i.concat({type:Qy,geometry:{type:ex,coordinates:r}})),this.value={type:Ky,features:i}};var ix=n("bc71"),rx=n("8905"),ax=n("6a3e"),ox=n("3fac"),sx=n("0aec"),ux=n("e237"),cx=n("9d5b"),lx=n("c963"),fx=n("f965"),dx=n("5572"),hx=n("c0a6"),px=n("6d40"),gx=n("2d9e"),mx=n("f273"),vx=n("2cff"),bx=n("691f"),yx=n("6384"),xx=n("d626"),Ox=Math.abs,wx=(Math.atan,Math.atan2,Math.ceil,Math.cos),jx=(Math.exp,Math.floor,Math.log,Math.max,Math.min,Math.pow,Math.round,Math.sign,Math.sin),kx=(Math.tan,1e-6),_x=Math.PI,Ax=_x/2,Ex=(Math.SQRT1_2,Sx(2));Sx(_x);function Dx(e){return e>1?Ax:e<-1?-Ax:Math.asin(e)}function Sx(e){return e>0?Math.sqrt(e):0}function Cx(e,t){var n,i=e*jx(t),r=30;do{t-=n=(t+jx(t)-i)/(1+wx(t))}while(Ox(n)>kx&&--r>0);return t/2}function Fx(e,t,n){function i(i,r){return[e*i*wx(r=Cx(n,r)),t*jx(r)]}return i.invert=function(i,r){return r=Dx(r/t),[i/(e*wx(r)),Dx((2*r+jx(2*r))/n)]},i}var $x=Fx(Ex/Ax,Ex,_x),Mx=function(){return Object(xx["a"])($x).scale(169.529)},Nx=Object(ix["a"])(),Rx=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function zx(e,t){return function n(){var i=t();return i.type=e,i.path=Object(ix["a"])().projection(i),i.copy=i.copy||function(){var e=n();return Rx.forEach((function(t){i[t]&&e[t](i[t]())})),e.path.pointRadius(i.path.pointRadius()),e},i}}function Tx(e,t){if(!e||"string"!==typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(Px[e]=zx(e,t),this):Px[e]||null}function Lx(e){return e&&e.path||Nx}var Px={albers:rx["a"],albersusa:ax["a"],azimuthalequalarea:ox["b"],azimuthalequidistant:sx["b"],conicconformal:ux["b"],conicequalarea:cx["b"],conicequidistant:lx["b"],equalEarth:fx["a"],equirectangular:dx["a"],gnomonic:hx["a"],identity:px["a"],mercator:gx["a"],mollweide:Mx,naturalEarth1:mx["a"],orthographic:vx["a"],stereographic:bx["a"],transversemercator:yx["a"]};for(var Bx in Px)Tx(Bx,Px[Bx]);function Ix(e){On.call(this,null,e)}Ix.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};var Ux=Object(ie["y"])(Ix,On);function qx(e,t){var n=e.pointRadius();return e.context(null),null!=t&&e.pointRadius(t),n}function Wx(e){On.call(this,null,e)}Ux.transform=function(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||ie["x"],a=e.as||"path",o=n.SOURCE;function s(e){e[a]=i(r(e))}!i||e.modified()?(this.value=i=Lx(e.projection),n.materialize().reflow()):o=r===ie["x"]||t.modified(r.fields)?n.ADD_MOD:n.ADD;var u=qx(i,e.pointRadius);return n.visit(o,s),i.pointRadius(u),n.modifies(a)},Wx.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};var Hx=Object(ie["y"])(Wx,On);function Gx(e){On.call(this,null,e)}Hx.transform=function(e,t){var n,i=e.projection,r=e.fields[0],a=e.fields[1],o=e.as||["x","y"],s=o[0],u=o[1];function c(e){var t=i([r(e),a(e)]);t?(e[s]=t[0],e[u]=t[1]):(e[s]=void 0,e[u]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,c):(n=t.modified(r.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,c)),t.modifies(o)},Gx.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};var Vx=Object(ie["y"])(Gx,On);function Zx(e,t,n){var i=null==n?function(n){return e(t(n))}:function(i){var r=e.pointRadius(),a=e.pointRadius(n)(t(i));return e.pointRadius(r),a};return i.context=function(t){return e.context(t),i},i}Vx.transform=function(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",a=n.ADD;return i&&!e.modified()||(this.value=i=Zx(Lx(e.projection),e.field||Object(ie["t"])("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,(function(e){e[r]=i})),n.modifies(r)};var Yx=n("adda");function Xx(e){On.call(this,[],e),this.generator=Object(Yx["a"])()}Xx.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};var Jx=Object(ie["y"])(Xx,On);Jx.transform=function(e,t){var n,i=this.value,r=this.generator;if(!i.length||e.modified())for(var a in e)Object(ie["D"])(r[a])&&r[a](e[a]);return n=r(),i.length?t.mod.push(pe(i[0],n)):t.add.push(fe(n)),i[0]=n,t};var Qx=n("166a");function Kx(e){On.call(this,null,e)}Kx.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};var eO=Object(ie["y"])(Kx,On);function tO(e,t){let n;return Object(ie["D"])(e)?(n=n=>Object(Qx["g"])(e(n,t)),n.dep=iO(e)):n=Object(ie["l"])(Object(Qx["g"])(e||"#888")),n}function nO(e,t){let n;return Object(ie["D"])(e)?(n=n=>e(n,t),n.dep=iO(e)):e?n=Object(ie["l"])(e):(n=e=>e.$value/e.$max||0,n.dep=!0),n}function iO(e){if(!Object(ie["D"])(e))return!1;const t=Object(ie["db"])(Object(ie["g"])(e));return t.$x||t.$y||t.$value||t.$max}function rO(e,t,n,i){const r=e.width,a=e.height,o=e.x1||0,s=e.y1||0,u=e.x2||r,c=e.y2||a,l=e.values,f=l?e=>l[e]:ie["kb"],d=Cu(u-o,c-s),h=d.getContext("2d"),p=h.getImageData(0,0,u-o,c-s),g=p.data;for(let m=s,v=0;m<c;++m){t.$y=m-s;for(let e=o,a=m*r;e<u;++e,v+=4){t.$x=e-o,t.$value=f(e+a);const r=n(t);g[v+0]=r.r,g[v+1]=r.g,g[v+2]=r.b,g[v+3]=~~(255*i(t))}}return h.putImageData(p,0,0),d}function aO(e){On.call(this,null,e),this.modified(!0)}eO.transform=function(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i="shared"===e.resolve,r=e.field||ie["x"],a=nO(e.opacity,e),o=tO(e.color,e),s=e.as||"image",u={$x:0,$y:0,$value:0,$max:i?Ln(n.map(e=>Ln(r(e).values))):0};return n.forEach(e=>{const t=r(e),n=Object(ie["o"])({},e,u);i||(n.$max=Ln(t.values||[])),e[s]=rO(t,n,o.dep?o:Object(ie["l"])(o(n)),a.dep?a:Object(ie["l"])(a(n)))}),t.reflow(!0).modifies(s)};var oO=Object(ie["y"])(aO,On);function sO(e,t){var n=lO(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function uO(e){var t=Tx((e||"mercator").toLowerCase());return t||Object(ie["n"])("Unrecognized projection type: "+e),t()}function cO(e,t,n){Object(ie["D"])(e[t])&&e[t](n)}function lO(e){return e=Object(ie["i"])(e),1===e.length?e[0]:{type:Ky,features:e.reduce((e,t)=>e.concat(fO(t)),[])}}function fO(e){return e.type===Ky?e.features:Object(ie["i"])(e).filter(e=>null!=e).map(e=>e.type===Qy?e:{type:Qy,geometry:e})}oO.transform=function(e,t){var n=this.value;return!n||e.modified("type")?(this.value=n=uO(e.type),Rx.forEach((function(t){null!=e[t]&&cO(n,t,e[t])}))):Rx.forEach((function(t){e.modified(t)&&cO(n,t,e[t])})),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&sO(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)};var dO=function(e,t){var n;function i(){var i,r,a=n.length,o=0,s=0;for(i=0;i<a;++i)r=n[i],o+=r.x,s+=r.y;for(o=o/a-e,s=s/a-t,i=0;i<a;++i)r=n[i],r.x-=o,r.y-=s}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i},hO=n("cfa1"),pO=function(e){return function(){return e}},gO=function(){return 1e-6*(Math.random()-.5)};function mO(e){return e.x+e.vx}function vO(e){return e.y+e.vy}var bO=function(e){var t,n,i=1,r=1;function a(){for(var e,a,s,u,c,l,f,d=t.length,h=0;h<r;++h)for(a=Object(hO["a"])(t,mO,vO).visitAfter(o),e=0;e<d;++e)s=t[e],l=n[s.index],f=l*l,u=s.x+s.vx,c=s.y+s.vy,a.visit(p);function p(e,t,n,r,a){var o=e.data,d=e.r,h=l+d;if(!o)return t>u+h||r<u-h||n>c+h||a<c-h;if(o.index>s.index){var p=u-o.x-o.vx,g=c-o.y-o.vy,m=p*p+g*g;m<h*h&&(0===p&&(p=gO(),m+=p*p),0===g&&(g=gO(),m+=g*g),m=(h-(m=Math.sqrt(m)))/m*i,s.vx+=(p*=m)*(h=(d*=d)/(f+d)),s.vy+=(g*=m)*h,o.vx-=p*(h=1-h),o.vy-=g*h)}}}function o(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function s(){if(t){var i,r,a=t.length;for(n=new Array(a),i=0;i<a;++i)r=t[i],n[r.index]=+e(r,i,t)}}return"function"!==typeof e&&(e=pO(null==e?1:+e)),a.initialize=function(e){t=e,s()},a.iterations=function(e){return arguments.length?(r=+e,a):r},a.strength=function(e){return arguments.length?(i=+e,a):i},a.radius=function(t){return arguments.length?(e="function"===typeof t?t:pO(+t),s(),a):e},a};function yO(e){return e.index}function xO(e,t){var n=e.get(t);if(!n)throw new Error("missing: "+t);return n}var OO=function(e){var t,n,i,r,a,o=yO,s=l,u=pO(30),c=1;function l(e){return 1/Math.min(r[e.source.index],r[e.target.index])}function f(i){for(var r=0,o=e.length;r<c;++r)for(var s,u,l,f,d,h,p,g=0;g<o;++g)s=e[g],u=s.source,l=s.target,f=l.x+l.vx-u.x-u.vx||gO(),d=l.y+l.vy-u.y-u.vy||gO(),h=Math.sqrt(f*f+d*d),h=(h-n[g])/h*i*t[g],f*=h,d*=h,l.vx-=f*(p=a[g]),l.vy-=d*p,u.vx+=f*(p=1-p),u.vy+=d*p}function d(){if(i){var s,u,c=i.length,l=e.length,f=new Map(i.map((e,t)=>[o(e,t,i),e]));for(s=0,r=new Array(c);s<l;++s)u=e[s],u.index=s,"object"!==typeof u.source&&(u.source=xO(f,u.source)),"object"!==typeof u.target&&(u.target=xO(f,u.target)),r[u.source.index]=(r[u.source.index]||0)+1,r[u.target.index]=(r[u.target.index]||0)+1;for(s=0,a=new Array(l);s<l;++s)u=e[s],a[s]=r[u.source.index]/(r[u.source.index]+r[u.target.index]);t=new Array(l),h(),n=new Array(l),p()}}function h(){if(i)for(var n=0,r=e.length;n<r;++n)t[n]=+s(e[n],n,e)}function p(){if(i)for(var t=0,r=e.length;t<r;++t)n[t]=+u(e[t],t,e)}return null==e&&(e=[]),f.initialize=function(e){i=e,d()},f.links=function(t){return arguments.length?(e=t,d(),f):e},f.id=function(e){return arguments.length?(o=e,f):o},f.iterations=function(e){return arguments.length?(c=+e,f):c},f.strength=function(e){return arguments.length?(s="function"===typeof e?e:pO(+e),h(),f):s},f.distance=function(e){return arguments.length?(u="function"===typeof e?e:pO(+e),p(),f):u},f},wO=n("c68f3"),jO=n("74f4");function kO(e){return e.x}function _O(e){return e.y}var AO=10,EO=Math.PI*(3-Math.sqrt(5)),DO=function(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),a=0,o=.6,s=new Map,u=Object(jO["c"])(l),c=Object(wO["a"])("tick","end");function l(){f(),c.call("tick",t),n<i&&(u.stop(),c.call("end",t))}function f(i){var u,c,l=e.length;void 0===i&&(i=1);for(var f=0;f<i;++f)for(n+=(a-n)*r,s.forEach((function(e){e(n)})),u=0;u<l;++u)c=e[u],null==c.fx?c.x+=c.vx*=o:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=o:(c.y=c.fy,c.vy=0);return t}function d(){for(var t,n=0,i=e.length;n<i;++n){if(t=e[n],t.index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var r=AO*Math.sqrt(n),a=n*EO;t.x=r*Math.cos(a),t.y=r*Math.sin(a)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function h(t){return t.initialize&&t.initialize(e),t}return null==e&&(e=[]),d(),t={tick:f,restart:function(){return u.restart(l),t},stop:function(){return u.stop(),t},nodes:function(n){return arguments.length?(e=n,d(),s.forEach(h),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(i=+e,t):i},alphaDecay:function(e){return arguments.length?(r=+e,t):+r},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},force:function(e,n){return arguments.length>1?(null==n?s.delete(e):s.set(e,h(n)),t):s.get(e)},find:function(t,n,i){var r,a,o,s,u,c=0,l=e.length;for(null==i?i=1/0:i*=i,c=0;c<l;++c)s=e[c],r=t-s.x,a=n-s.y,o=r*r+a*a,o<i&&(u=s,i=o);return u},on:function(e,n){return arguments.length>1?(c.on(e,n),t):c.on(e)}}},SO=function(){var e,t,n,i,r=pO(-30),a=1,o=1/0,s=.81;function u(i){var r,a=e.length,o=Object(hO["a"])(e,kO,_O).visitAfter(l);for(n=i,r=0;r<a;++r)t=e[r],o.visit(f)}function c(){if(e){var t,n,a=e.length;for(i=new Array(a),t=0;t<a;++t)n=e[t],i[n.index]=+r(n,t,e)}}function l(e){var t,n,r,a,o,s=0,u=0;if(e.length){for(r=a=o=0;o<4;++o)(t=e[o])&&(n=Math.abs(t.value))&&(s+=t.value,u+=n,r+=n*t.x,a+=n*t.y);e.x=r/u,e.y=a/u}else{t=e,t.x=t.data.x,t.y=t.data.y;do{s+=i[t.data.index]}while(t=t.next)}e.value=s}function f(e,r,u,c){if(!e.value)return!0;var l=e.x-t.x,f=e.y-t.y,d=c-r,h=l*l+f*f;if(d*d/s<h)return h<o&&(0===l&&(l=gO(),h+=l*l),0===f&&(f=gO(),h+=f*f),h<a&&(h=Math.sqrt(a*h)),t.vx+=l*e.value*n/h,t.vy+=f*e.value*n/h),!0;if(!(e.length||h>=o)){(e.data!==t||e.next)&&(0===l&&(l=gO(),h+=l*l),0===f&&(f=gO(),h+=f*f),h<a&&(h=Math.sqrt(a*h)));do{e.data!==t&&(d=i[e.data.index]*n/h,t.vx+=l*d,t.vy+=f*d)}while(e=e.next)}}return u.initialize=function(t){e=t,c()},u.strength=function(e){return arguments.length?(r="function"===typeof e?e:pO(+e),c(),u):r},u.distanceMin=function(e){return arguments.length?(a=e*e,u):Math.sqrt(a)},u.distanceMax=function(e){return arguments.length?(o=e*e,u):Math.sqrt(o)},u.theta=function(e){return arguments.length?(s=e*e,u):Math.sqrt(s)},u},CO=function(e){var t,n,i,r=pO(.1);function a(e){for(var r,a=0,o=t.length;a<o;++a)r=t[a],r.vx+=(i[a]-r.x)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),i=new Array(o),a=0;a<o;++a)n[a]=isNaN(i[a]=+e(t[a],a,t))?0:+r(t[a],a,t)}}return"function"!==typeof e&&(e=pO(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(r="function"===typeof e?e:pO(+e),o(),a):r},a.x=function(t){return arguments.length?(e="function"===typeof t?t:pO(+t),o(),a):e},a},FO=function(e){var t,n,i,r=pO(.1);function a(e){for(var r,a=0,o=t.length;a<o;++a)r=t[a],r.vy+=(i[a]-r.y)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),i=new Array(o),a=0;a<o;++a)n[a]=isNaN(i[a]=+e(t[a],a,t))?0:+r(t[a],a,t)}}return"function"!==typeof e&&(e=pO(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(r="function"===typeof e?e:pO(+e),o(),a):r},a.y=function(t){return arguments.length?(e="function"===typeof t?t:pO(+t),o(),a):e},a},$O={center:dO,collide:bO,nbody:SO,link:OO,x:CO,y:FO},MO="forces",NO=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],RO=["static","iterations"],zO=["x","y","vx","vy"];function TO(e){On.call(this,null,e)}TO.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:zO}]};var LO=Object(ie["y"])(TO,On);function PO(e,t){return function(){e.touch(t).run()}}function BO(e,t){var n=DO(e),i=!1,r=n.stop,a=n.restart;return n.stopped=function(){return i},n.restart=function(){return i=!1,a()},n.stop=function(){return i=!0,r()},IO(n,t,!0).on("end",(function(){i=!0}))}function IO(e,t,n,i){var r,a,o,s,u=Object(ie["i"])(t.forces);for(r=0,a=NO.length;r<a;++r)o=NO[r],o!==MO&&t.modified(o)&&e[o](t[o]);for(r=0,a=u.length;r<a;++r)s=MO+r,o=n||t.modified(MO,r)?qO(u[r]):i&&UO(u[r],i)?e.force(s):null,o&&e.force(s,o);for(a=e.numForces||0;r<a;++r)e.force(MO+r,null);return e.numForces=u.length,e}function UO(e,t){var n,i;for(n in e)if(Object(ie["D"])(i=e[n])&&t.modified(Object(ie["g"])(i)))return 1;return 0}function qO(e){var t,n;for(n in Object(ie["v"])($O,e.force)||Object(ie["n"])("Unrecognized force: "+e.force),t=$O[e.force](),e)Object(ie["D"])(t[n])&&WO(t[n],e[n],e);return t}function WO(e,t,n){e(Object(ie["D"])(t)?function(e){return t(e,n)}:t)}LO.transform=function(e,t){var n=this.value,i=t.changed(t.ADD_REM),r=e.modified(NO),a=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(r||t.changed(t.MOD))&&IO(n,e,0,t)):(this.value=n=BO(t.source,e),n.on("tick",PO(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),r||i||e.modified(RO)||t.changed()&&e.restart)if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/a)),e.static)for(n.stop();--a>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation;return this.finish(e,t)},LO.finish=function(e,t){for(var n,i=t.dataflow,r=this._argops,a=0,o=r.length;a<o;++a)if(n=r[a],n.name===MO&&"link"===n.op._argval.force)for(var s,u=n.op._argops,c=0,l=u.length;c<l;++c)if("links"===u[c].name&&(s=u[c].op.source)){i.pulse(s,i.changeset().reflow());break}return t.reflow(e.modified()).modifies(zO)};var HO=function(e,t,n){var i={};return e.each((function(e){var r=e.data;n(r)&&(i[t(r)]=e)})),e.lookup=i,e},GO=n("6bcb");function VO(e){On.call(this,null,e)}VO.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};var ZO=Object(ie["y"])(VO,On);function YO(e){return e.values}function XO(){var e,t=[];function n(e,i){if(i>=t.length)return e;var r,a,o,s=-1,u=e.length,c=t[i++],l={},f={};while(++s<u)r=c(a=e[s])+"",(o=l[r])?o.push(a):l[r]=[a];for(r in l)f[r]=n(l[r],i);return f}function i(e,n){if(++n>t.length)return e;var r,a=[];for(r in e)a.push({key:r,values:i(e[r],n)});return a}return e={entries:e=>i(n(e,0),0),key:n=>(t.push(n),e)}}function JO(e){On.call(this,null,e)}ZO.transform=function(e,t){t.source||Object(ie["n"])("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),a=this.value;return(!a||i||t.changed())&&(a&&a.each(e=>{e.children&&ue(e.data)&&r.rem.push(e.data)}),this.value=a=Object(GO["c"])({values:Object(ie["i"])(e.keys).reduce((e,t)=>(e.key(t),e),XO()).entries(r.source)},YO),n&&a.each(e=>{e.children&&(e=fe(e.data),r.add.push(e),r.source.push(e))}),HO(a,ce,ce)),r.source.root=a,r};var QO=Object(ie["y"])(JO,On);function KO(e,t,n){for(var i,r=0,a=t.length;r<a;++r)i=t[r],i in n&&e[i](n[i])}function ew(e,t,n){for(var i=e.data,r=0,a=t.length-1;r<a;++r)i[n[r]]=e[t[r]];i[n[a]]=e.children?e.children.length:0}function tw(e,t){return e.parent===t.parent?1:2}QO.transform=function(e,t){t.source&&t.source.root||Object(ie["n"])(this.constructor.name+" transform requires a backing tree data source.");var n=this.layout(e.method),i=this.fields,r=t.source.root,a=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(ge(e.sort,e=>e.data)),KO(n,this.params,e),n.separation&&n.separation(!1!==e.separation?tw:ie["O"]);try{this.value=n(r)}catch(o){Object(ie["n"])(o)}return r.each((function(e){ew(e,i,a)})),t.reflow(e.modified()).modifies(a).modifies("leaf")};var nw=n("2373"),iw=["x","y","r","depth","children"];function rw(e){JO.call(this,e)}rw.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:iw.length,default:iw}]};var aw=Object(ie["y"])(rw,JO);aw.layout=nw["a"],aw.params=["radius","size","padding"],aw.fields=iw;var ow=n("f8d7"),sw=["x0","y0","x1","y1","depth","children"];function uw(e){JO.call(this,e)}uw.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:sw.length,default:sw}]};var cw=Object(ie["y"])(uw,JO);cw.layout=ow["a"],cw.params=["size","round","padding"],cw.fields=sw;var lw=n("354e");function fw(e){On.call(this,null,e)}fw.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};var dw=Object(ie["y"])(fw,On);dw.transform=function(e,t){t.source||Object(ie["n"])("Stratify transform requires an upstream data source.");var n=this.value,i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),a=!this.value||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),a&&(n=r.source.length?HO(Object(lw["a"])().id(e.key).parentId(e.parentKey)(r.source),e.key,ie["gb"]):HO(Object(lw["a"])()([{}]),e.key,e.key)),r.source.root=this.value=n,r};var hw=n("5070"),pw=n("ce97"),gw={tidy:hw["a"],cluster:pw["a"]},mw=["x","y","depth","children"];function vw(e){JO.call(this,e)}vw.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:mw.length,default:mw}]};var bw=Object(ie["y"])(vw,JO);function yw(e){On.call(this,[],e)}bw.layout=function(e){var t=e||"tidy";if(Object(ie["v"])(gw,t))return gw[t]();Object(ie["n"])("Unrecognized Tree layout method: "+t)},bw.params=["size","nodeSize"],bw.fields=mw,yw.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};var xw=Object(ie["y"])(yw,On);xw.transform=function(e,t){var n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),a={};return i||Object(ie["n"])("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,(function(e){a[ce(e)]=1})),i.each((function(e){var t=e.data,n=e.parent&&e.parent.data;n&&a[ce(t)]&&a[ce(n)]&&r.add.push(fe({source:n,target:t}))})),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,(function(e){a[ce(e)]=1})),n.forEach((function(e){(a[ce(e.source)]||a[ce(e.target)])&&r.mod.push(e)}))),r};var Ow=n("8af3"),ww=n("14f3"),jw=n("ec83"),kw=n("0830"),_w=n("2388"),Aw=n("d426"),Ew=n("b6f4"),Dw={binary:Ow["a"],dice:ww["a"],slice:jw["a"],slicedice:kw["a"],squarify:_w["a"],resquarify:Aw["a"]},Sw=["x0","y0","x1","y1","depth","children"];function Cw(e){JO.call(this,e)}Cw.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Sw.length,default:Sw}]};var Fw=Object(ie["y"])(Cw,JO);Fw.layout=function(){var e=Object(Ew["a"])();return e.ratio=function(t){var n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=function(t){Object(ie["v"])(Dw,t)?e.tile(Dw[t]):Object(ie["n"])("Unrecognized Treemap layout method: "+t)},e},Fw.params=["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],Fw.fields=Sw;var $w=function(e,t){var n,i,r,a,o,s,u=[],c=function(e){return e(a)};if(null==t)u.push(e);else for(n={},i=0,r=e.length;i<r;++i)a=e[i],o=t.map(c),s=n[o],s||(n[o]=s=[],s.dims=o,u.push(s)),s.push(a);return u};function Mw(e){On.call(this,null,e)}Mw.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};var Nw=Object(ie["y"])(Mw,On);Nw.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=$w(i,e.groupby),a=(e.groupby||[]).map(ie["h"]),o=a.length,s=e.as||[Object(ie["h"])(e.x),Object(ie["h"])(e.y)],u=[];r.forEach(t=>{Ii(t,e.x,e.y,e.bandwidth||.3).forEach(e=>{const n={};for(let i=0;i<o;++i)n[a[i]]=t.dims[i];n[s[0]]=e[0],n[s[1]]=e[1],u.push(fe(n))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n};const Rw={linear:Ci,log:Fi,exp:$i,pow:Mi,quad:Ni,poly:Ri};function zw(e,t){return"poly"===e?t:"quad"===e?2:1}function Tw(e){On.call(this,null,e)}Tw.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(Rw)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};var Lw=Object(ie["y"])(Tw,On);Lw.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=$w(i,e.groupby),a=(e.groupby||[]).map(ie["h"]),o=e.method||"linear",s=e.order||3,u=zw(o,s),c=e.as||[Object(ie["h"])(e.x),Object(ie["h"])(e.y)],l=Rw[o],f=[];let d=e.extent;Object(ie["v"])(Rw,o)||Object(ie["n"])("Invalid regression method: "+o),null!=d&&"log"===o&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),r.forEach(n=>{const i=n.length;if(i<=u)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const r=l(n,e.x,e.y,s);if(e.params)return void f.push(fe({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const h=d||Object(ie["p"])(n,e.x),p=e=>{const t={};for(let i=0;i<a.length;++i)t[a[i]]=n.dims[i];t[c[0]]=e[0],t[c[1]]=e[1],f.push(fe(t))};"linear"===o?h.forEach(e=>p([e,r.predict(e)])):Gi(r.predict,h,25,200).forEach(p)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n};const Pw=Math.pow(2,-52),Bw=new Uint32Array(512);class Iw{static from(e,t=Jw,n=Qw){const i=e.length,r=new Float64Array(2*i);for(let a=0;a<i;a++){const i=e[a];r[2*a]=t(i),r[2*a+1]=n(i)}return new Iw(r)}constructor(e){const t=e.length>>1;if(t>0&&"number"!==typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:i,_hullHash:r}=this,a=e.length>>1;let o=1/0,s=1/0,u=-1/0,c=-1/0;for(let _=0;_<a;_++){const t=e[2*_],n=e[2*_+1];t<o&&(o=t),n<s&&(s=n),t>u&&(u=t),n>c&&(c=n),this._ids[_]=_}const l=(o+u)/2,f=(s+c)/2;let d,h,p,g=1/0;for(let _=0;_<a;_++){const t=qw(l,f,e[2*_],e[2*_+1]);t<g&&(d=_,g=t)}const m=e[2*d],v=e[2*d+1];g=1/0;for(let _=0;_<a;_++){if(_===d)continue;const t=qw(m,v,e[2*_],e[2*_+1]);t<g&&t>0&&(h=_,g=t)}let b=e[2*h],y=e[2*h+1],x=1/0;for(let _=0;_<a;_++){if(_===d||_===h)continue;const t=Vw(m,v,b,y,e[2*_],e[2*_+1]);t<x&&(p=_,x=t)}let O=e[2*p],w=e[2*p+1];if(x===1/0){for(let i=0;i<a;i++)this._dists[i]=e[2*i]-e[0]||e[2*i+1]-e[1];Yw(this._ids,this._dists,0,a-1);const t=new Uint32Array(a);let n=0;for(let e=0,i=-1/0;e<a;e++){const r=this._ids[e];this._dists[r]>i&&(t[n++]=r,i=this._dists[r])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(Hw(m,v,b,y,O,w)){const e=h,t=b,n=y;h=p,b=O,y=w,p=e,O=t,w=n}const j=Zw(m,v,b,y,O,w);this._cx=j.x,this._cy=j.y;for(let _=0;_<a;_++)this._dists[_]=qw(e[2*_],e[2*_+1],j.x,j.y);Yw(this._ids,this._dists,0,a-1),this._hullStart=d;let k=3;n[d]=t[p]=h,n[h]=t[d]=p,n[p]=t[h]=d,i[d]=0,i[h]=1,i[p]=2,r.fill(-1),r[this._hashKey(m,v)]=d,r[this._hashKey(b,y)]=h,r[this._hashKey(O,w)]=p,this.trianglesLen=0,this._addTriangle(d,h,p,-1,-1,-1);for(let _,A,E=0;E<this._ids.length;E++){const a=this._ids[E],o=e[2*a],s=e[2*a+1];if(E>0&&Math.abs(o-_)<=Pw&&Math.abs(s-A)<=Pw)continue;if(_=o,A=s,a===d||a===h||a===p)continue;let u=0;for(let e=0,t=this._hashKey(o,s);e<this._hashSize;e++)if(u=r[(t+e)%this._hashSize],-1!==u&&u!==n[u])break;u=t[u];let c,l=u;while(c=n[l],!Hw(o,s,e[2*l],e[2*l+1],e[2*c],e[2*c+1]))if(l=c,l===u){l=-1;break}if(-1===l)continue;let f=this._addTriangle(l,a,n[l],-1,-1,i[l]);i[a]=this._legalize(f+2),i[l]=f,k++;let g=n[l];while(c=n[g],Hw(o,s,e[2*g],e[2*g+1],e[2*c],e[2*c+1]))f=this._addTriangle(g,a,c,i[a],-1,i[g]),i[a]=this._legalize(f+2),n[g]=g,k--,g=c;if(l===u)while(c=t[l],Hw(o,s,e[2*c],e[2*c+1],e[2*l],e[2*l+1]))f=this._addTriangle(c,a,l,-1,i[l],i[c]),this._legalize(f+2),i[c]=f,n[l]=l,k--,l=c;this._hullStart=t[a]=l,n[l]=t[g]=a,n[a]=g,r[this._hashKey(o,s)]=a,r[this._hashKey(e[2*l],e[2*l+1])]=l}this.hull=new Uint32Array(k);for(let _=0,A=this._hullStart;_<k;_++)this.hull[_]=A,A=n[A];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(Uw(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:i}=this;let r=0,a=0;while(1){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,-1===o){if(0===r)break;e=Bw[--r];continue}const u=o-o%3,c=s+(e+1)%3,l=u+(o+2)%3,f=t[a],d=t[e],h=t[c],p=t[l],g=Gw(i[2*f],i[2*f+1],i[2*d],i[2*d+1],i[2*h],i[2*h+1],i[2*p],i[2*p+1]);if(g){t[e]=p,t[o]=f;const i=n[l];if(-1===i){let t=this._hullStart;do{if(this._hullTri[t]===l){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,i),this._link(o,n[a]),this._link(a,l);const s=u+(o+1)%3;r<Bw.length&&(Bw[r++]=s)}else{if(0===r)break;e=Bw[--r]}}return a}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,i,r,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,i),this._link(o+1,r),this._link(o+2,a),this.trianglesLen+=3,o}}function Uw(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function qw(e,t,n,i){const r=e-n,a=t-i;return r*r+a*a}function Ww(e,t,n,i,r,a){const o=(i-t)*(r-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function Hw(e,t,n,i,r,a){const o=Ww(r,a,e,t,n,i)||Ww(e,t,n,i,r,a)||Ww(n,i,r,a,e,t);return o<0}function Gw(e,t,n,i,r,a,o,s){const u=e-o,c=t-s,l=n-o,f=i-s,d=r-o,h=a-s,p=u*u+c*c,g=l*l+f*f,m=d*d+h*h;return u*(f*m-g*h)-c*(l*m-g*d)+p*(l*h-f*d)<0}function Vw(e,t,n,i,r,a){const o=n-e,s=i-t,u=r-e,c=a-t,l=o*o+s*s,f=u*u+c*c,d=.5/(o*c-s*u),h=(c*l-s*f)*d,p=(o*f-u*l)*d;return h*h+p*p}function Zw(e,t,n,i,r,a){const o=n-e,s=i-t,u=r-e,c=a-t,l=o*o+s*s,f=u*u+c*c,d=.5/(o*c-s*u),h=e+(c*l-s*f)*d,p=t+(o*f-u*l)*d;return{x:h,y:p}}function Yw(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const i=e[r],a=t[i];let o=r-1;while(o>=n&&t[e[o]]>a)e[o+1]=e[o--];e[o+1]=i}else{const r=n+i>>1;let a=n+1,o=i;Xw(e,r,a),t[e[n]]>t[e[i]]&&Xw(e,n,i),t[e[a]]>t[e[i]]&&Xw(e,a,i),t[e[n]]>t[e[a]]&&Xw(e,n,a);const s=e[a],u=t[s];while(1){do{a++}while(t[e[a]]<u);do{o--}while(t[e[o]]>u);if(o<a)break;Xw(e,a,o)}e[n+1]=e[o],e[o]=s,i-a+1>=o-n?(Yw(e,t,a,i),Yw(e,t,n,o-1)):(Yw(e,t,n,o-1),Yw(e,t,a,i))}}function Xw(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Jw(e){return e[0]}function Qw(e){return e[1]}const Kw=1e-6;class ej{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){e=+e,t=+t,n=+n;const i=e+n,r=t;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${i},${r}`:(Math.abs(this._x1-i)>Kw||Math.abs(this._y1-r)>Kw)&&(this._+="L"+i+","+r),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=i},${this._y1=r}`)}rect(e,t,n,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class tj{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class nj{constructor(e,[t,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(t=+t))||!((r=+r)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=i,this.xmin=t,this.ymax=r,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:i}=this,r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let d,h,p=0,g=0,m=n.length;p<m;p+=3,g+=2){const t=2*n[p],i=2*n[p+1],a=2*n[p+2],o=e[t],s=e[t+1],u=e[i],c=e[i+1],l=e[a],f=e[a+1],m=u-o,v=c-s,b=l-o,y=f-s,x=m*m+v*v,O=b*b+y*y,w=2*(m*y-v*b);if(w)if(Math.abs(w)<1e-8)d=(o+l)/2,h=(s+f)/2;else{const e=1/w;d=o+(y*x-v*O)*e,h=s+(m*O-b*x)*e}else d=(o+l)/2-1e8*y,h=(s+f)/2+1e8*b;r[g]=d,r[g+1]=h}let a,o,s,u=t[t.length-1],c=4*u,l=e[2*u],f=e[2*u+1];i.fill(0);for(let d=0;d<t.length;++d)u=t[d],a=c,o=l,s=f,c=4*u,l=e[2*u],f=e[2*u+1],i[a+2]=i[c]=s-f,i[a+3]=i[c+1]=l-o}render(e){const t=null==e?e=new ej:void 0,{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:a,vectors:o}=this;if(r.length<=1)return null;for(let c=0,l=n.length;c<l;++c){const t=n[c];if(t<c)continue;const i=2*Math.floor(c/3),r=2*Math.floor(t/3),o=a[i],s=a[i+1],u=a[r],l=a[r+1];this._renderSegment(o,s,u,l,e)}let s,u=r[r.length-1];for(let c=0;c<r.length;++c){s=u,u=r[c];const t=2*Math.floor(i[u]/3),n=a[t],l=a[t+1],f=4*s,d=this._project(n,l,o[f+2],o[f+3]);d&&this._renderSegment(n,l,d[0],d[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new ej:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=null==t?t=new ej:void 0,i=this._clip(e);if(null===i)return;t.moveTo(i[0],i[1]);let r=i.length;while(i[0]===i[r-2]&&i[1]===i[r-1]&&r>1)r-=2;for(let a=2;a<r;a+=2)i[a]===i[a-2]&&i[a+1]===i[a-1]||t.lineTo(i[a],i[a+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const e=this.cellPolygon(t);e&&(yield e)}}cellPolygon(e){const t=new tj;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,i,r){let a;const o=this._regioncode(e,t),s=this._regioncode(n,i);0===o&&0===s?(r.moveTo(e,t),r.lineTo(n,i)):(a=this._clipSegment(e,t,n,i,o,s))&&(r.moveTo(a[0],a[1]),r.lineTo(a[2],a[3]))}contains(e,t,n){return t=+t,t===t&&(n=+n,n===n)&&this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const e=this._clip(n);if(e)e:for(let i=0,r=t.length;i<r;i+=2)for(let a=0,o=e.length;a<o;a+=2)if(t[i]==e[a]&&t[i+1]==e[a+1]&&t[(i+2)%r]==e[(a+o-2)%o]&&t[(i+3)%r]==e[(a+o-1)%o]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:i,triangles:r}}=this,a=n[e];if(-1===a)return null;const o=[];let s=a;do{const n=Math.floor(s/3);if(o.push(t[2*n],t[2*n+1]),s=s%3===2?s-2:s+1,r[s]!==e)break;s=i[s]}while(s!==a&&-1!==s);return o}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:n}=this,i=4*e;return n[i]||n[i+1]?this._clipInfinite(e,t,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let i,r,a,o,s,u=null,c=t[n-2],l=t[n-1],f=this._regioncode(c,l);for(let d=0;d<n;d+=2)if(i=c,r=l,c=t[d],l=t[d+1],a=f,f=this._regioncode(c,l),0===a&&0===f)o=s,s=0,u?u.push(c,l):u=[c,l];else{let t,n,d,h,p;if(0===a){if(null===(t=this._clipSegment(i,r,c,l,a,f)))continue;[n,d,h,p]=t}else{if(null===(t=this._clipSegment(c,l,i,r,f,a)))continue;[h,p,n,d]=t,o=s,s=this._edgecode(n,d),o&&s&&this._edge(e,o,s,u,u.length),u?u.push(n,d):u=[n,d]}o=s,s=this._edgecode(h,p),o&&s&&this._edge(e,o,s,u,u.length),u?u.push(h,p):u=[h,p]}if(u)o=s,s=this._edgecode(u[0],u[1]),o&&s&&this._edge(e,o,s,u,u.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return u}_clipSegment(e,t,n,i,r,a){while(1){if(0===r&&0===a)return[e,t,n,i];if(r&a)return null;let o,s,u=r||a;8&u?(o=e+(n-e)*(this.ymax-t)/(i-t),s=this.ymax):4&u?(o=e+(n-e)*(this.ymin-t)/(i-t),s=this.ymin):2&u?(s=t+(i-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(i-t)*(this.xmin-e)/(n-e),o=this.xmin),r?(e=o,t=s,r=this._regioncode(e,t)):(n=o,i=s,a=this._regioncode(n,i))}}_clipInfinite(e,t,n,i,r,a){let o,s=Array.from(t);if((o=this._project(s[0],s[1],n,i))&&s.unshift(o[0],o[1]),(o=this._project(s[s.length-2],s[s.length-1],r,a))&&s.push(o[0],o[1]),s=this._clipFinite(e,s))for(let u,c=0,l=s.length,f=this._edgecode(s[l-2],s[l-1]);c<l;c+=2)u=f,f=this._edgecode(s[c],s[c+1]),u&&f&&(c=this._edge(e,u,f,s,c),l=s.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(e,t,n,i,r){while(t!==n){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin;break}i[r]===n&&i[r+1]===a||!this.contains(e,n,a)||(i.splice(r,0,n,a),r+=2)}if(i.length>4)for(let a=0;a<i.length;a+=2){const e=(a+2)%i.length,t=(a+4)%i.length;(i[a]===i[e]&&i[e]===i[t]||i[a+1]===i[e+1]&&i[e+1]===i[t+1])&&(i.splice(e,2),a-=2)}return r}_project(e,t,n,i){let r,a,o,s=1/0;if(i<0){if(t<=this.ymin)return null;(r=(this.ymin-t)/i)<s&&(o=this.ymin,a=e+(s=r)*n)}else if(i>0){if(t>=this.ymax)return null;(r=(this.ymax-t)/i)<s&&(o=this.ymax,a=e+(s=r)*n)}if(n>0){if(e>=this.xmax)return null;(r=(this.xmax-e)/n)<s&&(a=this.xmax,o=t+(s=r)*i)}else if(n<0){if(e<=this.xmin)return null;(r=(this.xmin-e)/n)<s&&(a=this.xmin,o=t+(s=r)*i)}return[a,o]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const ij=2*Math.PI;function rj(e){return e[0]}function aj(e){return e[1]}function oj(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const e=2*t[i],r=2*t[i+1],a=2*t[i+2],o=(n[a]-n[e])*(n[r+1]-n[e+1])-(n[r]-n[e])*(n[a+1]-n[e+1]);if(o>1e-10)return!1}return!0}function sj(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class uj{static from(e,t=rj,n=aj,i){return new uj("length"in e?cj(e,t,n,i):Float64Array.from(lj(e,t,n,i)))}constructor(e){this._delaunator=new Iw(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&oj(e)){this.collinear=Int32Array.from({length:t.length/2},(e,t)=>t).sort((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]);const e=this.collinear[0],n=this.collinear[this.collinear.length-1],i=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],r=1e-8*Math.sqrt((i[3]-i[1])**2+(i[2]-i[0])**2);for(let a=0,o=t.length/2;a<o;++a){const e=sj(t[2*a],t[2*a+1],r);t[2*a]=e[0],t[2*a+1]=e[1]}this._delaunator=new Iw(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let s=0,u=n.length;s<u;++s){const e=r[s%3===2?s-2:s+1];-1!==n[s]&&-1!==a[e]||(a[e]=s)}for(let s=0,u=i.length;s<u;++s)o[i[s]]=s;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],a[i[0]]=1,2===i.length&&(a[i[1]]=0))}voronoi(e){return new nj(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:i,halfedges:r,triangles:a,collinear:o}=this;if(o){const t=o.indexOf(e);return t>0&&(yield o[t-1]),void(t<o.length-1&&(yield o[t+1]))}const s=t[e];if(-1===s)return;let u=s,c=-1;do{if(yield c=a[u],u=u%3===2?u-2:u+1,a[u]!==e)return;if(u=r[u],-1===u){const t=n[(i[e]+1)%n.length];return void(t!==c&&(yield t))}}while(u!==s)}find(e,t,n=0){if(e=+e,e!==e||(t=+t,t!==t))return-1;const i=n;let r;while((r=this._step(n,e,t))>=0&&r!==n&&r!==i)n=r;return r}_step(e,t,n){const{inedges:i,hull:r,_hullIndex:a,halfedges:o,triangles:s,points:u}=this;if(-1===i[e]||!u.length)return(e+1)%(u.length>>1);let c=e,l=(t-u[2*e])**2+(n-u[2*e+1])**2;const f=i[e];let d=f;do{let i=s[d];const f=(t-u[2*i])**2+(n-u[2*i+1])**2;if(f<l&&(l=f,c=i),d=d%3===2?d-2:d+1,s[d]!==e)break;if(d=o[d],-1===d){if(d=r[(a[e]+1)%r.length],d!==i&&(t-u[2*d])**2+(n-u[2*d+1])**2<l)return d;break}}while(d!==f);return c}render(e){const t=null==e?e=new ej:void 0,{points:n,halfedges:i,triangles:r}=this;for(let a=0,o=i.length;a<o;++a){const t=i[a];if(t<a)continue;const o=2*r[a],s=2*r[t];e.moveTo(n[o],n[o+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=null==e?e=new ej:void 0,{points:i}=this;for(let r=0,a=i.length;r<a;r+=2){const n=i[r],a=i[r+1];e.moveTo(n+t,a),e.arc(n,a,t,0,ij)}return n&&n.value()}renderHull(e){const t=null==e?e=new ej:void 0,{hull:n,points:i}=this,r=2*n[0],a=n.length;e.moveTo(i[r],i[r+1]);for(let o=1;o<a;++o){const t=2*n[o];e.lineTo(i[t],i[t+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new tj;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=null==t?t=new ej:void 0,{points:i,triangles:r}=this,a=2*r[e*=3],o=2*r[e+1],s=2*r[e+2];return t.moveTo(i[a],i[a+1]),t.lineTo(i[o],i[o+1]),t.lineTo(i[s],i[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new tj;return this.renderTriangle(e,t),t.value()}}function cj(e,t,n,i){const r=e.length,a=new Float64Array(2*r);for(let o=0;o<r;++o){const r=e[o];a[2*o]=t.call(i,r,o,e),a[2*o+1]=n.call(i,r,o,e)}return a}function*lj(e,t,n,i){let r=0;for(const a of e)yield t.call(i,a,r,e),yield n.call(i,a,r,e),++r}function fj(e){On.call(this,null,e)}fj.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const dj=Object(ie["y"])(fj,On),hj=[-1e5,-1e5,1e5,1e5];function pj(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}dj.transform=function(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:hj;const a=this.value=uj.from(i,e.x,e.y).voronoi(r);for(let o=0,s=i.length;o<s;++o){const e=a.cellPolygon(o);i[o][n]=e?pj(e):null}return t.reflow(e.modified()).modifies(n)};var gj=Math.PI/180,mj=64,vj=2048,bj=function(){var e,t,n,i,r,a,o,s=[256,256],u=jj,c=[],l=Math.random,f={};function d(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=(mj<<5)/t,e.height=vj/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}function h(e,t,n){var i,r,a,o=t.x,c=t.y,f=Math.sqrt(s[0]*s[0]+s[1]*s[1]),d=u(s),h=l()<.5?1:-1,p=-h;while(i=d(p+=h)){if(r=~~i[0],a=~~i[1],Math.min(Math.abs(r),Math.abs(a))>=f)break;if(t.x=o+r,t.y=c+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>s[0]||t.y+t.y1>s[1])&&(!n||!xj(t,e,s[0]))&&(!n||wj(t,n))){for(var g,m=t.sprite,v=t.width>>5,b=s[0]>>5,y=t.x-(v<<4),x=127&y,O=32-x,w=t.y1-t.y0,j=(t.y+t.y0)*b+(y>>5),k=0;k<w;k++){g=0;for(var _=0;_<=v;_++)e[j+_]|=g<<O|(_<v?(g=m[k*v+_])>>>x:0);j+=b}return t.sprite=null,!0}}return!1}return f.layout=function(){var u=d(Cu()),f=_j((s[0]>>5)*s[1]),p=null,g=c.length,m=-1,v=[],b=c.map((function(s){return{text:e(s),font:t(s),style:i(s),weight:r(s),rotate:a(s),size:~~(n(s)+1e-14),padding:o(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s}})).sort((function(e,t){return t.size-e.size}));while(++m<g){var y=b[m];y.x=s[0]*(l()+.5)>>1,y.y=s[1]*(l()+.5)>>1,yj(u,y,b,m),y.hasText&&h(f,y,p)&&(v.push(y),p?Oj(p,y):p=[{x:y.x+y.x0,y:y.y+y.y0},{x:y.x+y.x1,y:y.y+y.y1}],y.x-=s[0]>>1,y.y-=s[1]>>1)}return v},f.words=function(e){return arguments.length?(c=e,f):c},f.size=function(e){return arguments.length?(s=[+e[0],+e[1]],f):s},f.font=function(e){return arguments.length?(t=Aj(e),f):t},f.fontStyle=function(e){return arguments.length?(i=Aj(e),f):i},f.fontWeight=function(e){return arguments.length?(r=Aj(e),f):r},f.rotate=function(e){return arguments.length?(a=Aj(e),f):a},f.text=function(t){return arguments.length?(e=Aj(t),f):e},f.spiral=function(e){return arguments.length?(u=Ej[e]||e,f):u},f.fontSize=function(e){return arguments.length?(n=Aj(e),f):n},f.padding=function(e){return arguments.length?(o=Aj(e),f):o},f.random=function(e){return arguments.length?(l=e,f):l},f};function yj(e,t,n,i){if(!t.sprite){var r=e.context,a=e.ratio;r.clearRect(0,0,(mj<<5)/a,vj/a);var o,s,u,c,l,f=0,d=0,h=0,p=n.length;--i;while(++i<p){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,o=r.measureText(t.text+"m").width*a,u=t.size<<1,t.rotate){var g=Math.sin(t.rotate*gj),m=Math.cos(t.rotate*gj),v=o*m,b=o*g,y=u*m,x=u*g;o=Math.max(Math.abs(v+x),Math.abs(v-x))+31>>5<<5,u=~~Math.max(Math.abs(b+y),Math.abs(b-y))}else o=o+31>>5<<5;if(u>h&&(h=u),f+o>=mj<<5&&(f=0,d+=h,h=0),d+u>=vj)break;r.translate((f+(o>>1))/a,(d+(u>>1))/a),t.rotate&&r.rotate(t.rotate*gj),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=o,t.height=u,t.xoff=f,t.yoff=d,t.x1=o>>1,t.y1=u>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,f+=o}var O=r.getImageData(0,0,(mj<<5)/a,vj/a).data,w=[];while(--i>=0)if(t=n[i],t.hasText){for(o=t.width,s=o>>5,u=t.y1-t.y0,c=0;c<u*s;c++)w[c]=0;if(f=t.xoff,null==f)return;d=t.yoff;var j=0,k=-1;for(l=0;l<u;l++){for(c=0;c<o;c++){var _=s*l+(c>>5),A=O[(d+l)*(mj<<5)+(f+c)<<2]?1<<31-c%32:0;w[_]|=A,j|=A}j?k=l:(t.y0++,u--,l--,d++)}t.y1=t.y0+k,t.sprite=w.slice(0,(t.y1-t.y0)*s)}}}function xj(e,t,n){n>>=5;for(var i,r=e.sprite,a=e.width>>5,o=e.x-(a<<4),s=127&o,u=32-s,c=e.y1-e.y0,l=(e.y+e.y0)*n+(o>>5),f=0;f<c;f++){i=0;for(var d=0;d<=a;d++)if((i<<u|(d<a?(i=r[f*a+d])>>>s:0))&t[l+d])return!0;l+=n}return!1}function Oj(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function wj(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function jj(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function kj(e){var t=4,n=t*e[0]/e[1],i=0,r=0;return function(e){var a=e<0?-1:1;switch(Math.sqrt(1+4*a*e)-a&3){case 0:i+=n;break;case 1:r+=t;break;case 2:i-=n;break;default:r-=t;break}return[i,r]}}function _j(e){var t=[],n=-1;while(++n<e)t[n]=0;return t}function Aj(e){return"function"===typeof e?e:function(){return e}}var Ej={archimedean:jj,rectangular:kj},Dj=["x","y","font","fontSize","fontStyle","fontWeight","angle"],Sj=["text","font","rotate","fontSize","fontStyle","fontWeight"];function Cj(e){On.call(this,bj(),e)}Cj.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:Dj}]};var Fj=Object(ie["y"])(Cj,On);function $j(e){return new Uint8Array(e)}function Mj(e){return new Uint16Array(e)}function Nj(e){return new Uint32Array(e)}function Rj(){var e=8,t=[],n=Nj(0),i=Tj(0,e),r=Tj(0,e);return{data:function(){return t},seen:function(){return n=zj(n,t.length)},add:function(e){for(var n,i=0,r=t.length,a=e.length;i<a;++i)n=e[i],n._index=r++,t.push(n)},remove:function(e,n){var a,o,s,u=t.length,c=Array(u-e),l=t;for(o=0;!n[o]&&o<u;++o)c[o]=t[o],l[o]=o;for(s=o;o<u;++o)a=t[o],n[o]?l[o]=-1:(l[o]=s,i[s]=i[o],r[s]=r[o],c[s]=a,a._index=s++),i[o]=0;return t=c,l},size:function(){return t.length},curr:function(){return i},prev:function(){return r},reset:function(e){r[e]=i[e]},all:function(){return e<257?255:e<65537?65535:4294967295},set:function(e,t){i[e]|=t},clear:function(e,t){i[e]&=~t},resize:function(t,n){var a=i.length;(t>a||n>e)&&(e=Math.max(n,e),i=Tj(t,e,i),r=Tj(t,e))}}}function zj(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function Tj(e,t,n){var i=(t<257?$j:t<65537?Mj:Nj)(e);return n&&i.set(n),i}Fj.transform=function(e,t){function n(n){var i=e[n];return Object(ie["D"])(i)&&t.modified(i.fields)}!e.size||e.size[0]&&e.size[1]||Object(ie["n"])("Wordcloud size dimensions must be non-zero.");var i=e.modified();if(i||t.changed(t.ADD_REM)||Sj.some(n)){var r,a=t.materialize(t.SOURCE).source,o=this.value,s=e.as||Dj,u=e.fontSize||14;if(Object(ie["D"])(u)?r=e.fontSizeRange:u=Object(ie["l"])(u),r){var c=u,l=wv("sqrt")().domain(Object(ie["p"])(a,c)).range(r);u=function(e){return l(c(e))}}a.forEach((function(e){e[s[0]]=NaN,e[s[1]]=NaN,e[s[3]]=0}));for(var f,d,h=o.words(a).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(u).random(Qn).layout(),p=o.size(),g=p[0]>>1,m=p[1]>>1,v=0,b=h.length;v<b;++v)f=h[v],d=f.datum,d[s[0]]=f.x+g,d[s[1]]=f.y+m,d[s[2]]=f.font,d[s[3]]=f.size,d[s[4]]=f.style,d[s[5]]=f.weight,d[s[6]]=f.rotate;return t.reflow(i).modifies(s)}};var Lj=function(e,t,n){var i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd:function(e,t){var n,r=this,a=r.bisect(r.range,e.value),o=e.index,s=a[0],u=a[1],c=o.length;for(n=0;n<s;++n)t[o[n]]|=i;for(n=u;n<c;++n)t[o[n]]|=i;return r}}},Pj=function(e,t){return Array.from(t,t=>e[t])};function Bj(){var e=Nj(0),t=[],n=0;function i(i,r,a){if(!r.length)return[];var o,s,u,c=n,l=r.length,f=Array(l),d=Nj(l);for(u=0;u<l;++u)f[u]=i(r[u]),d[u]=u;if(f=Ij(f,d),c)o=t,s=e,t=Array(c+l),e=Nj(c+l),Uj(a,o,s,c,f,d,l,t,e);else{if(a>0)for(u=0;u<l;++u)d[u]+=a;t=f,e=d}return n=c+l,{index:d,value:f}}function r(i,r){var a,o,s,u=n;for(o=0;!r[e[o]]&&o<u;++o);for(s=o;o<u;++o)r[a=e[o]]||(e[s]=a,t[s]=t[o],++s);n=u-i}function a(t){for(var i=0,r=n;i<r;++i)e[i]=t[e[i]]}function o(e,i){var r;return i?r=i.length:(i=t,r=n),[Ug(i,e[0],0,r),Ig(i,e[1],0,r)]}return{insert:i,remove:r,bisect:o,reindex:a,index:function(){return e},size:function(){return n}}}function Ij(e,t){return e.sort.call(t,(function(t,n){var i=e[t],r=e[n];return i<r?-1:i>r?1:0})),Pj(e,t)}function Uj(e,t,n,i,r,a,o,s,u){var c,l=0,f=0;for(c=0;l<i&&f<o;++c)t[l]<r[f]?(s[c]=t[l],u[c]=n[l++]):(s[c]=r[f],u[c]=a[f++]+e);for(;l<i;++l,++c)s[c]=t[l],u[c]=n[l];for(;f<o;++f,++c)s[c]=r[f],u[c]=a[f]+e}function qj(e){On.call(this,Rj(),e),this._indices=null,this._dims=null}qj.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};var Wj=Object(ie["y"])(qj,On);function Hj(e){On.call(this,null,e)}Wj.transform=function(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some((function(e){return t.modified(e.fields)}));return n?this.reinit(e,t):this.eval(e,t)}return this.init(e,t)},Wj.init=function(e,t){for(var n,i,r=e.fields,a=e.query,o=this._indices={},s=this._dims=[],u=a.length,c=0;c<u;++c)n=r[c].fname,i=o[n]||(o[n]=Bj()),s.push(Lj(i,c,a[c]));return this.eval(e,t)},Wj.reinit=function(e,t){var n,i,r,a,o,s,u,c,l,f=t.materialize().fork(),d=e.fields,h=e.query,p=this._indices,g=this._dims,m=this.value,v=m.curr(),b=m.prev(),y=m.all(),x=f.rem=f.add,O=f.mod,w=h.length,j={};if(b.set(v),t.rem.length&&(o=this.remove(e,t,f)),t.add.length&&m.add(t.add),t.mod.length)for(s={},a=t.mod,u=0,c=a.length;u<c;++u)s[a[u]._index]=1;for(u=0;u<w;++u)l=d[u],(!g[u]||e.modified("fields",u)||t.modified(l.fields))&&(r=l.fname,(n=j[r])||(p[r]=i=Bj(),j[r]=n=i.insert(l,t.source,0)),g[u]=Lj(i,u,h[u]).onAdd(n,v));for(u=0,c=m.data().length;u<c;++u)o[u]||(b[u]!==v[u]?x.push(u):s[u]&&v[u]!==y&&O.push(u));return m.mask=(1<<w)-1,f},Wj.eval=function(e,t){var n=t.materialize().fork(),i=this._dims.length,r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},Wj.insert=function(e,t,n){var i,r,a,o=t.add,s=this.value,u=this._dims,c=this._indices,l=e.fields,f={},d=n.add,h=s.size(),p=h+o.length,g=u.length;s.resize(p,g),s.add(o);var m=s.curr(),v=s.prev(),b=s.all();for(i=0;i<g;++i)r=l[i].fname,a=f[r]||(f[r]=c[r].insert(l[i],o,h)),u[i].onAdd(a,m);for(;h<p;++h)v[h]=b,m[h]!==b&&d.push(h)},Wj.modify=function(e,t){var n,i,r,a=t.mod,o=this.value,s=o.curr(),u=o.all(),c=e.mod;for(n=0,i=c.length;n<i;++n)r=c[n]._index,s[r]!==u&&a.push(r)},Wj.remove=function(e,t,n){var i,r,a,o,s=this._indices,u=this.value,c=u.curr(),l=u.prev(),f=u.all(),d={},h=n.rem,p=t.rem;for(i=0,r=p.length;i<r;++i)a=p[i]._index,d[a]=1,l[a]=o=c[a],c[a]=f,o!==f&&h.push(a);for(a in s)s[a].remove(r,d);return this.reindex(t,r,d),d},Wj.reindex=function(e,t,n){var i=this._indices,r=this.value;e.runAfter((function(){var e=r.remove(t,n);for(var a in i)i[a].reindex(e)}))},Wj.update=function(e,t,n){var i,r,a=this._dims,o=e.query,s=t.stamp,u=a.length,c=0;for(n.filters=0,r=0;r<u;++r)e.modified("query",r)&&(i=r,++c);if(1===c)c=a[i].one,this.incrementOne(a[i],o[i],n.add,n.rem);else for(r=0,c=0;r<u;++r)e.modified("query",r)&&(c|=a[r].one,this.incrementAll(a[r],o[r],s,n.add),n.rem=n.add);return c},Wj.incrementAll=function(e,t,n,i){var r,a,o,s=this.value,u=s.seen(),c=s.curr(),l=s.prev(),f=e.index(),d=e.bisect(e.range),h=e.bisect(t),p=h[0],g=h[1],m=d[0],v=d[1],b=e.one;if(p<m)for(r=p,a=Math.min(m,g);r<a;++r)o=f[r],u[o]!==n&&(l[o]=c[o],u[o]=n,i.push(o)),c[o]^=b;else if(p>m)for(r=m,a=Math.min(p,v);r<a;++r)o=f[r],u[o]!==n&&(l[o]=c[o],u[o]=n,i.push(o)),c[o]^=b;if(g>v)for(r=Math.max(p,v),a=g;r<a;++r)o=f[r],u[o]!==n&&(l[o]=c[o],u[o]=n,i.push(o)),c[o]^=b;else if(g<v)for(r=Math.max(m,g),a=v;r<a;++r)o=f[r],u[o]!==n&&(l[o]=c[o],u[o]=n,i.push(o)),c[o]^=b;e.range=t.slice()},Wj.incrementOne=function(e,t,n,i){var r,a,o,s=this.value,u=s.curr(),c=e.index(),l=e.bisect(e.range),f=e.bisect(t),d=f[0],h=f[1],p=l[0],g=l[1],m=e.one;if(d<p)for(r=d,a=Math.min(p,h);r<a;++r)o=c[r],u[o]^=m,n.push(o);else if(d>p)for(r=p,a=Math.min(d,g);r<a;++r)o=c[r],u[o]^=m,i.push(o);if(h>g)for(r=Math.max(d,g),a=h;r<a;++r)o=c[r],u[o]^=m,n.push(o);else if(h<g)for(r=Math.max(p,h),a=g;r<a;++r)o=c[r],u[o]^=m,i.push(o);e.range=t.slice()},Hj.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};var Gj=Object(ie["y"])(Hj,On);Gj.transform=function(e,t){var n=~(e.ignore||0),i=e.filter,r=i.mask;if(0===(r&n))return t.StopPropagation;var a=t.fork(t.ALL),o=i.data(),s=i.curr(),u=i.prev(),c=function(e){return s[e]&n?null:o[e]};return a.filter(a.MOD,c),r&r-1?(a.filter(a.ADD,(function(e){var t=s[e]&n,i=!t&&t^u[e]&n;return i?o[e]:null})),a.filter(a.REM,(function(e){var t=s[e]&n,i=t&&!(t^t^u[e]&n);return i?o[e]:null}))):(a.filter(a.ADD,c),a.filter(a.REM,(function(e){return(s[e]&n)===r?o[e]:null}))),a.filter(a.SOURCE,(function(e){return c(e._index)}))};var Vj=n("f161"),Zj="default",Yj=function(e){var t=e._signals.cursor;t||(e._signals.cursor=t=e.add({user:Zj,item:null})),e.on(e.events("view","mousemove"),t,(function(e,n){var i=t.value,r=i?Object(ie["H"])(i)?i:i.user:Zj,a=n.item&&n.item.cursor||null;return i&&r===i.user&&a==i.item?i:{user:r,item:a}})),e.add(null,(function(e){var t=e.cursor,n=this.value;return Object(ie["H"])(t)||(n=t.item,t=t.user),Xj(t&&t!==Zj?t:n||t),n}),{cursor:t})};function Xj(e){"undefined"!==typeof document&&document.body&&(document.body.style.cursor=e)}function Jj(e,t){var n=e._runtime.data;return Object(ie["v"])(n,t)||Object(ie["n"])("Unrecognized data set: "+t),n[t]}function Qj(e,t){return arguments.length<2?Jj(this,e).values.value:Kj.call(this,e,ve().remove(ie["gb"]).insert(t))}function Kj(e,t){me(t)||Object(ie["n"])("Second argument to changes must be a changeset.");var n=Jj(this,e);return n.modified=!0,this.pulse(n.input,t)}function ek(e,t){return Kj.call(this,e,ve().insert(t))}function tk(e,t){return Kj.call(this,e,ve().remove(t))}function nk(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function ik(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function rk(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function ak(e){var t=rk(e),n=nk(e),i=ik(e);e._renderer.background(e._background),e._renderer.resize(n,i,t),e._handler.origin(t),e._resizeListeners.forEach((function(t){try{t(n,i)}catch(r){e.error(r)}}))}var ok=function(e,t,n){var i,r,a,o=e._renderer,s=o&&o.canvas();return s&&(a=rk(e),r=t.changedTouches?t.changedTouches[0]:t,i=Yd(r,s),i[0]-=a[0],i[1]-=a[1]),t.dataflow=e,t.item=n,t.vega=sk(e,n,i),t};function sk(e,t,n){var i=t?"group"===t.mark.marktype?t:t.mark.group:null;function r(e){var n,r=i;if(e)for(n=t;n;n=n.mark.group)if(n.mark.name===e){r=n;break}return r&&r.mark&&r.mark.interactive?r:{}}function a(e){if(!e)return n;Object(ie["H"])(e)&&(e=r(e));var t=n.slice();while(e)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:Object(ie["l"])(e),item:Object(ie["l"])(t||{}),group:r,xy:a,x:function(e){return a(e)[0]},y:function(e){return a(e)[1]}}}const uk="view",ck="timer",lk="window",fk={trap:!1};function dk(e){const t=Object(ie["o"])({defaults:{}},e),n=(e,t)=>{t.forEach(t=>{Object(ie["A"])(e[t])&&(e[t]=Object(ie["db"])(e[t]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function hk(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return!1!==i&&!0!==r&&(!0===i||!1===r||(i?i[t]:r?!r[t]:e.preventDefault()))}function pk(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return!(!1===i||Object(ie["F"])(i)&&!i[n])||(e.warn(`Blocked ${t} ${n} event listener.`),!1)}function gk(e,t,n){var i,r=this,a=new $e(n),o=function(n,i){r.runAsync(null,()=>{e===uk&&hk(r,t)&&n.preventDefault(),a.receive(ok(r,n,i))})};if(e===ck)pk(r,"timer",t)&&r.timer(o,t);else if(e===uk)pk(r,"view",t)&&r.addEventListener(t,o,fk);else if(e===lk?pk(r,"window",t)&&"undefined"!==typeof window&&(i=[window]):"undefined"!==typeof document&&pk(r,"selector",t)&&(i=document.querySelectorAll(e)),i){for(var s=0,u=i.length;s<u;++s)i[s].addEventListener(t,o);r._eventListeners.push({type:t,sources:i,handler:o})}else r.warn("Can not resolve event source: "+e);return a}function mk(e){return e.item}function vk(e){return e.item.mark.source}function bk(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}var yk=function(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",mk),vk,bk(e)),this.on(this.events("view","mouseout",mk),vk,bk(t)),this},xk=function(){var e,t,n,i=this._tooltip,r=this._timers,a=this._eventListeners;e=r.length;while(--e>=0)r[e].stop();e=a.length;while(--e>=0){n=a[e],t=n.sources.length;while(--t>=0)n.sources[t].removeEventListener(n.type,n.handler)}return i&&i.call(this,this._handler,null,null,null),this},Ok=function(e,t,n){var i=document.createElement(e);for(var r in t)i.setAttribute(r,t[r]);return null!=n&&(i.textContent=n),i},wk="vega-bind",jk="vega-bind-name",kk="vega-bind-radio",_k="vega-option-",Ak=function(e,t,n){if(t){var i=n.param,r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:function(t){t!==e.signal(i.signal)&&e.runAsync(null,(function(){r.source=!0,e.signal(i.signal,t)}))}},i.debounce&&(r.update=Object(ie["m"])(i.debounce,r.update))),Ek(r,t,i,e.signal(i.signal)),r.active||(e.on(e._signals[i.signal],null,(function(){r.source?r.source=!1:r.set(e.signal(i.signal))})),r.active=!0),r}};function Ek(e,t,n,i){var r=Ok("div",{class:wk});r.appendChild(Ok("span",{class:jk},n.name||n.signal)),t.appendChild(r);var a=Dk;switch(n.input){case"checkbox":a=Sk;break;case"select":a=Ck;break;case"radio":a=Fk;break;case"range":a=$k;break}a(e,r,n,i)}function Dk(e,t,n,i){var r=Ok("input");for(var a in n)"signal"!==a&&"element"!==a&&r.setAttribute("input"===a?"type":a,n[a]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",(function(){e.update(r.value)})),e.elements=[r],e.set=function(e){r.value=e}}function Sk(e,t,n,i){var r={type:"checkbox",name:n.signal};i&&(r.checked=!0);var a=Ok("input",r);t.appendChild(a),a.addEventListener("change",(function(){e.update(a.checked)})),e.elements=[a],e.set=function(e){a.checked=!!e||null}}function Ck(e,t,n,i){var r=Ok("select",{name:n.signal}),a=n.labels||[];n.options.forEach((function(e,t){var n={value:e};Mk(e,i)&&(n.selected=!0),r.appendChild(Ok("option",n,(a[t]||e)+""))})),t.appendChild(r),r.addEventListener("change",(function(){e.update(n.options[r.selectedIndex])})),e.elements=[r],e.set=function(e){for(var t=0,i=n.options.length;t<i;++t)if(Mk(n.options[t],e))return void(r.selectedIndex=t)}}function Fk(e,t,n,i){var r=Ok("span",{class:kk}),a=n.labels||[];t.appendChild(r),e.elements=n.options.map((function(t,o){var s=_k+n.signal+"-"+t,u={id:s,type:"radio",name:n.signal,value:t};Mk(t,i)&&(u.checked=!0);var c=Ok("input",u);return c.addEventListener("change",(function(){e.update(t)})),r.appendChild(c),r.appendChild(Ok("label",{for:s},(a[o]||t)+"")),c})),e.set=function(t){for(var n=e.elements,i=0,r=n.length;i<r;++i)Mk(n[i].value,t)&&(n[i].checked=!0)}}function $k(e,t,n,i){i=void 0!==i?i:(+n.max+ +n.min)/2;var r=null!=n.max?n.max:Math.max(100,+i)||100,a=n.min||Math.min(0,r,+i)||0,o=n.step||es(a,r,100),s=Ok("input",{type:"range",name:n.signal,min:a,max:r,step:o});s.value=i;var u=Ok("label",{},+i);function c(){u.textContent=s.value,e.update(+s.value)}t.appendChild(s),t.appendChild(u),s.addEventListener("input",c),s.addEventListener("change",c),e.elements=[s],e.set=function(e){s.value=e,u.textContent=e}}function Mk(e,t){return e===t||e+""===t+""}var Nk=function(e,t,n,i,r,a){return t=t||new i(e.loader()),t.initialize(n,nk(e),ik(e),rk(e),r,a).background(e._background)},Rk=function(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null},zk=function(e,t,n,i){var r=new i(e.loader(),Rk(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,rk(e),e);return t&&t.handlers().forEach((function(e){r.on(e.type,e.handler)})),r},Tk=function(e,t){var n,i,r=this,a=r._renderType,o=r._eventConfig.bind,s=ip(a);return e=r._el=e?Lk(r,e):null,s||r.error("Unrecognized renderer type: "+a),n=s.handler||oh,i=e?s.renderer:s.headless,r._renderer=i?Nk(r,r._renderer,e,i):null,r._handler=zk(r,r._handler,e,n),r._redraw=!0,e&&"none"!==o&&(t=t?r._elBind=Lk(r,t):e.appendChild(Ok("div",{class:"vega-bindings"})),r._bind.forEach((function(e){e.param.element&&"container"!==o&&(e.element=Lk(r,e.param.element))})),r._bind.forEach((function(e){Ak(r,e.element||t,e)}))),r};function Lk(e,t){if("string"===typeof t){if("undefined"===typeof document)return e.error("DOM document instance not found."),null;if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}if(t)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}var Pk=async function(e,t,n,i){const r=ip(t),a=r&&r.headless;return a||Object(ie["n"])("Unrecognized renderer type: "+t),await e.runAsync(),Nk(e,null,null,a,n,i).renderAsync(e._scenegraph.root)},Bk=async function(e,t){e!==tp.Canvas&&e!==tp.SVG&&e!==tp.PNG&&Object(ie["n"])("Unrecognized image type: "+e);const n=await Pk(this,e,t);return e===tp.SVG?Ik(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")};function Ik(e,t){var n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}var Uk,qk,Wk,Hk,Gk,Vk=async function(e,t){const n=await Pk(this,tp.Canvas,e,t);return n.canvas()},Zk=async function(e){const t=await Pk(this,tp.SVG,e);return t.svg()},Yk="RawCode",Xk="Literal",Jk="Property",Qk="Identifier",Kk="ArrayExpression",e_="BinaryExpression",t_="CallExpression",n_="ConditionalExpression",i_="LogicalExpression",r_="MemberExpression",a_="ObjectExpression",o_="UnaryExpression";function s_(e){this.type=e}function u_(e){switch(e.type){case Kk:return e.elements;case e_:case i_:return[e.left,e.right];case t_:var t=e.arguments.slice();return t.unshift(e.callee),t;case n_:return[e.test,e.consequent,e.alternate];case r_:return[e.object,e.property];case a_:return e.properties;case Jk:return[e.key,e.value];case o_:return[e.argument];case Qk:case Xk:case Yk:default:return[]}}s_.prototype.visit=function(e){var t,n,i,r=this;if(e(r))return 1;for(t=u_(r),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1};var c_=1,l_=2,f_=3,d_=4,h_=5,p_=6,g_=7,m_=8,v_=9;Uk={},Uk[c_]="Boolean",Uk[l_]="<end>",Uk[f_]="Identifier",Uk[d_]="Keyword",Uk[h_]="Null",Uk[p_]="Numeric",Uk[g_]="Punctuator",Uk[m_]="String",Uk[v_]="RegularExpression";var b_="ArrayExpression",y_="BinaryExpression",x_="CallExpression",O_="ConditionalExpression",w_="Identifier",j_="Literal",k_="LogicalExpression",__="MemberExpression",A_="ObjectExpression",E_="Property",D_="UnaryExpression",S_="Unexpected token %0",C_="Unexpected number",F_="Unexpected string",$_="Unexpected identifier",M_="Unexpected reserved word",N_="Unexpected end of input",R_="Invalid regular expression",z_="Invalid regular expression: missing /",T_="Octal literals are not allowed in strict mode.",L_="Duplicate data property in object literal not allowed in strict mode",P_="ILLEGAL",B_="Disabled.",I_=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),U_=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function q_(e,t){if(!e)throw new Error("ASSERT: "+t)}function W_(e){return e>=48&&e<=57}function H_(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function G_(e){return"01234567".indexOf(e)>=0}function V_(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Z_(e){return 10===e||13===e||8232===e||8233===e}function Y_(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&I_.test(String.fromCharCode(e))}function X_(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&U_.test(String.fromCharCode(e))}var J_={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Q_(){var e;while(Wk<Hk){if(e=qk.charCodeAt(Wk),!V_(e)&&!Z_(e))break;++Wk}}function K_(e){var t,n,i,r=0;for(n="u"===e?4:2,t=0;t<n;++t)Wk<Hk&&H_(qk[Wk])?(i=qk[Wk++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):EA({},S_,P_);return String.fromCharCode(r)}function eA(){var e,t,n,i;e=qk[Wk],t=0,"}"===e&&EA({},S_,P_);while(Wk<Hk){if(e=qk[Wk++],!H_(e))break;t=16*t+"0123456789abcdef".indexOf(e.toLowerCase())}return(t>1114111||"}"!==e)&&EA({},S_,P_),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),i=56320+(t-65536&1023),String.fromCharCode(n,i))}function tA(){var e,t;e=qk.charCodeAt(Wk++),t=String.fromCharCode(e),92===e&&(117!==qk.charCodeAt(Wk)&&EA({},S_,P_),++Wk,e=K_("u"),e&&"\\"!==e&&Y_(e.charCodeAt(0))||EA({},S_,P_),t=e);while(Wk<Hk){if(e=qk.charCodeAt(Wk),!X_(e))break;++Wk,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==qk.charCodeAt(Wk)&&EA({},S_,P_),++Wk,e=K_("u"),e&&"\\"!==e&&X_(e.charCodeAt(0))||EA({},S_,P_),t+=e)}return t}function nA(){var e,t;e=Wk++;while(Wk<Hk){if(t=qk.charCodeAt(Wk),92===t)return Wk=e,tA();if(!X_(t))break;++Wk}return qk.slice(e,Wk)}function iA(){var e,t,n;return e=Wk,t=92===qk.charCodeAt(Wk)?tA():nA(),n=1===t.length?f_:J_.hasOwnProperty(t)?d_:"null"===t?h_:"true"===t||"false"===t?c_:f_,{type:n,value:t,start:e,end:Wk}}function rA(){var e,t,n,i,r=Wk,a=qk.charCodeAt(Wk),o=qk[Wk];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Wk,{type:g_,value:String.fromCharCode(a),start:r,end:Wk};default:if(e=qk.charCodeAt(Wk+1),61===e)switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Wk+=2,{type:g_,value:String.fromCharCode(a)+String.fromCharCode(e),start:r,end:Wk};case 33:case 61:return Wk+=2,61===qk.charCodeAt(Wk)&&++Wk,{type:g_,value:qk.slice(r,Wk),start:r,end:Wk}}}return i=qk.substr(Wk,4),">>>="===i?(Wk+=4,{type:g_,value:i,start:r,end:Wk}):(n=i.substr(0,3),">>>"===n||"<<="===n||">>="===n?(Wk+=3,{type:g_,value:n,start:r,end:Wk}):(t=n.substr(0,2),o===t[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?(Wk+=2,{type:g_,value:t,start:r,end:Wk}):"<>=!+-*%&|^/".indexOf(o)>=0?(++Wk,{type:g_,value:o,start:r,end:Wk}):void EA({},S_,P_)))}function aA(e){var t="";while(Wk<Hk){if(!H_(qk[Wk]))break;t+=qk[Wk++]}return 0===t.length&&EA({},S_,P_),Y_(qk.charCodeAt(Wk))&&EA({},S_,P_),{type:p_,value:parseInt("0x"+t,16),start:e,end:Wk}}function oA(e){var t="0"+qk[Wk++];while(Wk<Hk){if(!G_(qk[Wk]))break;t+=qk[Wk++]}return(Y_(qk.charCodeAt(Wk))||W_(qk.charCodeAt(Wk)))&&EA({},S_,P_),{type:p_,value:parseInt(t,8),octal:!0,start:e,end:Wk}}function sA(){var e,t,n;if(n=qk[Wk],q_(W_(n.charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=Wk,e="","."!==n){if(e=qk[Wk++],n=qk[Wk],"0"===e){if("x"===n||"X"===n)return++Wk,aA(t);if(G_(n))return oA(t);n&&W_(n.charCodeAt(0))&&EA({},S_,P_)}while(W_(qk.charCodeAt(Wk)))e+=qk[Wk++];n=qk[Wk]}if("."===n){e+=qk[Wk++];while(W_(qk.charCodeAt(Wk)))e+=qk[Wk++];n=qk[Wk]}if("e"===n||"E"===n)if(e+=qk[Wk++],n=qk[Wk],"+"!==n&&"-"!==n||(e+=qk[Wk++]),W_(qk.charCodeAt(Wk)))while(W_(qk.charCodeAt(Wk)))e+=qk[Wk++];else EA({},S_,P_);return Y_(qk.charCodeAt(Wk))&&EA({},S_,P_),{type:p_,value:parseFloat(e),start:t,end:Wk}}function uA(){var e,t,n,i,r="",a=!1;e=qk[Wk],q_("'"===e||'"'===e,"String literal must starts with a quote"),t=Wk,++Wk;while(Wk<Hk){if(n=qk[Wk++],n===e){e="";break}if("\\"===n)if(n=qk[Wk++],n&&Z_(n.charCodeAt(0)))"\r"===n&&"\n"===qk[Wk]&&++Wk;else switch(n){case"u":case"x":"{"===qk[Wk]?(++Wk,r+=eA()):r+=K_(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:G_(n)?(i="01234567".indexOf(n),0!==i&&(a=!0),Wk<Hk&&G_(qk[Wk])&&(a=!0,i=8*i+"01234567".indexOf(qk[Wk++]),"0123".indexOf(n)>=0&&Wk<Hk&&G_(qk[Wk])&&(i=8*i+"01234567".indexOf(qk[Wk++]))),r+=String.fromCharCode(i)):r+=n;break}else{if(Z_(n.charCodeAt(0)))break;r+=n}}return""!==e&&EA({},S_,P_),{type:m_,value:r,octal:a,start:t,end:Wk}}function cA(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111)return"x";EA({},R_)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(i){EA({},R_)}try{return new RegExp(e,t)}catch(r){return null}}function lA(){var e,t,n,i,r;e=qk[Wk],q_("/"===e,"Regular expression literal must start with a slash"),t=qk[Wk++],n=!1,i=!1;while(Wk<Hk)if(e=qk[Wk++],t+=e,"\\"===e)e=qk[Wk++],Z_(e.charCodeAt(0))&&EA({},z_),t+=e;else if(Z_(e.charCodeAt(0)))EA({},z_);else if(n)"]"===e&&(n=!1);else{if("/"===e){i=!0;break}"["===e&&(n=!0)}return i||EA({},z_),r=t.substr(1,t.length-2),{value:r,literal:t}}function fA(){var e,t,n;t="",n="";while(Wk<Hk){if(e=qk[Wk],!X_(e.charCodeAt(0)))break;++Wk,"\\"===e&&Wk<Hk?EA({},S_,P_):(n+=e,t+=e)}return n.search(/[^gimuy]/g)>=0&&EA({},R_,n),{value:n,literal:t}}function dA(){var e,t,n,i;return Gk=null,Q_(),e=Wk,t=lA(),n=fA(),i=cA(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:Wk}}function hA(e){return e.type===f_||e.type===d_||e.type===c_||e.type===h_}function pA(){var e;return Q_(),Wk>=Hk?{type:l_,start:Wk,end:Wk}:(e=qk.charCodeAt(Wk),Y_(e)?iA():40===e||41===e||59===e?rA():39===e||34===e?uA():46===e?W_(qk.charCodeAt(Wk+1))?sA():rA():W_(e)?sA():rA())}function gA(){var e;return e=Gk,Wk=e.end,Gk=pA(),Wk=e.end,e}function mA(){var e;e=Wk,Gk=pA(),Wk=e}function vA(e){var t=new s_(b_);return t.elements=e,t}function bA(e,t,n){var i=new s_("||"===e||"&&"===e?k_:y_);return i.operator=e,i.left=t,i.right=n,i}function yA(e,t){var n=new s_(x_);return n.callee=e,n.arguments=t,n}function xA(e,t,n){var i=new s_(O_);return i.test=e,i.consequent=t,i.alternate=n,i}function OA(e){var t=new s_(w_);return t.name=e,t}function wA(e){var t=new s_(j_);return t.value=e.value,t.raw=qk.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function jA(e,t,n){var i=new s_(__);return i.computed="["===e,i.object=t,i.property=n,i.computed||(n.member=!0),i}function kA(e){var t=new s_(A_);return t.properties=e,t}function _A(e,t,n){var i=new s_(E_);return i.key=t,i.value=n,i.kind=e,i}function AA(e,t){var n=new s_(D_);return n.operator=e,n.argument=t,n.prefix=!0,n}function EA(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(function(e,t){return q_(t<i.length,"Message reference must be in range"),i[t]}));throw n=new Error(r),n.index=Wk,n.description=r,n}function DA(e){e.type===l_&&EA(e,N_),e.type===p_&&EA(e,C_),e.type===m_&&EA(e,F_),e.type===f_&&EA(e,$_),e.type===d_&&EA(e,M_),EA(e,S_,e.value)}function SA(e){var t=gA();t.type===g_&&t.value===e||DA(t)}function CA(e){return Gk.type===g_&&Gk.value===e}function FA(e){return Gk.type===d_&&Gk.value===e}function $A(){var e=[];Wk=Gk.start,SA("[");while(!CA("]"))CA(",")?(gA(),e.push(null)):(e.push(ZA()),CA("]")||SA(","));return gA(),vA(e)}function MA(){var e;return Wk=Gk.start,e=gA(),e.type===m_||e.type===p_?(e.octal&&EA(e,T_),wA(e)):OA(e.value)}function NA(){var e,t,n,i;return Wk=Gk.start,e=Gk,e.type===f_?(n=MA(),SA(":"),i=ZA(),_A("init",n,i)):e.type!==l_&&e.type!==g_?(t=MA(),SA(":"),i=ZA(),_A("init",t,i)):void DA(e)}function RA(){var e,t,n,i=[],r={},a=String;Wk=Gk.start,SA("{");while(!CA("}"))e=NA(),t=e.key.type===w_?e.key.name:a(e.key.value),n="$"+t,Object.prototype.hasOwnProperty.call(r,n)?EA({},L_):r[n]=!0,i.push(e),CA("}")||SA(",");return SA("}"),kA(i)}function zA(){var e;return SA("("),e=YA(),SA(")"),e}var TA={if:1,this:1};function LA(){var e,t,n;if(CA("("))return zA();if(CA("["))return $A();if(CA("{"))return RA();if(e=Gk.type,Wk=Gk.start,e===f_||TA[Gk.value])n=OA(gA().value);else if(e===m_||e===p_)Gk.octal&&EA(Gk,T_),n=wA(gA());else{if(e===d_)throw new Error(B_);e===c_?(t=gA(),t.value="true"===t.value,n=wA(t)):e===h_?(t=gA(),t.value=null,n=wA(t)):CA("/")||CA("/=")?(n=wA(dA()),mA()):DA(gA())}return n}function PA(){var e=[];if(SA("("),!CA(")"))while(Wk<Hk){if(e.push(ZA()),CA(")"))break;SA(",")}return SA(")"),e}function BA(){var e;return Wk=Gk.start,e=gA(),hA(e)||DA(e),OA(e.value)}function IA(){return SA("."),BA()}function UA(){var e;return SA("["),e=YA(),SA("]"),e}function qA(){var e,t,n;for(e=LA();;)if(CA("."))n=IA(),e=jA(".",e,n);else if(CA("("))t=PA(),e=yA(e,t);else{if(!CA("["))break;n=UA(),e=jA("[",e,n)}return e}function WA(){var e=qA();if(Gk.type===g_&&(CA("++")||CA("--")))throw new Error(B_);return e}function HA(){var e,t;if(Gk.type!==g_&&Gk.type!==d_)t=WA();else{if(CA("++")||CA("--"))throw new Error(B_);if(CA("+")||CA("-")||CA("~")||CA("!"))e=gA(),t=HA(),t=AA(e.value,t);else{if(FA("delete")||FA("void")||FA("typeof"))throw new Error(B_);t=WA()}}return t}function GA(e){var t=0;if(e.type!==g_&&e.type!==d_)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break;default:break}return t}function VA(){var e,t,n,i,r,a,o,s,u,c;if(e=Gk,u=HA(),i=Gk,r=GA(i),0===r)return u;i.prec=r,gA(),t=[e,Gk],o=HA(),a=[u,i,o];while((r=GA(Gk))>0){while(a.length>2&&r<=a[a.length-2].prec)o=a.pop(),s=a.pop().value,u=a.pop(),t.pop(),n=bA(s,u,o),a.push(n);i=gA(),i.prec=r,a.push(i),t.push(Gk),n=HA(),a.push(n)}c=a.length-1,n=a[c],t.pop();while(c>1)t.pop(),n=bA(a[c-1].value,a[c-2],n),c-=2;return n}function ZA(){var e,t,n;return e=VA(),CA("?")&&(gA(),t=ZA(),SA(":"),n=ZA(),e=xA(e,t,n)),e}function YA(){var e=ZA();if(CA(","))throw new Error(B_);return e}var XA=function(e){qk=e,Wk=0,Hk=qk.length,Gk=null,mA();var t=YA();if(Gk.type!==l_)throw new Error("Unexpect token after expression.");return t},JA={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"},QA=function(e){function t(t,n,i,r){var a=e(n[0]);return i&&(a=i+"("+a+")",0===i.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(r<0?"":0===r?"()":"("+n.slice(1).map(e).join(",")+")")}function n(e,n,i){return function(r){return t(e,r,n,i)}}var i="new Date",r="String",a="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&Object(ie["n"])("Missing arguments to clamp function."),t.length>3&&Object(ie["n"])("Too many arguments to clamp function.");var n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),join:n("join",null),indexof:n("indexOf",null),lastindexof:n("lastIndexOf",null),slice:n("slice",null),reverse:function(t){return"("+e(t[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),replace:n("replace",r),trim:n("trim",r,0),regexp:a,test:n("test",a),if:function(t){t.length<3&&Object(ie["n"])("Missing arguments to if function."),t.length>3&&Object(ie["n"])("Too many arguments to if function.");var n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}};function KA(e){var t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}var eE=function(e){e=e||{};var t=e.whitelist?Object(ie["db"])(e.whitelist):{},n=e.blacklist?Object(ie["db"])(e.blacklist):{},i=e.constants||JA,r=(e.functions||QA)(f),a=e.globalvar,o=e.fieldvar,s={},u={},c=0,l=Object(ie["D"])(a)?a:function(e){return a+'["'+e+'"]'};function f(e){if(Object(ie["H"])(e))return e;var t=d[e.type];return null==t&&Object(ie["n"])("Unsupported type: "+e.type),t(e)}var d={Literal:function(e){return e.raw},Identifier:function(e){var r=e.name;return c>0?r:Object(ie["v"])(n,r)?Object(ie["n"])("Illegal identifier: "+r):Object(ie["v"])(i,r)?i[r]:Object(ie["v"])(t,r)?r:(s[r]=1,l(r))},MemberExpression:function(e){var t=!e.computed,n=f(e.object);t&&(c+=1);var i=f(e.property);return n===o&&(u[KA(i)]=1),t&&(c-=1),n+(t?"."+i:"["+i+"]")},CallExpression:function(e){"Identifier"!==e.callee.type&&Object(ie["n"])("Illegal callee type: "+e.callee.type);var t=e.callee.name,n=e.arguments,i=Object(ie["v"])(r,t)&&r[t];return i||Object(ie["n"])("Unrecognized function: "+t),Object(ie["D"])(i)?i(n):i+"("+n.map(f).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(f).join(",")+"]"},BinaryExpression:function(e){return"("+f(e.left)+e.operator+f(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+f(e.argument)+")"},ConditionalExpression:function(e){return"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")"},LogicalExpression:function(e){return"("+f(e.left)+e.operator+f(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(f).join(",")+"}"},Property:function(e){c+=1;var t=f(e.key);return c-=1,t+":"+f(e.value)}};function h(e){var t={code:f(e),globals:Object.keys(s),fields:Object.keys(u)};return s={},u={},t}return h.functions=r,h.constants=i,h};const tE="intersect",nE="union",iE="vlMulti",rE="or",aE="and";var oE="E",sE="R",uE="R-E",cE="R-LE",lE="R-RE",fE="index:unit";function dE(e,t){for(var n,i,r=t.fields,a=t.values,o=r.length,s=0;s<o;++s)if(i=r[s],i.getter=ie["t"].getter||Object(ie["t"])(i.field),n=i.getter(e),Object(ie["C"])(n)&&(n=Object(ie["cb"])(n)),Object(ie["C"])(a[s])&&(a[s]=Object(ie["cb"])(a[s])),Object(ie["C"])(a[s][0])&&(a[s]=a[s].map(ie["cb"])),i.type===oE){if(Object(ie["A"])(a[s])?a[s].indexOf(n)<0:n!==a[s])return!1}else if(i.type===sE){if(!Object(ie["z"])(n,a[s]))return!1}else if(i.type===lE){if(!Object(ie["z"])(n,a[s],!0,!1))return!1}else if(i.type===uE){if(!Object(ie["z"])(n,a[s],!1,!1))return!1}else if(i.type===cE&&!Object(ie["z"])(n,a[s],!1,!0))return!1;return!0}function hE(e,t,n){for(var i,r,a,o,s,u=this.context.data[e],c=u?u.values.value:[],l=u?u[fE]&&u[fE].value:void 0,f=n===tE,d=c.length,h=0;h<d;++h)if(i=c[h],l&&f){if(r=r||{},a=r[o=i.unit]||0,-1===a)continue;if(s=dE(t,i),r[o]=s?-1:++a,s&&1===l.size)return!0;if(!s&&a===l.get(o).count)return!1}else if(s=dE(t,i),f^s)return s;return d&&f}function pE(e,t,n){for(var i,r,a,o,s,u,c,l,f,d,h,p=this.context.data[e],g=p?p.values.value:[],m={},v={},b={},y=g.length,x=0;x<y;++x){for(i=g[x],o=i.unit,r=i.fields,a=i.values,d=0,h=r.length;d<h;++d)s=r[d],u=m[s.field]||(m[s.field]={}),c=u[o]||(u[o]=[]),b[s.field]=l=s.type.charAt(0),f=gE[l+"_union"],u[o]=f(c,Object(ie["i"])(a[d]));n&&(c=v[o]||(v[o]=[]),c.push(Object(ie["i"])(a).reduce((e,t,n)=>(e[r[n].field]=t,e),{})))}return t=t||nE,Object.keys(m).forEach((function(e){m[e]=Object.keys(m[e]).map(t=>m[e][t]).reduce((n,i)=>void 0===n?i:gE[b[e]+"_"+t](n,i))})),g=Object.keys(v),n&&g.length&&(m[iE]=t===nE?{[rE]:g.reduce((e,t)=>(e.push.apply(e,v[t]),e),[])}:{[aE]:g.map(e=>({[rE]:v[e]}))}),m}var gE={E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((function(e){return t.indexOf(e)>=0})):t},R_union:function(e,t){var n=Object(ie["cb"])(t[0]),i=Object(ie["cb"])(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=Object(ie["cb"])(t[0]),i=Object(ie["cb"])(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};const mE=":",vE="@";function bE(e,t,n,i){t[0].type!==Xk&&Object(ie["n"])("First argument to selection functions must be a string literal.");const r=t[0].value,a=t.length>=2&&Object(ie["U"])(t).value,o="unit",s=vE+o,u=mE+r;a!==tE||Object(ie["v"])(i,s)||(i[s]=n.getData(r).indataRef(n,o)),Object(ie["v"])(i,u)||(i[u]=n.getData(r).tuplesRef())}var yE=n("62f0");function xE(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function OE(e){const t=Object(Qx["g"])(e),n=xE(t.r),i=xE(t.g),r=xE(t.b);return.2126*n+.7152*i+.0722*r}function wE(e,t){const n=OE(e),i=OE(t),r=Math.max(n,i),a=Math.min(n,i);return(r+.05)/(a+.05)}function jE(e){const t=this.context.data[e];return t?t.values.value:[]}function kE(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r?r.count:r}function _E(e,t){const n=this.context.dataflow,i=this.context.data[e],r=i.input;return n.pulse(r,n.changeset().remove(ie["gb"]).insert(t)),1}var AE=function(e,t,n){if(e){const n=this.context.dataflow,i=e.mark.source;n.pulse(i,n.changeset().encode(e,t))}return void 0!==n?n:e};const EE={};function DE(e,t,n){let i=e+":"+n,r=EE[i];return r&&r[0]===t||(EE[i]=r=[t,t(n)]),r[1]}function SE(e,t){return DE("format",Kg["b"],t)(e)}function CE(e,t){return DE("timeFormat",qo,t)(e)}function FE(e,t){return DE("utcFormat",Wo,t)(e)}function $E(e,t){return DE("timeParse",wt["c"],t)(e)}function ME(e,t){return DE("utcParse",wt["e"],t)(e)}var NE=new Date(2e3,0,1);function RE(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(NE.setYear(2e3),NE.setMonth(e),NE.setDate(t),CE(NE,n)):""}function zE(e){return RE(e,1,"%B")}function TE(e){return RE(e,1,"%b")}function LE(e){return RE(0,2+e,"%A")}function PE(e){return RE(0,2+e,"%a")}function BE(e,t){let n;return Object(ie["D"])(e)?e:Object(ie["H"])(e)?(n=t.scales[e])&&n.value:void 0}function IE(e,t){const n=BE(e,(t||this).context);return n&&n.range?n.range():[]}function UE(e,t){const n=BE(e,(t||this).context);return n?n.domain():[]}function qE(e,t){const n=BE(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function WE(e,t,n){return gg(e||0,t||0,n||0)}function HE(e,t){const n=BE(e,(t||this).context);return n?n.copy():void 0}function GE(e,t,n){const i=BE(e,(n||this).context);return i&&void 0!==t?i(t):void 0}function VE(e,t,n){const i=BE(e,(n||this).context);return i?Object(ie["A"])(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0}var ZE=n("3d23"),YE=n("7e33"),XE=n("a794");function JE(e,t){return function(n,i,r){if(n){const t=BE(n,(r||this).context);return t&&t.path[e](i)}return t(i)}}const QE=JE("area",ZE["c"]),KE=JE("bounds",YE["a"]),eD=JE("centroid",XE["a"]);var tD=function(e){let t=this.context.group,n=!1;if(t)while(e){if(e===t){n=!0;break}e=e.mark.group}return n},nD=function(e,t,n){if(!e)return[];const[i,r]=e,a=(new xu).set(i[0],i[1],r[0],r[1]),o=n||this.context.dataflow.scenegraph().root;return rp(o,a,iD(t))};function iD(e){let t=null;if(e){const n=Object(ie["i"])(e.marktype),i=Object(ie["i"])(e.markname);t=e=>(!n.length||n.some(t=>e.marktype===t))&&(!i.length||i.some(t=>e.name===t))}return t}function rD(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function aD(){return rD(this.context.dataflow,"warn",arguments)}function oD(){return rD(this.context.dataflow,"info",arguments)}function sD(){return rD(this.context.dataflow,"debug",arguments)}var uD=function(){var e=[].slice.call(arguments);return e.unshift({}),ie["o"].apply(null,e)};function cD(e,t){return e===t||e!==e&&t!==t||(Object(ie["A"])(e)?!(!Object(ie["A"])(t)||e.length!==t.length)&&lD(e,t):!(!Object(ie["F"])(e)||!Object(ie["F"])(t))&&fD(e,t))}function lD(e,t){for(let n=0,i=e.length;n<i;++n)if(!cD(e[n],t[n]))return!1;return!0}function fD(e,t){for(let n in e)if(!cD(e[n],t[n]))return!1;return!0}function dD(e){return t=>fD(e,t)}var hD=function(e,t,n,i,r,a){let o,s,u=this.context.dataflow,c=this.context.data[e],l=c.input,f=c.changes,d=u.stamp();if(!1===u._trigger||!(l.value.length||t||i))return 0;if((!f||f.stamp<d)&&(c.changes=f=u.changeset(),f.stamp=d,u.runAfter((function(){c.modified=!0,u.pulse(l,f).run()}),!0,1)),n&&(o=!0===n?ie["gb"]:Object(ie["A"])(n)||ue(n)?n:dD(n),f.remove(o)),t&&f.insert(t),i&&(o=dD(i),l.value.some(o)?f.remove(o):f.insert(i)),r)for(s in a)f.modify(r,s,a[s]);return 1};function pD(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+i*i)}function gD(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}var mD=function(e,t,n,i,r){e=BE(e,(r||this).context);const a=Eu(t,n);let o=e.domain(),s=o[0],u=Object(ie["U"])(o),c=ie["x"];return u-s?c=zv(e,s,u):e=(e.interpolator?wv("sequential")().interpolator(e.interpolator()):wv("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,u=1]),e.ticks&&(o=e.ticks(+i||15),s!==o[0]&&o.unshift(s),u!==Object(ie["U"])(o)&&o.push(u)),o.forEach(t=>a.stop(c(t),e(t))),a};function vD(e,t,n){const i=BE(e,(n||this).context);return function(e){return i?i.path.context(e)(t):""}}function bD(e){let t=null;return function(n){return n?pc(n,t=t||tc(e)):e}}const yD={};function xD(e){return e.data}function OD(e,t){const n=jE.call(t,e);return n.root&&n.root.lookup||yD}function wD(e,t,n){const i=OD(e,this),r=i[t],a=i[n];return r&&a?r.path(a).map(xD):void 0}function jD(e,t){const n=OD(e,this)[t];return n?n.ancestors().map(xD):void 0}const kD="undefined"!==typeof window&&window||null;function _D(){return kD?kD.screen:{}}function AD(){return kD?[kD.innerWidth,kD.innerHeight]:[void 0,void 0]}function ED(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}const DD=":",SD="@",CD="%",FD="$";function $D(e,t,n,i){t[0].type!==Xk&&Object(ie["n"])("First argument to data functions must be a string literal.");const r=t[0].value,a=DD+r;if(!Object(ie["v"])(a,i))try{i[a]=n.getData(r).tuplesRef()}catch(o){}}function MD(e,t,n,i){t[0].type!==Xk&&Object(ie["n"])("First argument to indata must be a string literal."),t[1].type!==Xk&&Object(ie["n"])("Second argument to indata must be a string literal.");const r=t[0].value,a=t[1].value,o=SD+a;Object(ie["v"])(o,i)||(i[o]=n.getData(r).indataRef(n,a))}function ND(e,t,n,i){if(t[0].type===Xk)RD(n,i,t[0].value);else if(t[0].type===Qk)for(e in n.scales)RD(n,i,e)}function RD(e,t,n){const i=CD+n;if(!Object(ie["v"])(t,i))try{t[i]=e.scaleRef(n)}catch(r){}}const zD={random:function(){return Qn()},cumulativeNormal:li,cumulativeLogNormal:vi,cumulativeUniform:ji,densityNormal:ci,densityLogNormal:mi,densityUniform:wi,quantileNormal:fi,quantileLogNormal:bi,quantileUniform:ki,sampleNormal:ui,sampleLogNormal:gi,sampleUniform:Oi,isArray:ie["A"],isBoolean:ie["B"],isDate:ie["C"],isDefined:function(e){return void 0!==e},isNumber:ie["E"],isObject:ie["F"],isRegExp:ie["G"],isString:ie["H"],isTuple:ue,isValid:function(e){return null!=e&&e===e},toBoolean:ie["ab"],toDate:ie["bb"],toNumber:ie["cb"],toString:ie["eb"],flush:ie["u"],lerp:ie["J"],merge:uD,pad:ie["P"],peek:ie["U"],span:ie["X"],inrange:ie["z"],truncate:ie["fb"],rgb:Qx["g"],lab:yE["a"],hcl:yE["c"],hsl:Qx["f"],luminance:OE,contrast:wE,sequence:Fa,format:SE,utcFormat:FE,utcParse:ME,utcOffset:To,utcSequence:Bo,timeFormat:CE,timeParse:$E,timeOffset:zo,timeSequence:Po,timeUnitSpecifier:Uo,monthFormat:zE,monthAbbrevFormat:TE,dayFormat:LE,dayAbbrevFormat:PE,quarter:ie["V"],utcquarter:ie["hb"],warn:aD,info:oD,debug:sD,extent:ie["p"],inScope:tD,intersect:nD,clampRange:ie["j"],pinchDistance:pD,pinchAngle:gD,screen:_D,containerSize:ED,windowSize:AD,bandspace:WE,setdata:_E,pathShape:bD,panLinear:ie["Q"],panLog:ie["R"],panPow:ie["S"],panSymlog:ie["T"],zoomLinear:ie["lb"],zoomLog:ie["mb"],zoomPow:ie["nb"],zoomSymlog:ie["ob"],encode:AE,modify:hD},TD=["view","item","group","xy","x","y"],LD="event.vega.",PD="this.",BD={};function ID(e){const t=QA(e);TD.forEach(e=>t[e]=LD+e);for(let n in zD)t[n]=PD+n;return t}function UD(e,t,n){return 1===arguments.length?zD[e]:(zD[e]=t,n&&(BD[e]=n),WD&&(WD.functions[e]=PD+e),this)}UD("bandwidth",qE,ND),UD("copy",HE,ND),UD("domain",UE,ND),UD("range",IE,ND),UD("invert",VE,ND),UD("scale",GE,ND),UD("gradient",mD,ND),UD("geoArea",QE,ND),UD("geoBounds",KE,ND),UD("geoCentroid",eD,ND),UD("geoShape",vD,ND),UD("indata",kE,MD),UD("data",jE,$D),UD("treePath",wD,$D),UD("treeAncestors",jD,$D),UD("vlSelectionTest",hE,bE),UD("vlSelectionResolve",pE,bE);const qD={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:function(e){return"_["+Object(ie["Z"])(FD+e)+"]"},functions:ID,constants:JA,visitors:BD};var WD=eE(qD),HD=n("ad68"),GD=n("70e1");function VD(e,t,n){";"!==t[t.length-1]&&(t="return("+t+");");var i=Function.apply(null,e.concat(t));return n&&n.functions?i.bind(n.functions):i}function ZD(e,t){return VD(["_"],e,t)}function YD(e,t){return VD(["datum","_"],e,t)}function XD(e,t){return VD(["event"],e,t)}function JD(e,t){return VD(["_","event"],e,t)}function QD(e,t){return VD(["item","_"],e,t)}function KD(e,t,n){var i,r;for(i in n=n||{},e)r=e[i],n[i]=Object(ie["A"])(r)?r.map((function(e){return eS(e,t,n)})):eS(r,t,n);return n}function eS(e,t,n){if(!e||!Object(ie["F"])(e))return e;for(var i,r=0,a=tS.length;r<a;++r)if(i=tS[r],Object(ie["v"])(e,i.key))return i.parse(e,t,n);return e}var tS=[{key:"$ref",parse:nS},{key:"$key",parse:rS},{key:"$expr",parse:iS},{key:"$field",parse:aS},{key:"$encode",parse:sS},{key:"$compare",parse:oS},{key:"$context",parse:uS},{key:"$subflow",parse:cS},{key:"$tupleid",parse:lS}];function nS(e,t){return t.get(e.$ref)||Object(ie["n"])("Operator not defined: "+e.$ref)}function iS(e,t,n){e.$params&&KD(e.$params,t,n);var i="e:"+e.$expr+"_"+e.$name;return t.fn[i]||(t.fn[i]=Object(ie["f"])(YD(e.$expr,t),e.$fields,e.$name))}function rS(e,t){var n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Object(ie["I"])(e.$key,e.$flat))}function aS(e,t){if(!e.$field)return null;var n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Object(ie["t"])(e.$field,e.$name))}function oS(e,t){var n="c:"+e.$compare+"_"+e.$order,i=Object(ie["i"])(e.$compare).map((function(e){return e&&e.$tupleid?ce:e}));return t.fn[n]||(t.fn[n]=Object(ie["k"])(i,e.$order))}function sS(e,t){var n,i,r=e.$encode,a={};for(n in r)i=r[n],a[n]=Object(ie["f"])(QD(i.$expr,t),i.$fields),a[n].output=i.$output;return a}function uS(e,t){return t}function cS(e,t){var n=e.$subflow;return function(e,i,r){var a=bS(n,t.fork()),o=a.get(n.operators[0].id),s=a.signals.parent;return s&&s.set(r),o}}function lS(){return ce}function fS(e){return(e+"").toLowerCase()}function dS(e){return"operator"===fS(e)}function hS(e){return"collect"===fS(e)}var pS=function(e,t){dS(e.type)||!e.type?t.operator(e,e.update?ZD(e.update,t):null):t.transform(e,e.type)};function gS(e,t){if(e.params){var n=t.get(e.id);n||Object(ie["n"])("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(KD(e.params,t),e.react,e.initonly))}}var mS=function(e,t){var n,i=null!=e.filter?XD(e.filter,t):void 0,r=null!=e.stream?t.get(e.stream):void 0;e.source?r=t.events(e.source,e.type,i):e.merge&&(n=e.merge.map(t.get.bind(t)),r=n[0].merge.apply(n[0],n.slice(1))),e.between&&(n=e.between.map(t.get.bind(t)),r=r.between(n[0],n[1])),e.filter&&(r=r.filter(i)),null!=e.throttle&&(r=r.throttle(+e.throttle)),null!=e.debounce&&(r=r.debounce(+e.debounce)),null==r&&Object(ie["n"])("Invalid stream definition: "+JSON.stringify(e)),e.consume&&r.consume(!0),t.stream(e,r)},vS=function(e,t){var n=Object(ie["F"])(n=e.source)?n.$ref:n,i=t.get(n),r=null,a=e.update,o=void 0;i||Object(ie["n"])("Source not defined: "+e.source),r=e.target&&e.target.$expr?XD(e.target.$expr,t):t.get(e.target),a&&a.$expr&&(a.$params&&(o=KD(a.$params,t)),a=JD(a.$expr,t)),t.update(e,i,r,a,o)},bS=function(e,t){var n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),n.forEach((function(e){pS(e,t)})),n.forEach((function(e){gS(e,t)})),(e.streams||[]).forEach((function(e){mS(e,t)})),(e.updates||[]).forEach((function(e){vS(e,t)})),t.resolve()},yS={skip:!0};function xS(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach((function(n){var r=t.signals[n];e.signals(n,r)&&(i[n]=r.value)}))}if(e.data){var r=n.data={};Object.keys(t.data).forEach((function(n){var i=t.data[n];e.data(n,i)&&(r[n]=i.input.value)}))}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map((function(t){return t.getState(e)}))),n}function OS(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach((function(e){n.update(t.signals[e],r[e],yS)})),Object.keys(i||{}).forEach((function(e){n.pulse(t.data[e].input,n.changeset().remove(ie["gb"]).insert(i[e]))})),(e.subcontext||[]).forEach((function(e,n){var i=t.subcontext[n];i&&i.setState(e)}))}var wS=function(e,t,n){return new jS(e,t,n)};function jS(e,t,n){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function kS(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.functions=e.functions,this.events=e.events,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}jS.prototype=kS.prototype={fork:function(){var e=new kS(this);return(this.subcontext||(this.subcontext=[])).push(e),e},get:function(e){return this.nodes[e]},set:function(e,t){return this.nodes[e]=t},add:function(e,t){var n,i=this,r=i.dataflow;if(i.set(e.id,t),hS(e.type)&&(n=e.value)&&(n.$ingest?r.ingest(t,n.$ingest,n.$format):n.$request?r.preload(t,n.$request,n.$format):r.pulse(t,r.changeset().insert(n))),e.root&&(i.root=t),e.parent){var a=i.get(e.parent.$ref);a?(r.connect(a,[t]),t.targets().add(a)):(i.unresolved=i.unresolved||[]).push((function(){a=i.get(e.parent.$ref),r.connect(a,[t]),t.targets().add(a)}))}if(e.signal&&(i.signals[e.signal]=t),e.scale&&(i.scales[e.scale]=t),e.data)for(var o in e.data)n=i.data[o]||(i.data[o]={}),e.data[o].forEach((function(e){n[e]=t}))},resolve:function(){return(this.unresolved||[]).forEach((function(e){e()})),delete this.unresolved,this},operator:function(e,t){this.add(e,this.dataflow.add(e.value,t))},transform:function(e,t){this.add(e,this.dataflow.add(this.transforms[fS(t)]))},stream:function(e,t){this.set(e.id,t)},update:function(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},getState:xS,setState:OS};var _S=function(e,t,n){var i=n||zD;return bS(t,wS(e,jn,i))};function AS(e){var t=this._runtime.scales;return Object(ie["v"])(t,e)||Object(ie["n"])("Unrecognized scale or projection: "+e),t[e].value}var ES="width",DS="height",SS="padding",CS={skip:!0};function FS(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===SS?i.left+i.right:0)}function $S(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===SS?i.top+i.bottom:0)}function MS(e){var t=e._signals,n=t[ES],i=t[DS],r=t[SS];function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,(function(t){e._width=t.size,e._viewWidth=FS(e,t.size),a()}),{size:n}),e._resizeHeight=e.add(null,(function(t){e._height=t.size,e._viewHeight=$S(e,t.size),a()}),{size:i});var o=e.add(null,a,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,o.rank=r.rank+1}function NS(e,t,n,i,r,a){this.runAfter((function(o){var s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(ES,n,CS),o._resizeWidth.skip(!0)),o.height()!==i&&(s=1,o.signal(DS,i,CS),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),o._origin[0]===r[0]&&o._origin[1]===r[1]||(o._resize=1,o._origin=r),s&&o.run("enter"),a&&o.runAfter(e=>e.resize())}),!1,1)}function RS(e){return this._runtime.getState(e||{data:zS,signals:TS,recurse:!0})}function zS(e,t){return t.modified&&Object(ie["A"])(t.input.value)&&e.indexOf("_:vega:_")}function TS(e,t){return!("parent"===e||t instanceof jn.proxy)}function LS(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},e=>{e._trigger=!0}),this}var PS=n("d5bc"),BS=function(e,t){function n(t){e({timestamp:Date.now(),elapsed:t})}this._timers.push(Object(PS["a"])(n,t))},IS=function(e,t,n,i){var r=e.element();r&&r.setAttribute("title",US(i))};function US(e){return null==e?"":Object(ie["A"])(e)?WS(e):Object(ie["F"])(e)&&!Object(ie["C"])(e)?qS(e):e+""}function qS(e){return Object.keys(e).map((function(t){var n=e[t];return t+": "+(Object(ie["A"])(n)?WS(n):HS(n))})).join("\n")}function WS(e){return"["+e.map(HS).join(", ")+"]"}function HS(e){return Object(ie["A"])(e)?"[…]":Object(ie["F"])(e)&&!Object(ie["C"])(e)?"{…}":e}function GS(e,t){var n=this;t=t||{},bn.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),n._el=null,n._elBind=null,n._renderType=t.renderer||tp.Canvas,n._scenegraph=new Id;var i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||IS,n._redraw=!0,n._handler=(new oh).scene(i),n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=dk(e.eventConfig);var r=_S(n,e,t.functions);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map((function(e){return{state:null,param:Object(ie["o"])({},e)}})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._background=t.background||r.background||null,n._width=n.width(),n._height=n.height(),n._viewWidth=FS(n,n._width),n._viewHeight=$S(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,MS(n),Yj(n),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}var VS=Object(ie["y"])(GS,bn);function ZS(e,t){return Object(ie["v"])(e._signals,t)?e._signals[t]:Object(ie["n"])("Unrecognized signal name: "+Object(ie["Z"])(t))}function YS(e,t){var n=e._targets||[],i=n.filter((function(e){var n=e._update;return n&&n.handler===t}));return i.length?i[0]:null}function XS(e,t,n,i){var r=YS(n,i);return r||(r=Rk(this,(function(){i(t,n.value)})),r.handler=i,e.on(n,null,r)),e}function JS(e,t,n){var i=YS(t,n);return i&&t._targets.remove(i),e}VS.evaluate=async function(e,t,n){if(await bn.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,ak(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&ae(this,n),this},VS.dirty=function(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},VS.container=function(){return this._el},VS.scenegraph=function(){return this._scenegraph},VS.origin=function(){return this._origin.slice()},VS.signal=function(e,t,n){var i=ZS(this,e);return 1===arguments.length?i.value:this.update(i,t,n)},VS.background=function(e){return arguments.length?(this._background=e,this._resize=1,this):this._background},VS.width=function(e){return arguments.length?this.signal("width",e):this.signal("width")},VS.height=function(e){return arguments.length?this.signal("height",e):this.signal("height")},VS.padding=function(e){return arguments.length?this.signal("padding",e):this.signal("padding")},VS.autosize=function(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},VS.renderer=function(e){return arguments.length?(ip(e)||Object(ie["n"])("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},VS.tooltip=function(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},VS.loader=function(e){return arguments.length?(e!==this._loader&&(bn.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},VS.resize=function(){return this._autosize=1,this.touch(ZS(this,"autosize"))},VS._resetRenderer=function(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},VS._resizeView=NS,VS.addEventListener=function(e,t,n){var i=t;return n&&!1===n.trap||(i=Rk(this,t),i.raw=t),this._handler.on(e,i),this},VS.removeEventListener=function(e,t){var n,i,r=this._handler.handlers(e),a=r.length;while(--a>=0)if(i=r[a].type,n=r[a].handler,e===i&&(t===n||t===n.raw)){this._handler.off(i,n);break}return this},VS.addResizeListener=function(e){var t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},VS.removeResizeListener=function(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},VS.addSignalListener=function(e,t){return XS(this,e,ZS(this,e),t)},VS.removeSignalListener=function(e,t){return JS(this,ZS(this,e),t)},VS.addDataListener=function(e,t){return XS(this,e,Jj(this,e).values,t)},VS.removeDataListener=function(e,t){return JS(this,Jj(this,e).values,t)},VS.preventDefault=function(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},VS.timer=BS,VS.events=gk,VS.finalize=xk,VS.hover=yk,VS.data=Qj,VS.change=Kj,VS.insert=ek,VS.remove=tk,VS.scale=AS,VS.initialize=Tk,VS.toImageURL=Bk,VS.toCanvas=Vk,VS.toSVG=Zk,VS.getState=RS,VS.setState=LS;var QS=function(e,t){return e=e||t.autosize,Object(ie["F"])(e)?e:{type:e||"pad"}},KS=function(e,t){return e=e||t.padding,Object(ie["F"])(e)?{top:eC(e.top),bottom:eC(e.bottom),left:eC(e.left),right:eC(e.right)}:tC(eC(e))};function eC(e){return+e||0}function tC(e){return{top:e,bottom:e,left:e,right:e}}var nC="outer",iC=["value","update","init","react","bind"];function rC(e,t){Object(ie["n"])(e+' for "outer" push: '+Object(ie["Z"])(t))}var aC=function(e,t){var n=e.name;if(e.push===nC)t.signals[n]||rC("No prior signal definition",n),iC.forEach((function(t){void 0!==e[t]&&rC("Invalid property ",t)}));else{var i=t.addSignal(n,e.value);!1===e.react&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}},oC=function(e,t,n){var i,r,a={};try{e=Object(ie["H"])(e)?e:Object(ie["Z"])(e)+"",i=XA(e)}catch(o){Object(ie["n"])("Expression parse error: "+e)}return i.visit((function(e){if(e.type===t_){var n=e.callee.name,i=qD.visitors[n];i&&i(n,e.arguments,t,a)}})),r=WD(i),r.globals.forEach((function(e){var n=FD+e;!Object(ie["v"])(a,n)&&t.getSignal(e)&&(a[n]=t.signalRef(e))})),{$expr:n?n+"return("+r.code+");":r.code,$fields:r.fields,$params:a}};function sC(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function uC(e,t,n,i){return new sC(e,t,n,i)}function cC(e,t){return uC("operator",e,t)}function lC(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function fC(e,t){return t?{$field:e,$name:t}:{$field:e}}var dC=fC("key");function hC(e,t){return{$compare:e,$order:t}}function pC(e,t){var n={$key:e};return t&&(n.$flat=!0),n}var gC="ascending",mC="descending";function vC(e){return Object(ie["F"])(e)?(e.order===mC?"-":"+")+bC(e.op,e.field):""}function bC(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}var yC="scope",xC="view";function OC(e){return e&&e.signal}function wC(e){return e&&e.expr}function jC(e){if(OC(e))return!0;if(Object(ie["F"])(e))for(var t in e)if(jC(e[t]))return!0;return!1}function kC(e,t){return null!=e?e:t}function _C(e){return e&&e.signal||e}var AC="timer";function EC(e,t){var n=e.merge?SC:e.stream?CC:e.type?FC:Object(ie["n"])("Invalid stream specification: "+Object(ie["Z"])(e));return n(e,t)}function DC(e){return e===yC?xC:e||xC}function SC(e,t){var n=e.merge.map(e=>EC(e,t)),i=$C({merge:n},e,t);return t.addStream(i).id}function CC(e,t){var n=EC(e.stream,t),i=$C({stream:n},e,t);return t.addStream(i).id}function FC(e,t){var n,i;return e.type===AC?(n=t.event(AC,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(DC(e.source),e.type),i=$C({stream:n},e,t),1===Object.keys(i).length?n:t.addStream(i).id}function $C(e,t,n){var i=t.between;return i&&(2!==i.length&&Object(ie["n"])('Stream "between" parameter must have 2 entries: '+Object(ie["Z"])(t)),e.between=[EC(i[0],n),EC(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(MC(t.marktype,t.markname,t.markrole)),t.source===yC&&i.push("inScope(event.item)"),i.length&&(e.filter=oC("("+i.join(")&&(")+")").$expr),null!=(i=t.throttle)&&(e.throttle=+i),null!=(i=t.debounce)&&(e.debounce=+i),t.consume&&(e.consume=!0),e}function MC(e,t,n){var i="event.item";return i+(e&&"*"!==e?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}var NC,RC,zC=function(e,t,n){return NC=t||TC,RC=n||VC,XC(e.trim()).map(JC)},TC="view",LC="[",PC="]",BC="{",IC="}",UC=":",qC=",",WC="@",HC=">",GC=/[[\]{}]/,VC={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function ZC(e){return RC[e]}function YC(e,t,n,i,r){for(var a,o=0,s=e.length;t<s;++t){if(a=e[t],!o&&a===n)return t;r&&r.indexOf(a)>=0?--o:i&&i.indexOf(a)>=0&&++o}return t}function XC(e){var t=[],n=0,i=e.length,r=0;while(r<i)r=YC(e,r,qC,LC+BC,PC+IC),t.push(e.substring(n,r).trim()),n=++r;if(0===t.length)throw"Empty event selector: "+e;return t}function JC(e){return"["===e[0]?QC(e):KC(e)}function QC(e){var t,n,i=e.length,r=1;if(r=YC(e,r,PC,LC,PC),r===i)throw"Empty between selector: "+e;if(t=XC(e.substring(1,r)),2!==t.length)throw"Between selector must have two elements: "+e;if(e=e.slice(r+1).trim(),e[0]!==HC)throw"Expected '>' after between selector: "+e;return t=t.map(JC),n=JC(e.slice(1).trim()),n.between?{between:t,stream:n}:(n.between=t,n)}function KC(e){var t,n,i={source:NC},r=[],a=[0,0],o=0,s=0,u=e.length,c=0;if(e[u-1]===IC){if(c=e.lastIndexOf(BC),!(c>=0))throw"Unmatched right brace: "+e;try{a=eF(e.substring(c+1,u-1))}catch(l){throw"Invalid throttle specification: "+e}e=e.slice(0,c).trim(),u=e.length,c=0}if(!u)throw e;if(e[0]===WC&&(o=++c),t=YC(e,c,UC),t<u&&(r.push(e.substring(s,t).trim()),s=c=++t),c=YC(e,c,LC),c===u)r.push(e.substring(s,u).trim());else if(r.push(e.substring(s,c).trim()),n=[],s=++c,s===u)throw"Unmatched left bracket: "+e;while(c<u){if(c=YC(e,c,PC),c===u)throw"Unmatched left bracket: "+e;if(n.push(e.substring(s,c).trim()),c<u-1&&e[++c]!==LC)throw"Expected left bracket: "+e;s=++c}if(!(u=r.length)||GC.test(r[u-1]))throw"Invalid event selector: "+e;return u>1?(i.type=r[1],o?i.markname=r[0].slice(1):ZC(r[0])?i.marktype=r[0]:i.source=r[0]):i.type=r[0],"!"===i.type.slice(-1)&&(i.consume=!0,i.type=i.type.slice(0,-1)),null!=n&&(i.filter=n),a[0]&&(i.throttle=a[0]),a[1]&&(i.debounce=a[1]),i}function eF(e){var t=e.split(qC);if(!e.length||t.length>2)throw e;return t.map((function(t){var n=+t;if(n!==n)throw e;return n}))}var tF="var datum=event.item&&event.item.datum;",nF=function(e,t,n){var i=e.events,r=e.update,a=e.encode,o=[],s={target:n};i||Object(ie["n"])("Signal update missing events specification."),Object(ie["H"])(i)&&(i=zC(i,t.isSubscope()?yC:xC)),i=Object(ie["i"])(i).filter(e=>e.signal||e.scale?(o.push(e),0):1),o.length>1&&(o=[rF(o)]),i.length&&o.push(i.length>1?{merge:i}:i[0]),null!=a&&(r&&Object(ie["n"])("Signal encode and update are mutually exclusive."),r="encode(item(),"+Object(ie["Z"])(a)+")"),s.update=Object(ie["H"])(r)?oC(r,t,tF):null!=r.expr?oC(r.expr,t,tF):null!=r.value?r.value:null!=r.signal?{$expr:"_.value",$params:{value:t.signalRef(r.signal)}}:Object(ie["n"])("Invalid signal update specification."),e.force&&(s.options={force:!0}),o.forEach((function(e){t.addUpdate(Object(ie["o"])(iF(e,t),s))}))};function iF(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):EC(e,t)}}function rF(e){return{signal:"["+e.map(e=>e.scale?'scale("'+e.scale+'")':e.signal)+"]"}}var aF=function(e,t){var n=t.getSignal(e.name),i=e.update;e.init&&(i?Object(ie["n"])("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=oC(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach((function(e){nF(e,t,n.id)}))};function oF(e){return function(t,n,i){return uC(e,n,t||void 0,i)}}var sF=oF("aggregate"),uF=oF("axisticks"),cF=oF("bound"),lF=oF("collect"),fF=oF("compare"),dF=oF("datajoin"),hF=oF("encode"),pF=oF("expression"),gF=(oF("extent"),oF("facet")),mF=oF("field"),vF=oF("key"),bF=oF("legendentries"),yF=oF("load"),xF=oF("mark"),OF=oF("multiextent"),wF=oF("multivalues"),jF=oF("overlap"),kF=oF("params"),_F=oF("prefacet"),AF=oF("projection"),EF=oF("proxy"),DF=oF("relay"),SF=oF("render"),CF=oF("scale"),FF=oF("sieve"),$F=oF("sortitems"),MF=oF("viewlayout"),NF=oF("values"),RF=0,zF={min:"min",max:"max",count:"sum"};function TF(e,t){var n=e.type||"linear";jv(n)||Object(ie["n"])("Unrecognized scale type: "+Object(ie["Z"])(n)),t.addScale(e.name,{type:n,domain:void 0})}function LF(e,t){var n,i=t.getScale(e.name).params;for(n in i.domain=UF(e.domain,e,t),null!=e.range&&(i.range=e$(e,t,i)),null!=e.interpolate&&KF(e.interpolate,i),null!=e.nice&&(i.nice=QF(e.nice)),null!=e.bins&&(i.bins=JF(e.bins,t)),e)Object(ie["v"])(i,n)||"name"===n||(i[n]=PF(e[n],t))}function PF(e,t){return Object(ie["F"])(e)?e.signal?t.signalRef(e.signal):Object(ie["n"])("Unsupported object: "+Object(ie["Z"])(e)):e}function BF(e,t){return e.signal?t.signalRef(e.signal):e.map(e=>PF(e,t))}function IF(e){Object(ie["n"])("Can not find data set: "+Object(ie["Z"])(e))}function UF(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Object(ie["A"])(e)?qF:e.fields?HF:WF)(e,t,n);null==t.domainMin&&null==t.domainMax||Object(ie["n"])("No scale domain defined for domainMin/domainMax to override.")}function qF(e,t,n){return e.map((function(e){return PF(e,n)}))}function WF(e,t,n){var i=n.getData(e.data);return i||IF(e.data),Av(t.type)?i.valuesRef(n,e.field,ZF(e.sort,!1)):Cv(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function HF(e,t,n){var i=e.data,r=e.fields.reduce((function(e,t){return t=Object(ie["H"])(t)?{data:i,field:t}:Object(ie["A"])(t)||t.signal?GF(t,n):t,e.push(t),e}),[]);return(Av(t.type)?VF:Cv(t.type)?YF:XF)(e,n,r)}function GF(e,t){var n="_:vega:_"+RF++,i=lF({});if(Object(ie["A"])(e))i.value={$ingest:e};else if(e.signal){var r="setdata("+Object(ie["Z"])(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,FF({})]),{data:n,field:"data"}}function VF(e,t,n){var i,r,a,o,s,u=ZF(e.sort,!0);return i=n.map((function(e){var n=t.getData(e.data);return n||IF(e.data),n.countsRef(t,e.field,u)})),r={groupby:dC,pulse:i},u&&(a=u.op||"count",s=u.field?bC(a,u.field):"count",r.ops=[zF[a]],r.fields=[t.fieldRef(s)],r.as=[s]),a=t.add(sF(r)),o=t.add(lF({pulse:lC(a)})),s=t.add(NF({field:dC,sort:t.sortRef(u),pulse:lC(o)})),lC(s)}function ZF(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!zF[e.op]&&Object(ie["n"])("Multiple domain scales can not be sorted using "+e.op):Object(ie["n"])("No field provided for sort aggregate op: "+e.op):Object(ie["F"])(e)?e.field="key":e={field:"key"}),e}function YF(e,t,n){var i=n.map((function(e){var n=t.getData(e.data);return n||IF(e.data),n.domainRef(t,e.field)}));return lC(t.add(wF({values:i})))}function XF(e,t,n){var i=n.map((function(e){var n=t.getData(e.data);return n||IF(e.data),n.extentRef(t,e.field)}));return lC(t.add(OF({extents:i})))}function JF(e,t){return e.signal||Object(ie["A"])(e)?BF(e,t):t.objectProperty(e)}function QF(e){return Object(ie["F"])(e)?{interval:PF(e.interval),step:PF(e.step)}:PF(e)}function KF(e,t){t.interpolate=PF(e.type||e),null!=e.gamma&&(t.interpolateGamma=PF(e.gamma))}function e$(e,t,n){var i=e.range,r=t.config.range;if(i.signal)return t.signalRef(i.signal);if(Object(ie["H"])(i)){if(r&&Object(ie["v"])(r,i))return e=Object(ie["o"])({},e,{range:r[i]}),e$(e,t,n);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=Av(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Object(ie["n"])("Unrecognized scale range value: "+Object(ie["Z"])(i))}else{if(i.scheme)return n.scheme=Object(ie["A"])(i.scheme)?BF(i.scheme,t):PF(i.scheme,t),i.extent&&(n.schemeExtent=BF(i.extent,t)),void(i.count&&(n.schemeCount=PF(i.count,t)));if(i.step)return void(n.rangeStep=PF(i.step,t));if(Av(e.type)&&!Object(ie["A"])(i))return UF(i,e,t);Object(ie["A"])(i)||Object(ie["n"])("Unsupported range type: "+Object(ie["Z"])(i))}return i.map(e=>(Object(ie["A"])(e)?BF:PF)(e,t))}var t$=function(e,t){var n=t.config.projection||{},i={};for(var r in e)"name"!==r&&(i[r]=n$(e[r],r,t));for(r in n)null==i[r]&&(i[r]=n$(n[r],r,t));t.addProjection(e.name,i)};function n$(e,t,n){return Object(ie["A"])(e)?e.map((function(e){return n$(e,t,n)})):Object(ie["F"])(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:Object(ie["n"])("Unsupported parameter object: "+Object(ie["Z"])(e)):e}const i$="top",r$="left",a$="right",o$="bottom",s$="center",u$="vertical",c$="start",l$="middle",f$="end",d$="index",h$="label",p$="offset",g$="perc",m$="perc2",v$="size",b$="value",y$="guide-label",x$="guide-title",O$="group-title",w$="group-subtitle",j$="symbol",k$="gradient",_$="discrete",A$=["size","shape","fill","stroke","strokeWidth","strokeDash","opacity"],E$={name:1,style:1,interactive:1},D$={value:0},S$={value:1};var C$=Object(ie["db"])(["rule"]),F$=Object(ie["db"])(["group","image","rect"]),$$=function(e,t){var n="";return C$[t]||(e.x2&&(e.x?(F$[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(F$[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n},M$=function(e,t,n,i){function r(e,r,a,o){var s=U$(null,r,t,n,i),u=U$(null,a,t,n,i),c=U$(null,o,t,n,i);return"this."+e+"("+[s,u,c].join(",")+").toString()"}return e.c?r("hcl",e.h,e.c,e.l):e.h||e.s?r("hsl",e.h,e.s,e.l):e.l||e.a?r("lab",e.l,e.a,e.b):e.r||e.g||e.b?r("rgb",e.r,e.g,e.b):null},N$=function(e,t,n,i){var r=oC(e,t);return r.$fields.forEach((function(e){i[e]=1})),Object(ie["o"])(n,r.$params),r.$expr},R$=function(e,t,n,i){return z$(Object(ie["F"])(e)?e:{datum:e},t,n,i)};function z$(e,t,n,i){var r,a,o;if(e.signal)r="datum",o=N$(e.signal,t,n,i);else if(e.group||e.parent){a=Math.max(1,e.level||1),r="item";while(a-- >0)r+=".mark.group";e.parent?(o=e.parent,r+=".datum"):o=e.group}else e.datum?(r="datum",o=e.datum):Object(ie["n"])("Invalid field reference: "+Object(ie["Z"])(e));return e.signal||(Object(ie["H"])(o)?(i[o]=1,o=Object(ie["Y"])(o).map(ie["Z"]).join("][")):o=z$(o,t,n,i)),r+"["+o+"]"}var T$=function(e,t,n,i){return Object(ie["F"])(e)?"("+U$(null,e,t,n,i)+")":e},L$=function(e,t,n,i,r){var a,o,s,u=B$(e.scale,n,i,r);return null!=e.range?(a=+e.range,o=u+".range()",t=0===a?o+"[0]":"($="+o+","+(1===a?"$[$.length-1]":"$[0]+"+a+"*($[$.length-1]-$[0])")+")"):(void 0!==t&&(t=u+"("+t+")"),e.band&&(s=P$(e.scale,n))&&(o=u+".bandwidth",e.band.signal?a=o+"()*"+T$(e.band,n,i,r):(a=+e.band,a=o+"()"+(1===a?"":"*"+a)),s<0&&(a="("+o+"?"+a+":0)"),t=(t?t+"+":"")+a,e.extra&&(t="(datum.extra?"+u+"(datum.extra.value):"+t+")")),null==t&&(t="0")),t};function P$(e,t){if(!Object(ie["H"])(e))return-1;var n=t.scaleType(e);return"band"===n||"point"===n?1:0}function B$(e,t,n,i){var r;if(Object(ie["H"])(e))r=CD+e,Object(ie["v"])(n,r)||(n[r]=t.scaleRef(e)),r=Object(ie["Z"])(r);else{for(r in t.scales)n[CD+r]=t.scaleRef(r);r=Object(ie["Z"])(CD)+"+"+(e.signal?"("+N$(e.signal,t,n,i)+")":R$(e,t,n,i))}return"_["+r+"]"}var I$=function(e,t,n,i){return"this.gradient("+B$(e.gradient,t,n,i)+","+Object(ie["Z"])(e.start)+","+Object(ie["Z"])(e.stop)+","+Object(ie["Z"])(e.count)+")"},U$=function(e,t,n,i,r){if(null!=t.gradient)return I$(t,n,i,r);var a=t.signal?N$(t.signal,n,i,r):t.color?M$(t.color,n,i,r):null!=t.field?R$(t.field,n,i,r):void 0!==t.value?Object(ie["Z"])(t.value):void 0;return null!=t.scale&&(a=L$(t,a,n,i,r)),void 0===a&&(a=null),null!=t.exponent&&(a="Math.pow("+a+","+T$(t.exponent,n,i,r)+")"),null!=t.mult&&(a+="*"+T$(t.mult,n,i,r)),null!=t.offset&&(a+="+"+T$(t.offset,n,i,r)),t.round&&(a="Math.round("+a+")"),a},q$=function(e,t,n){const i=e+"["+Object(ie["Z"])(t)+"]";return`$=${n};if(${i}!==$)${i}=$,m=1;`},W$=function(e,t,n,i,r){var a="";return t.forEach((function(t){var o=U$(e,t,n,i,r);a+=t.test?N$(t.test,n,i,r)+"?"+o+":":o})),":"===Object(ie["U"])(a)&&(a+="null"),q$("o",e,a)};function H$(e,t,n,i){var r,a,o,s={},u="var o=item,datum=o.datum,m=0,$;";for(r in e)a=e[r],Object(ie["A"])(a)?u+=W$(r,a,i,n,s):(o=U$(r,a,i,n,s),u+=q$("o",r,o));return u+=$$(e,t),u+="return m;",{$expr:u,$fields:Object.keys(s),$output:Object.keys(e)}}var G$="mark",V$="frame",Z$="scope",Y$="axis",X$="axis-domain",J$="axis-grid",Q$="axis-label",K$="axis-tick",eM="axis-title",tM="legend",nM="legend-band",iM="legend-entry",rM="legend-gradient",aM="legend-label",oM="legend-symbol",sM="legend-title",uM="title",cM="title-text",lM="title-subtitle";function fM(e){return Object(ie["F"])(e)&&!Object(ie["A"])(e)?Object(ie["o"])({},e):{value:e}}function dM(e,t,n,i){return null!=n?(Object(ie["F"])(n)&&!Object(ie["A"])(n)?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function hM(e,t,n){for(let i in t)dM(e,i,t[i]);for(let i in n)dM(e,i,n[i],"update")}function pM(e,t,n){for(var i in t)n&&Object(ie["v"])(n,i)||(e[i]=Object(ie["o"])(e[i]||{},t[i]));return e}function gM(e,t,n,i,r,a){var o,s;for(s in a=a||{},a.encoders={$encode:o={}},e=mM(e,t,n,i,r.config),e)o[s]=H$(e[s],t,a,r);return a}function mM(e,t,n,i,r){var a,o,s,u,c={},l={};for(o in"legend"!=n&&0!==String(n).indexOf("axis")||(n=null),u=n===V$?r.group:n===G$?Object(ie["o"])({},r.mark,r[t]):null,u)s=bM(o,e)||("fill"===o||"stroke"===o)&&(bM("fill",e)||bM("stroke",e)),s||vM(c,o,u[o]);for(o in Object(ie["i"])(i).forEach((function(t){var n=r.style&&r.style[t];for(var i in n)bM(i,e)||vM(c,i,n[i])})),e=Object(ie["o"])({},e),c)u=c[o],u.signal?(a=a||{})[o]=u:l[o]=u;return e.enter=Object(ie["o"])(l,e.enter),a&&(e.update=Object(ie["o"])(a,e.update)),e}function vM(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}function bM(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}var yM=function(e,t,n,i,r,a,o){return{type:e,name:o?o.name:void 0,role:t,style:o&&o.style||n,key:i,from:r,interactive:!(!o||!o.interactive),encode:pM(a,o,E$)}};function xM(e,t){const n=(n,i)=>kC(e[n],kC(t[n],i));return n.isVertical=n=>u$===kC(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>kC(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>kC(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>kC(e.columns,kC(t.columns,+n.isVertical(!0))),n}function OM(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function wM(e,t,n){var i=t.config.style[n];return i&&i[e]}function jM(e,t,n){return`item.anchor === "${c$}" ? ${e} : item.anchor === "${f$}" ? ${t} : ${n}`}const kM=jM(Object(ie["Z"])(r$),Object(ie["Z"])(a$),Object(ie["Z"])(s$));function _M(e){let t,n,i=e("tickBand"),r=e("tickOffset");return i?i.signal?(t={signal:`(${i.signal})==='extent'?1:0.5`},n={signal:`(${i.signal})==='extent'?true:false`},Object(ie["F"])(r)||(r={signal:`(${i.signal})==='extent'?0:${r}`})):"extent"===i?(t=1,n=!0,r=0):(t=.5,n=!1):(t=e("bandPosition"),n=e("tickExtra")),{extra:n,band:t,offset:r}}var AM="group",EM="rect",DM="rule",SM="symbol",CM="text",FM=function(e,t,n,i){var r,a,o,s,u,c,l=xM(e,n),f=l.isVertical(),d=l.gradientThickness(),h=l.gradientLength();return f?(o=[0,1],s=[0,0],u=d,c=h):(o=[0,0],s=[1,0],u=h,c=d),r={enter:a={opacity:D$,x:D$,y:D$,width:fM(u),height:fM(c)},update:Object(ie["o"])({},a,{opacity:S$,fill:{gradient:t,start:o,stop:s}}),exit:{opacity:D$}},hM(r,{stroke:l("gradientStrokeColor"),strokeWidth:l("gradientStrokeWidth")},{opacity:l("gradientOpacity")}),yM(EM,rM,null,void 0,void 0,r,i)},$M=function(e,t,n,i,r){var a,o,s,u,c,l,f=xM(e,n),d=f.isVertical(),h=f.gradientThickness(),p=f.gradientLength(),g="";return d?(s="y",c="y2",u="x",l="width",g="1-"):(s="x",c="x2",u="y",l="height"),o={opacity:D$,fill:{scale:t,field:b$}},o[s]={signal:g+"datum."+g$,mult:p},o[u]=D$,o[c]={signal:g+"datum."+m$,mult:p},o[l]=fM(h),a={enter:o,update:Object(ie["o"])({},o,{opacity:S$}),exit:{opacity:D$}},hM(a,{stroke:f("gradientStrokeColor"),strokeWidth:f("gradientStrokeWidth")},{opacity:f("gradientOpacity")}),yM(EM,nM,null,b$,r,a,i)};const MM=`datum.${g$}<=0?"${r$}":datum.${g$}>=1?"${a$}":"${s$}"`,NM=`datum.${g$}<=0?"${o$}":datum.${g$}>=1?"${i$}":"${l$}"`;var RM=function(e,t,n,i){var r,a,o,s,u,c=xM(e,t),l=c.isVertical(),f=fM(c.gradientThickness()),d=c.gradientLength(),h=c("labelOverlap"),p=c("labelSeparation"),g="";return r={enter:a={opacity:D$},update:o={opacity:S$,text:{field:h$}},exit:{opacity:D$}},hM(r,{fill:c("labelColor"),fillOpacity:c("labelOpacity"),font:c("labelFont"),fontSize:c("labelFontSize"),fontStyle:c("labelFontStyle"),fontWeight:c("labelFontWeight"),limit:kC(e.labelLimit,t.gradientLabelLimit)}),l?(a.align={value:"left"},a.baseline=o.baseline={signal:NM},s="y",u="x",g="1-"):(a.align=o.align={signal:MM},a.baseline={value:"top"},s="x",u="y"),a[s]=o[s]={signal:g+"datum."+g$,mult:d},a[u]=o[u]=f,f.offset=kC(e.labelOffset,t.gradientLabelOffset)||0,e=yM(CM,aM,y$,b$,i,r,n),h&&(e.overlap={separation:p,method:h,order:"datum."+d$}),e},zM=function(e,t,n,i,r,a,o,s){return{type:AM,name:n,role:e,style:t,from:i,interactive:r||!1,encode:a,marks:o,layout:s}},TM=function(e,t,n,i,r){var a,o,s,u,c,l,f,d=xM(e,t),h=n.entries,p=!(!h||!h.interactive),g=h?h.name:void 0,m=d("clipHeight"),v=d("symbolOffset"),b={data:"value"},y={},x=`(${r}) ? datum.${p$} : datum.${v$}`,O=m?fM(m):{field:v$},w=`datum.${d$}`,j=`max(1, ${r})`;O.mult=.5,y={enter:a={opacity:D$,x:{signal:x,mult:.5,offset:v},y:O},update:o={opacity:S$,x:a.x,y:a.y},exit:{opacity:D$}};var k=null,_=null;return e.fill||(k=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),hM(y,{fill:d("symbolFillColor",k),shape:d("symbolType"),size:d("symbolSize"),stroke:d("symbolStrokeColor",_),strokeDash:d("symbolDash"),strokeDashOffset:d("symbolDashOffset"),strokeWidth:d("symbolStrokeWidth")},{opacity:d("symbolOpacity")}),A$.forEach((function(t){e[t]&&(o[t]=a[t]={scale:e[t],field:b$})})),u=yM(SM,oM,null,b$,b,y,n.symbols),m&&(u.clip=!0),s=fM(v),s.offset=d("labelOffset"),y={enter:a={opacity:D$,x:{signal:x,offset:s},y:O},update:o={opacity:S$,text:{field:h$},x:a.x,y:a.y},exit:{opacity:D$}},hM(y,{align:d("labelAlign"),baseline:d("labelBaseline"),fill:d("labelColor"),fillOpacity:d("labelOpacity"),font:d("labelFont"),fontSize:d("labelFontSize"),fontStyle:d("labelFontStyle"),fontWeight:d("labelFontWeight"),limit:d("labelLimit")}),c=yM(CM,aM,y$,b$,b,y,n.labels),y={enter:{noBound:{value:!m},width:D$,height:m?fM(m):D$,opacity:D$},exit:{opacity:D$},update:o={opacity:S$,row:{signal:null},column:{signal:null}}},d.isVertical(!0)?(l=`ceil(item.mark.items.length / ${j})`,o.row.signal=`${w}%${l}`,o.column.signal=`floor(${w} / ${l})`,f={field:["row",w]}):(o.row.signal=`floor(${w} / ${j})`,o.column.signal=`${w} % ${j}`,f={field:w}),o.column.signal=`(${r})?${o.column.signal}:${w}`,i={facet:{data:i,name:"value",groupby:d$}},e=zM(Z$,null,g,i,p,pM(y,h,E$),[u,c]),e.sort=f,e};function LM(e,t){const n=xM(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const PM='item.orient === "left"',BM='item.orient === "right"',IM=`(${PM} || ${BM})`,UM=`datum.vgrad && ${IM}`,qM=jM('"top"','"bottom"','"middle"'),WM=jM('"right"','"left"','"center"'),HM=`datum.vgrad && ${BM} ? (${WM}) : (${IM} && !(datum.vgrad && ${PM})) ? "left" : ${kM}`,GM=`item._anchor || (${IM} ? "middle" : "start")`,VM=`${UM} ? (${PM} ? -90 : 90) : 0`,ZM=`${IM} ? (datum.vgrad ? (${BM} ? "bottom" : "top") : ${qM}) : "top"`;var YM=function(e,t,n,i){var r,a=xM(e,t);return r={enter:{opacity:D$},update:{opacity:S$,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:D$}},hM(r,{orient:a("titleOrient"),_anchor:a("titleAnchor"),anchor:{signal:GM},angle:{signal:VM},align:{signal:HM},baseline:{signal:ZM},text:e.title,fill:a("titleColor"),fillOpacity:a("titleOpacity"),font:a("titleFont"),fontSize:a("titleFontSize"),fontStyle:a("titleFontStyle"),fontWeight:a("titleFontWeight"),limit:a("titleLimit"),lineHeight:a("titleLineHeight")},{align:a("titleAlign"),baseline:a("titleBaseline")}),yM(CM,sM,x$,null,i,r,n)},XM=function(e,t){var n;return Object(ie["F"])(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+JM(e.path)+")":e.sphere&&(n="geoShape("+JM(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e};function JM(e){return Object(ie["F"])(e)&&e.signal?e.signal:Object(ie["Z"])(e)}var QM=function(e){var t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===AM?Z$:t||G$:t},KM=function(e){return{marktype:e.type,name:e.name||void 0,role:e.role||QM(e),zindex:+e.zindex||void 0}},eN=function(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e},tN=function(e,t){var n=kn(e.type);n||Object(ie["n"])("Unrecognized transform type: "+Object(ie["Z"])(e.type));var i=uC(n.type.toLowerCase(),null,nN(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i};function nN(e,t,n){var i,r,a,o={};for(r=0,a=e.params.length;r<a;++r)i=e.params[r],o[i.name]=iN(i,t,n);return o}function iN(e,t,n){var i=e.type,r=t[e.name];return"index"===i?aN(e,t,n):void 0!==r?"param"===i?oN(e,t,n):"projection"===i?n.projectionRef(t[e.name]):e.array&&!OC(r)?r.map((function(t){return rN(e,t,n)})):rN(e,r,n):void(e.required&&Object(ie["n"])("Missing required "+Object(ie["Z"])(t.type)+" parameter: "+Object(ie["Z"])(e.name)))}function rN(e,t,n){var i=e.type;if(OC(t))return fN(i)?Object(ie["n"])("Expression references can not be signals."):dN(i)?n.fieldRef(t):hN(i)?n.compareRef(t):n.signalRef(t.signal);var r=e.expr||dN(i);return r&&uN(t)?n.exprRef(t.expr,t.as):r&&cN(t)?fC(t.field,t.as):fN(i)?oC(t,n):lN(i)?lC(n.getData(t).values):dN(i)?fC(t):hN(i)?n.compareRef(t):t}function aN(e,t,n){return Object(ie["H"])(t.from)||Object(ie["n"])('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function oN(e,t,n){var i=t[e.name];return e.array?(Object(ie["A"])(i)||Object(ie["n"])("Expected an array of sub-parameters. Instead: "+Object(ie["Z"])(i)),i.map((function(t){return sN(e,t,n)}))):sN(e,i,n)}function sN(e,t,n){var i,r,a,o,s;for(o=0,s=e.params.length;o<s;++o){for(a in r=e.params[o],r.key)if(r.key[a]!==t[a]){r=null;break}if(r)break}return r||Object(ie["n"])("Unsupported parameter: "+Object(ie["Z"])(t)),i=Object(ie["o"])(nN(r,t,n),r.key),lC(n.add(kF(i)))}function uN(e){return e&&e.expr}function cN(e){return e&&e.field}function lN(e){return"data"===e}function fN(e){return"expr"===e}function dN(e){return"field"===e}function hN(e){return"compare"===e}var pN=function(e,t,n){var i,r,a,o,s;return e?(i=e.facet)&&(t||Object(ie["n"])("Only group marks can be faceted."),null!=i.field?o=s=gN(i,n):(e.data?s=lC(n.getData(e.data).aggregate):(a=tN(Object(ie["o"])({type:"aggregate",groupby:Object(ie["i"])(i.groupby)},i.aggregate),n),a.params.key=n.keyRef(i.groupby),a.params.pulse=gN(i,n),o=s=lC(n.add(a))),r=n.keyRef(i.groupby,!0))):o=lC(n.add(lF(null,[{}]))),o||(o=gN(e,n)),{key:r,pulse:o,parent:s}};function gN(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:lC(t.getData(e.data).output)}function mN(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}mN.fromEntries=function(e,t){var n=t.length,i=1,r=t[0],a=t[n-1],o=t[n-2],s=null;for(r&&"load"===r.type&&(r=t[1]),e.add(t[0]);i<n;++i)t[i].params.pulse=lC(t[i-1]),e.add(t[i]),"aggregate"===t[i].type&&(s=t[i]);return new mN(e,r,o,a,s)};var vN=mN.prototype;function bN(e){return Object(ie["H"])(e)?e:null}function yN(e,t,n){var i,r=bC(n.op,n.field);if(t.ops){for(var a=0,o=t.as.length;a<o;++a)if(t.as[a]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function xN(e,t,n,i,r,a,o){var s,u,c=t[n]||(t[n]={}),l=vC(a),f=bN(r);if(null!=f&&(e=t.scope,f+=l?"|"+l:"",s=c[f]),!s){var d=a?{field:dC,pulse:t.countsRef(e,r,a)}:{field:e.fieldRef(r),pulse:lC(t.output)};l&&(d.sort=e.sortRef(a)),u=e.add(uC(i,void 0,d)),o&&(t.index[r]=u),s=lC(u),null!=f&&(c[f]=s)}return s}vN.countsRef=function(e,t,n){var i,r,a,o=this,s=o.counts||(o.counts={}),u=bN(t);return null!=u&&(e=o.scope,i=s[u]),i?n&&n.field&&yN(e,i.agg.params,n):(a={groupby:e.fieldRef(t,"key"),pulse:lC(o.output)},n&&n.field&&yN(e,a,n),r=e.add(sF(a)),i=e.add(lF({pulse:lC(r)})),i={agg:r,ref:lC(i)},null!=u&&(s[u]=i)),i.ref},vN.tuplesRef=function(){return lC(this.values)},vN.extentRef=function(e,t){return xN(e,this,"extent","extent",t,!1)},vN.domainRef=function(e,t){return xN(e,this,"domain","values",t,!1)},vN.valuesRef=function(e,t,n){return xN(e,this,"vals","values",t,n||!0)},vN.lookupRef=function(e,t){return xN(e,this,"lookup","tupleindex",t,!1)},vN.indataRef=function(e,t){return xN(e,this,"indata","tupleindex",t,!0,!0)};var ON=function(e,t,n){var i,r,a,o,s=e.from.facet,u=s.name,c=gN(s,t);s.name||Object(ie["n"])("Facet must have a name: "+Object(ie["Z"])(s)),s.data||Object(ie["n"])("Facet must reference a data set: "+Object(ie["Z"])(s)),s.field?o=t.add(_F({field:t.fieldRef(s.field),pulse:c})):s.groupby?o=t.add(gF({key:t.keyRef(s.groupby),group:lC(t.proxy(n.parent)),pulse:c})):Object(ie["n"])("Facet must specify groupby or field: "+Object(ie["Z"])(s)),i=t.fork(),r=i.add(lF()),a=i.add(FF({pulse:lC(r)})),i.addData(u,new mN(i,r,r,a)),i.addSignal("parent",null),o.params.subflow={$subflow:KN(e,i).toRuntime()}},wN=function(e,t,n){var i=t.add(_F({pulse:n.pulse})),r=t.fork();r.add(FF()),r.addSignal("parent",null),i.params.subflow={$subflow:KN(e,r).toRuntime()}},jN=function(e,t,n){var i,r,a=e.remove,o=e.insert,s=e.toggle,u=e.modify,c=e.values,l=t.add(cC());i="if("+e.trigger+',modify("'+n+'",'+[o,a,s,u,c].map((function(e){return null==e?"null":e})).join(",")+"),0)",r=oC(i,t),l.update=r.$expr,l.params=r.$params},kN=function(e,t){var n,i,r,a,o,s,u,c,l,f,d,h,p,g,m=QM(e),v=e.type===AM,b=e.from&&e.from.facet,y=e.layout||m===Z$||m===V$,x=m===G$||y||b,O=e.overlap;r=pN(e.from,v,t),i=t.add(dF({key:r.key||(e.key?fC(e.key):void 0),pulse:r.pulse,clean:!v})),f=lC(i),i=a=t.add(lF({pulse:f})),i=t.add(xF({markdef:KM(e),interactive:eN(e.interactive,t),clip:XM(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:lC(i)})),d=lC(i),i=o=t.add(hF(gM(e.encode,e.type,m,e.style,t,{mod:!1,pulse:d}))),i.params.parent=t.encode(),e.transform&&e.transform.forEach((function(e){const n=tN(e,t),r=n.metadata;(r.generates||r.changes)&&Object(ie["n"])("Mark transforms should not generate new data."),r.nomod||(o.params.mod=!0),n.params.pulse=lC(i),t.add(i=n)})),e.sort&&(i=t.add($F({sort:t.compareRef(e.sort),pulse:lC(i)}))),h=lC(i),(b||y)&&(y=t.add(MF({layout:t.objectProperty(e.layout),legends:t.legends,mark:d,pulse:h})),p=lC(y)),s=t.add(cF({mark:d,pulse:p||h})),g=lC(s),v&&(x&&(n=t.operators,n.pop(),y&&n.pop()),t.pushState(h,p||g,f),b?ON(e,t,r):x?wN(e,t,r):KN(e,t),t.popState(),x&&(y&&n.push(y),n.push(s))),O&&(g=_N(O,g,t)),u=t.add(SF({pulse:g})),c=t.add(FF({pulse:lC(u)},void 0,t.parent())),null!=e.name&&(l=e.name,t.addData(l,new mN(t,a,u,c)),e.on&&e.on.forEach((function(e){(e.insert||e.remove||e.toggle)&&Object(ie["n"])("Marks only support modify triggers."),jN(e,t,l)})))};function _N(e,t,n){var i,r=e.method,a=e.bound,o=e.separation,s={separation:OC(o)?n.signalRef(o.signal):o,method:OC(r)?n.signalRef(r.signal):r,pulse:t};return e.order&&(s.sort=n.compareRef({field:e.order})),a&&(i=a.tolerance,s.boundTolerance=OC(i)?n.signalRef(i.signal):+i,s.boundScale=n.scaleRef(a.scale),s.boundOrient=a.orient),lC(n.add(jF(s)))}var AN=function(e,t){var n,i,r,a,o,s,u,c,l,f=t.config.legend,d=e.encode||{},h=d.legend||{},p=h.name||void 0,g=h.interactive,m=h.style,v=xM(e,f),b=A$.reduce((function(t,n){return t||e[n]}),0);return b||Object(ie["n"])("Missing valid scale for legend."),o=EN(e,t.scaleType(b)),s={title:null!=e.title,type:o,vgrad:"symbol"!==o&&v.isVertical()},u=lC(t.add(lF(null,[s]))),h=pM(SN(v,f),h,E$),n={enter:{x:{value:0},y:{value:0}}},c=lC(t.add(bF(r={type:o,scale:t.scaleRef(b),count:t.objectProperty(v("tickCount")),limit:t.property(v("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),o===k$?(a=[FM(e,b,f,d.gradient),RM(e,f,d.labels,c)],r.count=r.count||t.signalRef(`max(2,2*floor((${_C(v.gradientLength())})/100))`)):o===_$?a=[$M(e,b,f,d.gradient,c),RM(e,f,d.labels,c)]:(i=LM(e,f),a=[TM(e,f,d,c,_C(i.columns))],r.size=CN(e,t,a[0].marks)),a=[zM(iM,null,null,u,g,n,a,i)],s.title&&a.push(YM(e,f,d.title,u)),l=zM(tM,m,p,u,g,h,a),e.zindex&&(l.zindex=e.zindex),kN(l,t)};function EN(e,t){var n=e.type||j$;return e.type||1!==DN(e)||!e.fill&&!e.stroke||(n=_v(t)?k$:Ev(t)?_$:j$),n!==k$?n:Ev(t)?_$:k$}function DN(e){return A$.reduce((function(t,n){return t+(e[n]?1:0)}),0)}function SN(e,t){var n={enter:{},update:{}};return hM(n,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:t.strokeWidth,strokeDash:t.strokeDash,x:e("legendX"),y:e("legendY")}),n}function CN(e,t,n){var i=_C(FN("size",e,n)),r=_C(FN("strokeWidth",e,n)),a=_C($N(n[1].encode,t,y$));return oC(`max(ceil(sqrt(${i})+${r}),${a})`,t)}function FN(e,t,n){return t[e]?`scale("${t[e]}",datum)`:OM(e,n[0].encode)}function $N(e,t,n){return OM("fontSize",e)||wM("fontSize",t,n)}const MN=`item.orient==="${r$}"?-90:item.orient==="${a$}"?90:0`;var NN=function(e,t){e=Object(ie["H"])(e)?{text:e}:e;var n,i,r=xM(e,t.config.title),a=e.encode||{},o=a.group||{},s=o.name||void 0,u=o.interactive,c=o.style,l=[];return n=lC(t.add(lF(null,[{}]))),l.push(TN(e,r,RN(e),n)),e.subtitle&&l.push(LN(e,r,a.subtitle,n)),i=zM(uM,c,s,n,u,zN(r,o),l),e.zindex&&(i.zindex=e.zindex),kN(i,t)};function RN(e){const t=e.encode;return t&&t.title||Object(ie["o"])({name:e.name,interactive:e.interactive,style:e.style},t)}function zN(e,t){var n={enter:{},update:{}};return hM(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:kM},angle:{signal:MN},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),pM(n,t,E$)}function TN(e,t,n,i){var r={value:0},a=e.text,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return hM(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),yM(CM,cM,O$,null,i,o,n)}function LN(e,t,n,i){var r={value:0},a=e.subtitle,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return hM(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),yM(CM,lM,w$,null,i,o,n)}function PN(e,t){var n=[];e.transform&&e.transform.forEach((function(e){n.push(tN(e,t))})),e.on&&e.on.forEach((function(n){jN(n,t,e.name)})),t.addDataPipeline(e.name,BN(e,t,n))}function BN(e,t,n){var i,r,a,o,s,u=[],c=null,l=!1,f=!1;for(e.values?jC(e.values)||jC(e.format)?(u.push(UN(t,e)),u.push(c=IN())):u.push(c=IN({$ingest:e.values,$format:e.format})):e.url?jC(e.url)||jC(e.format)?(u.push(UN(t,e)),u.push(c=IN())):u.push(c=IN({$request:e.url,$format:e.format})):e.source&&(c=i=Object(ie["i"])(e.source).map((function(e){return lC(t.getData(e).output)})),u.push(null)),r=0,a=n.length;r<a;++r)o=n[r],s=o.metadata,c||s.source||u.push(c=IN()),u.push(o),s.generates&&(f=!0),s.modifies&&!f&&(l=!0),s.source?c=o:s.changes&&(c=null);return i&&(a=i.length-1,u[0]=DF({derive:l,pulse:a?i:i[0]}),(l||a)&&u.splice(1,0,IN())),c||u.push(IN()),u.push(FF({})),u}function IN(e){var t=lF({},e);return t.metadata={source:!0},t}function UN(e,t){return yF({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}var qN=function(e,t){var n=t.config,i=e.orient,r=i===i$||i===o$?n.axisX:n.axisY,a=n["axis"+i[0].toUpperCase()+i.slice(1)],o="band"===t.scaleType(e.scale)&&n.axisBand;return r||a||o?Object(ie["o"])({},n.axis,r,a,o):n.axis},WN=function(e,t,n,i){var r,a,o,s,u,c,l=xM(e,t),f=e.orient;return r={enter:a={opacity:D$},update:o={opacity:S$},exit:{opacity:D$}},hM(r,{stroke:l("domainColor"),strokeDash:l("domainDash"),strokeDashOffset:l("domainDashOffset"),strokeWidth:l("domainWidth"),strokeOpacity:l("domainOpacity")}),f===i$||f===o$?(s="x",c="y"):(s="y",c="x"),u=s+"2",a[c]=D$,o[s]=a[s]=HN(e,0),o[u]=a[u]=HN(e,1),yM(DM,X$,null,null,i,r,n)};function HN(e,t){return{scale:e.scale,range:t}}var GN=function(e,t,n,i,r){var a,o,s,u,c,l,f,d,h,p=xM(e,t),g=e.orient,m=e.gridScale,v=g===r$||g===i$?1:-1,b=VN(e.offset,v);return a={enter:o={opacity:D$},update:u={opacity:S$},exit:s={opacity:D$}},hM(a,{stroke:p("gridColor"),strokeDash:p("gridDash"),strokeDashOffset:p("gridDashOffset"),strokeOpacity:p("gridOpacity"),strokeWidth:p("gridWidth")}),c={scale:e.scale,field:b$,band:r.band,extra:r.extra,offset:r.offset,round:p("tickRound")},g===i$||g===o$?(l="x",f="y",h="height"):(l="y",f="x",h="width"),d=f+"2",u[l]=o[l]=s[l]=c,m?(u[f]=o[f]={scale:m,range:0,mult:v,offset:b},u[d]=o[d]={scale:m,range:1,mult:v,offset:b}):(u[f]=o[f]={value:0,offset:b},u[d]=o[d]={signal:h,mult:v,offset:b}),yM(DM,J$,null,b$,i,a,n)};function VN(e,t){if(1===t);else if(Object(ie["F"])(e)){var n=e=Object(ie["o"])({},e);while(null!=n.mult){if(!Object(ie["F"])(n.mult))return n.mult*=t,e;n=n.mult=Object(ie["o"])({},n.mult)}n.mult=t}else e=t*(e||0);return e}var ZN=function(e,t,n,i,r,a){var o,s,u,c,l,f,d=xM(e,t),h=e.orient,p=h===r$||h===i$?-1:1;return o={enter:s={opacity:D$},update:c={opacity:S$},exit:u={opacity:D$}},hM(o,{stroke:d("tickColor"),strokeDash:d("tickDash"),strokeDashOffset:d("tickDashOffset"),strokeOpacity:d("tickOpacity"),strokeWidth:d("tickWidth")}),l=fM(r),l.mult=p,f={scale:e.scale,field:b$,band:a.band,extra:a.extra,offset:a.offset,round:d("tickRound")},h===i$||h===o$?(c.y=s.y=D$,c.y2=s.y2=l,c.x=s.x=u.x=f):(c.x=s.x=D$,c.x2=s.x2=l,c.y=s.y=u.y=f),yM(DM,K$,null,b$,i,o,n)};function YN(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}var XN=function(e,t,n,i,r,a){var o,s,u,c,l,f,d,h,p,g,m=xM(e,t),v=e.orient,b=v===r$||v===i$?-1:1,y=v===i$||v===o$,x=e.scale,O=_C(m("labelFlush")),w=_C(m("labelFlushOffset")),j=0===O||!!O,k=m("labelAlign"),_=m("labelBaseline");return u=fM(r),u.mult=b,u.offset=fM(m("labelPadding")||0),u.offset.mult=b,c={scale:x,field:b$,band:.5,offset:a.offset},y?(l=k||(j?YN(x,O,'"left"','"right"','"center"'):"center"),f=_||(v===i$?"bottom":"top"),d=!k):(l=k||(v===a$?"left":"right"),f=_||(j?YN(x,O,'"top"','"bottom"','"middle"'):"middle"),d=!_),d=d&&j&&w?YN(x,O,"-("+w+")",w,0):null,o={enter:s={opacity:D$,x:y?c:u,y:y?u:c},update:{opacity:S$,text:{field:h$},x:s.x,y:s.y},exit:{opacity:D$,x:s.x,y:s.y}},hM(o,{[y?"dx":"dy"]:d,align:l,baseline:f,angle:m("labelAngle"),fill:m("labelColor"),fillOpacity:m("labelOpacity"),font:m("labelFont"),fontSize:m("labelFontSize"),fontWeight:m("labelFontWeight"),fontStyle:m("labelFontStyle"),limit:m("labelLimit")}),h=m("labelBound"),p=m("labelOverlap"),g=m("labelSeparation"),e=yM(CM,Q$,y$,b$,i,o,n),(p||h)&&(e.overlap={separation:g,method:p,order:"datum.index",bound:h?{scale:x,orient:v,tolerance:h}:null}),e},JN=function(e,t,n,i){var r,a,o,s,u=xM(e,t),c=e.orient,l=c===r$||c===i$?-1:1,f=c===i$||c===o$;return r={enter:a={opacity:D$,anchor:fM(u("titleAnchor")),align:{signal:kM}},update:o=Object(ie["o"])({},a,{opacity:S$,text:fM(e.title)}),exit:{opacity:D$}},s={signal:`lerp(range("${e.scale}"), ${jM(0,1,.5)})`},f?(o.x=s,a.angle={value:0},a.baseline={value:c===i$?"bottom":"top"}):(o.y=s,a.angle={value:90*l},a.baseline={value:"bottom"}),hM(r,{angle:u("titleAngle"),baseline:u("titleBaseline"),fill:u("titleColor"),fillOpacity:u("titleOpacity"),font:u("titleFont"),fontSize:u("titleFontSize"),fontStyle:u("titleFontStyle"),fontWeight:u("titleFontWeight"),limit:u("titleLimit"),lineHeight:u("titleLineHeight")},{align:u("titleAlign")}),!dM(r,"x",u("titleX"),"update")&&!f&&!bM("x",n)&&(r.enter.auto={value:!0}),!dM(r,"y",u("titleY"),"update")&&f&&!bM("y",n)&&(r.enter.auto={value:!0}),yM(CM,eM,x$,null,i,r,n)},QN=function(e,t){var n,i,r,a,o,s,u=qN(e,t),c=e.encode||{},l=c.axis||{},f=l.name||void 0,d=l.interactive,h=l.style,p=xM(e,u),g=_M(p);return n={orient:e.orient,ticks:!!p("ticks"),labels:!!p("labels"),grid:!!p("grid"),domain:!!p("domain"),title:null!=e.title,translate:p("translate")},i=lC(t.add(lF({},[n]))),l=pM({update:{offset:fM(p("offset")||0),position:fM(kC(e.position,0)),titlePadding:fM(p("titlePadding")),minExtent:fM(p("minExtent")),maxExtent:fM(p("maxExtent")),range:{signal:`abs(span(range("${e.scale}")))`}}},c.axis,E$),r=lC(t.add(uF({scale:t.scaleRef(e.scale),extra:t.property(g.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),s=[],n.grid&&s.push(GN(e,u,c.grid,r,g)),n.ticks&&(a=p("tickSize"),s.push(ZN(e,u,c.ticks,r,a,g))),n.labels&&(a=n.ticks?a:0,s.push(XN(e,u,c.labels,r,a,g))),n.domain&&s.push(WN(e,u,c.domain,i)),n.title&&s.push(JN(e,u,c.title,i)),o=zM(Y$,h,f,i,d,l,s),e.zindex&&(o.zindex=e.zindex),kN(o,t)},KN=function(e,t,n){var i=Object(ie["i"])(e.signals),r=Object(ie["i"])(e.scales);return n||i.forEach(e=>aC(e,t)),Object(ie["i"])(e.projections).forEach(e=>t$(e,t)),r.forEach(e=>TF(e,t)),Object(ie["i"])(e.data).forEach(e=>PN(e,t)),r.forEach(e=>LF(e,t)),(n||i).forEach(e=>aF(e,t)),Object(ie["i"])(e.axes).forEach(e=>QN(e,t)),Object(ie["i"])(e.marks).forEach(e=>kN(e,t)),Object(ie["i"])(e.legends).forEach(e=>AN(e,t)),e.title&&NN(e.title,t),t.parseLambdas(),t},eR=Object(ie["db"])(["width","height","padding","autosize"]);function tR(e,t){var n,i,r,a,o,s,u=t.config;return t.background=e.background||u.background,t.eventConfig=u.events,o=lC(t.root=t.add(cC())),t.addSignal("width",e.width||0),t.addSignal("height",e.height||0),t.addSignal("padding",KS(e.padding,u)),t.addSignal("autosize",QS(e.autosize,u)),t.legends=t.objectProperty(u.legend&&u.legend.layout),s=nR(t,e.signals,u.signals),i=t.add(lF()),r=pM({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e.encode),r=t.add(hF(gM(r,AM,V$,e.style,t,{pulse:lC(i)}))),a=t.add(MF({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:o,pulse:lC(r)})),t.operators.pop(),t.pushState(lC(r),lC(a),null),KN(e,t,s),t.operators.push(a),n=t.add(cF({mark:o,pulse:lC(a)})),n=t.add(SF({pulse:lC(n)})),n=t.add(FF({pulse:lC(n)})),t.addData("root",new mN(t,i,i,n)),t}function nR(e,t,n){if(Object(ie["i"])(t).forEach(t=>{eR[t.name]||aC(t,e)}),!n)return t;const i=Object(ie["i"])(t).slice();return Object(ie["i"])(n).forEach(t=>{e.hasOwnSignal(t.name)||(aC(t,e),i.push(t))}),i}function iR(e){this.config=e,this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.background=null,this.eventConfig=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function rR(e){this.config=e.config,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}var aR=iR.prototype=rR.prototype;function oR(e){return(Object(ie["A"])(e)?sR:uR)(e)}function sR(e){for(var t,n="[",i=0,r=e.length;i<r;++i)t=e[i],n+=(i>0?",":"")+(Object(ie["F"])(t)?t.signal||oR(t):Object(ie["Z"])(t));return n+"]"}function uR(e){var t,n,i="{",r=0;for(t in e)n=e[t],i+=(++r>1?",":"")+Object(ie["Z"])(t)+":"+(Object(ie["F"])(n)?n.signal||oR(n):Object(ie["Z"])(n));return i+"}"}aR.fork=function(){return new rR(this)},aR.isSubscope=function(){return this._subid>0},aR.toRuntime=function(){return this.finish(),{background:this.background,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig}},aR.id=function(){return(this._subid?this._subid+":":0)+this._id++},aR.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((function(t){t.$ref=e.id})),e.refs=null),e},aR.proxy=function(e){var t=e instanceof sC?lC(e):e;return this.add(EF({value:t}))},aR.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},aR.addUpdate=function(e){return this.updates.push(e),e},aR.finish=function(){var e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){var i,r;e&&(i=e.data||(e.data={}),r=i[t]||(i[t]=[]),r.push(n))}for(e in this.data)for(var i in t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values"),t.index)n(t.index[i],e,"index:"+i);return this},aR.pushState=function(e,t,n){this._encode.push(lC(this.add(FF({pulse:e})))),this._parent.push(t),this._lookup.push(n?lC(this.proxy(n)):null),this._markpath.push(-1)},aR.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},aR.parent=function(){return Object(ie["U"])(this._parent)},aR.encode=function(){return Object(ie["U"])(this._encode)},aR.lookup=function(){return Object(ie["U"])(this._lookup)},aR.markpath=function(){var e=this._markpath;return++e[e.length-1]},aR.fieldRef=function(e,t){if(Object(ie["H"])(e))return fC(e,t);e.signal||Object(ie["n"])("Unsupported field reference: "+Object(ie["Z"])(e));var n,i=e.signal,r=this.field[i];return r||(n={name:this.signalRef(i)},t&&(n.as=t),this.field[i]=r=lC(this.add(mF(n)))),r},aR.compareRef=function(e){function t(e){return OC(e)?(i=!0,n.signalRef(e.signal)):wC(e)?(i=!0,n.exprRef(e.expr)):e}var n=this,i=!1,r=Object(ie["i"])(e.field).map(t),a=Object(ie["i"])(e.order).map(t);return i?lC(this.add(fF({fields:r,orders:a}))):hC(r,a)},aR.keyRef=function(e,t){function n(e){return OC(e)?(r=!0,lC(i[e.signal])):e}var i=this.signals,r=!1;return e=Object(ie["i"])(e).map(n),r?lC(this.add(vF({fields:e,flat:t}))):pC(e,t)},aR.sortRef=function(e){if(!e)return e;var t=bC(e.op,e.field),n=e.order||gC;return n.signal?lC(this.add(fF({fields:t,orders:this.signalRef(n.signal)}))):hC(t,n)},aR.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},aR.hasOwnSignal=function(e){return Object(ie["v"])(this.signals,e)},aR.addSignal=function(e,t){this.hasOwnSignal(e)&&Object(ie["n"])("Duplicate signal name: "+Object(ie["Z"])(e));var n=t instanceof sC?t:this.add(cC(t));return this.signals[e]=n},aR.getSignal=function(e){return this.signals[e]||Object(ie["n"])("Unrecognized signal name: "+Object(ie["Z"])(e)),this.signals[e]},aR.signalRef=function(e){return this.signals[e]?lC(this.signals[e]):(Object(ie["v"])(this.lambdas,e)||(this.lambdas[e]=this.add(cC(null))),lC(this.lambdas[e]))},aR.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var i=e[t],r=oC(i,this),a=this.lambdas[i];a.params=r.$params,a.update=r.$expr}},aR.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},aR.objectProperty=function(e){return e&&Object(ie["F"])(e)?this.signalRef(e.signal||oR(e)):e},aR.exprRef=function(e,t){var n={expr:oC(e,this)};return t&&(n.expr.$name=t),lC(this.add(pF(n)))},aR.addBinding=function(e,t){this.bindings||Object(ie["n"])("Nested signals do not support binding: "+Object(ie["Z"])(e)),this.bindings.push(Object(ie["o"])({signal:e},t))},aR.addScaleProj=function(e,t){Object(ie["v"])(this.scales,e)&&Object(ie["n"])("Duplicate scale or projection name: "+Object(ie["Z"])(e)),this.scales[e]=this.add(t)},aR.addScale=function(e,t){this.addScaleProj(e,CF(t))},aR.addProjection=function(e,t){this.addScaleProj(e,AF(t))},aR.getScale=function(e){return this.scales[e]||Object(ie["n"])("Unrecognized scale name: "+Object(ie["Z"])(e)),this.scales[e]},aR.projectionRef=aR.scaleRef=function(e){return lC(this.getScale(e))},aR.projectionType=aR.scaleType=function(e){return this.getScale(e).params.type},aR.addData=function(e,t){return Object(ie["v"])(this.data,e)&&Object(ie["n"])("Duplicate data set name: "+Object(ie["Z"])(e)),this.data[e]=t},aR.getData=function(e){return this.data[e]||Object(ie["n"])("Undefined data set name: "+Object(ie["Z"])(e)),this.data[e]},aR.addDataPipeline=function(e,t){return Object(ie["v"])(this.data,e)&&Object(ie["n"])("Duplicate data set name: "+Object(ie["Z"])(e)),this.addData(e,mN.fromEntries(this,t))};var cR="sans-serif",lR=30,fR=2,dR="#4c78a8",hR="#000",pR="#888",gR="#ddd",mR=function(){return{padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:dR},area:{fill:dR},image:null,line:{stroke:dR,strokeWidth:fR},path:{stroke:dR},rect:{fill:dR},rule:{stroke:hR},shape:{stroke:dR},symbol:{fill:dR,size:64},text:{fill:hR,font:cR,fontSize:11},style:{"guide-label":{fill:hR,font:cR,fontSize:10},"guide-title":{fill:hR,font:cR,fontSize:11,fontWeight:"bold"},"group-title":{fill:hR,font:cR,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:hR,font:cR,fontSize:12},point:{size:lR,strokeWidth:fR,shape:"circle"},circle:{size:lR,strokeWidth:fR},square:{size:lR,strokeWidth:fR,shape:"square"},cell:{fill:"transparent",stroke:gR}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:pR,grid:!1,gridWidth:1,gridColor:gR,labels:!0,labelAngle:0,labelLimit:180,labelPadding:2,ticks:!0,tickColor:pR,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:gR,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:pR,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}},vR=function(e,t){return Object(ie["F"])(e)||Object(ie["n"])("Input Vega specification must be an object."),t=Object(ie["N"])(mR(),t,e.config),tR(e,new iR(t)).toRuntime()};Object(ie["o"])(jn,a,o,s,u,c,l,f,d,h,p);var bR=n("a87b");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function yR(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var xR=n("2410"),OR=n.n(xR),wR=n("694b"),jR=n.n(wR),kR=n("f71e"),_R=n.n(kR);function AR(e){return!!e.or}function ER(e){return!!e.and}function DR(e){return!!e.not}function SR(e,t){if(DR(e))SR(e.not,t);else if(ER(e))for(const n of e.and)SR(n,t);else if(AR(e))for(const n of e.or)SR(n,t);else t(e)}function CR(e,t){return DR(e)?{not:CR(e.not,t)}:ER(e)?{and:e.and.map(e=>CR(e,t))}:AR(e)?{or:e.or.map(e=>CR(e,t))}:t(e)}const FR=jR.a,$R=OR.a;function MR(e,t){const n={};for(const i of t)Object(ie["v"])(e,i)&&(n[i]=e[i]);return n}function NR(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype["toJSON"]=function(){return`Set(${[...this].map(e=>_R()(e)).join(",")})`};const RR=_R.a;function zR(e){if(Object(ie["E"])(e))return e;const t=Object(ie["H"])(e)?e:_R()(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const e=t.charCodeAt(i);n=(n<<5)-n+e,n&=n}return n}function TR(e){return!1===e||null===e}function LR(e,t){return e.indexOf(t)>-1}function PR(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function BR(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function IR(e,...t){for(const n of t)UR(e,null!==n&&void 0!==n?n:{});return e}function UR(e,t){for(const n of Object.keys(t))Object(ie["jb"])(e,n,t[n],!0)}function qR(e,t){const n=[],i={};let r;for(const a of e)r=t(a),r in i||(i[r]=1,n.push(a));return n}function WR(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function HR(e,t){for(const n of e)if(t.has(n))return!0;return!1}function GR(e){const t=new Set;for(const n of e){const e=Object(ie["Y"])(n),i=e.map((e,t)=>0===t?e:`[${e}]`),r=i.map((e,t)=>i.slice(0,t+1).join(""));r.forEach(e=>t.add(e))}return t}function VR(e,t){return void 0===e||void 0===t||HR(GR(e),GR(t))}const ZR=Object.keys,YR=Object.values;function XR(e){return!0===e||!1===e}function JR(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function QR(e,t){return DR(e)?"!("+QR(e.not,t)+")":ER(e)?"("+e.and.map(e=>QR(e,t)).join(") && (")+")":AR(e)?"("+e.or.map(e=>QR(e,t)).join(") || (")+")":t(e)}function KR(e,t){if(0===t.length)return!0;const n=t.shift();return KR(e[n],t)&&delete e[n],0===ZR(e).length}function ez(e){return e.charAt(0).toUpperCase()+e.substr(1)}function tz(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function nz(e,t="datum"){const n=Object(ie["Y"])(e),i=[];for(let r=1;r<=n.length;r++){const e=`[${n.slice(0,r).map(ie["Z"]).join("][")}]`;i.push(`${t}${e}`)}return i.join(" && ")}function iz(e,t="datum"){return`${t}[${Object(ie["Z"])(Object(ie["Y"])(e).join("."))}]`}function rz(e){return`${Object(ie["Y"])(e).map(tz).join("\\.")}`}function az(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function oz(e){return`${Object(ie["Y"])(e).join(".")}`}function sz(e){return e?Object(ie["Y"])(e).length:0}function uz(...e){for(const t of e)if(void 0!==t)return t}let cz=42;function lz(e){const t=++cz;return e?String(e)+t:t}function fz(e){return dz(e)?e:`__${e}`}function dz(e){return 0===e.indexOf("__")}function hz(e){return(e%360+360)%360}function pz(e){return!!Object(ie["E"])(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const gz={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function mz(e){return e&&e["condition"]}const vz=["domain","grid","labels","ticks","title"],bz={grid:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",domain:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},yz={orient:1,bandPosition:1,domain:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,values:1,translate:1,zindex:1},xz=Object.assign(Object.assign({},yz),{style:1,labelExpr:1,labelOffset:1,encoding:1});function Oz(e){return!!xz[e]}ZR(xz);const wz="area",jz="bar",kz="image",_z="line",Az="point",Ez="rect",Dz="rule",Sz="text",Cz="tick",Fz="trail",$z="circle",Mz="square",Nz="geoshape",Rz={area:1,bar:1,image:1,line:1,point:1,text:1,tick:1,trail:1,rect:1,geoshape:1,rule:1,circle:1,square:1};function zz(e){return LR(["line","area","trail"],e)}function Tz(e){return LR(["rect","bar","image"],e)}const Lz=ZR(Rz);function Pz(e){return e["type"]}Object(ie["db"])(Lz);const Bz=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Iz=["fill","fillOpacity"],Uz=[...Bz,...Iz],qz=["filled","color","tooltip","invalid","timeUnitBandPosition","timeUnitBand"],Wz={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},Hz={color:"#4c78a8",invalid:"filter",timeUnitBand:1},Gz={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Vz=5,Zz={binSpacing:1,continuousBandSize:Vz,timeUnitBandPosition:.5},Yz={binSpacing:0,continuousBandSize:Vz,timeUnitBandPosition:.5},Xz={thickness:1};function Jz(e){return Pz(e)?e.type:e}function Qz(e){return!!e["mark"]}class Kz{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!Qz(e)&&Jz(e.mark)===this.name}}const eT={argmax:1,argmin:1,average:1,count:1,distinct:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},tT={count:1,min:1,max:1};function nT(e){return!!e&&!!e["argmin"]}function iT(e){return!!e&&!!e["argmax"]}ZR(eT);function rT(e){return Object(ie["H"])(e)&&!!eT[e]}const aT=["count","valid","missing","distinct"];function oT(e){return Object(ie["H"])(e)&&LR(aT,e)}function sT(e){return Object(ie["H"])(e)&&LR(["min","max"],e)}const uT=["count","sum","distinct","valid","missing"],cT=["mean","average","median","q1","q3","min","max"],lT=Object(ie["db"])(cT),fT="row",dT="column",hT="facet",pT="x",gT="y",mT="x2",vT="y2",bT="latitude",yT="longitude",xT="latitude2",OT="longitude2",wT="color",jT="fill",kT="stroke",_T="shape",AT="size",ET="opacity",DT="fillOpacity",ST="strokeOpacity",CT="strokeWidth",FT="strokeDash",$T="text",MT="order",NT="detail",RT="key",zT="tooltip",TT="href",LT="url",PT={x:1,y:1,x2:1,y2:1};function BT(e){switch(e){case bT:return"y";case xT:return"y2";case yT:return"x";case OT:return"x2"}}const IT={longitude:1,longitude2:1,latitude:1,latitude2:1};function UT(e){return e in IT}const qT=ZR(IT),WT=Object.assign(Object.assign(Object.assign({},PT),IT),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1});function HT(e){return"color"===e||"fill"===e||"stroke"===e}const GT={row:1,column:1,facet:1},VT=ZR(GT),ZT=Object.assign(Object.assign({},WT),GT),YT=ZR(ZT),{order:XT,detail:JT,tooltip:QT}=ZT,KT=yR(ZT,["order","detail","tooltip"]),{row:eL,column:tL,facet:nL}=KT,iL=yR(KT,["row","column","facet"]);ZR(KT),ZR(iL);function rL(e){return!!iL[e]}function aL(e){return!!ZT[e]}const oL=["x2","y2","latitude2","longitude2"];function sL(e){const t=uL(e);return t!==e}function uL(e){switch(e){case"x2":return"x";case"y2":return"y";case"latitude2":return"latitude";case"longitude2":return"longitude"}return e}function cL(e){switch(e){case"x":return"x2";case"y":return"y2";case"latitude":return"latitude2";case"longitude":return"longitude2"}}ZR(WT);const{x:lL,y:fL,x2:dL,y2:hL,latitude:pL,longitude:gL,latitude2:mL,longitude2:vL}=WT,bL=yR(WT,["x","y","x2","y2","latitude","longitude","latitude2","longitude2"]),yL=ZR(bL),xL={x:1,y:1},OL=ZR(xL);function wL(e){return"x"===e?"width":"height"}function jL(e){return"width"===e?"x":"y"}const{text:kL,tooltip:_L,href:AL,url:EL,detail:DL,key:SL,order:CL}=bL,FL=yR(bL,["text","tooltip","href","url","detail","key","order"]),$L=ZR(FL);function ML(e){return!!bL[e]}function NL(e){switch(e){case wT:case jT:case kT:case AT:case _T:case ET:case CT:case FT:return!0;case DT:case ST:return!1}}const RL=Object.assign(Object.assign({},xL),FL),zL=ZR(RL);function TL(e){return!!RL[e]}function LL(e,t){return UL(e)[t]}const PL={area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:BL}=PL,IL=yR(PL,["geoshape"]);function UL(e){switch(e){case wT:case jT:case kT:case NT:case RT:case zT:case TT:case MT:case ET:case DT:case ST:case CT:case hT:case fT:case dT:return PL;case pT:case gT:case bT:case yT:return IL;case mT:case vT:case xT:case OT:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case AT:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case FT:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case _T:return{point:"always",geoshape:"always"};case $T:return{text:"always"};case LT:return{image:"always"}}}function qL(e){switch(e){case pT:case gT:case AT:case CT:case ET:case DT:case ST:case mT:case vT:return;case hT:case fT:case dT:case _T:case FT:case $T:case zT:case TT:case LT:return"discrete";case wT:case jT:case kT:return"flexible";case bT:case yT:case xT:case OT:case NT:case RT:case MT:return}}function WL(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const HL='Autosize "fit" only works for single views and layered views.';function GL(e){const t="width"==e?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function VL(e){const t="width"==e?"Width":"Height";return`${t} "container" only works well with autosize "fit" or "fit-x".`}function ZL(e){return e?`Dropping "fit-${e}" because spec has discrete ${wL(e)}.`:'Dropping "fit" because spec has discrete size.'}function YL(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function XL(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function JL(e){return`The "nearest" transform is not supported for ${e} marks.`}function QL(e){return`Selection not supported for ${e} yet.`}function KL(e){return`Cannot find a selection named "${e}".`}const eP="Scale bindings are currently only supported for scales with unbinned, continuous domains.",tP="Legend bindings are only supported for selections over an individual field or encoding channel.";function nP(e){return`Cannot define and lookup the "${e}" selection in the same view. `+"Try moving the lookup into a second, layered view?"}function iP(e){return`Unknown repeated value "${e}".`}function rP(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const aP="Axes cannot be shared in concatenated views yet (https://github.com/vega/vega-lite/issues/2415).",oP="Axes cannot be shared in repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function sP(e){return`Unrecognized parse "${e}".`}function uP(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function cP(e){return`Ignoring an invalid transform: ${RR(e)}.`}const lP='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function fP(e){return`Layer's shared ${e.join(",")} channel ${1===e.length?"is":"are"} overriden.`}function dP(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${RR(t)} is overridden by a child projection ${RR(n)}.`}function hP(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${RR(n)}}.`}function pP(e){return`Invalid field type "${e}".`}function gP(e,t,n){const i=n.scaleType?`${n.scaleType} scale`:n.zeroFalse?"scale with zero=false":"scale with custom domain that excludes zero";return`A ${i} is used to encode ${e}'s ${t}. This can be misleading as the ${"x"===t?"width":"height"} of the ${e} can be arbitrary based on the scale domain. You may want to use point mark instead.`}function mP(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function vP(e){return`Invalid aggregation operator "${e}".`}function bP(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function yP(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function xP(e,t){return`Dropping ${RR(e)} from channel "${t}" since it does not contain any data field, value, or signal.`}function OP(e,t,n){return`${e}-encoding with type ${t} is deprecated. Replacing with ${n}-encoding.`}const wP="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function jP(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function kP(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function _P(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function AP(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function EP(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function DP(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function SP(e,t){return`Specified orient "${e}" overridden with "${t}".`}const CP="Custom domain scale cannot be unioned with default field-based domain.",FP='Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.';function $P(e){return`Cannot use the scale property "${e}" with non-color channel.`}function MP(e){return`Using unaggregated domain with raw field has no effect (${RR(e)}).`}function NP(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function RP(e){return`Unaggregated domain is currently unsupported for log scale (${RR(e)}).`}function zP(e){return`Cannot apply size to non-oriented mark "${e}".`}function TP(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function LP(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function PP(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function BP(e,t){return`Scale type "${t}" does not work with mark "${e}".`}function IP(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}function UP(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${RR(n)} and ${RR(i)}). Using ${RR(n)}.`}function qP(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${RR(n)} and ${RR(i)}). Using the union of the two domains.`}function WP(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function HP(e){return`Dropping sort property ${RR(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const GP="Unable to merge domains.",VP="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",ZP="Invalid channel for axis.";function YP(e){return`Cannot stack "${e}" if there is already "${e}2".`}function XP(e){return`Cannot stack non-linear scale (${e}).`}function JP(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function QP(e,t){return`Invalid ${e}: ${RR(t)}.`}function KP(e){return`Time unit "${e}" is not supported. We are replacing it with ${az(e,"day","date")}.`}function eB(e){return`Dropping day from datetime ${RR(e)} as day cannot be combined with other units.`}function tB(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function nB(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function iB(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function rB(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function aB(e){return`1D error band does not support ${e}.`}function oB(e){return`Channel ${e} is required for "binned" bin.`}function sB(e){return`Domain for ${e} is required for threshold scale.`}const uB=m,cB=Object(ie["K"])(ie["e"]);let lB=cB;function fB(e){return lB=e,lB}function dB(){return lB=cB,lB}function hB(...e){lB.warn(...e)}function pB(...e){lB.debug(...e)}const gB=2006;function mB(e){return!!e&&(!!e.year||!!e.quarter||!!e.month||!!e.date||!!e.day||!!e.hours||!!e.minutes||!!e.seconds||!!e.milliseconds)}const vB=["january","february","march","april","may","june","july","august","september","october","november","december"],bB=vB.map(e=>e.substr(0,3)),yB=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],xB=yB.map(e=>e.substr(0,3));function OB(e){if(pz(e)&&(e=+e),Object(ie["E"])(e))return e>4&&hB(uB.invalidTimeUnit("quarter",e)),e-1;throw new Error(uB.invalidTimeUnit("quarter",e))}function wB(e){if(pz(e)&&(e=+e),Object(ie["E"])(e))return e-1;{const t=e.toLowerCase(),n=vB.indexOf(t);if(-1!==n)return n;const i=t.substr(0,3),r=bB.indexOf(i);if(-1!==r)return r;throw new Error(uB.invalidTimeUnit("month",e))}}function jB(e){if(pz(e)&&(e=+e),Object(ie["E"])(e))return e%7;{const t=e.toLowerCase(),n=yB.indexOf(t);if(-1!==n)return n;const i=t.substr(0,3),r=xB.indexOf(i);if(-1!==r)return r;throw new Error(uB.invalidTimeUnit("day",e))}}function kB(e,t){const n=[];if(t&&void 0!==e.day&&ZR(e).length>1&&(hB(uB.droppedDay(e)),e=$R(e),delete e.day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(gB):n.push(0),void 0!==e.month){const i=t?wB(e.month):e.month;n.push(i)}else if(void 0!==e.quarter){const i=t?OB(e.quarter):e.quarter;n.push(Object(ie["E"])(i)?3*i:i+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const i=t?jB(e.day):e.day;n.push(Object(ie["E"])(i)?i+1:i+"+1")}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const t=e[i];n.push("undefined"===typeof t?0:t)}return n}function _B(e){const t=kB(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function AB(e){const t=kB(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function EB(e){const t=kB(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}var DB;(function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.MONTHDATEHOURS="monthdatehours",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth",e.UTCYEAR="utcyear",e.UTCMONTH="utcmonth",e.UTCDAY="utcday",e.UTCDATE="utcdate",e.UTCHOURS="utchours",e.UTCMINUTES="utcminutes",e.UTCSECONDS="utcseconds",e.UTCMILLISECONDS="utcmilliseconds",e.UTCYEARMONTH="utcyearmonth",e.UTCYEARMONTHDATE="utcyearmonthdate",e.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",e.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",e.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",e.UTCMONTHDATE="utcmonthdate",e.UTCMONTHDATEHOURS="utcmonthdatehours",e.UTCHOURSMINUTES="utchoursminutes",e.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",e.UTCMINUTESSECONDS="utcminutesseconds",e.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",e.UTCQUARTER="utcquarter",e.UTCYEARQUARTER="utcyearquarter",e.UTCQUARTERMONTH="utcquartermonth",e.UTCYEARQUARTERMONTH="utcyearquartermonth"})(DB||(DB={}));const SB={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},CB=ZR(SB);function FB(e){return!!SB[e]}const $B={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};const MB={yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,monthdatehours:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},NB={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utcmonthdatehours:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},RB=Object.assign(Object.assign({},$B),NB);function zB(e){return!!RB[e]}function TB(e){return e.substr(3)}const LB=Object.assign(Object.assign(Object.assign(Object.assign({},SB),$B),MB),NB),PB=(ZR(LB),{"year-month":"%b %Y ","year-month-date":"%b %d, %Y "});function BB(e){return CB.reduce((t,n)=>IB(e,n)?[...t,n]:t,[])}function IB(e,t){const n=e.indexOf(t);return n>-1&&(t!==DB.SECONDS||0===n||"i"!==e.charAt(n-1))}function UB(e,t,{end:n}={end:!1}){const i=nz(t),r=zB(e)?"utc":"";function a(e){return e===DB.QUARTER?`(${r}quarter(${i})-1)`:`${r}${e}(${i})`}let o;const s=CB.reduce((t,n)=>(IB(e,n)&&(t[n]=a(n),o=n),t),{});return n&&(s[o]+="+1"),AB(s)}function qB(e){if(!e)return;const t=BB(e);return`timeUnitSpecifier(${_R()(t)}, ${_R()(PB)})`}function WB(e,t,n){if(!e)return;const i=qB(e);return n||zB(e)?`utcFormat(${t}, ${i})`:`timeFormat(${t}, ${i})`}function HB(e){if(!e)return;let t;return Object(ie["H"])(e)?t={unit:GB(e)}:Object(ie["F"])(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:GB(e.unit)}:{})),zB(t.unit)&&(t.utc=!0,t.unit=TB(t.unit)),t}function GB(e){return"day"!==e&&e.indexOf("day")>=0?(hB(uB.dayReplacedWithDate(e)),az(e,"day","date")):e}function VB(e){const t=HB(e),{utc:n}=t,i=yR(t,["utc"]);return i.unit?(n?"utc":"")+ZR(i).map(e=>JR(`${"unit"===e?"":`_${e}_`}${i[e]}`)).join(""):(n?"utc":"")+"timeunit"+ZR(i).map(e=>JR(`_${e}_${i[e]}`)).join("")}function ZB(e){return null===e||void 0===e?void 0:e["selection"]}function YB(e){return e&&!!e.field&&void 0!==e.equal}function XB(e){return e&&!!e.field&&void 0!==e.lt}function JB(e){return e&&!!e.field&&void 0!==e.lte}function QB(e){return e&&!!e.field&&void 0!==e.gt}function KB(e){return e&&!!e.field&&void 0!==e.gte}function eI(e){return!!(e&&e.field&&Object(ie["A"])(e.range)&&2===e.range.length)}function tI(e){return e&&!!e.field&&(Object(ie["A"])(e.oneOf)||Object(ie["A"])(e.in))}function nI(e){return e&&!!e.field&&void 0!==e.valid}function iI(e){return tI(e)||YB(e)||eI(e)||XB(e)||QB(e)||JB(e)||KB(e)}function rI(e,t){return _q(e,{timeUnit:t,time:!0})}function aI(e,t){return e.map(e=>rI(e,t))}function oI(e,t=!0){var n;const{field:i}=e,r=null===(n=HB(e.timeUnit))||void 0===n?void 0:n.unit,a=r?"time("+UB(r,i)+")":tq(e,{expr:"datum"});if(YB(e))return a+"==="+rI(e.equal,r);if(XB(e)){const t=e.lt;return`${a}<${rI(t,r)}`}if(QB(e)){const t=e.gt;return`${a}>${rI(t,r)}`}if(JB(e)){const t=e.lte;return`${a}<=${rI(t,r)}`}if(KB(e)){const t=e.gte;return`${a}>=${rI(t,r)}`}if(tI(e))return`indexof([${aI(e.oneOf,r).join(",")}], ${a}) !== -1`;if(nI(e))return sI(a,e.valid);if(eI(e)){const n=e.range[0],i=e.range[1];if(null!==n&&null!==i&&t)return"inrange("+a+", ["+rI(n,r)+", "+rI(i,r)+"])";const o=[];return null!==n&&o.push(`${a} >= ${rI(n,r)}`),null!==i&&o.push(`${a} <= ${rI(i,r)}`),o.length>0?o.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function sI(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function uI(e){var t;return iI(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=HB(e.timeUnit))||void 0===t?void 0:t.unit}):e}const cI={quantitative:1,ordinal:1,temporal:1,nominal:1,geojson:1};const lI="quantitative",fI="ordinal",dI="temporal",hI="nominal",pI="geojson";function gI(e){if(e)switch(e=e.toLowerCase(),e){case"q":case lI:return"quantitative";case"t":case dI:return"temporal";case"o":case fI:return"ordinal";case"n":case hI:return"nominal";case pI:return"geojson"}}var mI;(function(e){e.LINEAR="linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.SYMLOG="symlog",e.IDENTITY="identity",e.SEQUENTIAL="sequential",e.TIME="time",e.UTC="utc",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.BIN_ORDINAL="bin-ordinal",e.ORDINAL="ordinal",e.POINT="point",e.BAND="band"})(mI||(mI={}));const vI={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},bI=ZR(vI);function yI(e,t){const n=vI[e],i=vI[t];return n===i||"ordinal-position"===n&&"time"===i||"ordinal-position"===i&&"time"===n}const xI={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function OI(e){return xI[e]}const wI=["linear","log","pow","sqrt","symlog","time","utc"],jI=Object(ie["db"])(wI),kI=["linear","log","pow","sqrt","symlog"],_I=Object(ie["db"])(kI);function AI(e){return e in _I}const EI=["quantile","quantize","threshold"],DI=Object(ie["db"])(EI),SI=wI.concat(["quantile","quantize","threshold","sequential","identity"]),CI=Object(ie["db"])(SI),FI=["ordinal","bin-ordinal","point","band"],$I=Object(ie["db"])(FI);function MI(e){return e in $I}function NI(e){return e in CI}function RI(e){return e in jI}function zI(e){return e in DI}const TI={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function LI(e){return!Object(ie["H"])(e)&&!!e["name"]}function PI(e){return null===e||void 0===e?void 0:e["selection"]}function BI(e){return e&&e["unionWith"]}const II={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:UI,domain:qI,range:WI,scheme:HI}=(ZR(II),II),GI=yR(II,["type","domain","range","scheme"]),VI=ZR(GI);QI();function ZI(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!LR(["point","band","identity"],e);case"bins":return!LR(["point","band","identity","ordinal"],e);case"round":return RI(e)||"band"===e||"point"===e;case"padding":return RI(e)||LR(["point","band"],e);case"paddingOuter":case"align":return LR(["point","band"],e);case"paddingInner":return"band"===e;case"domainMid":case"clamp":return RI(e);case"nice":return RI(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return NI(e)&&!LR(["log","time","utc","threshold","quantile"],e)}}function YI(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return HT(e)?void 0:uB.cannotUseScalePropertyWithNonColor(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function XI(e,t){return LR([fI,hI],t)?void 0===e||MI(e):t===dI?LR([mI.TIME,mI.UTC,void 0],e):t!==lI||LR([mI.LOG,mI.POW,mI.SQRT,mI.SYMLOG,mI.QUANTILE,mI.QUANTIZE,mI.THRESHOLD,mI.LINEAR,void 0],e)}function JI(e,t){switch(e){case pT:case gT:return RI(t)||LR(["band","point"],t);case AT:case CT:case ET:case DT:case ST:return RI(t)||zI(t)||LR(["band","point","ordinal"],t);case wT:case jT:case kT:return"band"!==t;case FT:return"ordinal"===t||zI(t);case _T:return"ordinal"===t}return!1}function QI(){var e;const t={};for(const n of YT)for(const i of ZR(cI))for(const r of bI){const a=KI(n,i);JI(n,r)&&XI(r,i)&&(t[a]=null!==(e=t[a])&&void 0!==e?e:[],t[a].push(r))}return t}function KI(e,t){return e+"_"+t}function eU(e){const{anchor:t,frame:n,offset:i,orient:r,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:u,subtitleFontStyle:c,subtitleFontWeight:l,subtitleLineHeight:f,subtitlePadding:d}=e,h=yR(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},h),a?{fill:a}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),u?{subtitleFontSize:u}:{}),c?{subtitleFontStyle:c}:{}),l?{subtitleFontWeight:l}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{});return{mark:p,nonMark:g,subtitle:m}}function tU(e){return Object(ie["H"])(e)||Object(ie["A"])(e)&&Object(ie["H"])(e[0])}function nU(e){return e&&!!e["signal"]}function iU(e){return!!e["step"]}function rU(e){return!Object(ie["A"])(e)&&("fields"in e&&!("data"in e))}function aU(e){return!Object(ie["A"])(e)&&("fields"in e&&"data"in e)}function oU(e){return!Object(ie["A"])(e)&&("field"in e&&"data"in e)}const sU={opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1},uU=ZR(sU),cU=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"],lU=" – ";function fU(e){return nU(e)?e:{value:e}}function dU(e,t,n){for(const i of n){const n=gU(i,t.markDef,t.config);void 0!==n&&(e[i]={value:n})}return e}function hU(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function pU(e,t,n){return uz(t[e],gU(e,t,n))}function gU(e,t,n,{vgChannel:i}={}){return uz(i?mU(e,t,n.style):void 0,mU(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function mU(e,t,n){return vU(e,hU(t),n)}function vU(e,t,n){let i;t=Object(ie["i"])(t);for(const r of t){const t=n[r];t&&(i=t[e])}return i}function bU(e,t,n,i){var r;if(jq(e)){const a=XU(e)&&e["scale"]&&e["scale"].type===mI.UTC;return{signal:jU(tq(e,{expr:n}),null===(r=HB(e.timeUnit))||void 0===r?void 0:r.unit,t,i.timeFormat,a,!0)}}{const r=yU(e,t,i);if(Sq(e.bin)){const t=tq(e,{expr:n}),a=tq(e,{expr:n,binSuffix:"end"});return{signal:wU(t,a,r,i)}}return"quantitative"===e.type||r?{signal:`${xU(tq(e,{expr:n,binSuffix:"range"}),r)}`}:{signal:`''+${tq(e,{expr:n})}`}}}function yU(e,t,n){return t||(e.type===lI?n.numberFormat:void 0)}function xU(e,t){return`format(${e}, "${t||""}")`}function OU(e,t,n){return xU(e,null!==t&&void 0!==t?t:n.numberFormat)}function wU(e,t,n,i){return`${sI(e,!1)} ? "null" : ${OU(e,n,i)} + "${lU}" + ${OU(t,n,i)}`}function jU(e,t,n,i,r,a=!1){return!t||n?(n=null!==n&&void 0!==n?n:i,n||a?`${r?"utc":"time"}Format(${e}, '${n}')`:void 0):WB(t,e,r)}function kU(e,t){return Object(ie["i"])(e).reduce((e,n)=>{var i;return e.field.push(tq(n,t)),e.order.push(null!==(i=n.sort)&&void 0!==i?i:"ascending"),e},{field:[],order:[]})}function _U(e,t){const n=[...e];return t.forEach(e=>{for(const t of n)if(FR(t,e))return;n.push(e)}),n}function AU(e,t){return FR(e,t)||!t?e:e?[...Object(ie["i"])(e),...Object(ie["i"])(t)].join(", "):t}function EU(e,t){const n=e.value,i=t.value;if(null==n||null===i)return{explicit:e.explicit,value:null};if(tU(n)&&tU(i))return{explicit:e.explicit,value:AU(n,i)};if(!tU(n)&&!tU(i))return{explicit:e.explicit,value:_U(n,i)};throw new Error("It should never reach here")}const DU="min",SU={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function CU(e){return!!SU[e]}function FU(e){return!!e&&!!e["encoding"]}function $U(e){return!!e&&("count"===e["op"]||!!e["field"])}function MU(e){return!!e&&Object(ie["A"])(e)}function NU(e){return!!e["row"]||!!e["column"]}function RU(e){return!!e&&!!e["header"]}function zU(e){return void 0!==e["facet"]}function TU(e){return e["selection"]}function LU(e){return e&&!Object(ie["H"])(e)&&"repeat"in e}function PU(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function BU(e){return VU(e)&&!!e["sort"]}function IU(e,t,n,i,r,{isMidPoint:a}={}){const{timeUnit:o,bin:s}=t;if(LR(["x","y"],e)){if(JU(t)&&void 0!==t.band)return t.band;if(o&&!n)return a?gU("timeUnitBandPosition",i,r):Tz(i.type)?gU("timeUnitBand",i,r):0;if(Sq(s))return Tz(i.type)&&!a?1:.5}}function UU(e,t,n,i,r){return!!(Sq(t.bin)||t.timeUnit&&VU(t)&&"temporal"===t.type)&&!!IU(e,t,n,i,r)}function qU(e){return!!e&&!!e["condition"]}function WU(e){return!!e&&!!e.condition&&!Object(ie["A"])(e.condition)&&GU(e.condition)}function HU(e){return!!e&&!!e.condition&&(Object(ie["A"])(e.condition)||YU(e.condition))}function GU(e){return!!e&&(!!e["field"]||"count"===e["aggregate"])}function VU(e){return!!e&&(!!e["field"]&&!!e["type"]||"count"===e["aggregate"])}function ZU(e){return GU(e)&&Object(ie["H"])(e.field)}function YU(e){return e&&"value"in e&&void 0!==e["value"]}function XU(e){return!!e&&(!!e["scale"]||!!e["sort"])}function JU(e){return!!e&&(!!e["axis"]||!!e["stack"]||!!e["impute"]||void 0!==e["band"])}function QU(e){return!!e&&!!e["legend"]}function KU(e){return!!e&&!!e["format"]}function eq(e){return!!e["op"]}function tq(e,t={}){var n,i,r;let a=e.field;const o=t.prefix;let s=t.suffix,u="";if(rq(e))a=fz("count");else{let o;if(!t.nofn)if(eq(e))o=e.op;else{const{bin:c,aggregate:l,timeUnit:f}=e;Sq(c)?(o=Dq(c),s=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(i=t.suffix)&&void 0!==i?i:"")):l?iT(l)?(u=`.${a}`,a=`argmax_${l.argmax}`):nT(l)?(u=`.${a}`,a=`argmin_${l.argmin}`):o=String(l):f&&(o=VB(f),s=(!LR(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(r=t.suffix)&&void 0!==r?r:""))}o&&(a=a?`${o}_${a}`:o)}return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?a:t.expr?iz(a,t.expr)+u:rz(a)+u}function nq(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return!!e.bin;case"temporal":return!1}throw new Error(uB.invalidFieldType(e.type))}function iq(e){return!nq(e)}function rq(e){return"count"===e.aggregate}function aq(e,t){var n;const{field:i,bin:r,timeUnit:a,aggregate:o}=e;if("count"===o)return t.countTitle;if(Sq(r))return`${i} (binned)`;if(a){const e=null===(n=HB(a))||void 0===n?void 0:n.unit;if(e)return`${i} (${BB(e).join("-")})`}else if(o)return iT(o)?`${i} for max ${o.argmax}`:nT(o)?`${i} for min ${o.argmin}`:`${ez(o)} of ${i}`;return i}function oq(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(iT(t))return`${r} for argmax(${t.argmax})`;if(nT(t))return`${r} for argmin(${t.argmin})`;const a=HB(i),o=t||(null===a||void 0===a?void 0:a.unit)||(null===a||void 0===a?void 0:a.maxbins)&&"timeunit"||Sq(n)&&"bin";return o?o.toUpperCase()+"("+r+")":r}const sq=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return oq(e);default:return aq(e,t)}};let uq=sq;function cq(e){uq=e}function lq(){cq(sq)}function fq(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,a;const o=null!==(r=dq(e))&&void 0!==r?r:{},s=o.title,u=i?hq(e,t):void 0;return n?uz(s,e.title,u):null!==(a=null!==s&&void 0!==s?s:e.title)&&void 0!==a?a:u}function dq(e){return JU(e)&&e.axis?e.axis:QU(e)&&e.legend?e.legend:RU(e)&&e.header?e.header:void 0}function hq(e,t){return uq(e,t)}function pq(e){var t;if(KU(e)&&e.format)return e.format;{const n=null!==(t=dq(e))&&void 0!==t?t:{};return n.format}}function gq(e,t){if(e.timeUnit)return"temporal";if(Sq(e.bin))return"quantitative";switch(qL(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function mq(e){return GU(e)?e:WU(e)?e.condition:void 0}function vq(e){return GU(e)?e:WU(e)?e.condition:void 0}function bq(e,t){if(Object(ie["H"])(e)||Object(ie["E"])(e)||Object(ie["B"])(e)){const n=Object(ie["H"])(e)?"string":Object(ie["E"])(e)?"number":"boolean";return hB(uB.primitiveChannelDef(t,n,e)),{value:e}}return GU(e)?yq(e,t):WU(e)?Object.assign(Object.assign({},e),{condition:yq(e.condition,t)}):e}function yq(e,t){const{aggregate:n,timeUnit:i,bin:r,field:a}=e,o=Object.assign({},e);if(!n||rT(n)||iT(n)||nT(n)||(hB(uB.invalidAggregate(n)),delete o.aggregate),i&&(o.timeUnit=HB(i)),a&&(o.field=`${a}`),Sq(r)&&(o.bin=xq(r,t)),Cq(r)&&!LR(OL,t)&&hB(`Channel ${t} should not be used with "binned" bin.`),VU(o)){const{type:e}=o,t=gI(e);e!==t&&(o.type=t),"quantitative"!==e&&oT(n)&&(hB(uB.invalidFieldTypeForCountAggregate(e,n)),o.type="quantitative")}else if(!sL(t)){const e=gq(o,t);hB(uB.missingFieldType(t,e)),o["type"]=e}if(VU(o)){const{compatible:e,warning:n}=wq(o,t);e||hB(n)}if(BU(o)&&Object(ie["H"])(o.sort)){const{sort:e}=o;if(CU(e))return Object.assign(Object.assign({},o),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&CU(t))return Object.assign(Object.assign({},o),{sort:{encoding:t,order:"descending"}})}return o}function xq(e,t){return Object(ie["B"])(e)?{maxbins:Mq(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:Mq(t)})}const Oq={compatible:!0};function wq(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case"row":case"column":case"facet":return iq(e)?{compatible:!1,warning:uB.facetChannelShouldBeDiscrete(t)}:Oq;case"x":case"y":case"color":case"fill":case"stroke":case"text":case"detail":case"key":case"tooltip":case"href":case"url":return Oq;case"longitude":case"longitude2":case"latitude":case"latitude2":return n!==lI?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:Oq;case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeWidth":case"size":case"x2":case"y2":return"nominal"!==n||e["sort"]?Oq:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case"strokeDash":return LR(["ordinal","nominal"],e.type)?Oq:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case"shape":return LR(["ordinal","nominal","geojson"],e.type)?Oq:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case"order":return"nominal"!==e.type||"sort"in e?Oq:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}function jq(e){const t=dq(e),n=t&&t.formatType||KU(e)&&e.formatType;return"time"===n||!n&&kq(e)}function kq(e){return"temporal"===e.type||!!e.timeUnit}function _q(e,{timeUnit:t,type:n,time:i,undefinedIfExprNotRequired:r}){var a;const o=null===(a=HB(t))||void 0===a?void 0:a.unit;let s;return nU(e)?s=e.signal:mB(e)?s=_B(e):(Object(ie["H"])(e)||Object(ie["E"])(e))&&(o||"temporal"===n)&&(s=FB(o)?_B({[o]:e}):`datetime(${JSON.stringify(e)})`),s?i?`time(${s})`:s:r?void 0:JSON.stringify(e)}function Aq(e,t){var n;const{type:i}=e,r=null===(n=HB(e.timeUnit))||void 0===n?void 0:n.unit;return t.map(e=>{const t=_q(e,{timeUnit:r,type:i,undefinedIfExprNotRequired:!0});return void 0!==t?{signal:t}:e})}function Eq(e,t){return Sq(e.bin)?TL(t)&&LR(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function Dq(e){return Object(ie["B"])(e)&&(e=xq(e,void 0)),"bin"+ZR(e).map(t=>$q(e[t])?JR(`_${t}_${Object.entries(e[t])}`):JR(`_${t}_${e[t]}`)).join("")}function Sq(e){return!0===e||Fq(e)&&!e.binned}function Cq(e){return"binned"===e||Fq(e)&&!0===e.binned}function Fq(e){return Object(ie["F"])(e)}function $q(e){return null===e||void 0===e?void 0:e["selection"]}function Mq(e){switch(e){case fT:case dT:case AT:case wT:case jT:case kT:case CT:case ET:case DT:case ST:case _T:return 6;case FT:return 4;default:return 10}}function Nq(e,t){const n=e&&e[t];return!!n&&(Object(ie["A"])(n)?PR(n,e=>!!e.field):GU(n)||WU(n))}function Rq(e){return PR(YT,t=>{if(Nq(e,t)){const n=e[t];if(Object(ie["A"])(n))return PR(n,e=>!!e.aggregate);{const e=mq(n);return e&&!!e.aggregate}}return!1})}function zq(e,t){const n=[],i=[],r=[],a=[],o={};return Bq(e,(s,u)=>{if(GU(s)){const{field:c,aggregate:l,bin:f,timeUnit:d}=s,h=yR(s,["field","aggregate","bin","timeUnit"]);if(l||d||f){const e=dq(s),p=e&&e.title;let g=tq(s,{forAs:!0});const m=Object.assign(Object.assign(Object.assign({},p?[]:{title:fq(s,t,{allowDisabling:!0})}),h),{field:g}),v="x"===u||"y"===u;if(l){let e;if(iT(l)?(e="argmax",g=tq({op:"argmax",field:l.argmax},{forAs:!0}),m.field=`${g}.${c}`):nT(l)?(e="argmin",g=tq({op:"argmin",field:l.argmin},{forAs:!0}),m.field=`${g}.${c}`):"boxplot"!==l&&"errorbar"!==l&&"errorband"!==l&&(e=l),e){const t={op:e,as:g};c&&(t.field=c),a.push(t)}}else if(n.push(g),VU(s)&&Sq(f)){if(i.push({bin:f,field:c,as:g}),n.push(tq(s,{binSuffix:"end"})),Eq(s,u)&&n.push(tq(s,{binSuffix:"range"})),v){const e={field:g+"_end"};o[u+"2"]=e}m.bin="binned",sL(u)||(m["type"]="quantitative")}else if(d){r.push({timeUnit:d,field:c,as:g});const e=VU(s)&&s.type!==dI&&"time";e&&("text"===u||"tooltip"===u?m["formatType"]=e:ML(u)?m["legend"]=Object.assign({formatType:e},m["legend"]):v&&(m["axis"]=Object.assign({formatType:e},m["axis"])))}o[u]=m}else n.push(c),o[u]=e[u]}else o[u]=e[u]}),{bins:i,timeUnits:r,aggregate:a,groupby:n,encoding:o}}function Tq(e,t,n){const i=LL(t,n);if(!i)return!1;if("binned"===i){const n=e["x2"===t?"x":"y"];return!!(GU(n)&&GU(e[t])&&Cq(n.bin))}return!0}function Lq(e,t){const n=t.type;return ZR(e).reduce((i,r)=>{if(!aL(r))return hB(uB.invalidEncodingChannel(r)),i;if(!Tq(e,r,n))return hB(uB.incompatibleChannel(r,n)),i;if("size"===r&&"line"===n){const t=vq(e[r]);if(null===t||void 0===t?void 0:t.aggregate)return hB(uB.LINE_WITH_VARYING_SIZE),i}if("color"===r&&(t.filled?"fill"in e:"stroke"in e))return hB(uB.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;const a=e[r];if("detail"===r||"order"===r&&!Object(ie["A"])(a)&&!YU(a)||"tooltip"===r&&Object(ie["A"])(a))a&&(i[r]=Object(ie["i"])(a).reduce((e,t)=>(GU(t)?e.push(yq(t,r)):hB(uB.emptyFieldDef(t,r)),e),[]));else{if("tooltip"===r&&null===a)i[r]=null;else if(!GU(a)&&!YU(a)&&!qU(a)&&!nU(a))return hB(uB.emptyFieldDef(a,r)),i;i[r]=bq(a,r)}return i},{})}function Pq(e){const t=[];for(const n of ZR(e))if(Nq(e,n)){const i=e[n],r=Object(ie["i"])(i);for(const e of r)GU(e)?t.push(e):WU(e)&&t.push(e.condition)}return t}function Bq(e,t,n){if(e)for(const i of ZR(e)){const r=e[i];Object(ie["A"])(r)?r.forEach(e=>{t.call(n,e,i)}):t.call(n,r,i)}}function Iq(e,t,n,i){return e?ZR(e).reduce((n,r)=>{const a=e[r];return Object(ie["A"])(a)?a.reduce((e,n)=>t.call(i,e,n,r),n):t.call(i,n,a,r)},n):n}function Uq(e,t){return ZR(t).reduce((n,i)=>{switch(i){case"x":case"y":case"href":case"url":case"x2":case"y2":case"latitude":case"longitude":case"latitude2":case"longitude2":case"text":case"shape":case"tooltip":return n;case"order":if("line"===e||"trail"===e)return n;case"detail":case"key":{const e=t[i];return(Object(ie["A"])(e)||GU(e))&&Object(ie["i"])(e).forEach(e=>{e.aggregate||n.push(tq(e,{}))}),n}case"size":if("trail"===e)return n;case"color":case"fill":case"stroke":case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeDash":case"strokeWidth":{const e=vq(t[i]);return e&&!e.aggregate&&n.push(tq(e,{})),n}}},[])}function qq(e){const{tooltip:t}=e,n=yR(e,["tooltip"]);if(!t)return{filteredEncoding:e};let i,r;return Object(ie["A"])(t)?(t.forEach(e=>{e.aggregate?(i||(i=[]),i.push(e)):(r||(r=[]),r.push(e))}),i&&(n.tooltip=i)):t["aggregate"]?n.tooltip=t:r=t,Object(ie["A"])(r)&&1===r.length&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function Wq(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:e,titlePrefix:n})=>{const r=i?` of ${t.field}`:"";return{field:e+t.field,type:t.type,title:nU(n)?{signal:n+`"${escape(r)}"`}:n+r}});return{tooltip:[...r,...Pq(n)]}}function Hq(e){const{axis:t,title:n,field:i}=e;return t&&void 0!==t.title?void 0:uz(n,i)}function Gq(e,t,n,i,r){const{scale:a,axis:o}=n;return({partName:s,mark:u,positionPrefix:c,endPositionPrefix:l,extraEncoding:f={}})=>{const d=Hq(n);return Vq(e,s,r,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:c+"_"+n.field,type:n.type},void 0!==d?{title:d}:{}),void 0!==a?{scale:a}:{}),void 0!==o?{axis:o}:{})},Object(ie["H"])(l)?{[t+"2"]:{field:l+"_"+n.field}}:{}),i),f)})}}function Vq(e,t,n,i){const{clip:r,color:a,opacity:o}=e,s=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),a?{color:a}:{}),o?{opacity:o}:{}),Pz(i.mark)?i.mark:{type:i.mark}),{style:`${s}-${t}`}),Object(ie["B"])(e[t])?{}:e[t])})]:[]}function Zq(e,t,n){const{encoding:i}=e,r="vertical"===t?"y":"x",a=i[r],o=i[r+"2"],s=i[r+"Error"],u=i[r+"Error2"];return{continuousAxisChannelDef:Yq(a,n),continuousAxisChannelDef2:Yq(o,n),continuousAxisChannelDefError:Yq(s,n),continuousAxisChannelDefError2:Yq(u,n),continuousAxis:r}}function Yq(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=yR(e,["aggregate"]);return n!==t&&hB(uB.errorBarContinuousAxisHasCustomizedAggregate(n,t)),i}return e}function Xq(e,t){const{mark:n,encoding:i}=e;if(GU(i.x)&&iq(i.x)){if(GU(i.y)&&iq(i.y)){if(void 0===i.x.aggregate&&i.y.aggregate===t)return"vertical";if(void 0===i.y.aggregate&&i.x.aggregate===t)return"horizontal";if(i.x.aggregate===t&&i.y.aggregate===t)throw new Error("Both x and y cannot have aggregate");return Pz(n)&&n.orient?n.orient:"vertical"}return"horizontal"}if(GU(i.y)&&iq(i.y))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}const Jq="boxplot",Qq={box:1,median:1,outliers:1,rule:1,ticks:1},Kq=ZR(Qq),eW=new Kz(Jq,nW);function tW(e){return Object(ie["E"])(e)?"tukey":e}function nW(e,{config:t}){var n,i;const{mark:r,encoding:a,selection:o,projection:s}=e,u=yR(e,["mark","encoding","selection","projection"]),c=Pz(r)?r:{type:r};o&&hB(uB.selectionNotSupported("boxplot"));const l=null!==(n=c.extent)&&void 0!==n?n:t.boxplot.extent,f=uz(c.size,t.boxplot.size),d=tW(l),{transform:h,continuousAxisChannelDef:p,continuousAxis:g,groupby:m,aggregate:v,encodingWithoutContinuousAxis:b,ticksOrient:y,boxOrient:x,customTooltipWithoutAggregatedField:O}=rW(e,l,t),{color:w,size:j}=b,k=yR(b,["color","size"]),_=e=>Gq(c,g,p,e,t.boxplot),A=_(k),E=_(b),D=_(Object.assign(Object.assign({},k),j?{size:j}:{})),S=Wq([{fieldPrefix:"min-max"===d?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===d?"lower_whisker_":"min_",titlePrefix:"Min"}],p,b),C={type:"tick",color:"black",opacity:1,orient:y,invalid:null},F="min-max"===d?S:Wq([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,b),$=[...A({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:F}),...A({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:F}),...A({partName:"ticks",mark:C,positionPrefix:"lower_whisker",extraEncoding:F}),...A({partName:"ticks",mark:C,positionPrefix:"upper_whisker",extraEncoding:F})],M=[..."tukey"!==d?$:[],...E({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:x,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:S}),...D({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},Object(ie["F"])(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:y}),positionPrefix:"mid_box",extraEncoding:S})];let N;if("min-max"!==d){const e=`datum["lower_box_${p.field}"]`,n=`datum["upper_box_${p.field}"]`,i=`(${n} - ${e})`,r=`${e} - ${l} * ${i}`,a=`${n} + ${l} * ${i}`,o=`datum["${p.field}"]`,s={joinaggregate:iW(p.field),groupby:m};let u=void 0;"tukey"===d&&(u={transform:[{filter:`(${r} <= ${o}) && (${o} <= ${a})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...v],groupby:m}],layer:$});const{tooltip:f}=k,h=yR(k,["tooltip"]),{scale:b,axis:y}=p,x=Hq(p),w=Vq(c,"outliers",t.boxplot,{transform:[{filter:`(${o} < ${r}) || (${o} > ${a})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},void 0!==x?{title:x}:{}),void 0!==b?{scale:b}:{}),void 0!==y?{axis:y}:{})},h),O?{tooltip:O}:{})})[0];w&&u?N={transform:[s],layer:[w,u]}:w?(N=w,N.transform.unshift(s)):u&&(N=u,N.transform.unshift(s))}return N?Object.assign(Object.assign({},u),{layer:[N,{transform:h,layer:M}]}):Object.assign(Object.assign({},u),{transform:(null!==(i=u.transform)&&void 0!==i?i:[]).concat(h),layer:M})}function iW(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function rW(e,t,n){const i=Xq(e,Jq),{continuousAxisChannelDef:r,continuousAxis:a}=Zq(e,i,Jq),o=r.field,s=tW(t),u=[...iW(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:("min-max"===s?"lower_whisker_":"min_")+o},{op:"max",field:o,as:("min-max"===s?"upper_whisker_":"max_")+o}],c="min-max"===s||"tukey"===s?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],l=e.encoding,f=a,d=(l[f],yR(l,["symbol"===typeof f?f:f+""])),{customTooltipWithoutAggregatedField:h,filteredEncoding:p}=qq(d),{bins:g,timeUnits:m,aggregate:v,groupby:b,encoding:y}=zq(p,n),x="vertical"===i?"horizontal":"vertical",O=i,w=[...g,...m,{aggregate:[...v,...u],groupby:b},...c];return{transform:w,groupby:b,aggregate:v,continuousAxisChannelDef:r,continuousAxis:a,encodingWithoutContinuousAxis:y,ticksOrient:x,boxOrient:O,customTooltipWithoutAggregatedField:h}}const aW="errorbar",oW={ticks:1,rule:1},sW=ZR(oW),uW=new Kz(aW,cW);function cW(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:u,tooltipEncoding:c}=pW(e,aW,t),l=Gq(s,r,i,a,t.errorbar),f={type:"tick",orient:o},d=[...l({partName:"ticks",mark:f,positionPrefix:"lower",extraEncoding:c}),...l({partName:"ticks",mark:f,positionPrefix:"upper",extraEncoding:c}),...l({partName:"rule",mark:"rule",positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),d.length>1?{layer:d}:Object.assign({},d[0]))}function lW(e,t){const{encoding:n}=e;if(fW(n))return{orient:Xq(e,t),inputType:"raw"};const i=dW(n),r=hW(n),a=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const e=n.x2,i=n.y2;if(GU(e)&&GU(i))throw new Error(`${t} cannot have both x2 and y2`);if(GU(e)){if(GU(a)&&iq(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(GU(i)){if(GU(o)&&iq(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const e=n.xError,i=n.xError2,r=n.yError,s=n.yError2;if(GU(i)&&!GU(e))throw new Error(`${t} cannot have xError2 without xError`);if(GU(s)&&!GU(r))throw new Error(`${t} cannot have yError2 without yError`);if(GU(e)&&GU(r))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(GU(e)){if(GU(a)&&iq(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(GU(r)){if(GU(o)&&iq(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function fW(e){return(GU(e.x)||GU(e.y))&&!GU(e.x2)&&!GU(e.y2)&&!GU(e.xError)&&!GU(e.xError2)&&!GU(e.yError)&&!GU(e.yError2)}function dW(e){return GU(e.x2)||GU(e.y2)}function hW(e){return GU(e.xError)||GU(e.xError2)||GU(e.yError)||GU(e.yError2)}function pW(e,t,n){var i;const{mark:r,encoding:a,selection:o,projection:s}=e,u=yR(e,["mark","encoding","selection","projection"]),c=Pz(r)?r:{type:r};o&&hB(uB.selectionNotSupported(t));const{orient:l,inputType:f}=lW(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:m}=Zq(e,l,t),{errorBarSpecificAggregate:v,postAggregateCalculates:b,tooltipSummary:y,tooltipTitleWithFieldName:x}=gW(c,d,h,p,g,f,t,n),O=a,w=m,j=(O[w],"x"===m?"x2":"y2"),k=(O[j],"x"===m?"xError":"yError"),_=(O[k],"x"===m?"xError2":"yError2"),A=(O[_],yR(O,["symbol"===typeof w?w:w+"","symbol"===typeof j?j:j+"","symbol"===typeof k?k:k+"","symbol"===typeof _?_:_+""])),{bins:E,timeUnits:D,aggregate:S,groupby:C,encoding:F}=zq(A,n),$=[...S,...v],M="raw"!==f?[]:C,N=Wq(y,d,F,x);return{transform:[...null!==(i=u.transform)&&void 0!==i?i:[],...E,...D,...0===$.length?[]:[{aggregate:$,groupby:M}],...b],groupby:M,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:F,ticksOrient:"vertical"===l?"horizontal":"vertical",markDef:c,outerSpec:u,tooltipEncoding:N}}function gW(e,t,n,i,r,a,o,s){let u=[],c=[];const l=t.field;let f,d=!1;if("raw"===a){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":s.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!==("iqr"===n)&&hB(uB.errorBarCenterIsUsedWithWrongExtent(t,n,o)),"stderr"===n||"stdev"===n)u=[{op:n,field:l,as:"extent_"+l},{op:t,field:l,as:"center_"+l}],c=[{calculate:`datum["center_${l}"] + datum["extent_${l}"]`,as:"upper_"+l},{calculate:`datum["center_${l}"] - datum["extent_${l}"]`,as:"lower_"+l}],f=[{fieldPrefix:"center_",titlePrefix:ez(t)},{fieldPrefix:"upper_",titlePrefix:mW(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:mW(t,n,"-")}],d=!0;else{let t,i,r;e.center&&e.extent&&hB(uB.errorBarCenterIsNotNeeded(e.extent,o)),"ci"===n?(t="mean",i="ci0",r="ci1"):(t="median",i="q1",r="q3"),u=[{op:i,field:l,as:"lower_"+l},{op:r,field:l,as:"upper_"+l},{op:t,field:l,as:"center_"+l}],f=[{fieldPrefix:"upper_",titlePrefix:fq({field:l,aggregate:r,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:fq({field:l,aggregate:i,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:fq({field:l,aggregate:t,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&hB(uB.errorBarCenterAndExtentAreNotNeeded(e.center,e.extent)),"aggregated-upper-lower"===a?(f=[],c=[{calculate:`datum["${n.field}"]`,as:"upper_"+l},{calculate:`datum["${l}"]`,as:"lower_"+l}]):"aggregated-error"===a&&(f=[{fieldPrefix:"",titlePrefix:l}],c=[{calculate:`datum["${l}"] + datum["${i.field}"]`,as:"upper_"+l}],r?c.push({calculate:`datum["${l}"] + datum["${r.field}"]`,as:"lower_"+l}):c.push({calculate:`datum["${l}"] - datum["${i.field}"]`,as:"lower_"+l}));for(const e of c)f.push({fieldPrefix:e.as.substring(0,6),titlePrefix:az(az(e.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:c,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:d}}function mW(e,t,n){return ez(e)+" "+n+" "+t}const vW="errorband",bW={band:1,borders:1},yW=ZR(bW),xW=new Kz(vW,OW);function OW(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:u}=pW(e,vW,t),c=o,l=Gq(c,r,i,a,t.errorband),f=void 0!==e.encoding.x&&void 0!==e.encoding.y;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p=Object.assign(Object.assign({},c.interpolate?{interpolate:c.interpolate}:{}),c.tension&&c.interpolate?{tension:c.tension}:{});return f?(d=Object.assign(Object.assign({},d),p),h=Object.assign(Object.assign({},h),p)):c.interpolate?hB(uB.errorBand1DNotSupport("interpolate")):c.tension&&hB(uB.errorBand1DNotSupport("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...l({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...l({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:u}),...l({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:u})]})}const wW={};function jW(e,t,n){const i=new Kz(e,t);wW[e]={normalizer:i,parts:n}}function kW(){return ZR(wW)}jW(Jq,nW,Kq),jW(aW,cW,sW),jW(vW,OW,yW);const _W=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],AW={size:1,shape:1,fill:1,stroke:1,strokeDash:1,strokeWidth:1,opacity:1},EW=ZR(AW),DW={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},SW={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},CW={clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},FW=(ZR(CW),"_vgsid_"),$W={single:{on:"click",fields:[FW],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[FW],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function MW(e){return!!e&&("legend"===e||!!e.legend)}function NW(e){return MW(e)&&Object(ie["F"])(e)}function RW(e){return TW(e)||LW(e)||zW(e)}function zW(e){return void 0!==e["concat"]}function TW(e){return void 0!==e["vconcat"]}function LW(e){return void 0!==e["hconcat"]}function PW(e){return void 0!==e["repeat"]}function BW(e){return Object(ie["F"])(e)&&void 0!==e["step"]}function IW(e){return e["view"]||e["width"]||e["height"]}const UW=20,qW={align:1,bounds:1,center:1,columns:1,spacing:1},WW=ZR(qW);function HW(e,t,n){var i,r;const a=n[t],o={},{spacing:s,columns:u}=a;void 0!==s&&(o.spacing=s),void 0!==u&&(zU(e)&&!NU(e.facet)||PW(e)&&Object(ie["A"])(e.repeat)||zW(e))&&(o.columns=u);for(const c of WW)if(void 0!==e[c])if("spacing"===c){const t=e[c];o[c]=Object(ie["E"])(t)?t:{row:null!==(i=t.row)&&void 0!==i?i:s,column:null!==(r=t.column)&&void 0!==r?r:s}}else o[c]=e[c];return o}function GW(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function VW(e,t){const n=ZW(e,t);return BW(n)?n.step:YW}function ZW(e,t){var n;const i=null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"];return uz(i,{step:e.step})}const YW=20,XW={continuousWidth:200,continuousHeight:200,step:YW};const JW={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:XW,mark:Hz,area:{},bar:Zz,circle:{},geoshape:{},image:{},line:{},point:{},rect:Yz,rule:{color:"black"},square:{},text:{color:"black"},tick:Xz,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:TI,projection:{},axis:{},axisX:{},axisY:{},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:SW,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:$W,style:{},title:{},facet:{spacing:UW},repeat:{spacing:UW},concat:{spacing:UW}},QW=Wv("tableau10"),KW={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},eH={blue:QW[0],orange:QW[1],red:QW[2],teal:QW[3],green:QW[4],yellow:QW[5],purple:QW[6],pink:QW[7],brown:QW[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function tH(e={}){return{signals:[{name:"color",value:Object(ie["F"])(e)?Object.assign(Object.assign({},eH),e):eH}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function nH(e){return{signals:[{name:"fontSize",value:Object(ie["F"])(e)?Object.assign(Object.assign({},KW),e):KW}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function iH(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function rH(e={}){const{color:t,font:n,fontSize:i}=e,r=yR(e,["color","font","fontSize"]);return Object(ie["N"])({},JW,n?iH(n):{},t?tH(t):{},i?nH(i):{},r||{})}const aH=["view",...Lz],oH=["color","fontSize","background","padding","facet","concat","repeat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","scale","selection","overlay"],sH=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},Wz);function uH(e){e=$R(e);for(const t of oH)delete e[t];if(e.axis)for(const t in e.axis)mz(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of _W)delete e.legend[t];if(e.mark)for(const t of qz)delete e.mark[t];for(const t of aH){for(const i of qz)delete e[t][i];const n=sH[t];if(n)for(const i of n)delete e[t][i];lH(e,t)}for(const t of kW())delete e[t];cH(e);for(const t in e)Object(ie["F"])(e[t])&&0===ZR(e[t]).length&&delete e[t];return ZR(e).length>0?e:void 0}function cH(e){const{mark:t,subtitle:n}=eU(e.title),i=Object.assign(Object.assign({},e.style["group-title"]),t);ZR(i).length>0&&(e.style["group-title"]=i),ZR(n).length>0?e.title=n:delete e.title}function lH(e,t,n,i){const r=i?e[t][i]:e[t];"view"===t&&(n="cell");const a=Object.assign(Object.assign({},r),e.style[null!==n&&void 0!==n?n:t]);ZR(a).length>0&&(e.style[null!==n&&void 0!==n?n:t]=a),i||delete e[t]}function fH(e){return void 0!==e["layer"]}class dH{map(e,t){return zU(e)?this.mapFacet(e,t):PW(e)?this.mapRepeat(e,t):LW(e)?this.mapHConcat(e,t):TW(e)?this.mapVConcat(e,t):zW(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(fH(e))return this.mapLayer(e,t);if(Qz(e))return this.mapUnit(e,t);throw new Error(uB.invalidSpec(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map(e=>this.mapLayerOrUnit(e,t))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map(e=>this.map(e,t))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map(e=>this.map(e,t))})}mapConcat(e,t){const{concat:n}=e,i=yR(e,["concat"]);return Object.assign(Object.assign({},i),{concat:n.map(e=>this.map(e,t))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}const hH={zero:1,center:1,normalize:1};function pH(e){return!!hH[e]}const gH=[jz,wz,Dz,Az,$z,Mz,_z,Sz,Cz],mH=[jz,wz];function vH(e){const t=e.x,n=e.y;if(GU(t)&&GU(n))if("quantitative"===t.type&&"quantitative"===n.type){if(t.stack)return"x";if(n.stack)return"y";if(!!t.aggregate!==!!n.aggregate)return t.aggregate?"x":"y"}else{if("quantitative"===t.type)return"x";if("quantitative"===n.type)return"y"}else{if(GU(t)&&"quantitative"===t.type)return"x";if(GU(n)&&"quantitative"===n.type)return"y"}}function bH(e,t,n={}){const i=Pz(e)?e.type:e;if(!LR(gH,i))return null;const r=vH(t);if(!r)return null;const a=t[r],o=ZU(a)?tq(a,{}):void 0,s="x"===r?"y":"x",u=t[s],c=ZU(u)?tq(u,{}):void 0,l=yL.reduce((e,n)=>{if("tooltip"!==n&&Nq(t,n)){const i=t[n];Object(ie["i"])(i).forEach(t=>{const i=vq(t);if(i.aggregate)return;const r=ZU(i)?tq(i,{}):void 0;(!r||r!==c&&r!==o)&&e.push({channel:n,fieldDef:i})})}return e},[]);let f;if(void 0!==a.stack?f=Object(ie["B"])(a.stack)?a.stack?"zero":null:a.stack:l.length>0&&LR(mH,i)&&(f="zero"),!f||!pH(f))return null;if(Rq(t)&&0===l.length)return null;if(a.scale&&a.scale.type&&a.scale.type!==mI.LINEAR){if(n.disallowNonLinearStack)return null;hB(uB.cannotStackNonLinearScale(a.scale.type))}return Nq(t,r===pT?mT:vT)?(void 0!==a.stack&&hB(uB.cannotStackRangedMark(r)),null):(a.aggregate&&!LR(uT,a.aggregate)&&hB(uB.stackNonSummativeAggregate(a.aggregate)),{groupbyChannel:u?s:void 0,fieldChannel:r,impute:null!==a.impute&&zz(i),stackBy:l,offset:f})}function yH(e){const{point:t,line:n}=e,i=yR(e,["point","line"]);return ZR(i).length>1?i:i.type}function xH(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:NR(e[t],["point","line"])}));return e}function OH(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?Object(ie["F"])(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?Object(ie["F"])(t.point)?t.point:{}:void 0}function wH(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class jH{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(Qz(e)){const{mark:n,encoding:i}=e,r=Pz(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!OH(r,t[r.type],i);case"area":return!!OH(r,t[r.type],i)||!!wH(r,t[r.type])}}return!1}run(e,t,n){const{config:i}=t,{selection:r,projection:a,encoding:o,mark:s}=e,u=yR(e,["selection","projection","encoding","mark"]),c=Pz(s)?s:{type:s},l=OH(c,i[c.type],o),f="area"===c.type&&wH(c,i[c.type]),d=[Object.assign(Object.assign({},r?{selection:r}:{}),{mark:yH(Object.assign(Object.assign({},"area"===c.type&&void 0===c.opacity&&void 0===c.fillOpacity?{opacity:.7}:{}),c)),encoding:NR(o,["shape"])})],h=bH(c,o);let p=o;if(h){const{fieldChannel:e,offset:t}=h;p=Object.assign(Object.assign({},o),{[e]:Object.assign(Object.assign({},o[e]),t?{stack:t}:{})})}return f&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},MR(c,["clip","interpolate","tension","tooltip"])),f),encoding:p})),l&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},MR(c,["clip","tooltip"])),l),encoding:p})),n(Object.assign(Object.assign({},u),{layer:d}),Object.assign(Object.assign({},t),{config:xH(i)}))}}class kH{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(Qz(e)&&e.encoding)for(const n of OL){const i=e.encoding[n];if(i&&GU(i)&&(null===(t=null===i||void 0===i?void 0:i.scale)||void 0===t?void 0:t["rangeStep"]))return!0}return!1}run(e){var t;const n={};let i=Object.assign({},e.encoding);for(const r of OL){const e=wL(r),a=i[r];if(a&&GU(a)&&(null===(t=null===a||void 0===a?void 0:a.scale)||void 0===t?void 0:t["rangeStep"])){const{scale:t}=a,o=yR(a,["scale"]),s=t,{rangeStep:u}=s,c=yR(s,["rangeStep"]);n[e]={step:t["rangeStep"]},hB(uB.RANGE_STEP_DEPRECATED),i=Object.assign(Object.assign({},i),{[r]:Object.assign(Object.assign({},o),ZR(c).length>0?{scale:c}:{})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:i})}}class _H{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(Qz(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of oL){const n=uL(e),i=t[n];if(t[e]&&GU(i)&&!Cq(i.bin))return!0}}return!1}run(e,t,n){const{encoding:i}=e;return hB(uB.lineWithRange(!!i.x2,!!i.y2)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}class AH extends dH{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[eW,uW,xW,new jH,new _H,new kH]}map(e,t){if(Qz(e)){const n=Nq(e.encoding,fT),i=Nq(e.encoding,dT),r=Nq(e.encoding,hT);if(n||i||r)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:i}=t;if(n||i)return this.mapUnitWithParentEncodingOrProjection(e,t);const r=this.mapLayerOrUnit.bind(this);for(const a of this.nonFacetUnitNormalizers)if(a.hasMatchingType(e,t.config))return a.run(e,t,r);return e}mapRepeat(e,t){const{repeat:n}=e;return!Object(ie["A"])(n)&&e.columns&&(e=NR(e,["columns"]),hB(uB.columnsNotSupportByRowCol("repeat"))),Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapFacet(e,t){const{facet:n}=e;return NU(n)&&e.columns&&(e=NR(e,["columns"]),hB(uB.columnsNotSupportByRowCol("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:i}=e,{parentEncoding:r,parentProjection:a,config:o}=t,s=DH({parentProjection:a,projection:i}),u=EH({parentEncoding:r,encoding:n});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),u?{encoding:u}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:i,column:r,facet:a}=n,o=yR(n,["row","column","facet"]),{mark:s,width:u,projection:c,height:l,view:f,selection:d,encoding:h}=e,p=yR(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:a});return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),m),{facet:g,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},u?{width:u}:{}),l?{height:l}:{}),f?{view:f}:{}),c?{projection:c}:{}),{mark:s,encoding:o}),d?{selection:d}:{})}),t)}getFacetMappingAndLayout(e){var t;const{row:n,column:i,facet:r}=e;if(n||i){r&&hB(uB.facetChannelDropped([...n?[fT]:[],...i?[dT]:[]]));const a={},o={};for(const n of[fT,dT]){const i=e[n];if(i){const{align:e,center:r,spacing:s,columns:u}=i,c=yR(i,["align","center","spacing","columns"]);a[n]=c;for(const a of["align","center","spacing"])void 0!==i[a]&&(o[a]=null!==(t=o[a])&&void 0!==t?t:{},o[a][n]=i[a])}}return{facetMapping:a,layout:o}}{const{align:e,center:t,spacing:n,columns:i}=r,a=yR(r,["align","center","spacing","columns"]);return{facetMapping:a,layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),t?{center:t}:{}),n?{spacing:n}:{}),i?{columns:i}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:i}=t,r=yR(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=yR(e,["encoding","projection"]),u=Object.assign(Object.assign({},r),{parentEncoding:EH({parentEncoding:n,encoding:a}),parentProjection:DH({parentProjection:i,projection:o})});return super.mapLayer(s,u)}}function EH(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const e=ZR(t).reduce((e,t)=>(n[t]&&e.push(t),e),[]);e.length>0&&hB(uB.encodingOverridden(e))}const i=Object.assign(Object.assign({},null!==t&&void 0!==t?t:{}),null!==n&&void 0!==n?n:{});return ZR(i).length>0?i:void 0}function DH(e){const{parentProjection:t,projection:n}=e;return t&&n&&hB(uB.projectionOverridden({parentProjection:t,projection:n})),null!==n&&void 0!==n?n:t}function SH(e,t){void 0===t&&(t=rH(e.config));const n=FH(e,t),{width:i,height:r}=e,a=MH(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const CH=new AH;function FH(e,t={}){return CH.map(e,{config:t})}function $H(e){return Object(ie["H"])(e)?{type:e}:null!==e&&void 0!==e?e:{}}function MH(e,t,n){let{width:i,height:r}=t;const a=Qz(e)||fH(e),o={};a?"container"==i&&"container"==r?(o.type="fit",o.contains="padding"):"container"==i?(o.type="fit-x",o.contains="padding"):"container"==r&&(o.type="fit-y",o.contains="padding"):("container"==i&&(hB(uB.containerSizeNonSingle("width")),i=void 0),"container"==r&&(hB(uB.containerSizeNonSingle("height")),r=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?$H(n.autosize):{}),$H(e.autosize));if("fit"!==s.type||a||(hB(uB.FIT_NON_SINGLE),s.type="pad"),"container"==i&&"fit"!=s.type&&"fit-x"!=s.type&&hB(uB.containerSizeNotCompatibleWithAutosize("width")),"container"==r&&"fit"!=s.type&&"fit-y"!=s.type&&hB(uB.containerSizeNotCompatibleWithAutosize("height")),!FR(s,{type:"pad"}))return s}function NH(e){return"fit"===e||"fit-x"===e||"fit-y"===e}function RH(e){return e?`fit-${jL(e)}`:"fit"}const zH=["background","padding"];function TH(e){return zH.reduce((t,n)=>(e&&void 0!==e[n]&&(t[n]=e[n]),t),{})}function LH(e){return!!e["url"]}function PH(e){return!!e["values"]}function BH(e){return!!e["name"]&&!LH(e)&&!PH(e)&&!IH(e)}function IH(e){return e&&(UH(e)||qH(e)||WH(e))}function UH(e){return!!e["sequence"]}function qH(e){return!!e["sphere"]}function WH(e){return!!e["graticule"]}const HH="main",GH="raw";function VH(e){return void 0!==e["filter"]}function ZH(e){return void 0!==(null===e||void 0===e?void 0:e["stop"])}function YH(e){return void 0!==e["lookup"]}function XH(e){return void 0!==e["data"]}function JH(e){return void 0!==e["selection"]}function QH(e){return void 0!==e["pivot"]}function KH(e){return void 0!==e["density"]}function eG(e){return void 0!==e["quantile"]}function tG(e){return void 0!==e["regression"]}function nG(e){return void 0!==e["loess"]}function iG(e){return void 0!==e["sample"]}function rG(e){return void 0!==e["window"]}function aG(e){return void 0!==e["joinaggregate"]}function oG(e){return void 0!==e["flatten"]}function sG(e){return void 0!==e["calculate"]}function uG(e){return!!e["bin"]}function cG(e){return void 0!==e["impute"]}function lG(e){return void 0!==e["timeUnit"]}function fG(e){return void 0!==e["aggregate"]}function dG(e){return void 0!==e["stack"]}function hG(e){return void 0!==e["fold"]}function pG(e){return e.map(e=>VH(e)?{filter:CR(e.filter,uI)}:e)}function gG(e,t,n,i){const r=t&&t.condition,a=i(t);if(r){const t=Object(ie["i"])(r),o=t.map(t=>{const n=i(t),r=TU(t)?yZ(e,t.selection):wZ(e,t.test);return Object.assign({test:r},n)});return{[n]:[...o,...void 0!==a?[a]:[]]}}return void 0!==a?{[n]:a}:{}}function mG(e){const{channel:t,channelDef:n,markDef:i,scale:r}=e,a=wG(e);return GU(n)&&!oT(n.aggregate)&&r&&RI(r.get("type"))&&!1===r.get("zero")?vG({fieldDef:n,channel:t,markDef:i,ref:a}):a}function vG({fieldDef:e,channel:t,markDef:n,ref:i}){return zz(n.type)?i:[bG(e,t),i]}function bG(e,t){const n=yG(e,!0),i=uL(t),r="x"===i?{value:0}:{field:{group:"height"}};return Object.assign({test:n},r)}function yG(e,t=!0){return sI(Object(ie["H"])(e)?e:tq(e,{expr:"datum"}),!t)}function xG(e,t,n,i){const r=Object.assign(Object.assign({},t?{scale:t}:{}),{field:tq(e,n)});if(i){const{offset:e,band:t}=i;return Object.assign(Object.assign(Object.assign({},r),e?{offset:e}:{}),t?{band:t}:{})}return r}function OG({scaleName:e,fieldDef:t,fieldDef2:n,offset:i,startSuffix:r,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=tq(t,{expr:o,suffix:r}),u=void 0!==n?tq(n,{expr:o}):tq(t,{suffix:"end",expr:o});if(0===a)return Object.assign({scale:e,field:s},i?{offset:i}:{});if(1===a)return Object.assign({scale:e,field:u},i?{offset:i}:{});{const t=`${a} * ${s} + ${1-a} * ${u}`;return Object.assign({signal:`scale("${e}", ${t})`},i?{offset:i}:{})}}function wG({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:a,scale:o,stack:s,offset:u,defaultRef:c}){if(t){if(GU(t)){if(VU(t)){const o=IU(e,t,n,i,r,{isMidPoint:!0});if(Sq(t.bin)||o&&t.timeUnit)return LR([pT,gT],e)&&LR([lI,dI],t.type)?s&&s.impute?xG(t,a,{binSuffix:"mid"},{offset:u}):OG({scaleName:a,fieldDef:t,band:o,offset:u}):xG(t,a,Eq(t,e)?{binSuffix:"range"}:{},{offset:u});if(Cq(t.bin)){if(GU(n))return OG({scaleName:a,fieldDef:t,fieldDef2:n,band:o,offset:u});{const t=e===pT?mT:vT;hB(uB.channelRequiredForBinned(t))}}}if(o){const e=o.get("type");if(MI(e)){if("band"===e){const e=uz(JU(t)?t.band:void 0,.5);return xG(t,a,{binSuffix:"range"},{band:e,offset:u})}return xG(t,a,{binSuffix:"range"},{offset:u})}}return xG(t,a,{},{offset:u})}if(YU(t)){const n=t.value,i=u?{offset:u}:{};return Object.assign(Object.assign({},jG(e,n)),i)}if(nU(t))return t}const l=Object(ie["D"])(c)?Object.assign(Object.assign({},c()),u?{offset:u}:{}):c;return l?Object.assign(Object.assign({},l),u?{offset:u}:{}):l}function jG(e,t){return LR(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:LR(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:fU(t)}function kG(e,t,n={}){const{markDef:i,encoding:r,config:a}=t,{vgChannel:o=e}=n;let{defaultRef:s,defaultValue:u}=n;void 0===s&&(u=null!==u&&void 0!==u?u:o===e?i[e]:uz(i[e],i[o],gU(e,i,a,{vgChannel:o})),void 0!==u&&(s=fU(u)));const c=r[e];return gG(t,c,o,n=>wG({channel:e,channelDef:n,markDef:i,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s}))}function _G(e,t={filled:void 0}){const{markDef:n,encoding:i,config:r}=e,{type:a}=n,o=uz(t.filled,n.filled),s={fill:gU("fill",n,r),stroke:gU("stroke",n,r),color:gU("color",n,r)},u=LR(["bar","point","circle","square","geoshape"],a)?"transparent":void 0,c=uz(n.fill,!0===o?n.color:void 0,s.fill,!0===o?s.color:void 0,u),l=uz(n.stroke,!1===o?n.color:void 0,s.stroke,!1===o?s.color:void 0),f=o?"fill":"stroke",d=Object.assign(Object.assign({},c?{fill:fU(c)}:{}),l?{stroke:fU(l)}:{});return n.color&&(o?n.fill:n.stroke)&&hB(uB.droppingColor("property",{fill:"fill"in n,stroke:"stroke"in n})),Object.assign(Object.assign(Object.assign(Object.assign({},d),kG("color",e,{vgChannel:f,defaultValue:o?c:l})),kG("fill",e,{defaultValue:i.fill?c:void 0})),kG("stroke",e,{defaultValue:i.stroke?l:void 0}))}function AG(e,t="text"){const n=e.encoding[t];return gG(e,n,t,t=>EG(t,e.config))}function EG(e,t,n="datum"){if(e){if(YU(e))return{value:e.value};if(VU(e))return bU(e,pq(e),n,t)}}function DG(e,t={}){const{encoding:n,markDef:i,config:r}=e,a=n.tooltip;return Object(ie["A"])(a)?{tooltip:SG({tooltip:a},r,t)}:gG(e,a,"tooltip",a=>{const o=EG(a,e.config,t.reactiveGeom?"datum.datum":"datum");if(o)return o;if(null===a)return;let s=uz(i.tooltip,gU("tooltip",i,r));return!0===s&&(s={content:"encoding"}),Object(ie["H"])(s)?{value:s}:Object(ie["F"])(s)?"encoding"===s.content?SG(n,r,t):{signal:"datum"}:void 0})}function SG(e,t,{reactiveGeom:n}={}){const i=[],r={},a={},o=n?"datum.datum":"datum",s=[];function u(n,i){const r=uL(i),u=VU(n)?n:Object.assign(Object.assign({},n),{type:e[r].type}),c=Object(ie["i"])(fq(u,t,{allowDisabling:!1})).join(", ");let l=EG(u,t,o).signal;if("x"===i||"y"===i){const n="x"===i?"x2":"y2",r=mq(e[n]);if(Cq(u.bin)&&r){const e=tq(u,{expr:o}),i=tq(r,{expr:o});l=wU(e,i,pq(u),t),a[n]=!0}}s.push({channel:i,key:c,value:l})}Bq(e,(e,t)=>{GU(e)?u(e,t):WU(e)&&u(e.condition,t)});for(const{channel:c,key:l,value:f}of s)a[c]||r[l]||(i.push(`${Object(ie["Z"])(l)}: ${f}`),r[l]=!0);return i.length>0?{signal:`{${i.join(", ")}}`}:void 0}function CG(e,t){const n=e+"Offset",i=t[n];if(i)return i}function FG(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:a,config:o,stack:s}=t,u=r[e],c=r[e===pT?mT:vT],l=t.scaleName(e),f=t.getScaleComponent(e),d=CG(e,a),h=MG({model:t,defaultPos:n,channel:e,scaleName:l,scale:f,checkBarAreaWithoutZero:!c}),p=u||!r.latitude&&!r.longitude?$G({channel:e,channelDef:u,channel2Def:c,markDef:a,config:o,scaleName:l,scale:f,stack:s,offset:d,defaultRef:h}):{field:t.getName(e)};return{[null!==i&&void 0!==i?i:e]:p}}function $G(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:a}=e;return GU(n)&&r&&t===r.fieldChannel?JU(n)&&void 0!==n.band?OG({scaleName:i,fieldDef:n,startSuffix:"start",band:n.band,offset:0}):xG(n,i,{suffix:"end"},{offset:a}):mG(e)}function MG({model:e,defaultPos:t,channel:n,scaleName:i,scale:r,checkBarAreaWithoutZero:a}){const{mark:o,markDef:s,config:u}=e;return()=>{const c=uL(n),l=uz(s[n],gU(n,s,u));if(void 0!==l)return jG(n,l);if("zeroOrMin"===t||"zeroOrMax"===t){if(i){const e=r.get("type");if(LR([mI.LOG,mI.TIME,mI.UTC],e))!a||"bar"!==o&&"area"!==o&&"rule"!==o||hB(uB.nonZeroScaleUsedWithLengthMark(o,c,{scaleType:e}));else{if(r.domainDefinitelyIncludesZero())return{scale:i,value:0};!a||"bar"!==o&&"area"!==o||hB(uB.nonZeroScaleUsedWithLengthMark(o,c,{zeroFalse:!1===r.explicit.zero}))}}return"zeroOrMin"===t?"x"===c?{value:0}:{field:{group:"height"}}:"x"===c?{field:{group:"width"}}:{value:0}}{const t=e["x"===c?"width":"height"];return Object.assign(Object.assign({},t),{mult:.5})}}}const NG={left:"x",center:"xc",right:"x2"},RG={top:"y",middle:"yc",bottom:"y2"};function zG(e,t,n){const i="x"===e?"align":"baseline",r=uz(t[i],gU(i,t,n));return"x"===e?NG[null!==r&&void 0!==r?r:"center"]:RG[null!==r&&void 0!==r?r:"middle"]}function TG(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?LG(e,t,{defaultPos:n,defaultPos2:i}):FG(e,t,{defaultPos:n})}function LG(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:a}=t,o="x"===e?"x2":"y2",s="x"===e?"width":"height",u=PG(t,i,o),c=u[s]?zG(e,r,a):e;return Object.assign(Object.assign({},FG(e,t,{defaultPos:n,vgChannel:c})),u)}function PG(e,t,n){const{encoding:i,mark:r,markDef:a,stack:o,config:s}=e,u="x2"===n?"x":"y",c="x2"===n?"width":"height",l=i[u],f=e.scaleName(u),d=e.getScaleComponent(u),h=CG(n,e.markDef);if(!l&&(i.latitude||i.longitude))return{[n]:{field:e.getName(n)}};const p=BG({channel:n,channelDef:l,channel2Def:i[n],markDef:a,config:s,scaleName:f,scale:d,stack:o,offset:h,defaultRef:void 0});if(void 0!==p)return{[n]:p};const g=MG({model:e,defaultPos:t,channel:n,scaleName:f,scale:d,checkBarAreaWithoutZero:!i[n]})();return uz(IG(n,a),IG(n,{[n]:mU(n,a,s.style),[c]:mU(c,a,s.style)}),IG(n,s[r]),IG(n,s.mark),{[n]:g})}function BG({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:a,scale:o,stack:s,offset:u,defaultRef:c}){return GU(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0)?xG(t,a,{suffix:"start"},{offset:u}):mG({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:i,config:r,offset:u,defaultRef:c})}function IG(e,t){const n="x2"===e?"width":"height";return t[e]?{[e]:jG(e,t[e])}:t[n]?{[n]:{value:t[n]}}:void 0}function UG(e,t,n){var i,r,a,o;const{config:s,encoding:u,markDef:c}=e,l="x"===t?"x2":"y2",f="x"===t?"width":"height",d=u[t],h=u[l],p=e.getScaleComponent(t),g=p?p.get("type"):void 0,m=e.scaleName(t),v=c.orient,b=null!==(o=null!==(a=null!==(r=null!==(i=u[f])&&void 0!==i?i:u.size)&&void 0!==r?r:c[f])&&void 0!==a?a:c.size)&&void 0!==o?o:gU("size",c,s,{vgChannel:f}),y="x"===t?"vertical"===v:"horizontal"===v;if(GU(d)&&(Sq(d.bin)||Cq(d.bin)||d.timeUnit&&!h)&&!b&&!MI(g)){const e=IU(t,d,void 0,c,s);return ZG({fieldDef:d,fieldDef2:h,channel:t,markDef:c,scaleName:m,band:e,spacing:uz(c.binSpacing,s[n].binSpacing),reverse:p.get("reverse")})}if((GU(d)&&MI(g)||y)&&!h){if(GU(d)&&g===mI.BAND){const i=JU(d)?d.band:void 0;return GG(d,t,e,WG(n,c,f,m,p,s,i))}return qG(t,e,WG(n,c,f,m,p,s))}return LG(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function qG(e,t,n){const i="x"===e?"xc":"yc",r="x"===e?"width":"height";return Object.assign(Object.assign({},FG(e,t,{defaultPos:"mid",vgChannel:i})),kG("size",t,{defaultRef:n,vgChannel:r}))}function WG(e,t,n,i,r,a,o){const s=uz(t[n],t.size,gU("size",t,a,{vgChannel:n}));if(void 0!==s)return fU(s);if(r){const t=r.get("type");if("point"===t||"band"===t){if(void 0!==a[e].discreteBandSize)return{value:a[e].discreteBandSize};if(t===mI.POINT){const e=r.get("range");return iU(e)&&Object(ie["E"])(e.step)?{value:e.step-2}:{value:YW-2}}return HG(i,o)}return{value:a[e].continuousBandSize}}const u=VW(a.view,n),c=uz(a[e].discreteBandSize,u-2);return{value:c}}function HG(e,t=!0){return{scale:e,band:t}}function GG(e,t,n,i){const r=n.scaleName(t),a="x"===t?"width":"height",{markDef:o,encoding:s,config:u}=n,c=zG(t,o,u),l=CG(t,o),f={[c]:xG(e,r,{},{band:.5,offset:l})};if(s.size||null!==o.size&&void 0!==o.size){const e=o.orient;if(e){if(vq(s.size)||YU(s.size))return Object.assign(Object.assign({},f),kG("size",n,{vgChannel:a}));if(void 0!==o.size)return Object.assign(Object.assign({},f),{[a]:{value:o.size}})}else hB(uB.cannotApplySizeToNonOrientedMark(o.type))}if(void 0!==(null===i||void 0===i?void 0:i.value))return Object.assign(Object.assign({},f),{[a]:i});const{band:d=1}=e;return{[t]:xG(e,r,{binSuffix:"range"},{band:(1-d)/2,offset:l}),[a]:null!==i&&void 0!==i?i:HG(r,d)}}function VG(e,t,n){if(nU(n))return"x"===e||"y2"===e?{signal:`${n.signal} ? ${t} : 0`}:{signal:`${n.signal} ? 0 : ${t}`};{const i={x:n?t:0,x2:n?0:t,y:n?0:t,y2:n?t:0};return i[e]}}function ZG({fieldDef:e,fieldDef2:t,channel:n,band:i,scaleName:r,markDef:a,spacing:o=0,reverse:s}){const u=n===pT?mT:vT;return Sq(e.bin)||e.timeUnit?{[u]:YG({channel:n,fieldDef:e,scaleName:r,markDef:a,band:(1-i)/2,offset:VG(u,o,s)}),[n]:YG({channel:n,fieldDef:e,scaleName:r,markDef:a,band:1-(1-i)/2,offset:VG(n,o,s)})}:Cq(e.bin)&&GU(t)?{[u]:xG(e,r,{},{offset:VG(u,o,s)}),[n]:xG(t,r,{},{offset:VG(n,o,s)})}:void hB(uB.channelRequiredForBinned(u))}function YG({channel:e,fieldDef:t,scaleName:n,markDef:i,band:r,offset:a}){const o=OG({scaleName:n,fieldDef:t,band:r,offset:a});return vG({fieldDef:t,channel:e,markDef:i,ref:o})}function XG(e,t){const{fill:n,stroke:i}="include"===t.color?_G(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},QG(e.markDef,t)),JG(e,"fill",n)),JG(e,"stroke",i)),kG("opacity",e)),kG("fillOpacity",e)),kG("strokeOpacity",e)),kG("strokeWidth",e)),kG("strokeDash",e)),DG(e)),AG(e,"href"))}function JG(e,t,n){const{config:i,mark:r,markDef:a}=e,o=pU("invalid",a,i);if("hide"===o&&n&&!zz(r)){const i=KG(e,{invalid:!0,channels:zL});if(i)return{[t]:[{test:i,value:null},...Object(ie["i"])(n)]}}return n?{[t]:n}:{}}function QG(e,t){return uU.reduce((n,i)=>(void 0!==e[i]&&"ignore"!==t[i]&&(n[i]={value:e[i]}),n),{})}function KG(e,{invalid:t=!1,channels:n}){const i=n.reduce((t,n)=>{const i=e.getScaleComponent(n);if(i){const r=i.get("type"),a=e.vgField(n,{expr:"datum"});a&&NI(r)&&(t[a]=!0)}return t},{}),r=ZR(i);if(r.length>0){const e=t?"||":"&&";return r.map(e=>yG(e,t)).join(` ${e} `)}}function eV(e){const{config:t,markDef:n}=e,i=pU("invalid",n,t);if(i){const t=tV(e,{channels:["x","y"]});if(t)return{defined:{signal:t}}}return{}}function tV(e,{invalid:t=!1,channels:n}){const i=n.reduce((t,n)=>{const i=e.getScaleComponent(n);if(i){const r=i.get("type"),a=e.vgField(n,{expr:"datum"});a&&NI(r)&&(t[a]=!0)}return t},{}),r=ZR(i);if(r.length>0){const e=t?"||":"&&";return r.map(e=>yG(e,t)).join(` ${e} `)}}function nV(e,t){if(void 0!==t)return{[e]:{value:t}}}const iV="voronoi",rV={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(iV)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,a=e.mark;if(zz(a))return hB(uB.nearestNotSupportForContinuous(a)),n;const o={name:e.getName(iV),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},DG(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,u=!1;return n.forEach((t,n)=>{var i;const r=null!==(i=t.name)&&void 0!==i?i:"";r===e.component.mark[0].name?s=n:r.indexOf(iV)>=0&&(u=!0)}),u||n.splice(s+1,0,o),n}};var aV=rV;class oV{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?console.warn("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const n of this._children)n.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class sV extends oV{constructor(e,t,n,i){super(e,t),this.type=n,this.refCounts=i,this._source=this._name=t,!this.refCounts||this._name in this.refCounts||(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash=`Output ${lz()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class uV extends oV{constructor(e,t){super(e),this.formula=t}clone(){return new uV(null,$R(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((e,n,i)=>{const{field:r,timeUnit:a}=n,o=uQ(t)?t.encoding[cL(i)]:void 0,s=uQ(t)&&UU(i,n,o,t.markDef,t.config);if(a){const t=tq(n,{forAs:!0});e[zR({as:t,field:r,timeUnit:a})]=Object.assign({as:t,field:r,timeUnit:a},s?{band:!0}:{})}return e},{});return 0===ZR(n).length?null:new uV(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:i}=n,r=yR(n,["timeUnit"]),a=HB(i),o=Object.assign(Object.assign({},r),{timeUnit:a});return new uV(e,{[zR(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(YR(this.formula).map(e=>e.as))}dependentFields(){return new Set(YR(this.formula).map(e=>e.field))}hash(){return`TimeUnit ${zR(this.formula)}`}assemble(){const e=[];for(const t of YR(this.formula)){const{field:n,as:i,timeUnit:r}=t,a=HB(r),{unit:o,utc:s}=a,u=yR(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:n,type:"timeunit"},o?{units:BB(o)}:{}),s?{timezone:"utc"}:{}),u),{as:[i,`${i}_end`]}))}return e}}const cV="_tuple_fields";class lV{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const fV={has:()=>!0,parse:(e,t,n)=>{var i,r,a;const o=t.name,s=null!==(i=t.project)&&void 0!==i?i:t.project=new lV,u={},c={},l=new Set,f=(e,t)=>{const n="visual"===t?e.channel:e.field;let i=JR(`${o}_${n}`);for(let r=1;l.has(i);r++)i=JR(`${o}_${n}_${r}`);return l.add(i),{[t]:i}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of Object(ie["i"])(n.init))for(const i of ZR(e))rL(i)?(n.encodings||(n.encodings=[])).push(i):"interval"===n.type?(hB('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(i);else n.encodings=t.encodings,n.fields=t.fields}for(const d of null!==(r=n.fields)&&void 0!==r?r:[]){const e={type:"E",field:d};e.signals=Object.assign({},f(e,"data")),s.items.push(e),s.hasField[d]=e}for(const d of null!==(a=n.encodings)&&void 0!==a?a:[]){const n=e.fieldDef(d);if(n){let i=n.field;if(n.aggregate){hB(uB.cannotProjectAggregate(d,n.aggregate));continue}if(!i){hB(uB.cannotProjectOnChannelWithoutField(d));continue}if(n.timeUnit){i=e.vgField(d);const t={timeUnit:n.timeUnit,as:i,field:n.field};c[zR(t)]=t}if(!u[i]){let r="E";if("interval"===t.type){const t=e.getScaleComponent(d).get("type");NI(t)&&(r="R")}else n.bin&&(r="R-RE");const a={field:i,channel:d,type:r};a.signals=Object.assign(Object.assign({},f(a,"data")),f(a,"visual")),s.items.push(u[i]=a),s.hasField[i]=s.hasChannel[d]=u[i]}}else hB(uB.cannotProjectOnChannelWithoutField(d))}if(n.init){const e=e=>s.items.map(t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]);if("interval"===n.type)t.init=e(n.init);else{const i=Object(ie["i"])(n.init);t.init=i.map(e)}}ZR(c).length>0&&(s.timeUnit=new uV(null,c))},signals:(e,t,n)=>{const i=t.name+cV,r=n.filter(e=>e.name===i);return r.length>0?n:n.concat({name:i,value:t.project.items.map(e=>{const{signals:t,hasLegend:n}=e,i=yR(e,["signals","hasLegend"]),r=$R(i);return r.field=rz(r.field),r})})}};var dV=fV;const hV={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!MW(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,a=t.bind,o=t.init&&t.init[0],s=aV.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((e,r)=>{var u,c;const l=JR(`${i}_${e.field}`),f=n.filter(e=>e.name===l);f.length||n.unshift(Object.assign(Object.assign({name:l},o?{init:PV(o[r])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${Object(ie["Z"])(e.field)}] : null`}]:[],bind:null!==(c=null!==(u=a[e.field])&&void 0!==u?u:a[e.channel])&&void 0!==c?c:a}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,a=n.filter(e=>e.name===i+oZ)[0],o=i+cV,s=r.items.map(e=>JR(`${i}_${e.field}`)),u=s.map(e=>`${e} !== null`).join(" && ");return s.length&&(a.update=`${u} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}};var pV=hV;const gV="_toggle",mV={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+gV,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+oZ,i=t.name+gV;return`${i} ? null : ${n}, `+("global"===t.resolve?`${i} ? null : true, `:`${i} ? null : {unit: ${dZ(e)}}, `)+`${i} ? ${n} : null`}};var vV=mV;const bV={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=Object(ie["H"])(n.clear)?zC(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>(pV.has(t)&&t.project.items.forEach(e=>{const i=n.findIndex(n=>n.name===JR(`${t.name}_${e.field}`));-1!==i&&n[i].on.push({events:t.clear,update:"null"})}),n),signals:(e,t,n)=>{function i(e,i){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:i})}if("interval"===t.type)t.project.items.forEach(e=>{const t=n.findIndex(t=>t.name===e.signals.visual);if(i(t,"[0, 0]"),-1===t){const t=n.findIndex(t=>t.name===e.signals.data);i(t,"null")}});else{let e=n.findIndex(e=>e.name===t.name+oZ);i(e,"null"),vV.has(t)&&(e=n.findIndex(e=>e.name===t.name+gV),i(e,"false"))}return n}};var yV=bV;const xV={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!TL(r))continue;const a=e.getScaleComponent(r),o=a?a.get("type"):void 0;if(!a||!NI(o)){hB(uB.SCALE_BINDINGS_CONTINUOUS);continue}const s={selection:t.name,field:i.field};if(a.set("selectionExtent",s,!0),n.push(i),e.repeater&&e.repeater.row===e.repeater.column){const t=e.getScaleComponent(r===pT?gT:pT);t.set("selectionExtent",s,!0)}}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(e=>0===n.filter(t=>t.name===e.signals.data).length);if(!e.parent||jV(e)||0===i.length)return n;const r=n.filter(e=>e.name===t.name)[0];let a=r.update;if(a.indexOf(uZ)>=0)r.update=`{${i.map(e=>`${Object(ie["Z"])(e.field)}: ${e.signals.data}`).join(", ")}}`;else{for(const e of i){const t=`${Object(ie["Z"])(e.field)}: ${e.signals.data}`;a.indexOf(t)<0&&(a=`${a.substring(0,a.length-1)}, ${t}}`)}r.update=a}return n.concat(i.map(e=>({name:e.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!jV(e))for(const i of t.scales){const e=n.filter(e=>e.name===i.signals.data)[0];e.push="outer",delete e.value,delete e.update}return n}};var OV=xV;function wV(e,t){const n=Object(ie["Z"])(e.scaleName(t));return`domain(${n})`}function jV(e){var t;return e.parent&&dQ(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:jV(e.parent.parent))}const kV={has:e=>{const t="global"===e.resolve&&e.bind&&MW(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==FW;return t&&!n&&hB(uB.LEGEND_BINDINGS_PROJECT_LENGTH),t&&n},parse:(e,t,n,i)=>{var r;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=Object(ie["i"])(null!==(r=n.filter)&&void 0!==r?r:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const a=NW(t.bind)?t.bind.legend:"click",o=Object(ie["H"])(a)?zC(a,"view"):Object(ie["i"])(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=NW(t.bind)&&t.bind.legend,a=e=>t=>{const n=$R(t);return n.markname=e,n};for(const o of t.project.items){if(!o.hasLegend)continue;const e=`${JR(o.field)}_legend`,s=`${i}_${e}`,u=n.filter(e=>e.name===s);if(0===u.length){const i=r.merge.map(a(`${e}_symbols`)).concat(r.merge.map(a(`${e}_labels`))).concat(r.merge.map(a(`${e}_entries`)));n.unshift(Object.assign(Object.assign({name:s},t.init?{}:{value:null}),{on:[{events:i,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${s}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,a=n.find(e=>e.name===i+oZ),o=i+cV,s=r.items.filter(e=>e.hasLegend).map(e=>JR(`${i}_${JR(e.field)}_legend`)),u=s.map(e=>`${e} !== null`).join(" && "),c=`${u} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map(e=>({signal:e})),update:c}):s.length>0&&(a.update=c,delete a.value,delete a.on);const l=n.find(e=>e.name===i+gV),f=NW(t.bind)&&t.bind.legend;return l&&(t.events?l.on.push(Object.assign(Object.assign({},l.on[0]),{events:f})):l.on[0].events=f),n}};var _V=kV;function AV(e,t,n){const i=e.fieldDef(t).field;lZ(e,e=>{var r,a;const o=null!==(r=e.project.hasField[i])&&void 0!==r?r:e.project.hasChannel[t];if(o&&kV.has(e)){const t=null!==(a=n.get("selections"))&&void 0!==a?a:[];t.push(e.name),n.set("selections",t,!1),o.hasLegend=!0}})}const EV="_translate_anchor",DV="_translate_delta",SV={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const i=t.name,r=OV.has(t),a=i+EV,{x:o,y:s}=t.project.hasChannel;let u=zC(t.translate,"scope");return r||(u=u.map(e=>(e.between[0].markname=i+ZV,e))),n.push({name:a,value:{},on:[{events:u.map(e=>e.between[0]),update:"{x: x(unit), y: y(unit)"+(void 0!==o?", extent_x: "+(r?wV(e,pT):`slice(${o.signals.visual})`):"")+(void 0!==s?", extent_y: "+(r?wV(e,gT):`slice(${s.signals.visual})`):"")+"}"}]},{name:i+DV,value:{},on:[{events:u,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),void 0!==o&&FV(e,t,o,"width",n),void 0!==s&&FV(e,t,s,"height",n),n}};var CV=SV;function FV(e,t,n,i,r){var a;const o=t.name,s=o+EV,u=o+DV,c=n.channel,l=OV.has(t),f=r.filter(e=>e.name===n.signals[l?"data":"visual"])[0],d=e.getSizeSignalRef(i).signal,h=e.getScaleComponent(c),p=h.get("type"),g=l&&c===pT?"-":"",m=`${s}.extent_${c}`,v=`${g}${u}.${c} / `+(l?`${d}`:`span(${m})`),b=l?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear",y=`${b}(${m}, ${v}`+(l&&"pow"===p?`, ${null!==(a=h.get("exponent"))&&void 0!==a?a:1}`:"")+")";f.on.push({events:{signal:u},update:l?y:`clampRange(${y}, 0, ${d})`})}const $V="_zoom_anchor",MV="_zoom_delta",NV={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=OV.has(t),a=i+MV,{x:o,y:s}=t.project.hasChannel,u=Object(ie["Z"])(e.scaleName(pT)),c=Object(ie["Z"])(e.scaleName(gT));let l=zC(t.zoom,"scope");return r||(l=l.map(e=>(e.markname=i+ZV,e))),n.push({name:i+$V,on:[{events:l,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",c?`y: invert(${c}, y(unit))`:""].filter(e=>!!e).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:l,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==o&&zV(e,t,o,"width",n),void 0!==s&&zV(e,t,s,"height",n),n}};var RV=NV;function zV(e,t,n,i,r){var a;const o=t.name,s=n.channel,u=OV.has(t),c=r.filter(e=>e.name===n.signals[u?"data":"visual"])[0],l=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(s),d=f.get("type"),h=u?wV(e,s):c.name,p=o+MV,g=`${o}${$V}.${s}`,m=u?"log"===d?"zoomLog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear",v=`${m}(${h}, ${g}, ${p}`+(u&&"pow"===d?`, ${null!==(a=f.get("exponent"))&&void 0!==a?a:1}`:"")+")";c.on.push({events:{signal:p},update:u?v:`clampRange(${v}, 0, ${l})`})}const TV=[dV,vV,OV,_V,CV,RV,pV,aV,yV];function LV(e,t){for(const n of TV)n.has(e)&&t(n)}function PV(e,t=!0,n=ie["x"]){if(Object(ie["A"])(e)){const i=e.map(e=>PV(e,t,n));return t?`[${i.join(", ")}]`:i}return mB(e)?n(t?_B(e):EB(e)):t?n(JSON.stringify(e)):e}function BV(e,t){return lZ(e,(n,i)=>{const r=n.name;let a=i.modifyExpr(e,n);t.push(...i.signals(e,n)),LV(n,i=>{i.signals&&(t=i.signals(e,n,t)),i.modifyExpr&&(a=i.modifyExpr(e,n,a))}),t.push({name:r+sZ,on:[{events:{signal:n.name+oZ},update:`modify(${Object(ie["Z"])(n.name+aZ)}, ${a})`}]})}),VV(t)}function IV(e,t){if(e.component.selection&&ZR(e.component.selection).length){const n=Object(ie["Z"])(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:zC("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return VV(t)}function UV(e,t){let n=!1;if(lZ(e,(i,r)=>{const a=i.name,o=Object(ie["Z"])(a+aZ),s=t.filter(e=>e.name===a);if(0===s.length){const e="global"===i.resolve?"union":i.resolve,n="multi"===i.type?", true)":")";t.push({name:i.name,update:`${uZ}(${o}, ${Object(ie["Z"])(e)}${n}`})}n=!0,r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),LV(i,n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,i,t))})}),n){const e=t.filter(e=>"unit"===e.name);0===e.length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return VV(t)}function qV(e,t){const n=[...t];return lZ(e,t=>{const i={name:t.name+aZ};if(t.init){const n=t.project.items.map(e=>{const{signals:t}=e,n=yR(e,["signals"]);return n}),r=t.init.map(e=>PV(e,!1));i.values="interval"===t.type?[{unit:dZ(e,{escape:!1}),fields:n,values:r}]:r.map(t=>({unit:dZ(e,{escape:!1}),fields:n,values:t}))}const r=n.filter(e=>e.name===t.name+aZ);r.length||n.push(i)}),n}function WV(e,t){return lZ(e,(n,i)=>{t=i.marks?i.marks(e,n,t):t,LV(n,i=>{i.marks&&(t=i.marks(e,n,t))})}),t}function HV(e,t){for(const n of e.children)uQ(n)&&(t=WV(n,t));return t}function GV(e,t){const n=t.selection,i=e.getSelectionComponent(n,JR(n));return{signal:xZ(i,t)}}function VV(e){return e.map(e=>(e.on&&!e.on.length&&delete e.on,e))}const ZV="_brush",YV="_scale_trigger",XV={signals:(e,t)=>{const n=t.name,i=n+cV,r=OV.has(t),a=[],o=[],s=[];if(t.translate&&!r){const e=`!event.item || event.item.mark.name !== ${Object(ie["Z"])(n+ZV)}`;KV(t,(t,n)=>{var i;const r=Object(ie["i"])(null!==(i=n.between[0].filter)&&void 0!==i?i:n.between[0].filter=[]);return r.indexOf(e)<0&&r.push(e),t})}t.project.items.forEach((n,i)=>{const r=n.channel;if(r!==pT&&r!==gT)return void hB("Interval selections only support x and y encoding channels.");const u=t.init?t.init[i]:null,c=QV(e,t,n,u),l=n.signals.data,f=n.signals.visual,d=Object(ie["Z"])(e.scaleName(r)),h=e.getScaleComponent(r).get("type"),p=NI(h)?"+":"";a.push(...c),o.push(l),s.push({scaleName:e.scaleName(r),expr:`(!isArray(${l}) || `+`(${p}invert(${d}, ${f})[0] === ${p}${l}[0] && `+`${p}invert(${d}, ${f})[1] === ${p}${l}[1]))`})}),r||a.push({name:n+YV,value:{},on:[{events:s.map(e=>({scale:e.scaleName})),update:s.map(e=>e.expr).join(" && ")+` ? ${n+YV} : {}`}]});const u=t.init,c=`unit: ${dZ(e)}, fields: ${i}, values`;return a.concat(Object.assign(Object.assign({name:n+oZ},u?{init:`{${c}: ${PV(u)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${c}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>{const n=t.name+oZ;return n+", "+("global"===t.resolve?"true":`{unit: ${dZ(e)}}`)},marks:(e,t,n)=>{const i=t.name,{x:r,y:a}=t.project.hasChannel,o=r&&r.signals.visual,s=a&&a.signals.visual,u=`data(${Object(ie["Z"])(t.name+aZ)})`;if(OV.has(t))return n;const c={x:void 0!==r?{signal:`${o}[0]`}:{value:0},y:void 0!==a?{signal:`${s}[0]`}:{value:0},x2:void 0!==r?{signal:`${o}[1]`}:{field:{group:"width"}},y2:void 0!==a?{signal:`${s}[1]`}:{field:{group:"height"}}};if("global"===t.resolve)for(const m of ZR(c))c[m]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${dZ(e)}`},c[m]),{value:0}];const l=t.mark,{fill:f,fillOpacity:d,cursor:h}=l,p=yR(l,["fill","fillOpacity","cursor"]),g=ZR(p).reduce((e,t)=>(e[t]=[{test:[void 0!==r&&`${o}[0] !== ${o}[1]`,void 0!==a&&`${s}[0] !== ${s}[1]`].filter(e=>e).join(" && "),value:p[t]},{value:null}],e),{});return[{name:i+ZV+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:c}},...n,{name:i+ZV,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},c),g)}}]}};var JV=XV;function QV(e,t,n,i){const r=n.channel,a=n.signals.visual,o=n.signals.data,s=OV.has(t),u=Object(ie["Z"])(e.scaleName(r)),c=e.getScaleComponent(r),l=c?c.get("type"):void 0,f=e=>`scale(${u}, ${e})`,d=e.getSizeSignalRef(r===pT?"width":"height").signal,h=`${r}(unit)`,p=KV(t,(e,t)=>[...e,{events:t.between[0],update:`[${h}, ${h}]`},{events:t,update:`[${a}[0], clamp(${h}, 0, ${d})]`}]);return p.push({events:{signal:t.name+YV},update:NI(l)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},i?{init:PV(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:PV(i)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${u}, ${a})`}]})]}function KV(e,t){return e.events.reduce((e,n)=>n.between?t(e,n):(hB(`${n} is not an ordered event stream for interval selections.`),e),[])}function eZ(e,t){const n=t.name,i=n+cV,r=t.project,a="(item().isVoronoi ? datum.datum : datum)",o=r.items.map(t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${a}[${Object(ie["Z"])(e.vgField(t.channel,{}))}], `+`${a}[${Object(ie["Z"])(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${a}[${Object(ie["Z"])(t.field)}]`}).join(", "),s=`unit: ${dZ(e)}, fields: ${i}, values`,u=t.events;return[{name:n+oZ,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${o}]} : null`,force:!0}]:[]}]}const tZ={signals:eZ,modifyExpr:(e,t)=>{const n=t.name+oZ;return n+", "+("global"===t.resolve?"null":`{unit: ${dZ(e)}}`)}};var nZ=tZ;const iZ={signals:eZ,modifyExpr:(e,t)=>{const n=t.name+oZ;return n+", "+("global"===t.resolve?"true":`{unit: ${dZ(e)}}`)}};var rZ=iZ;const aZ="_store",oZ="_tuple",sZ="_modify",uZ="vlSelectionResolve",cZ={single:rZ,multi:nZ,interval:JV};function lZ(e,t){const n=e.component.selection;if(n)for(const i of YR(n)){const e=t(i,cZ[i.type]);if(!0===e)break}}function fZ(e){let t=e.parent;while(t){if(cQ(t))break;t=t.parent}return t}function dZ(e,{escape:t}={escape:!0}){let n=t?Object(ie["Z"])(e.name):e.name;const i=fZ(e);if(i){const{facet:e}=i;for(const t of VT)e[t]&&(n+=` + '__facet_${t}_' + (facet[${Object(ie["Z"])(i.vgField(t))}])`)}return n}function hZ(e){let t=!1;return lZ(e,e=>{t=t||e.project.items.some(e=>e.field===FW)}),t}function pZ(e){const t=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(t.push(...pZ(e.object)),t.push(...pZ(e.property))),t)}function gZ(e){return"MemberExpression"===e.object.type?gZ(e.object):"datum"===e.object.name}function mZ(e){const t=XA(e),n=new Set;return t.visit(e=>{"MemberExpression"===e.type&&gZ(e)&&n.add(pZ(e).slice(1).join("."))}),n}class vZ extends oV{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=wZ(this.model,this.filter,this),this._dependentFields=mZ(this.expr)}clone(){return new vZ(null,this.model,$R(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function bZ(e,t){var n;const i={},r=e.config.selection;for(const a of ZR(null!==t&&void 0!==t?t:{})){const o=$R(t[a]),s=r[o.type],{fields:u,encodings:c}=s,l=yR(s,["fields","encodings"]);for(const e in l)"encodings"===e&&o.fields||"fields"===e&&o.encodings||("mark"===e&&(o[e]=Object.assign(Object.assign({},l[e]),o[e])),void 0!==o[e]&&!0!==o[e]||(o[e]=null!==(n=l[e])&&void 0!==n?n:o[e]));const f=JR(a),d=i[f]=Object.assign(Object.assign({},o),{name:f,events:Object(ie["H"])(o.on)?zC(o.on,"scope"):$R(o.on)});LV(d,n=>{n.has(d)&&n.parse&&n.parse(e,d,o,t[a])})}return i}function yZ(e,t,n,i="datum"){const r=[];function a(t){const a=JR(t),o=e.getSelectionComponent(a,t),s=Object(ie["Z"])(a+aZ);if(o.project.timeUnit){const t=null!==n&&void 0!==n?n:e.component.data.raw,i=o.project.timeUnit.clone();t.parent?i.insertAsParentOf(t):t.parent=i}return"none"!==o.empty&&r.push(s),`vlSelectionTest(${s}, ${i}`+("global"===o.resolve?")":`, ${Object(ie["Z"])(o.resolve)})`)}const o=QR(t,a);return(r.length?"!("+r.map(e=>`length(data(${e}))`).join(" || ")+") || ":"")+`(${o})`}function xZ(e,t){const n=t["encoding"];let i=t["field"];if(n||i){if(n&&!i){const r=e.project.items.filter(e=>e.channel===n);!r.length||r.length>1?(i=e.project.items[0].field,hB((r.length?"Multiple ":"No ")+`matching ${Object(ie["Z"])(n)} encoding found for selection ${Object(ie["Z"])(t.selection)}. `+`Using "field": ${Object(ie["Z"])(i)}.`)):i=r[0].field}}else i=e.project.items[0].field,e.project.items.length>1&&hB('A "field" or "encoding" must be specified when using a selection as a scale domain. '+`Using "field": ${Object(ie["Z"])(i)}.`);return`${e.name}[${Object(ie["Z"])(i)}]`}function OZ(e,t){lZ(e,n=>{const i=n.name,r=e.getName(`lookup_${i}`);e.component.data.outputNodes[r]=n.materialized=new sV(new vZ(t,e,{selection:i}),r,"lookup",e.component.data.outputNodeRefCounts)})}function wZ(e,t,n){return QR(t,t=>Object(ie["H"])(t)?t:ZB(t)?yZ(e,t.selection,n):oI(t))}function jZ(e,t){if(e)return tU(e)?e:e.map(e=>hq(e,t)).join(", ")}function kZ(e,t,n,i){var r,a,o;e.encode=null!==(r=e.encode)&&void 0!==r?r:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=i}function _Z(e,t,n,i={header:!1}){var r,a;const o=e.combine(),{orient:s,scale:u,labelExpr:c,labelOffset:l,title:f,zindex:d}=o,h=yR(o,["orient","scale","labelExpr","labelOffset","title","zindex"]);for(const p in h){const e=bz[p],n=h[p];if(e&&e!==t&&"both"!==e)delete h[p];else if(mz(n)){const{condition:e,value:t}=n,i=Object(ie["i"])(e),r=gz[p];if(r){const{vgProp:e,part:n}=r,a=[...i.map(e=>{const{value:t,test:n}=e;return{test:wZ(null,n),value:t}}),{value:t}];kZ(h,n,e,a),delete h[p]}else if(null===r){const e={signal:i.map(e=>{const{value:t,test:n}=e;return`${wZ(null,n)} ? ${Object(ie["Z"])(t)} : `}).join("")+Object(ie["Z"])(t)};h[p]=e}}else if(nU(n)){const e=gz[p];if(e){const{vgProp:t,part:i}=e;kZ(h,i,t,n),delete h[p]}}}if("grid"===t){if(!h.grid)return;if(h.encode){const{grid:e}=h.encode;h.encode=Object.assign({},e?{grid:e}:{}),0===ZR(h.encode).length&&delete h.encode}return Object.assign(Object.assign({scale:u,orient:s},h),{domain:!1,labels:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:uz(d,0)})}{if(!i.header&&e.mainExtracted)return;if(void 0!==c){let e=c;(null===(a=null===(r=h.encode)||void 0===r?void 0:r.labels)||void 0===a?void 0:a.update)&&nU(h.encode.labels.update.text)&&(e=az(c,"datum.label",h.encode.labels.update.text.signal)),kZ(h,"labels","text",{signal:e})}if(l){let e;if(mz(l)){const{condition:t,value:n}=l,i=Object(ie["i"])(t);e=[...i.map(e=>{const{value:t,test:n}=e;return{test:wZ(null,n),value:t}}),{value:n}]}else e={value:l};kZ(h,"labels","bottom"===s||"top"===s?"dx":"dy",e)}if(h.encode){for(const t of vz)e.hasAxisPart(t)||delete h.encode[t];0===ZR(h.encode).length&&delete h.encode}const t=jZ(f,n);return Object.assign(Object.assign(Object.assign({scale:u,orient:s,grid:!1},t?{title:t}:{}),h),{zindex:uz(d,0)})}}function AZ(e){const{axes:t}=e.component;for(const n of OL)if(t[n])for(const i of t[n])if(!i.get("gridScale")){const t="x"===n?"height":"width";return[{name:t,update:e.getSizeSignalRef(t).signal}]}return[]}function EZ(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(e=>_Z(e,"grid",t)),...i.map(e=>_Z(e,"grid",t)),...n.map(e=>_Z(e,"main",t)),...i.map(e=>_Z(e,"main",t))].filter(e=>e)}const DZ={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},SZ={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelLimit:"limit",labelOrient:"orient",labelPadding:"offset"},CZ=ZR(DZ),FZ=ZR(SZ);function $Z(e,t,n,i,r,a){var o;const s=vU(e,a,t.style);if(void 0!==s)return{configFrom:"style",configValue:s};const u=[..."band"===r?["axisBand","axisDiscrete"]:[],..."point"===r?["axisPoint","axisDiscrete"]:[],...AI(r)?["axisQuantitative"]:[],..."time"===r||"utc"===r?["axisTemporal"]:[],"x"===n?"axisX":"axisY",...i?["axis"+i.substr(0,1).toUpperCase()+i.substr(1)]:[],"axis"];for(const c of u)if(void 0!==(null===(o=t[c])||void 0===o?void 0:o[e]))return{configFrom:c,configValue:t[c][e]};return{}}function MZ(e,t){return!MI(e)&&!Sq(t.bin)}function NZ(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function RZ(e,t,n,i){if(void 0!==t.labelAngle)return hz(t.labelAngle);{const{configValue:r}=$Z("labelAngle",e.config,n,BZ(n),e.getScaleComponent(n).get("type"),t.style);return void 0!==r?hz(r):n===pT&&LR([hI,fI],i.type)?270:void 0}}function zZ(e,t){if(void 0!==e)return e=hz(e),"top"===t||"bottom"===t?e<=45||315<=e?"top"===t?"bottom":"top":135<=e&&e<=225?"top"===t?"top":"bottom":"middle":e<=45||315<=e||135<=e&&e<=225?"middle":45<=e&&e<=135?"left"===t?"top":"bottom":"left"===t?"bottom":"top"}function TZ(e,t){if(void 0!==e)return e=hz(e),"top"===t||"bottom"===t?e%180===0?"center":0<e&&e<180?"top"===t?"right":"left":"top"===t?"left":"right":(e+90)%180===0?"center":90<=e&&e<270?"left"===t?"left":"right":"left"===t?"right":"left"}function LZ(e,t){if("x"===t&&LR(["quantitative","temporal"],e.type))return!0}function PZ(e,t){if("nominal"!==e.type)return"log"!==t||"greedy"}function BZ(e){switch(e){case pT:return"bottom";case gT:return"left"}throw new Error(uB.INVALID_CHANNEL_FOR_AXIS)}function IZ({fieldDef:e,scaleType:t,size:n}){var i;if(!MI(t)&&"log"!==t&&!LR(["month","hours","day","quarter"],null===(i=HB(e.timeUnit))||void 0===i?void 0:i.unit))return Sq(e.bin)?{signal:`ceil(${n.signal}/10)`}:{signal:`ceil(${n.signal}/40)`}}function UZ(e,t,n){const i=e.values;return Object(ie["A"])(i)?Aq(n,i):nU(i)?i:void 0}function qZ(e,t){return"rect"===e&&nq(t)?1:0}class WZ extends oV{constructor(e,t){super(e),this.transform=t,this._dependentFields=mZ(this.transform.calculate)}clone(){return new WZ(null,$R(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef((t,n)=>{if(XU(t)&&MU(t.sort)){const{field:i,timeUnit:r}=t,a=t.sort,o=a.map((e,t)=>`${oI({field:i,timeUnit:r,equal:e})} ? ${t} : `).join("")+a.length;e=new WZ(e,{calculate:o,as:HZ(t,n,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${zR(this.transform)}`}}function HZ(e,t,n){return tq(e,Object.assign({prefix:t,suffix:"sort_index"},null!==n&&void 0!==n?n:{}))}function GZ(e,t){return LR(["top","bottom"],t)?"column":LR(["left","right"],t)||"row"===e?"row":"column"}function VZ(e,t,n,i){const r="row"===i?n.headerRow:"column"===i?n.headerColumn:n.headerFacet;return uz(t&&t.header?t.header[e]:void 0,r[e],n.header[e])}function ZZ(e,t,n,i){const r={};for(const a of e){const e=VZ(a,t,n,i);void 0!==e&&(r[a]=e)}return r}const YZ=["row","column"],XZ=["header","footer"];function JZ(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=ZZ(["titleAnchor","titleAngle","titleOrient"],r,i,t),u=GZ(t,s);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),KZ(o,u)),QZ(u,o,a)),sY(i,r,t,CZ,DZ))}}function QZ(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=TZ(t,"row"===e?"left":"top");return i?{align:i}:{}}function KZ(e,t){const n=zZ(e,"row"===t?"left":"top");return n?{baseline:n}:{}}function eY(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of XZ)if(n[r])for(const a of n[r])i.push(iY(e,t,r,n,a));return i}function tY(e,t){var n;const{sort:i}=e;return $U(i)?{field:tq(i,{expr:"datum"}),order:null!==(n=i.order)&&void 0!==n?n:"ascending"}:Object(ie["A"])(i)?{field:HZ(e,t,{expr:"datum"}),order:"ascending"}:{field:tq(e,{expr:"datum"}),order:null!==i&&void 0!==i?i:"ascending"}}function nY(e,t,n){const{format:i,labelAngle:r,labelAnchor:a,labelOrient:o,labelExpr:s}=ZZ(["format","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),u=bU(e,i,"parent",n).signal,c=GZ(t,o);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:s?az(az(s,"datum.label",u),"datum.value",tq(e,{expr:"parent"})):u}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),KZ(r,c)),QZ(c,r,a)),sY(n,e,t,FZ,SZ))}function iY(e,t,n,i,r){if(r){let a=null;const{facetFieldDef:o}=i,s=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:e}=ZZ(["labelOrient"],o,s,t);("row"===t&&!LR(["top","bottom"],e)||"column"===t&&!LR(["left","right"],e))&&(a=nY(o,t,s))}const u=cQ(e)&&!NU(e.facet),c=r.axes,l=(null===c||void 0===c?void 0:c.length)>0;if(a||l){const s="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:tY(o,t)}:{}),l&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),a?{title:a}:{}),r.sizeSignal?{encode:{update:{[s]:r.sizeSignal}}}:{}),l?{axes:c}:{})}}return null}const rY={column:{start:0,end:1},row:{start:1,end:0}};function aY(e,t){return rY[t][e]}function oY(e,t){const n={};for(const i of VT){const r=e[i];if(null===r||void 0===r?void 0:r.facetFieldDef){const{titleAnchor:e,titleOrient:a}=ZZ(["titleAnchor","titleOrient"],r.facetFieldDef,t,i),o=GZ(i,a),s=aY(e,o);void 0!==s&&(n[o]=s)}}return ZR(n).length>0?n:void 0}function sY(e,t,n,i,r){const a={};for(const o of i){if(!r[o])continue;const i=VZ(o,t,e,n);void 0!==i&&(a[r[o]]=i)}return a}function uY(e){return[...cY(e,"width"),...cY(e,"height")]}function cY(e,t){const n="width"===t?"x":"y",i=e.component.layoutSize.get(t);if(!i||"merged"===i)return[];const r=e.getSizeSignalRef(t).signal;if("step"===i){const t=e.getScaleComponent(n);if(t){const i=t.get("type"),a=t.get("range");if(MI(i)&&iU(a)){const i=e.scaleName(n);if(cQ(e.parent)){const t=e.parent.component.resolve;if("independent"===t.scale[n])return[lY(i,a)]}return[lY(i,a),{name:r,update:fY(i,t,`domain('${i}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==i){const t=r.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",i=GW(e.config.view,t?"width":"height"),a=`isFinite(${n}) ? ${n} : ${i}`;return[{name:r,init:a,on:[{update:a,events:"window:resize"}]}]}return[{name:r,value:i}]}function lY(e,t){return{name:e+"_step",value:t.step}}function fY(e,t,n){const i=t.get("type"),r=t.get("padding"),a=uz(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o="band"===i?void 0!==o?o:r:1,`bandspace(${n}, ${o}, ${a}) * ${e}_step`}function dY(e,t){return ZR(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),gG(t,r,i,e=>nU(e)?e:{value:e.value}))},{})}function hY(e,t){if(dQ(t)||cQ(t))return"shared";if(fQ(t)||lQ(t))return LR(OL,e)?"independent":"shared";throw new Error("invalid model type for resolve")}function pY(e,t){const n=e.scale[t],i=LR(OL,t)?"axis":"legend";return"independent"===n?("shared"===e[i][t]&&hB(uB.independentScaleMeansIndependentGuide(t)),"independent"):e[i][t]||"shared"}class gY{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new gY($R(this.explicit),$R(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return uz(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of ZR(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function mY(e){return{explicit:!0,value:e}}function vY(e){return{explicit:!1,value:e}}function bY(e){return(t,n,i,r)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:yY(t,n,i,r)}}function yY(e,t,n,i){return e.explicit&&t.explicit&&hB(uB.mergeConflictingProperty(n,i,e.value,t.value)),e}function xY(e,t,n,i,r=yY){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:FR(e.value,t.value)?e:r(e,t,n,i)}const OY=Object.assign(Object.assign({},CW),{labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),wY=ZR(OY);class jY extends gY{}function kY(e,t){const n=e.values;return Object(ie["A"])(n)?Aq(t,n):nU(n)?n:void 0}function _Y(e,t,n,i){var r;if("shape"!==t){const e=null!==(r=PY(n))&&void 0!==r?r:i;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function AY(e){const{legend:t}=e;return uz(t.type,EY(e))}function EY({channel:e,timeUnit:t,scaleType:n,alwaysReturn:i}){if(HT(e)){if(LR(["quarter","month","day"],t))return"symbol";if(RI(n))return i?"gradient":void 0}return i?"symbol":void 0}function DY({legend:e,legendConfig:t,timeUnit:n,channel:i,scaleType:r}){const a=uz(e.orient,t.orient,"right"),o=AY({legend:e,channel:i,timeUnit:n,scaleType:r,alwaysReturn:!0});return uz(e.direction,t[o?"gradientDirection":"symbolDirection"],SY(a,o))}function SY(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}function CY({legend:e,legendConfig:t,model:n,channel:i,scaleType:r}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:u}=t;if(RI(r)){const c=DY({legend:e,legendConfig:t,channel:i,scaleType:r});if("horizontal"===c){const i=uz(e.orient,t.orient);return"top"===i||"bottom"===i?FY(n,"width",o,a):o}return FY(n,"height",u,s)}}function FY(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function $Y(e){if(LR(["quantile","threshold","log"],e))return"greedy"}function MY(e,t,n){const i=t.getScaleComponent(n).get("type");return uz(e.get("type"),EY({channel:n,scaleType:i,alwaysReturn:!0}))}function NY(e,t,n,i,r){var a,o,s,u,c;if("symbol"!==MY(r,n,i))return;const{markDef:l,encoding:f,config:d,mark:h}=n,p=l.filled&&"trail"!==h;let g=Object.assign(Object.assign({},dU({},n,Uz)),_G(n,{filled:p}));const m=null!==(a=LY(f.opacity))&&void 0!==a?a:l.opacity,v=IY(n,r,e);if(g.fill)if("fill"===i||p&&i===wT)delete g.fill;else if(g.fill["field"])r.get("symbolFillColor")?delete g.fill:(g.fill=fU(null!==(o=d.legend.symbolBaseFillColor)&&void 0!==o?o:"black"),g.fillOpacity=fU(null!==m&&void 0!==m?m:1));else if(Object(ie["A"])(g.fill)){const e=null!==(c=null!==(u=PY(null!==(s=f.fill)&&void 0!==s?s:f.color))&&void 0!==u?u:l.fill)&&void 0!==c?c:p&&l.color;e&&(g.fill=fU(e))}if(g.stroke)if("stroke"===i||!p&&i===wT)delete g.stroke;else if(g.stroke["field"])delete g.stroke;else if(Object(ie["A"])(g.stroke)){const e=uz(PY(f.stroke||f.color),l.stroke,p?l.color:void 0);e&&(g.stroke={value:e})}return i!==ET&&(v?g.opacity=[Object.assign({test:v},fU(null!==m&&void 0!==m?m:1)),fU(d.legend.unselectedOpacity)]:m&&(g.opacity=fU(m))),g=Object.assign(Object.assign({},g),t),ZR(g).length>0?g:void 0}function RY(e,t,n,i,r){if("gradient"!==MY(r,n,i))return;let a={};const o=LY(n.encoding.opacity)||n.markDef.opacity;return o&&(a.opacity=fU(o)),a=Object.assign(Object.assign({},a),t),ZR(a).length>0?a:void 0}function zY(e,t,n,i,r){var a;const o=n.legend(i),s=n.config,u=IY(n,r,e);let c={};if(jq(e)){const r=n.getScaleComponent(i).get("type")===mI.UTC,u=jU("datum.value",null===(a=HB(e.timeUnit))||void 0===a?void 0:a.unit,o.format,s.timeFormat,r);t=Object.assign(Object.assign({},u?{text:{signal:u}}:{}),t)}return u&&(t.opacity=[{test:u,value:1},{value:s.legend.unselectedOpacity}]),c=Object.assign(Object.assign({},c),t),ZR(c).length>0?c:void 0}function TY(e,t,n,i,r){const a=r.get("selections");return(null===a||void 0===a?void 0:a.length)?{fill:{value:"transparent"}}:void 0}function LY(e){return BY(e,(e,t)=>Math.max(e,t.value))}function PY(e){return BY(e,(e,t)=>uz(e,t.value))}function BY(e,t){return HU(e)?Object(ie["i"])(e.condition).reduce(t,e.value):YU(e)?e.value:void 0}function IY(e,t,n){const i=t.get("selections");if(!(null===i||void 0===i?void 0:i.length))return;const r=Object(ie["Z"])(n.field);return i.map(e=>{const t=Object(ie["Z"])(JR(e)+aZ);return`(!length(data(${t})) || (${e}[${r}] && indexof(${e}[${r}], datum.value) >= 0))`}).join(" || ")}function UY(e){uQ(e)?e.component.legends=qY(e):e.component.legends=ZY(e)}function qY(e){const{encoding:t}=e;return[wT,jT,kT,CT,FT,AT,_T,ET,DT,ST].reduce((n,i)=>{const r=t[i];return!e.legend(i)||!e.getScaleComponent(i)||GU(r)&&i===_T&&r.type===pI||(n[i]=GY(e,i)),n},{})}function WY(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function HY(e,t,n,i){switch(t){case"values":return!!n.values;case"title":if("title"===t&&e===i.title)return!0}return e===n[t]}function GY(e,t){var n;const i=e.fieldDef(t),r=e.legend(t),a=new jY({},WY(e,t));AV(e,t,a);for(const c of wY){const n=VY(c,r,t,e);if(void 0!==n){const t=HY(n,c,r,i);(t||void 0===e.config.legend[c])&&a.set(c,n,t)}}const o=null!==(n=r.encoding)&&void 0!==n?n:{},s=a.get("selections"),u=["labels","legend","title","symbols","gradient","entries"].reduce((n,r)=>{var u;const c=dY(null!==(u=o[r])&&void 0!==u?u:{},e),l=v[r]?v[r](i,c,e,t,a):c;return void 0!==l&&ZR(l).length>0&&(n[r]=Object.assign(Object.assign(Object.assign({},(null===s||void 0===s?void 0:s.length)?{name:`${JR(i.field)}_legend_${r}`}:{}),(null===s||void 0===s?void 0:s.length)?{interactive:!!s}:{}),{update:l})),n},{});return ZR(u).length>0&&a.set("encode",u,!!r.encoding),a}function VY(e,t,n,i){var r;const{encoding:a,mark:o}=i,s=vq(a[n]),u=i.config.legend,c=null===(r=HB(s.timeUnit))||void 0===r?void 0:r.unit,l=i.getScaleComponent(n).get("type");switch(e){case"direction":return DY({legend:t,legendConfig:u,timeUnit:c,channel:n,scaleType:l});case"format":if(jq(s))return;return yU(s,t.format,i.config);case"formatType":if(jq(s))return;return t.formatType;case"gradientLength":return uz(t.gradientLength,u.gradientLength,CY({model:i,legend:t,legendConfig:u,channel:n,scaleType:l}));case"labelOverlap":return uz(t.labelOverlap,$Y(l));case"symbolType":return uz(t.symbolType,_Y(o,n,a.shape,i.markDef.shape));case"title":return fq(s,i.config,{allowDisabling:!0})||void 0;case"type":return AY({legend:t,channel:n,timeUnit:c,scaleType:l,alwaysReturn:!1});case"values":return kY(t,s)}return t[e]}function ZY(e){const{legends:t,resolve:n}=e.component;for(const i of e.children)UY(i),ZR(i.component.legends).forEach(r=>{n.legend[r]=pY(e.component.resolve,r),"shared"===n.legend[r]&&(t[r]=YY(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))});return ZR(t).forEach(t=>{for(const i of e.children)i.component.legends[t]&&"shared"===n.legend[t]&&delete i.component.legends[t]}),t}function YY(e,t){var n,i,r,a,o,s;if(!e)return t.clone();const u=e.getWithExplicit("orient"),c=t.getWithExplicit("orient");if(u.explicit&&c.explicit&&u.value!==c.value)return;let l=!1;for(const f of wY){const n=xY(e.getWithExplicit(f),t.getWithExplicit(f),f,"legend",(e,t)=>{switch(f){case"symbolType":return XY(e,t);case"title":return EU(e,t);case"type":return l=!0,vY("symbol")}return yY(e,t,f,"legend")});e.setWithExplicit(f,n)}return l&&((null===(r=null===(i=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===i?void 0:i.gradient)||void 0===r||r)&&KR(e.implicit,["encode","gradient"]),(null===(s=null===(o=null===(a=e.explicit)||void 0===a?void 0:a.encode)||void 0===o?void 0:o.gradient)||void 0===s||s)&&KR(e.explicit,["encode","gradient"])),e}function XY(e,t){return"circle"===t.value?t:e}function JY(e,t,n,i){var r,a,o;e.encode=null!==(r=e.encode)&&void 0!==r?r:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=i}function QY(e){const t=e.component.legends,n={};for(const i of ZR(t)){const r=e.getScaleComponent(i),a=RR(r.get("domains"));if(n[a])for(const e of n[a]){const r=YY(e,t[i]);r||n[a].push(t[i])}else n[a]=[t[i].clone()]}return YR(n).flat().map(KY)}function KY(e){var t,n,i,r;const a=e.combine(),{labelExpr:o,selections:s}=a,u=yR(a,["labelExpr","selections"]);if(null===(t=u.encode)||void 0===t?void 0:t.symbols){const e=u.encode.symbols.update;!e.fill||"transparent"===e.fill["value"]||e.stroke||u.stroke||(e.stroke={value:"transparent"});for(const t of EW)u[t]&&delete e[t]}if(void 0!==o){let e=o;(null===(r=null===(i=null===(n=u.encode)||void 0===n?void 0:n.labels)||void 0===i?void 0:i.update)||void 0===r?void 0:r.text)&&nU(u.encode.labels.update.text)&&(e=az(o,"datum.label",u.encode.labels.update.text.signal)),JY(u,"labels","text",{signal:e})}for(const c in u){const e=u[c];if(nU(e)){const t=DW[c];if(t){const{vgProp:n,part:i}=t;JY(u,i,n,e),delete u[c]}}}return u}function eX(e){return dQ(e)||fQ(e)||lQ(e)?tX(e):nX(e)}function tX(e){return e.children.reduce((e,t)=>e.concat(t.assembleProjections()),nX(e))}function nX(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n,r=yR(n,["name"]);if(t.data){const n={signal:`[${t.size.map(e=>e.signal).join(", ")}]`},a=t.data.reduce((t,n)=>{const i=nU(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return LR(t,i)||t.push(i),t},[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:n,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},r)]}return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),r)]}const iX=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class rX extends gY{constructor(e,t,n,i){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function aX(e){e.component.projection=uQ(e)?oX(e):cX(e)}function oX(e){var t;if(e.hasProjection){const n=e.specifiedProjection,i=!(n&&(null!=n.scale||null!=n.translate)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=i?sX(e):void 0;return new rX(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!==n&&void 0!==n?n:{}),r,a)}}function sX(e){const t=[];for(const n of[[yT,bT],[OT,xT]])(e.channelHasField(n[0])||e.channelHasField(n[1]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(_T)&&e.fieldDef(_T).type===pI&&t.push({signal:e.getName(`geojson_${t.length}`)}),0===t.length&&t.push(e.requestDataName(HH)),t}function uX(e,t){const n=BR(iX,n=>!Object(ie["v"])(e.explicit,n)&&!Object(ie["v"])(t.explicit,n)||!(!Object(ie["v"])(e.explicit,n)||!Object(ie["v"])(t.explicit,n)||RR(e.get(n))!==RR(t.get(n)))),i=RR(e.size)===RR(t.size);if(i){if(n)return e;if(RR(e.explicit)===RR({}))return t;if(RR(t.explicit)===RR({}))return e}return null}function cX(e){if(0===e.children.length)return;let t;e.children.forEach(e=>aX(e));const n=BR(e.children,e=>{const n=e.component.projection;if(n){if(t){const e=uX(t,n);return e&&(t=e),!!e}return t=n,!0}return!0});if(t&&n){const n=e.projectionName(!0),i=new rX(n,t.specifiedProjection,t.size,$R(t.data));return e.children.forEach(e=>{const t=e.component.projection;t&&(t.isFit&&i.data.push(...e.component.projection.data),e.renameProjection(t.get("name"),n),t.merged=!0)}),i}}function lX(e,t,n,i){var r,a;if(Eq(t,n)){const o=uQ(e)&&null!==(a=null!==(r=e.axis(n))&&void 0!==r?r:e.legend(n))&&void 0!==a?a:{},s=tq(t,{expr:"datum"}),u=tq(t,{expr:"datum",binSuffix:"end"});return{formulaAs:tq(t,{binSuffix:"range",forAs:!0}),formula:wU(s,u,o.format,i)}}return{}}function fX(e,t){return`${Dq(e)}_${t}`}function dX(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function hX(e,t,n){var i;const r=null!==(i=xq(n,void 0))&&void 0!==i?i:{},a=fX(r,t);return e.getName(`${a}_bins`)}function pX(e){return"as"in e}function gX(e,t,n){let i,r;i=pX(e)?Object(ie["H"])(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[tq(e,{forAs:!0}),tq(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},xq(t,void 0)),o=fX(a,e.field),{signal:s,extentSignal:u}=dX(n,o);if($q(a.extent)){const e=a.extent,t=e.selection;r=xZ(n.getSelectionComponent(JR(t),t),e),delete a.extent}const c=Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[i]},s?{signal:s}:{}),u?{extentSignal:u}:{}),r?{span:r}:{});return{key:o,binComponent:c}}class mX extends oV{constructor(e,t){super(e),this.bins=t}clone(){return new mX(null,$R(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((e,n,i)=>{if(VU(n)&&Sq(n.bin)){const{key:r,binComponent:a}=gX(n,n.bin,t);e[r]=Object.assign(Object.assign(Object.assign({},a),e[r]),lX(t,n,i,t.config))}return e},{});return 0===ZR(n).length?null:new mX(e,n)}static makeFromTransform(e,t,n){const{key:i,binComponent:r}=gX(t,t.bin,n);return new mX(e,{[i]:r})}merge(e,t){for(const n of ZR(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=qR([...this.bins[n].as,...e.bins[n].as],zR)):this.bins[n]=e.bins[n];for(const n of e.children)e.removeChild(n),n.parent=this;e.remove()}producedFields(){return new Set(YR(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(YR(this.bins).map(e=>e.field))}hash(){return`Bin ${zR(this.bins)}`}assemble(){return YR(this.bins).flatMap(e=>{const t=[],[n,...i]=e.as,r=e.bin,{extent:a}=r,o=yR(r,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:rz(e.field),as:n,signal:e.signal},$q(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:rz(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const u of i)for(let e=0;e<2;e++)t.push({type:"formula",expr:tq({field:n[e]},{expr:"datum"}),as:u[e]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t})}}class vX extends oV{constructor(e){let t;if(super(null),e=null!==e&&void 0!==e?e:{name:"source"},IH(e)||(t=e.format?Object.assign({},NR(e.format,["parse"])):{}),PH(e))this._data={values:e.values};else if(LH(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];LR(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else qH(e)?this._data={values:[{type:"Sphere"}]}:(BH(e)||IH(e))&&(this._data={});this._generator=IH(e),e.name&&(this._name=e.name),t&&ZR(t).length>0&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function bX(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return console.error("Dataflow graph is inconsistent.",t,e),!1;if(!bX(t.children))return!1}return!0}class yX extends oV{constructor(e,t){super(e),this.params=t}clone(){return new yX(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${zR(this.params)}`}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class xX extends oV{constructor(e,t){super(e),this.params=t}clone(){return new xX(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return`Hash ${zR(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function OX(e){return e instanceof vX||e instanceof yX||e instanceof xX}class wX{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class jX extends wX{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:e,mutatedFlag:t}){e&&this.setContinue(),t&&this.setMutated()}reset(){}optimizeNextFromLeaves(e){if(OX(e))return!1;const t=e.parent,{continueFlag:n}=this.run(e);return n&&this.optimizeNextFromLeaves(t),this.mutatedFlag}}class kX extends wX{}function _X(e,t,n,i){const r=uQ(i)?i.encoding[cL(t)]:void 0;if(VU(n)&&uQ(i)&&UU(t,n,r,i.markDef,i.config))e.add(tq(n,{})),e.add(tq(n,{suffix:"end"})),n.bin&&Eq(n,t)&&e.add(tq(n,{binSuffix:"range"}));else if(UT(t)){const n=BT(t);e.add(i.getName(n))}else e.add(tq(n));return e}function AX(e,t){var n;for(const i of ZR(t)){const r=t[i];for(const t of ZR(r))i in e?e[i][t]=new Set([...null!==(n=e[i][t])&&void 0!==n?n:[],...r[t]]):e[i]={[t]:r[t]}}}class EX extends oV{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new EX(null,new Set(this.dimensions),$R(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef(e=>{e.aggregate&&(n=!0)});const i={},r=new Set;return n?(t.forEachFieldDef((e,n)=>{var a,o,s,u;const{aggregate:c,field:l}=e;if(c)if("count"===c)i["*"]=null!==(a=i["*"])&&void 0!==a?a:{},i["*"]["count"]=new Set([tq(e,{forAs:!0})]);else{if(nT(c)||iT(c)){const e=nT(c)?"argmin":"argmax",t=c[e];i[t]=null!==(o=i[t])&&void 0!==o?o:{},i[t][e]=new Set([tq({op:e,field:t},{forAs:!0})])}else i[l]=null!==(s=i[l])&&void 0!==s?s:{},i[l][c]=new Set([tq(e,{forAs:!0})]);TL(n)&&"unaggregated"===t.scaleDomain(n)&&(i[l]=null!==(u=i[l])&&void 0!==u?u:{},i[l]["min"]=new Set([tq({field:l,aggregate:"min"},{forAs:!0})]),i[l]["max"]=new Set([tq({field:l,aggregate:"max"},{forAs:!0})]))}else _X(r,n,e,t)}),r.size+ZR(i).length===0?null:new EX(e,r,i)):null}static makeFromTransform(e,t){var n,i,r;const a=new Set,o={};for(const s of t.aggregate){const{op:e,field:t,as:r}=s;e&&("count"===e?(o["*"]=null!==(n=o["*"])&&void 0!==n?n:{},o["*"]["count"]=new Set([r||tq(s,{forAs:!0})])):(o[t]=null!==(i=o[t])&&void 0!==i?i:{},o[t][e]=new Set([r||tq(s,{forAs:!0})])))}for(const s of null!==(r=t.groupby)&&void 0!==r?r:[])a.add(s);return a.size+ZR(o).length===0?null:new EX(e,a,o)}merge(e){return WR(this.dimensions,e.dimensions)?(AX(this.measures,e.measures),!0):(pB("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...ZR(this.measures)])}producedFields(){const e=new Set;for(const t of ZR(this.measures))for(const n of ZR(this.measures[t])){const i=this.measures[t][n];0===i.size?e.add(`${n}_${t}`):i.forEach(e.add,e)}return e}hash(){return`Aggregate ${zR({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const r of ZR(this.measures))for(const i of ZR(this.measures[r]))for(const a of this.measures[r][i])n.push(a),e.push(i),t.push("*"===r?null:rz(r));const i={type:"aggregate",groupby:[...this.dimensions],ops:e,fields:t,as:n};return i}}class DX extends oV{constructor(e,t,n,i){super(e),this.model=t,this.name=n,this.data=i;for(const r of VT){const e=t.facet[r];if(e){const{bin:n,sort:i}=e;this[r]=Object.assign({name:t.getName(`${r}_domain`),fields:[tq(e),...Sq(n)?[tq(e,{binSuffix:"end"})]:[]]},$U(i)?{sortField:i}:Object(ie["A"])(i)?{sortIndexField:HZ(e,r)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of VT)this[t]&&(e+=` ${t.charAt(0)}:${zR(this[t])}`);return e}get fields(){var e;const t=[];for(const n of VT)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of VT)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of["x","y"]){const n=this.childModel.component.scales[t];if(n&&!n.merged){const i=n.get("type"),r=n.get("range");if(MI(i)&&iU(r)){const n=jJ(this.childModel,t),i=wJ(n);i?e[t]=i:hB(`Unknown field for ${t}. Cannot calculate view size.`)}}}return e}assembleRowColumnHeaderData(e,t,n){const i={row:"y",column:"x"}[e],r=[],a=[],o=[];n&&n[i]&&(t?(r.push(`distinct_${n[i]}`),a.push("max")):(r.push(n[i]),a.push("distinct")),o.push(`distinct_${n[i]}`));const{sortField:s,sortIndexField:u}=this[e];if(s){const{op:e=DU,field:t}=s;r.push(t),a.push(e),o.push(tq(s,{forAs:!0}))}else u&&(r.push(u),a.push("max"),o.push(u));return{name:this[e].name,source:null!==t&&void 0!==t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},r.length?{fields:r,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:i}=this.model.layout,{layoutHeaders:r}=this.model.component,a=[],o={};for(const c of YZ){for(const e of XZ){const i=null!==(t=r[c]&&r[c][e])&&void 0!==t?t:[];for(const e of i)if((null===(n=e.axes)||void 0===n?void 0:n.length)>0){o[c]=!0;break}}if(o[c]){const e=`length(data("${this.facet.name}"))`,t="row"===c?i?{signal:`ceil(${e} / ${i})`}:1:i?{signal:`min(${e}, ${i})`}:{signal:e};a.push({name:`${this.facet.name}_${c}`,transform:[{type:"sequence",start:0,stop:t}]})}}const{row:s,column:u}=o;return(s||u)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let i=null;const r=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(r.x||r.y)){i=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(null!==(e=r.x)&&void 0!==e?e:[],null!==(t=r.y)&&void 0!==t?t:[]),o=a.map(()=>"distinct");n.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:o}]})}for(const u of[dT,fT])this[u]&&n.push(this.assembleRowColumnHeaderData(u,i,r));if(s){const e=this.assembleFacetHeaderData(r);e&&n.push(...e)}return n}}function SX(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function CX(e,t){const n=nz(e);if("number"===t)return`toNumber(${n})`;if("boolean"===t)return`toBoolean(${n})`;if("string"===t)return`toString(${n})`;if("date"===t)return`toDate(${n})`;if("flatten"===t)return n;if(0===t.indexOf("date:")){const e=SX(t.slice(5,t.length));return`timeParse(${n},'${e}')`}if(0===t.indexOf("utc:")){const e=SX(t.slice(4,t.length));return`utcParse(${n},'${e}')`}return hB(uB.unrecognizedParse(t)),null}function FX(e){const t={};return SR(e.filter,e=>{var n;if(iI(e)){let i=null;YB(e)?i=e.equal:eI(e)?i=e.range[0]:tI(e)&&(i=(null!==(n=e.oneOf)&&void 0!==n?n:e["in"])[0]),i&&(mB(i)?t[e.field]="date":Object(ie["E"])(i)?t[e.field]="number":Object(ie["H"])(i)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}}),t}function $X(e){const t={};function n(e){jq(e)?t[e.field]="date":"quantitative"===e.type&&sT(e.aggregate)?t[e.field]="number":sz(e.field)>1?e.field in t||(t[e.field]="flatten"):XU(e)&&$U(e.sort)&&sz(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((uQ(e)||cQ(e))&&e.forEachFieldDef((t,i)=>{if(VU(t))n(t);else{const r=uL(i),a=e.fieldDef(r);n(Object.assign(Object.assign({},t),{type:a.type}))}}),uQ(e)){const{mark:n,markDef:i,encoding:r}=e;if(zz(n)&&!e.encoding.order){const e="horizontal"===i.orient?"y":"x",n=r[e];!GU(n)||"quantitative"!==n.type||n.field in t||(t[n.field]="number")}}return t}function MX(e){const t={};if(uQ(e)&&e.component.selection)for(const n of ZR(e.component.selection)){const i=e.component.selection[n];for(const e of i.project.items)!e.channel&&sz(e.field)>1&&(t[e.field]="flatten")}return t}class NX extends oV{constructor(e,t){super(e),this._parse=t}clone(){return new NX(null,$R(this._parse))}hash(){return`Parse ${zR(this._parse)}`}static makeExplicit(e,t,n){let i={};const r=t.data;return!IH(r)&&r&&r.format&&r.format.parse&&(i=r.format.parse),this.makeWithAncestors(e,i,{},n)}static makeWithAncestors(e,t,n,i){for(const o of ZR(n)){const e=i.getWithExplicit(o);void 0!==e.value&&(e.explicit||e.value===n[o]||"derived"===e.value||"flatten"===n[o]?delete n[o]:hB(uB.differentParse(o,n[o],e.value)))}for(const o of ZR(t)){const e=i.get(o);void 0!==e&&(e===t[o]?delete t[o]:hB(uB.differentParse(o,t[o],e)))}const r=new gY(t,n);i.copyAll(r);const a={};for(const o of ZR(r.combine())){const e=r.get(o);null!==e&&(a[o]=e)}return 0===ZR(a).length||i.parseNothing?null:new NX(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of ZR(this._parse)){const n=this._parse[t];1===sz(t)&&(e[t]=n)}return e}producedFields(){return new Set(ZR(this._parse))}dependentFields(){return new Set(ZR(this._parse))}assembleTransforms(e=!1){return ZR(this._parse).filter(t=>!e||sz(t)>1).map(e=>{const t=CX(e,this._parse[e]);if(!t)return null;const n={type:"formula",expr:t,as:oz(e)};return n}).filter(e=>null!==e)}}class RX extends oV{constructor(e,t){super(e),this.transform=t}clone(){return new RX(null,$R(this.transform))}addDimensions(e){this.transform.groupby=qR(this.transform.groupby.concat(e),e=>e)}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t=>e.add(t)),this.transform.joinaggregate.map(e=>e.field).filter(e=>void 0!==e).forEach(t=>e.add(t)),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:tq(e)}hash(){return`JoinAggregateTransform ${zR(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const r of this.transform.joinaggregate)t.push(r.op),n.push(this.getDefaultName(r)),e.push(void 0===r.field?null:r.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==i?{groupby:i}:{})}}function zX(e){return e.stack.stackBy.reduce((e,t)=>{const n=t.fieldDef,i=tq(n);return i&&e.push(i),e},[])}function TX(e){return Object(ie["A"])(e)&&e.every(e=>Object(ie["H"])(e))&&e.length>1}class LX extends oV{constructor(e,t){super(e),this._stack=t}clone(){return new LX(null,$R(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:i,as:r,offset:a="zero"}=t,o=[],s=[];if(void 0!==t.sort)for(const l of t.sort)o.push(l.field),s.push(uz(l.order,"ascending"));const u={field:o,order:s};let c;return c=TX(r)?r:Object(ie["H"])(r)?[r,r+"_end"]:[t.stack+"_start",t.stack+"_end"],new LX(e,{stackField:n,groupby:i,offset:a,sort:u,facetby:[],as:c})}static makeFromEncoding(e,t){const n=t.stack,{encoding:i}=t;if(!n)return null;let r;if(n.groupbyChannel){const e=i[n.groupbyChannel];r=vq(e)}const a=zX(t),o=t.encoding.order;let s;return s=Object(ie["A"])(o)||GU(o)?kU(o):a.reduce((e,t)=>(e.field.push(t),e.order.push("descending"),e),{field:[],order:[]}),new LX(e,{dimensionFieldDef:r,stackField:t.vgField(n.fieldChannel),facetby:[],stackby:a,sort:s,offset:n.offset,impute:n.impute,as:[t.vgField(n.fieldChannel,{suffix:"start",forAs:!0}),t.vgField(n.fieldChannel,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(t=>e.add(t)),this._stack.facetby.forEach(t=>e.add(t)),this._stack.sort.field.forEach(t=>e.add(t)),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${zR(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[tq(e,{binSuffix:"mid"})]:[tq(e,{}),tq(e,{binSuffix:"end"})]:[tq(e)]:null!==n&&void 0!==n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:i,stackby:r,sort:a,offset:o,impute:s,as:u}=this._stack;if(s&&n){const{band:a=.5,bin:o}=n;o&&e.push({type:"formula",expr:`${a}*`+tq(n,{expr:"datum"})+`+${1-a}*`+tq(n,{expr:"datum",binSuffix:"end"}),as:tq(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:i,groupby:[...r,...t],key:tq(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:i,sort:a,as:u,offset:o}),e}}class PX extends oV{constructor(e,t){super(e),this.transform=t}clone(){return new PX(null,$R(this.transform))}addDimensions(e){this.transform.groupby=qR(this.transform.groupby.concat(e),e=>e)}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(e=>n.add(e)),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach(e=>n.add(e.field)),this.transform.window.map(e=>e.field).filter(e=>void 0!==e).forEach(e=>n.add(e)),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:tq(e)}hash(){return`WindowTransform ${zR(this.transform)}`}assemble(){var e;const t=[],n=[],i=[],r=[];for(const f of this.transform.window)n.push(f.op),i.push(this.getDefaultName(f)),r.push(void 0===f.param?null:f.param),t.push(void 0===f.field?null:f.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&null===a[0]&&null===a[1]&&n.every(e=>rT(e)))return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},void 0!==o?{groupby:o}:{});const s=[],u=[];if(void 0!==this.transform.sort)for(const f of this.transform.sort)s.push(f.field),u.push(null!==(e=f.order)&&void 0!==e?e:"ascending");const c={field:s,order:u},l=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:r,as:i,ops:n,fields:t,sort:c},void 0!==l?{ignorePeers:l}:{}),void 0!==o?{groupby:o}:{}),void 0!==a?{frame:a}:{})}}class BX extends oV{clone(){return new BX(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([FW])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:FW}}}class IX extends jX{run(e){const t=e.parent;if(e instanceof NX){if(OX(t))return this.flags;if(t.numChildren()>1)return this.setContinue(),this.flags;if(t instanceof NX)this.setMutated(),t.merge(e);else{if(VR(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags}}class UX extends kX{mergeNodes(e,t){const n=t.shift();for(const i of t)e.removeChild(i),i.parent=n,i.remove()}run(e){const t=e.children.map(e=>e.hash()),n={};for(let i=0;i<t.length;i++)void 0===n[t[i]]?n[t[i]]=[e.children[i]]:n[t[i]].push(e.children[i]);for(const i of ZR(n))n[i].length>1&&(this.setMutated(),this.mergeNodes(e,n[i]));for(const i of e.children)this.run(i);return this.mutatedFlag}}class qX extends jX{run(e){return e instanceof sV||e.numChildren()>0||e instanceof DX||(this.setMutated(),e.remove()),this.flags}}class WX extends jX{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(e){if(this.setContinue(),e instanceof uV){const t=e.producedFields();HR(t,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...t]),this.prev=e}return this.flags}reset(){this.fields.clear()}}class HX extends jX{run(e){this.setContinue();const t=e.parent,n=t.children.filter(e=>e instanceof uV),i=n.pop();for(const r of n)this.setMutated(),i.merge(r);return this.flags}}function GX(e){function t(n){if(!(n instanceof DX)){const i=n.clone();if(i instanceof sV){const t=tJ+i.getSource();i.setSource(t),e.model.component.data.outputNodes[t]=i}else(i instanceof EX||i instanceof LX||i instanceof PX||i instanceof RX)&&i.addDimensions(e.fields);return n.children.flatMap(t).forEach(e=>e.parent=i),[i]}return n.children.flatMap(t)}return t}function VX(e){if(e instanceof DX)if(1!==e.numChildren()||e.children[0]instanceof sV){const t=e.model.component.data.main;ZX(t);const n=GX(e),i=e.children.map(n).flat();for(const e of i)e.parent=t}else{const t=e.children[0];(t instanceof EX||t instanceof LX||t instanceof PX||t instanceof RX)&&t.addDimensions(e.fields),t.swapWithParent(),VX(e)}else e.children.map(VX)}function ZX(e){if(e instanceof sV&&e.type===HH&&1===e.numChildren()){const t=e.children[0];t instanceof DX||(t.swapWithParent(),ZX(e))}}class YX extends kX{constructor(){super()}run(e){e instanceof sV&&!e.isRequired()&&(this.setMutated(),e.remove());for(const t of e.children)this.run(t);return this.mutatedFlag}}class XX extends kX{constructor(e){super(),this.requiresSelectionId=e&&hZ(e)}run(e){e instanceof BX&&(this.requiresSelectionId&&(OX(e.parent)||e.parent instanceof EX||e.parent instanceof NX)||(this.setMutated(),e.remove()));for(const t of e.children)this.run(t);return this.mutatedFlag}}class JX extends jX{run(e){const t=e.parent,n=[...t.children],i=t.children.filter(e=>e instanceof NX);if(t.numChildren()>1&&i.length>=1){const e={},r=new Set;for(const t of i){const n=t.parse;for(const t of ZR(n))t in e?e[t]!==n[t]&&r.add(t):e[t]=n[t]}for(const t of r)delete e[t];if(0!==ZR(e).length){this.setMutated();const i=new NX(t,e);for(const r of n){if(r instanceof NX)for(const t of ZR(e))delete r.parse[t];t.removeChild(r),r.parent=i,r instanceof NX&&0===ZR(r.parse).length&&r.remove()}}}return this.setContinue(),this.flags}}class QX extends jX{run(e){const t=e.parent,n=t.children.filter(e=>e instanceof EX),i={};for(const r of n){const e=zR(r.groupBy);e in i||(i[e]=[]),i[e].push(r)}for(const r of ZR(i)){const e=i[r];if(e.length>1){const n=e.pop();for(const i of e)n.merge(i)&&(t.removeChild(i),i.parent=n,i.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class KX extends jX{constructor(e){super(),this.model=e}run(e){const t=e.parent,n=!(OX(t)||t instanceof vZ||t instanceof NX||t instanceof BX),i=[],r=[];for(const a of t.children)a instanceof mX&&(n&&!VR(t.producedFields(),a.dependentFields())?i.push(a):r.push(a));if(i.length>0){const e=i.pop();for(const t of i)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated(),t instanceof mX?t.merge(e,this.model.renameSignal.bind(this.model)):e.swapWithParent()}if(r.length>1){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class eJ extends jX{run(e){const t=e.parent,n=[...t.children],i=PR(n,e=>e instanceof sV);if(!i||t.numChildren()<=1)return this.setContinue(),this.flags;const r=[];let a;for(const o of n)if(o instanceof sV){let e=o;while(1===e.numChildren()){const t=e.children[0];if(!(t instanceof sV))break;e=t}r.push(...e.children),a?(t.removeChild(o),o.parent=a.parent,a.parent.removeChild(a),a.parent=e,this.setMutated()):a=e}else r.push(o);if(r.length){this.setMutated();for(const e of r)e.parent.removeChild(e),e.parent=a}return this.setContinue(),this.flags}}const tJ="scale_",nJ=5;function iJ(e){const t=[];function n(e){0===e.numChildren()?t.push(e):e.children.forEach(n)}return e.forEach(n),t}function rJ(e){return e}function aJ(e,t){const n=t.map(t=>{if(e instanceof jX){const n=e.optimizeNextFromLeaves(t);return e.reset(),n}return e.run(t)});return n.some(rJ)}function oJ(e,t){let n=e.sources;const i=new Set;return i.add(aJ(new YX,n)),i.add(aJ(new XX(t),n)),n=n.filter(e=>e.numChildren()>0),i.add(aJ(new qX,iJ(n))),n=n.filter(e=>e.numChildren()>0),i.add(aJ(new IX,iJ(n))),i.add(aJ(new KX(t),iJ(n))),i.add(aJ(new WX,iJ(n))),i.add(aJ(new JX,iJ(n))),i.add(aJ(new QX,iJ(n))),i.add(aJ(new HX,iJ(n))),i.add(aJ(new UX,n)),i.add(aJ(new eJ,iJ(n))),e.sources=n,i.has(!0)}function sJ(e,t){bX(e.sources);let n=0,i=0;for(let r=0;r<nJ;r++){if(!oJ(e,t))break;n++}e.sources.map(VX);for(let r=0;r<nJ;r++){if(!oJ(e,t))break;i++}bX(e.sources),Math.max(n,i)===nJ&&hB(`Maximum optimization runs(${nJ}) reached.`)}class uJ{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new uJ(()=>e(t))}}function cJ(e){uQ(e)?lJ(e):fJ(e)}function lJ(e){const t=e.component.scales;ZR(t).forEach(n=>{const i=hJ(e,n),r=t[n];if(r.setWithExplicit("domains",i),vJ(e,n),e.component.data.isFaceted){let t=e;while(!cQ(t)&&t.parent)t=t.parent;const r=t.component.resolve.scale[n];if("shared"===r)for(const e of i.value)oU(e)&&(e.data=tJ+e.data.replace(tJ,""))}})}function fJ(e){for(const n of e.children)cJ(n);const t=e.component.scales;ZR(t).forEach(n=>{let i,r=null;for(const t of e.children){const e=t.component.scales[n];if(e){i=void 0===i?e.getWithExplicit("domains"):xY(i,e.getWithExplicit("domains"),"domains","scale",xJ);const t=e.get("selectionExtent");r&&t&&r.selection!==t.selection&&hB("The same selection must be used to override scale domains in a layered view."),r=t}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)})}function dJ(e,t,n,i){if("unaggregated"===e){const{valid:e,reason:i}=yJ(t,n);if(!e)return void hB(i)}else if(void 0===e&&i.useUnaggregatedDomain){const{valid:e}=yJ(t,n);if(e)return"unaggregated"}return e}function hJ(e,t){const n=e.getScaleComponent(t).get("type"),i=dJ(e.scaleDomain(t),e.fieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),"x"===t&&e.channelHasField("x2")?e.channelHasField("x")?xY(gJ(n,i,e,"x"),gJ(n,i,e,"x2"),"domain","scale",xJ):gJ(n,i,e,"x2"):"y"===t&&e.channelHasField("y2")?e.channelHasField("y")?xY(gJ(n,i,e,"y"),gJ(n,i,e,"y2"),"domain","scale",xJ):gJ(n,i,e,"y2"):gJ(n,i,e,t)}function pJ(e,t){var n;const{type:i}=t,r=null===(n=HB(t.timeUnit))||void 0===n?void 0:n.unit;return"temporal"===i||r?e.map(e=>({signal:_q(e,{timeUnit:r,type:i})})):[e]}function gJ(e,t,n,i){const r=n.fieldDef(i);if(BI(t)){const a=gJ(e,void 0,n,i),o=pJ(t.unionWith,r);return mY([...a.value,...o])}if(nU(t))return mY([t]);if(t&&"unaggregated"!==t&&!PI(t))return mY(pJ(t,r));const a=n.stack;if(a&&i===a.fieldChannel){if("normalize"===a.offset)return vY([[0,1]]);const e=n.requestDataName(HH);return vY([{data:e,field:n.vgField(i,{suffix:"start"})},{data:e,field:n.vgField(i,{suffix:"end"})}])}const o=TL(i)?bJ(n,i,e):void 0;if("unaggregated"===t){const e=n.requestDataName(HH),{field:t}=r;return vY([{data:e,field:tq({field:t,aggregate:"min"})},{data:e,field:tq({field:t,aggregate:"max"})}])}if(Sq(r.bin)){if(MI(e))return vY("bin-ordinal"===e?[]:[{data:XR(o)?n.requestDataName(HH):n.requestDataName(GH),field:n.vgField(i,Eq(r,i)?{binSuffix:"range"}:{}),sort:!0!==o&&Object(ie["F"])(o)?o:{field:n.vgField(i,{}),op:"min"}}]);{const{bin:e}=r;if(Sq(e)){const t=hX(n,r.field,e);return vY([new uJ(()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`})])}return vY([{data:n.requestDataName(HH),field:n.vgField(i,{})}])}}if(r.timeUnit&&LR(["time","utc"],e)&&UU(i,r,uQ(n)?n.encoding[cL(i)]:void 0,n.markDef,n.config)){const e=n.requestDataName(HH);return vY([{data:e,field:n.vgField(i)},{data:e,field:n.vgField(i,{suffix:"end"})}])}return vY(o?[{data:XR(o)?n.requestDataName(HH):n.requestDataName(GH),field:n.vgField(i),sort:o}]:[{data:n.requestDataName(HH),field:n.vgField(i)}])}function mJ(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:null!==n&&void 0!==n?n:t?"sum":DU},i?{field:rz(i)}:{}),r?{order:r}:{})}function vJ(e,t){const n=e.component.scales[t],i=e.specifiedScales[t].domain,r=e.fieldDef(t).bin,a=PI(i)&&i,o=Fq(r)&&$q(r.extent)&&r.extent;(a||o)&&n.set("selectionExtent",null!==a&&void 0!==a?a:o,!0)}function bJ(e,t,n){if(!MI(n))return;const i=e.fieldDef(t),r=i.sort;if(MU(r))return{op:"min",field:HZ(i,t),order:"ascending"};const a=null!==e.stack;if($U(r))return mJ(r,a);if(FU(r)){const{encoding:t,order:n}=r,i=e.fieldDef(t),{aggregate:o,field:s}=i;if(nT(o)||iT(o))return mJ({field:tq(i),order:n},a);if(rT(o)||!o)return mJ({op:o,field:s,order:n},a)}else{if("descending"===r)return{op:"min",field:e.vgField(t),order:"descending"};if(LR(["ascending",void 0],r))return!0}}function yJ(e,t){const{aggregate:n,type:i}=e;return n?Object(ie["H"])(n)&&!lT[n]?{valid:!1,reason:uB.unaggregateDomainWithNonSharedDomainOp(n)}:"quantitative"===i&&"log"===t?{valid:!1,reason:uB.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:uB.unaggregateDomainHasNoEffectForRawField(e)}}function xJ(e,t,n,i){return e.explicit&&t.explicit&&hB(uB.mergeConflictingDomainProperty(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function OJ(e){const t=qR(e.map(e=>{if(oU(e)){const{sort:t}=e,n=yR(e,["sort"]);return n}return e}),zR),n=qR(e.map(e=>{if(oU(e)){const t=e.sort;return void 0===t||XR(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}}).filter(e=>void 0!==e),zR);if(0===t.length)return;if(1===t.length){const t=e[0];if(oU(t)&&n.length>0){let e=n[0];if(n.length>1)hB(uB.MORE_THAN_ONE_SORT),e=!0;else if(Object(ie["F"])(e)&&"field"in e){const n=e.field;t.field===n&&(e={order:e.order})}return Object.assign(Object.assign({},t),{sort:e})}return t}const i=qR(n.map(e=>XR(e)||!("op"in e)||e.op in tT?e:(hB(uB.domainSortDropped(e)),!0)),zR);let r;1===i.length?r=i[0]:i.length>1&&(hB(uB.MORE_THAN_ONE_SORT),r=!0);const a=qR(e.map(e=>oU(e)?e.data:null),e=>e);if(1===a.length&&null!==a[0]){const e=Object.assign({data:a[0],fields:t.map(e=>e.field)},r?{sort:r}:{});return e}return Object.assign({fields:t},r?{sort:r}:{})}function wJ(e){if(oU(e)&&Object(ie["H"])(e.field))return e.field;if(rU(e)){let t;for(const n of e.fields)if(oU(n)&&Object(ie["H"])(n.field))if(t){if(t!==n.field)return hB("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),t}else t=n.field;return hB("Detected faceted independent scales that union domain of identical fields from different source detected. We will assume that this is the same field from a different fork of the same data source. However, if this is not case, the result view size maybe incorrect."),t}if(aU(e)){hB("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const t=e.fields[0];return Object(ie["H"])(t)?t:void 0}}function jJ(e,t){const n=e.component.scales[t],i=n.get("domains").map(t=>(oU(t)&&(t.data=e.lookupDataSource(t.data)),t));return OJ(i)}function kJ(e){return dQ(e)||fQ(e)||lQ(e)?e.children.reduce((e,t)=>e.concat(kJ(t)),_J(e)):_J(e)}function _J(e){return ZR(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:a,type:o,selectionExtent:s,domains:u,range:c,reverse:l}=r,f=yR(r,["name","type","selectionExtent","domains","range","reverse"]),d=AJ(r.range,a,n);let h;s&&(h=GV(e,s));const p=jJ(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},p?{domain:p}:{}),h?{domainRaw:h}:{}),{range:d}),void 0!==l?{reverse:l}:{}),f)),t},[])}function AJ(e,t,n){return"x"!==n&&"y"!==n||!iU(e)?e:{step:{signal:t+"_step"}}}class EJ extends gY{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||PR(this.get("domains"),e=>Object(ie["A"])(e)&&2===e.length&&e[0]<=0&&e[1]>=0)}}const DJ=["range","scheme"];function SJ(e){return"x"===e?"width":"y"===e?"height":void 0}function CJ(e){const t=e.component.scales;zL.forEach(n=>{const i=t[n];if(!i)return;const r=$J(n,e);i.setWithExplicit("range",r)})}function FJ(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Sq(n.bin)){const i=hX(e,n.field,n.bin),r=SJ(t),a=e.getName(r);return new uJ(()=>{const t=e.getSignalName(i),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(a)} / (${n})`})}}function $J(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e),a=r.get("type");for(const o of DJ)if(void 0!==n[o]){const t=ZI(a,o),i=YI(e,o);if(t)if(i)hB(i);else switch(o){case"range":return mY(n[o]);case"scheme":return mY(MJ(n[o]))}else hB(uB.scalePropertyNotWorkWithScaleType(a,o,e))}if(e===pT||e===gT){const t=e===pT?"width":"height",n=i[t];if(BW(n)){if(MI(a))return mY({step:n.step});hB(uB.stepDropped(t))}}return vY(NJ(e,t))}function MJ(e){return LI(e)?Object.assign({scheme:e.name},NR(e,["name"])):{scheme:e}}function NJ(e,t){const{size:n,config:i,mark:r}=t,a=t.getSignalName.bind(t),{type:o}=t.fieldDef(e),s=t.getScaleComponent(e),u=s.get("type"),{domain:c,domainMid:l}=t.specifiedScales[e];switch(e){case pT:case gT:{if(LR(["point","band"],u))if(e!==pT||n.width){if(e===gT&&!n.height){const e=ZW(i.view,"height");if(BW(e))return e}}else{const e=ZW(i.view,"width");if(BW(e))return e}const r=SJ(e),o=t.getName(r);return e===gT&&NI(u)?[uJ.fromName(a,o),0]:[0,uJ.fromName(a,o)]}case AT:{const a=t.component.scales[e].get("zero"),o=TJ(r,a,i),s=PJ(r,n,t,i);return zI(u)?zJ(o,s,RJ(u,i,c,e)):[o,s]}case CT:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case FT:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case _T:return"symbol";case wT:case jT:case kT:return"ordinal"===u?"nominal"===o?"category":"ordinal":void 0!==l?"diverging":"rect"===r||"geoshape"===r?"heatmap":"ramp";case ET:case DT:case ST:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function RJ(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&Object(ie["A"])(n)?n.length+1:(hB(uB.domainRequiredForThresholdScale(i)),3)}}function zJ(e,t,n){const i=()=>{const i=nU(t)?t.signal:t,r=nU(e)?e.signal:e,a=`(${i} - ${r}) / (${n} - 1)`;return`sequence(${r}, ${i} + ${a}, ${a})`};return nU(t)?new uJ(i):{signal:i()}}function TJ(e,t,n){if(t)return nU(t)?{signal:`${t.signal} ? 0 : ${TJ(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(uB.incompatibleChannel("size",e))}const LJ=.95;function PJ(e,t,n,i){const r={x:FJ(n,"x"),y:FJ(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==i.scale.maxBandSize)return i.scale.maxBandSize;const e=BJ(t,r,i.view);return Object(ie["E"])(e)?e-1:new uJ(()=>`${e.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const e=BJ(t,r,i.view);return Object(ie["E"])(e)?Math.pow(LJ*e,2):new uJ(()=>`pow(${LJ} * ${e.signal}, 2)`)}}throw new Error(uB.incompatibleChannel("size",e))}function BJ(e,t,n){const i=BW(e.width)?e.width.step:VW(n,"width"),r=BW(e.height)?e.height.step:VW(n,"height");return t.x||t.y?new uJ(()=>{const e=[t.x?t.x.signal:i,t.y?t.y.signal:r];return`min(${e.join(", ")})`}):Math.min(i,r)}function IJ(e,t){uQ(e)?UJ(e,t):HJ(e,t)}function UJ(e,t){const n=e.component.scales;ZR(n).forEach(i=>{const r=e.specifiedScales[i],a=n[i],o=e.getScaleComponent(i),s=e.fieldDef(i),u=e.config,c=r[t],l=o.get("type"),f=ZI(l,t),d=YI(i,t);if(void 0!==c&&(f?d&&hB(d):hB(uB.scalePropertyNotWorkWithScaleType(l,t,i))),f&&void 0===d)if(void 0!==c)a.copyKeyFromObject(t,r);else{const n=qJ(t,e,i,s,o.get("type"),o.get("padding"),o.get("paddingInner"),r.domain,e.markDef,u);void 0!==n&&a.set(t,n,!1)}})}function qJ(e,t,n,i,r,a,o,s,u,c){const l=c.scale,{type:f,sort:d}=i;switch(e){case"bins":return GJ(t,i);case"interpolate":return VJ(n,f);case"nice":return ZJ(r,n,i);case"padding":return YJ(n,r,l,i,u,c.bar);case"paddingInner":return XJ(a,n,u.type,l);case"paddingOuter":return JJ(a,n,r,u.type,o,l);case"reverse":return QJ(r,d,n,l);case"zero":return KJ(n,i,s,u,r)}return l[e]}function WJ(e){uQ(e)?CJ(e):HJ(e,"range")}function HJ(e,t){const n=e.component.scales;for(const i of e.children)"range"===t?WJ(i):IJ(i,t);ZR(n).forEach(i=>{let r;for(const n of e.children){const e=n.component.scales[i];if(e){const n=e.getWithExplicit(t);r=xY(r,n,t,"scale",bY((e,n)=>{switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0}))}}n[i].setWithExplicit(t,r)})}function GJ(e,t){const n=t.bin;if(Sq(n)){const i=hX(e,t.field,n);return new uJ(()=>e.getSignalName(i))}if(Cq(n)&&Fq(n)&&void 0!==n.step)return{step:n.step}}function VJ(e,t){if(LR([wT,jT,kT],e)&&"nominal"!==t)return"hcl"}function ZJ(e,t,n){if(!n.bin&&!LR([mI.TIME,mI.UTC],e))return!!LR([pT,gT],t)||void 0}function YJ(e,t,n,i,r,a){if(LR([pT,gT],e)){if(RI(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:o}=r;if("bar"===t&&!i.bin&&!i.timeUnit&&("vertical"===o&&"x"===e||"horizontal"===o&&"y"===e))return a.continuousBandSize}if(t===mI.POINT)return n.pointPadding}}function XJ(e,t,n,i){if(void 0===e&&LR([pT,gT],t)){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:r}=i;return uz(e,"bar"===n?t:r)}}function JJ(e,t,n,i,r,a){if(void 0===e&&LR([pT,gT],t)&&n===mI.BAND){const{bandPaddingOuter:e}=a;return uz(e,nU(r)?{signal:`${r.signal}/2`}:r/2)}}function QJ(e,t,n,i){const r=NI(e)&&"descending"===t;return"x"===n&&void 0!==i.xReverse?r?nU(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:!!r||void 0}function KJ(e,t,n,i,r){const a=!!n&&"unaggregated"!==n;if(a&&NI(r)){if(Object(ie["A"])(n)){const e=n[0],t=n[n.length-1];if(e<=0&&t>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!zI(r))return!0;if(!t.bin&&LR([pT,gT],e)){const{orient:t,type:n}=i;return!LR(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}function eQ(e,t,n,i){const r=tQ(t,n,i),{type:a}=e;return TL(t)?void 0!==a?JI(t,a)?XI(a,n.type)?a:(hB(uB.scaleTypeNotWorkWithFieldDef(a,r)),r):(hB(uB.scaleTypeNotWorkWithChannel(t,a,r)),r):r:null}function tQ(e,t,n){switch(t.type){case"nominal":case"ordinal":return HT(e)||"discrete"===qL(e)?("shape"===e&&"ordinal"===t.type&&hB(uB.discreteChannelCannotEncode(e,"ordinal")),"ordinal"):LR(["x","y"],e)&&LR(["rect","bar","image","rule"],n)?"band":"point";case"temporal":return HT(e)?"time":"discrete"===qL(e)?(hB(uB.discreteChannelCannotEncode(e,"temporal")),"ordinal"):t.timeUnit&&HB(t.timeUnit).utc?"utc":"time";case"quantitative":return HT(e)?Sq(t.bin)?"bin-ordinal":"linear":"discrete"===qL(e)?(hB(uB.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(uB.invalidFieldType(t.type))}function nQ(e,{ignoreRange:t}={}){iQ(e),cJ(e);for(const n of VI)IJ(e,n);t||WJ(e)}function iQ(e){uQ(e)?e.component.scales=rQ(e):e.component.scales=oQ(e)}function rQ(e){const{encoding:t,mark:n}=e;return zL.reduce((i,r)=>{let a,o;const s=t[r];if(GU(s)&&n===Nz&&r===_T&&s.type===pI)return i;if(GU(s)?(a=s,o=s.scale):WU(s)&&(a=s.condition,o=s.condition["scale"]),a&&null!==o&&!1!==o){o=null!==o&&void 0!==o?o:{};const t=eQ(o,r,a,n);i[r]=new EJ(e.scaleName(r+"",!0),{value:t,explicit:o.type===t})}return i},{})}const aQ=bY((e,t)=>OI(e)-OI(t));function oQ(e){const t=e.component.scales={},n={},i=e.component.resolve;for(const r of e.children)iQ(r),ZR(r.component.scales).forEach(t=>{var a;if(i.scale[t]=null!==(a=i.scale[t])&&void 0!==a?a:hY(t,e),"shared"===i.scale[t]){const e=n[t],a=r.component.scales[t].getWithExplicit("type");e?yI(e.value,a.value)?n[t]=xY(e,a,"type","scale",aQ):(i.scale[t]="independent",delete n[t]):n[t]=a}});for(const r of ZR(n)){const i=e.scaleName(r,!0),a=n[r];t[r]=new EJ(i,a);for(const t of e.children){const e=t.component.scales[r];e&&(t.renameScale(e.get("name"),i),e.merged=!0)}}return t}class sQ{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){while(this.nameMap[e]&&e!==this.nameMap[e])e=this.nameMap[e];return e}}function uQ(e){return"unit"===(null===e||void 0===e?void 0:e.type)}function cQ(e){return"facet"===(null===e||void 0===e?void 0:e.type)}function lQ(e){return"repeat"===(null===e||void 0===e?void 0:e.type)}function fQ(e){return"concat"===(null===e||void 0===e?void 0:e.type)}function dQ(e){return"layer"===(null===e||void 0===e?void 0:e.type)}class hQ{constructor(e,t,n,i,r,a,o,s){var u,c;this.type=t,this.parent=n,this.config=r,this.repeater=a,this.view=s,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=r,this.repeater=a,this.name=null!==(u=e.name)&&void 0!==u?u:i,this.title=tU(e.title)?{text:e.title}:e.title,this.scaleNameMap=n?n.scaleNameMap:new sQ,this.projectionNameMap=n?n.projectionNameMap:new sQ,this.signalNameMap=n?n.signalNameMap:new sQ,this.data=e.data,this.description=e.description,this.transforms=pG(null!==(c=e.transform)&&void 0!==c?c:[]),this.layout=Qz(e)||fH(e)?{}:HW(e,t,r),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:zU(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new gY,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?$R(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){nQ(this)}parseProjection(){aX(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){UY(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const{style:t}=e,n=yR(e,["style"]),i={};for(const r of ZR(n)){const e=n[r];void 0!==e&&(i[r]=fU(e))}return i}assembleGroupEncodeEntry(e){let t=void 0;return this.view&&(t=this.assembleEncodeFromView(this.view)),e||"unit"!==this.type&&"layer"!==this.type?t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!==t&&void 0!==t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=yR(e,["spacing"]),{component:i,config:r}=this,a=oY(i.layoutHeaders,r);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of VT)e[n].title&&t.push(JZ(this,n));for(const n of YZ)t=t.concat(eY(this,n));return t}assembleAxes(){return EZ(this.component.axes,this.config)}assembleLegends(){return QY(this)}assembleProjections(){return eX(this)}assembleTitle(){var e,t,n;const i=null!==(e=this.title)&&void 0!==e?e:{},{encoding:r}=i,a=yR(i,["encoding"]),o=Object.assign(Object.assign(Object.assign({},eU(this.config.title).nonMark),a),r?{encode:{update:r}}:{});if(o.text)return LR(["unit","layer"],this.type)?LR(["middle",void 0],o.anchor)&&(o.frame=null!==(t=o.frame)&&void 0!==t?t:"group"):o.anchor=null!==(n=o.anchor)&&void 0!==n?n:"start",ZR(o).length>0?o:void 0}assembleGroup(e=[]){const t={};e=e.concat(this.assembleSignals()),e.length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||cQ(this.parent)?kJ(this):[];i.length>0&&(t.scales=i);const r=this.assembleAxes();r.length>0&&(t.axes=r);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return JR((this.name?this.name+"_":"")+e)}requestDataName(e){var t;const n=this.getName(e),i=this.component.data.outputNodeRefCounts;return i[n]=(null!==(t=i[n])&&void 0!==t?t:0)+1,n}getSizeSignalRef(e){if(cQ(this.parent)){const t=jL(e),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),i=n.get("range");if(MI(e)&&iU(i)){const e=n.get("name"),i=jJ(this,t),r=wJ(i);if(r){const t=tq({aggregate:"distinct",field:r},{expr:"datum"});return{signal:fY(e,n,t)}}return hB(`Unknown field for ${t}. Cannot calculate view size.`),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):aL(e)&&TL(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(uB.selectionNotFound(t));return n}}class pQ extends hQ{vgField(e,t={}){const n=this.fieldDef(e);if(n)return tq(n,t)}reduceFieldDef(e,t){return Iq(this.getMapping(),(t,n,i)=>{const r=mq(n);return r?e(t,r,i):t},t)}forEachFieldDef(e,t){Bq(this.getMapping(),(t,n)=>{const i=mq(t);i&&e(i,n)},t)}}class gQ extends oV{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=$R(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=a[0])&&void 0!==i?i:"value",null!==(r=a[1])&&void 0!==r?r:"density"]}clone(){return new gQ(null,$R(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${zR(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=yR(e,["density"]),i=Object.assign({type:"kde",field:t},n);return i}}class mQ extends oV{constructor(e,t){super(e),this.filter=t}clone(){return new mQ(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:i,markDef:r}=t,a=pU("invalid",r,n);if("filter"!==a)return null;const o=t.reduceFieldDef((e,n,r)=>{const a=TL(r)&&t.getScaleComponent(r);if(a){const t=a.get("type");!NI(t)||n.aggregate||zz(i)||(e[n.field]=n)}return e},{});return ZR(o).length?new mQ(e,o):null}dependentFields(){return new Set(ZR(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${zR(this.filter)}`}assemble(){const e=ZR(this.filter).reduce((e,t)=>{const n=this.filter[t],i=tq(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${i}) || (isValid(${i}) && isFinite(+${i})))`):"quantitative"===n.type&&(e.push(`isValid(${i})`),e.push(`isFinite(+${i})`))),e},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class vQ extends oV{constructor(e,t){super(e),this.transform=t,this.transform=$R(t);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map((e,t)=>{var n;return null!==(n=i[t])&&void 0!==n?n:e})}clone(){return new vQ(this.parent,$R(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${zR(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform,n={type:"flatten",fields:e,as:t};return n}}class bQ extends oV{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=$R(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=a[0])&&void 0!==i?i:"key",null!==(r=a[1])&&void 0!==r?r:"value"]}clone(){return new bQ(null,$R(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${zR(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform,n={type:"fold",fields:e,as:t};return n}}class yQ extends oV{constructor(e,t,n,i){super(e),this.fields=t,this.geojson=n,this.signal=i}clone(){return new yQ(null,$R(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const i of[[yT,bT],[OT,xT]]){const r=i.map(e=>t.channelHasField(e)?t.fieldDef(e).field:YU(t.encoding[e])?{expr:t.encoding[e].value+""}:void 0);(r[0]||r[1])&&(e=new yQ(e,r,null,t.getName(`geojson_${n++}`)))}if(t.channelHasField(_T)){const i=t.fieldDef(_T);i.type===pI&&(e=new yQ(e,null,i.field,t.getName(`geojson_${n++}`)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(ie["H"]);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${zR(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class xQ extends oV{constructor(e,t,n,i){super(e),this.projection=t,this.fields=n,this.as=i}clone(){return new xQ(null,this.projection,$R(this.fields),$R(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[yT,bT],[OT,xT]]){const i=n.map(e=>t.channelHasField(e)?t.fieldDef(e).field:YU(t.encoding[e])?{expr:t.encoding[e].value+""}:void 0),r=n[0]===OT?"2":"";(i[0]||i[1])&&(e=new xQ(e,t.projectionName(),i,[t.getName("x"+r),t.getName("y"+r)]))}return e}dependentFields(){return new Set(this.fields.filter(ie["H"]))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${zR(this.fields)} ${zR(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class OQ extends oV{constructor(e,t){super(e),this.transform=t}clone(){return new OQ(null,$R(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:i}=e,r=[t,n,...i?[i]:[]].join(",");return{signal:`sequence(${r})`}}static makeFromTransform(e,t){return new OQ(e,t)}static makeFromEncoding(e,t){const n=t.encoding,i=n.x,r=n.y;if(GU(i)&&GU(r)){const a=i.impute?i:r.impute?r:void 0;if(void 0===a)return;const o=i.impute?r:r.impute?i:void 0,{method:s,value:u,frame:c,keyvals:l}=a.impute,f=Uq(t.mark,n);return new OQ(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),void 0!==u?{value:u}:{}),c?{frame:c}:{}),void 0!==l?{keyvals:l}:{}),f.length?{groupby:f}:{}))}return null}hash(){return`Impute ${zR(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:i,groupby:r,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:ZH(n)?this.processSequence(n):n}:{}),{method:"value"}),r?{groupby:r}:{}),{value:i&&"value"!==i?null:a});if(i&&"value"!==i){const t=Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[i],fields:[e],frame:o,ignorePeers:!1},r?{groupby:r}:{}),n={type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e};return[s,t,n]}return[s]}}class wQ extends gY{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}class jQ extends oV{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=$R(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=a[0])&&void 0!==i?i:t.on,null!==(r=a[1])&&void 0!==r?r:t.loess]}clone(){return new jQ(null,$R(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${zR(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,i=yR(e,["loess","on"]),r=Object.assign({type:"loess",x:n,y:t},i);return r}}class kQ extends oV{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new kQ(null,$R(this.transform),this.secondary)}static make(e,t,n,i){const r=t.component.data.sources,{from:a}=n;let o=null;if(XH(a)){let e=eK(a.data,r);e||(e=new vX(a.data),r.push(e));const n=t.getName(`lookup_${i}`);o=new sV(e,n,"lookup",t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=o}else if(JH(a)){const e=a.selection;if(n=Object.assign({as:e},n),o=t.getSelectionComponent(JR(e),e).materialized,!o)throw new Error(uB.noSameUnitLookup(e))}return new kQ(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?Object(ie["i"])(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${zR({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:Object(ie["i"])(this.transform.as)}:{});else{let t=this.transform.as;Object(ie["H"])(t)||(hB(uB.NO_FIELDS_NEEDS_AS),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class _Q extends oV{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=$R(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=a[0])&&void 0!==i?i:"prob",null!==(r=a[1])&&void 0!==r?r:"value"]}clone(){return new _Q(null,$R(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${zR(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=yR(e,["quantile"]),i=Object.assign({type:"quantile",field:t},n);return i}}class AQ extends oV{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=$R(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=a[0])&&void 0!==i?i:t.on,null!==(r=a[1])&&void 0!==r?r:t.regression]}clone(){return new AQ(null,$R(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${zR(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,i=yR(e,["regression","on"]),r=Object.assign({type:"regression",x:n,y:t},i);return r}}class EQ extends oV{constructor(e,t){super(e),this.transform=t}clone(){return new EQ(null,$R(this.transform))}addDimensions(e){var t;this.transform.groupby=qR((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),e=>e)}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return`PivotTransform ${zR(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:i,op:r}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==i?{limit:i}:{}),void 0!==r?{op:r}:{}),void 0!==n?{groupby:n}:{})}}class DQ extends oV{constructor(e,t){super(e),this.transform=t}clone(){return new DQ(null,$R(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${zR(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function SQ(e){let t=0;function n(i,r){var a;if(i instanceof vX&&!i.isGenerator&&!LH(i.data)){e.push(r);const t={name:null,source:r.name,transform:[]};r=t}if(i instanceof NX&&(i.parent instanceof vX&&!r.source?(r.format=Object.assign(Object.assign({},null!==(a=r.format)&&void 0!==a?a:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof DX)return r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,void i.assemble().forEach(t=>e.push(t));if((i instanceof yX||i instanceof xX||i instanceof mQ||i instanceof vZ||i instanceof WZ||i instanceof xQ||i instanceof yQ||i instanceof EX||i instanceof kQ||i instanceof PX||i instanceof RX||i instanceof bQ||i instanceof vQ||i instanceof gQ||i instanceof jQ||i instanceof _Q||i instanceof AQ||i instanceof BX||i instanceof DQ||i instanceof EQ)&&r.transform.push(i.assemble()),(i instanceof mX||i instanceof uV||i instanceof OQ||i instanceof LX)&&r.transform.push(...i.assemble()),i instanceof sV)if(r.source&&0===r.transform.length)i.setSource(r.source);else if(i.parent instanceof sV)i.setSource(r.name);else if(r.name||(r.name=`data_${t++}`),i.setSource(r.name),1===i.numChildren()){e.push(r);const t={name:null,source:r.name,transform:[]};r=t}switch(i.numChildren()){case 0:i instanceof sV&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let a=r.name;!r.source||r.transform.length>0?e.push(r):a=r.source,i.children.forEach(e=>{const t={name:null,source:a,transform:[]};n(e,t)});break}}}return n}function CQ(e){const t=[],n=SQ(t);return e.children.forEach(t=>n(t,{source:e.name,name:null,transform:[]})),t}function FQ(e,t){var n,i;const r=[],a=SQ(r);let o=0;e.sources.forEach(e=>{e.hasName()||(e.dataName=`source_${o++}`);const t=e.assemble();a(e,t)}),r.forEach(e=>{0===e.transform.length&&delete e.transform});let s=0;for(const[u,c]of r.entries())0!==(null!==(n=c.transform)&&void 0!==n?n:[]).length||c.source||r.splice(s++,0,r.splice(u,1)[0]);for(const u of r)for(const t of null!==(i=u.transform)&&void 0!==i?i:[])"lookup"===t.type&&(t.from=e.outputNodes[t.from].getSource());for(const u of r)u.name in t&&(u.values=t[u.name]);return r}function $Q(e){return"top"===e||"left"===e?"header":"footer"}function MQ(e){for(const t of VT)NQ(e,t);zQ(e,"x"),zQ(e,"y")}function NQ(e,t){var n;if(e.channelHasField(t)){const i=e.facet[t],r=VZ("title",null,e.config,t);let a=fq(i,e.config,{allowDisabling:!0,includeDefault:void 0===r||!!r});e.child.component.layoutHeaders[t].title&&(a=Object(ie["A"])(a)?a.join(", "):a,a+=" / "+e.child.component.layoutHeaders[t].title,e.child.component.layoutHeaders[t].title=null);const o=VZ("labelOrient",i,e.config,t),s=null!==(n=i.header)&&void 0!==n?n:{},u=uz(s.labels,!0),c=LR(["bottom","right"],o)?"footer":"header";e.component.layoutHeaders[t]={title:a,facetFieldDef:i,[c]:"facet"===t?[]:[RQ(e,t,u)]}}}function RQ(e,t,n){const i="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function zQ(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:a}=e.component;if(a.axis[t]=pY(a,t),"shared"===a.axis[t]){const a="x"===t?"column":"row",o=r[a];for(const r of i.component.axes[t]){const t=$Q(r.get("orient"));o[t]=null!==(n=o[t])&&void 0!==n?n:[RQ(e,a,!1)];const i=_Z(r,"main",e.config,{header:!0});o[t][0].axes.push(i),r.mainExtracted=!0}}}}function TQ(e){IQ(e);const t=e.component.layoutSize;t.setWithExplicit("width",UQ(e,"width")),t.setWithExplicit("height",UQ(e,"height"))}const LQ=TQ,PQ={vconcat:"width",hconcat:"height"};function BQ(e){IQ(e);const t=e.component.layoutSize,n=PQ[e.concatType];n&&t.setWithExplicit(n,UQ(e,n))}function IQ(e){for(const t of e.children)t.parseLayoutSize()}function UQ(e,t){const n="width"===t?"x":"y",i=e.component.resolve;let r;for(const a of e.children){const e=a.component.layoutSize.getWithExplicit(t),o=i.scale[n];if("independent"===o&&"step"===e.value){r=void 0;break}if(r){if("independent"===o&&r.value!==e.value){r=void 0;break}r=xY(r,e,t,"")}else r=e}if(r){for(const n of e.children)e.renameSignal(n.getName(t),e.getName(t)),n.component.layoutSize.set(t,"merged",!1);return r}return{explicit:!1,value:void 0}}function qQ(e){const{size:t,component:n}=e;for(const i of OL){const r=wL(i);if(t[r]){const e=t[r];n.layoutSize.set(r,BW(e)?"step":e,!0)}else{const t=WQ(e,r);n.layoutSize.set(r,t,!1)}}}function WQ(e,t){const n="width"===t?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const e=r.get("type"),n=r.get("range");if(MI(e)){const e=ZW(i.view,t);return iU(n)||BW(e)?"step":e}return GW(i.view,t)}if(e.hasProjection)return GW(i.view,t);{const e=ZW(i.view,t);return BW(e)?e.step:e}}function HQ(e,t){return NU(e)?XQ(e,t):ZQ(e,t)}function GQ(e,t){return XQ(e,t)}function VQ(e,t){return LU(e.field)?e.field.repeat in t?Object.assign(Object.assign({},e),{field:t[e.field.repeat]}):void hB(uB.noSuchRepeatedValue(e.field.repeat)):e}function ZQ(e,t){if(e=VQ(e,t),void 0!==e){if(null===e)return null;if(BU(e)&&$U(e.sort)){const n=VQ(e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function YQ(e,t){if(!GU(e)){if(WU(e)){const n=ZQ(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const{condition:t}=e,n=yR(e,["condition"]);return n}}return e}{const n=ZQ(e,t);if(n)return n;if(qU(e))return{condition:e.condition}}}function XQ(e,t){const n={};for(const i in e)if(Object(ie["v"])(e,i)){const r=e[i];if(Object(ie["A"])(r))n[i]=r.map(e=>YQ(e,t)).filter(e=>e);else{const e=YQ(r,t);void 0!==e&&(n[i]=e)}}return n}function JQ(e,t,n){return tq(t,Object.assign({suffix:`by_${tq(e)}`},null!==n&&void 0!==n?n:{}))}class QQ extends pQ{constructor(e,t,n,i,r){super(e,"facet",t,n,r,i,e.resolve),this.child=r0(e.spec,this,this.getName("child"),void 0,i,r),this.children=[this.child];const a=HQ(e.facet,i);this.facet=this.initFacet(a)}initFacet(e){return NU(e)?Iq(e,(e,t,n)=>LR([fT,dT],n)?void 0===t.field?(hB(uB.emptyFieldDef(t,n)),e):(e[n]=bq(t,n),e):(hB(uB.incompatibleChannel(n,"facet")),e),{}):{facet:bq(e,"facet")}}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=iK(this),this.child.parseData()}parseLayoutSize(){IQ(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),MQ(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const i={};for(const r of VT)for(const a of XZ){const o=this.component.layoutHeaders[r],s=o[a],{facetFieldDef:u}=o;if(u){const t=VZ("titleOrient",u,this.config,r);if(LR(["right","bottom"],t)){const n=GZ(r,t);i.titleAnchor=null!==(e=i.titleAnchor)&&void 0!==e?e:{},i.titleAnchor[n]="end"}}if(null===s||void 0===s?void 0:s[0]){const e="row"===r?"height":"width",s="header"===a?"headerBand":"footerBand";"facet"===r||this.child.component.layoutSize.get(e)||(i[s]=null!==(t=i[s])&&void 0!==t?t:{},i[s][r]=.5),o.title&&(i.offset=null!==(n=i.offset)&&void 0!==n?n:{},i.offset["row"===r?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let i="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof QQ)){const e=this.getName("column_domain");return{signal:`length(data('${e}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof QQ?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:tq(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof QQ){if(this.child.channelHasField("column")){const i=tq(this.child.facet.column);e.push(i),t.push("distinct"),n.push(`distinct_${i}`)}}else for(const i of["x","y"]){const r=this.child.component.scales[i];if(r&&!r.merged){const a=r.get("type"),o=r.get("range");if(MI(a)&&iU(o)){const r=jJ(this.child,i),a=wJ(r);a?(e.push(a),t.push("distinct"),n.push(`distinct_${a}`)):hB(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:i}=this.facet,{fields:r,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const c of VT){const e=this.facet[c];if(e){s.push(tq(e));const{bin:t,sort:u}=e;if(Sq(t)&&s.push(tq(e,{binSuffix:"end"})),$U(u)){const{field:t,op:s=DU}=u,c=JQ(e,u);n&&i?(r.push(c),a.push("max"),o.push(c)):(r.push(t),a.push(s),o.push(c))}else if(Object(ie["A"])(u)){const t=HZ(e,c);r.push(t),a.push("max"),o.push(t)}}}const u=!!n&&!!i;return Object.assign({name:e,data:t,groupby:s},u||r.length>0?{aggregate:Object.assign(Object.assign({},u?{cross:u}:{}),r.length?{fields:r,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?$U(n.sort)?[JQ(n,n.sort,{expr:"datum"})]:Object(ie["A"])(n.sort)?[HZ(n,e,{expr:"datum"})]:[tq(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n,t=($U(e)?e.order:!Object(ie["A"])(e)&&e)||"ascending";return[t]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return nY(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const i of YZ)if(e[i]){const r=VZ("labelOrient",e[i],t,i);if(LR(n[i],r))return nY(e[i],i,t)}}assembleMarks(){const{child:e}=this,t=this.component.data.facetRoot,n=CQ(t),i=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),a=e.assembleGroupStyle(),o=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),a?{style:a}:{}),{from:{facet:this.assembleFacet()},sort:{field:VT.map(e=>this.facetSortFields(e)).flat(),order:VT.map(e=>this.facetSortOrder(e)).flat()}}),n.length>0?{data:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup(IV(this,[])));return[o]}getMapping(){return this.facet}}function KQ(e,t){const{row:n,column:i}=t;if(n&&i){let t=null;for(const r of[n,i])if($U(r.sort)){const{field:n,op:i=DU}=r.sort;e=t=new RX(e,{joinaggregate:[{op:i,field:n,as:JQ(r,r.sort,{forAs:!0})}],groupby:[tq(r)]})}return t}return null}function eK(e,t){var n,i,r,a,o,s,u,c,l,f;for(const d of t){const t=d.data;if((!e.name||!d.hasName()||e.name===d.dataName)&&(!((null===(n=e["format"])||void 0===n?void 0:n.mesh)&&(null===(i=t.format)||void 0===i?void 0:i.feature))&&(!((null===(r=e["format"])||void 0===r?void 0:r.feature)||(null===(a=t.format)||void 0===a?void 0:a.feature))||(null===(o=e["format"])||void 0===o?void 0:o.feature)===(null===(s=t.format)||void 0===s?void 0:s.feature))&&(!((null===(u=e["format"])||void 0===u?void 0:u.mesh)||(null===(c=t.format)||void 0===c?void 0:c.mesh))||(null===(l=e["format"])||void 0===l?void 0:l.mesh)===(null===(f=t.format)||void 0===f?void 0:f.mesh))))if(PH(e)&&PH(t)){if(FR(e.values,t.values))return d}else if(LH(e)&&LH(t)){if(e.url===t.url)return d}else if(BH(e)&&e.name===d.dataName)return d}return null}function tK(e,t){if(e.data||!e.parent){if(null===e.data){const e=new vX([]);return t.push(e),e}const n=eK(e.data,t);if(n)return IH(e.data)||(n.data.format=IR({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new vX(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function nK(e,t,n){var i,r;let a=0;for(const o of t.transforms){let s,u=void 0;if(sG(o))s=e=new WZ(e,o),u="derived";else if(VH(o)){const r=FX(o);s=e=null!==(i=NX.makeWithAncestors(e,{},r,n))&&void 0!==i?i:e,e=new vZ(e,t,o.filter)}else if(uG(o))s=e=mX.makeFromTransform(e,o,t),u="number";else if(lG(o)){u="date";const t=n.getWithExplicit(o.field);void 0===t.value&&(e=new NX(e,{[o.field]:u}),n.set(o.field,u,!1)),s=e=uV.makeFromTransform(e,o)}else if(fG(o))s=e=EX.makeFromTransform(e,o),u="number",hZ(t)&&(e=new BX(e));else if(YH(o))s=e=kQ.make(e,t,o,a++),u="derived";else if(rG(o))s=e=new PX(e,o),u="number";else if(aG(o))s=e=new RX(e,o),u="number";else if(dG(o))s=e=LX.makeFromTransform(e,o),u="derived";else if(hG(o))s=e=new bQ(e,o),u="derived";else if(oG(o))s=e=new vQ(e,o),u="derived";else if(QH(o))s=e=new EQ(e,o),u="derived";else if(iG(o))e=new DQ(e,o);else if(cG(o))s=e=OQ.makeFromTransform(e,o),u="derived";else if(KH(o))s=e=new gQ(e,o),u="derived";else if(eG(o))s=e=new _Q(e,o),u="derived";else if(tG(o))s=e=new AQ(e,o),u="derived";else{if(!nG(o)){hB(uB.invalidTransformIgnored(o));continue}s=e=new jQ(e,o),u="derived"}if(s&&void 0!==u)for(const e of null!==(r=s.producedFields())&&void 0!==r?r:[])n.set(e,u,!1)}return e}function iK(e){var t,n,i,r,a,o,s,u,c,l;let f=tK(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new wQ,g=e.data;IH(g)?(UH(g)?f=new xX(f,g.sequence):WH(g)&&(f=new yX(f,g.graticule)),p.parseNothing=!0):null===(null===(t=null===g||void 0===g?void 0:g.format)||void 0===t?void 0:t.parse)&&(p.parseNothing=!0),f=null!==(n=NX.makeExplicit(f,e,p))&&void 0!==n?n:f,f=new BX(f);const m=e.parent&&dQ(e.parent);(uQ(e)||cQ(e))&&m&&(f=null!==(i=mX.makeFromEncoding(f,e))&&void 0!==i?i:f),e.transforms.length>0&&(f=nK(f,e,p));const v=MX(e),b=$X(e);f=null!==(r=NX.makeWithAncestors(f,{},Object.assign(Object.assign({},v),b),p))&&void 0!==r?r:f,uQ(e)&&(f=yQ.parseAll(f,e),f=xQ.parseAll(f,e)),(uQ(e)||cQ(e))&&(m||(f=null!==(a=mX.makeFromEncoding(f,e))&&void 0!==a?a:f),f=null!==(o=uV.makeFromEncoding(f,e))&&void 0!==o?o:f,f=WZ.parseAllForSortIndex(f,e));const y=e.getName(GH),x=new sV(f,y,GH,h);if(d[y]=x,f=x,uQ(e)){const t=EX.makeFromEncoding(f,e);t&&(f=t,hZ(e)&&(f=new BX(f))),f=null!==(s=OQ.makeFromEncoding(f,e))&&void 0!==s?s:f,f=null!==(u=LX.makeFromEncoding(f,e))&&void 0!==u?u:f}uQ(e)&&(f=null!==(c=mQ.make(f,e))&&void 0!==c?c:f);const O=e.getName(HH),w=new sV(f,O,HH,h);d[O]=w,f=w,uQ(e)&&OZ(e,w);let j=null;if(cQ(e)){const t=e.getName("facet");f=WZ.parseAllForSortIndex(f,e),f=null!==(l=KQ(f,e.facet))&&void 0!==l?l:f,j=new DX(f,e,t,w.getSource()),d[t]=j,f=j}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:x,main:w,facetRoot:j,ancestorParse:p})}class rK extends hQ{constructor(e,t,n,i,r,a,o){super(e,t,n,i,r,a,o)}parseData(){this.component.data=iK(this),this.children.forEach(e=>{e.parseData()})}parseSelections(){this.component.selection={};for(const e of this.children)e.parseSelections(),ZR(e.component.selection).forEach(t=>{this.component.selection[t]=e.component.selection[t]})}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}assembleSelectionTopLevelSignals(e){return this.children.reduce((e,t)=>t.assembleSelectionTopLevelSignals(e),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){return this.children.reduce((e,t)=>[...e,...t.assembleLayoutSignals()],uY(this))}assembleSelectionData(e){return this.children.reduce((e,t)=>t.assembleSelectionData(e),e)}assembleMarks(){return this.children.map(e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),i=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup())})}}class aK extends rK{constructor(e,t,n,i,r){var a,o,s,u;super(e,"concat",t,n,r,i,e.resolve),"shared"!==(null===(o=null===(a=e.resolve)||void 0===a?void 0:a.axis)||void 0===o?void 0:o.x)&&"shared"!==(null===(u=null===(s=e.resolve)||void 0===s?void 0:s.axis)||void 0===u?void 0:u.y)||hB(uB.CONCAT_CANNOT_SHARE_AXIS),this.concatType=TW(e)?"vconcat":LW(e)?"hconcat":"concat",this.children=this.getChildren(e).map((e,t)=>r0(e,this,this.getName("concat_"+t),void 0,i,r))}getChildren(e){return TW(e)?e.vconcat:LW(e)?e.hconcat:e.concat}parseLayoutSize(){BQ(this)}parseAxisGroup(){return null}assembleDefaultLayout(){return Object.assign(Object.assign({},"vconcat"===this.concatType?{columns:1}:{}),{bounds:"full",align:"each"})}}function oK(e){return!1===e||null===e}const sK=Object.assign(Object.assign({gridScale:1,scale:1},yz),{labelExpr:1,labelOffset:1,encode:1}),uK=ZR(sK);class cK extends gY{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new cK($R(this.explicit),$R(this.implicit),this.mainExtracted)}hasAxisPart(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!oK(this.get(e)))}}function lK(e,t,n){var i,r;const a=null!==(i=e.fieldDef(t))&&void 0!==i?i:"x"===t?e.fieldDef("x2"):"y"===t?e.fieldDef("y2"):void 0,o=e.axis(t);let s={};if(jq(a)){const n=e.getScaleComponent(t).get("type")===mI.UTC,i=jU("datum.value",null===(r=HB(a.timeUnit))||void 0===r?void 0:r.unit,o.format,null,n);i&&(s.text={signal:i})}return s=Object.assign(Object.assign({},s),n),0===ZR(s).length?void 0:s}function fK(e){return OL.reduce((t,n)=>(e.component.scales[n]&&e.axis(n)&&(t[n]=[bK(n,e)]),t),{})}const dK={bottom:"top",top:"bottom",left:"right",right:"left"};function hK(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const a of e.children){a.parseAxesAndHeaders();for(const t of ZR(a.component.axes))i.axis[t]=pY(e.component.resolve,t),"shared"===i.axis[t]&&(n[t]=pK(n[t],a.component.axes[t]),n[t]||(i.axis[t]="independent",delete n[t]))}for(const a of[pT,gT]){for(const o of e.children)if(o.component.axes[a]){if("independent"===i.axis[a]){n[a]=(null!==(t=n[a])&&void 0!==t?t:[]).concat(o.component.axes[a]);for(const e of o.component.axes[a]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(r[t]>0&&!n){const n=dK[t];r[t]>r[n]&&e.set("orient",n,!1)}r[t]++}}delete o.component.axes[a]}if("independent"===i.axis[a]&&n[a]&&n[a].length>1)for(const e of n[a])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}function pK(e,t){if(!e)return t.map(e=>e.clone());{if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const n=e[i],r=t[i];if(!!n!==!!r)return;if(n&&r){const t=n.getWithExplicit("orient"),a=r.getWithExplicit("orient");if(t.explicit&&a.explicit&&t.value!==a.value)return;e[i]=gK(n,r)}}}return e}function gK(e,t){for(const n of uK){const i=xY(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(e,t)=>{switch(n){case"title":return EU(e,t);case"gridScale":return{explicit:e.explicit,value:uz(e.value,t.value)}}return yY(e,t,n,"axis")});e.setWithExplicit(n,i)}return e}function mK(e,t){const n="x"===t?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),a=i?i.title:void 0,o=r?r.title:void 0;return a&&o?AU(a,o):a||(o||(void 0!==a?a:void 0!==o?o:void 0))}function vK(e,t,n,i,r){switch(t){case"titleAngle":case"labelAngle":return e===hz(n[t]);case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===mK(i,r))return!0}return e===n[t]}function bK(e,t){var n;const i=t.axis(e),r=new cK;for(const s of uK){const n=yK(s,i,e,t),{configValue:a,configFrom:o}=Oz(s)?$Z(s,t.config,e,r.get("orient"),t.getScaleComponent(e).get("type"),i.style):{},u=vK(n,s,i,t,e);void 0===n||!u&&void 0!==a?(LR(["grid","orient","tickCount","labelExpr"],s)&&a||mz(a)||nU(a)||LR(["axisQuantitative","axisTemporal","style"],o))&&r.set(s,a,!1):r.set(s,n,u)}const a=null!==(n=i.encoding)&&void 0!==n?n:{},o=vz.reduce((n,i)=>{var o;if(!r.hasAxisPart(i))return n;const s=dY(null!==(o=a[i])&&void 0!==o?o:{},t),u="labels"===i?lK(t,e,s):s;return void 0!==u&&ZR(u).length>0&&(n[i]={update:u}),n},{});return ZR(o).length>0&&r.set("encode",o,!!i.encoding||void 0!==i.labelAngle),r}function yK(e,t,n,i){const r=i.fieldDef(n),a=RZ(i,t,n,r),o=uz(t.orient,BZ(n)),{mark:s,config:u}=i;switch(e){case"scale":return i.scaleName(n);case"gridScale":return NZ(i,n);case"format":if(jq(r))return;return yU(r,t.format,u);case"formatType":if(jq(r))return;return t.formatType;case"grid":if(Cq(i.fieldDef(n).bin))return!1;{const e=i.getScaleComponent(n).get("type");return uz(t.grid,MZ(e,r))}case"labelAlign":return uz(t.labelAlign,TZ(a,o));case"labelAngle":return a;case"labelBaseline":return uz(t.labelBaseline,zZ(a,o));case"labelFlush":return uz(t.labelFlush,LZ(r,n));case"labelOverlap":{const e=i.getScaleComponent(n).get("type");return uz(t.labelOverlap,PZ(r,e))}case"orient":return o;case"tickCount":{const e=i.getScaleComponent(n).get("type"),a="x"===n?"width":"y"===n?"height":void 0,o=a?i.getSizeSignalRef(a):void 0;return uz(t.tickCount,IZ({fieldDef:r,scaleType:e,size:o}))}case"title":{const e="x"===n?"x2":"y2",a=i.fieldDef(e);return uz(t.title,mK(i,n),_U([PU(r)],a?[PU(a)]:[]))}case"values":return UZ(t,i,r);case"zindex":return uz(t.zindex,qZ(s,r))}return Oz(e)?t[e]:void 0}function xK({encoding:e,size:t}){for(const n of OL){const i=wL(n),r=mq(e[n]);BW(t[i])&&r&&iq(r)&&(delete t[i],hB(uB.stepDropped(i)))}return t}function OK(e,t,n,{graticule:i}){var r,a,o;const s=Pz(e)?Object.assign({},e):{type:e},u=null!==(r=s.orient)&&void 0!==r?r:gU("orient",s,n);if(s.orient=_K(s.type,t,u),void 0!==u&&u!==s.orient&&hB(uB.orientOverridden(s.orient,u)),"bar"===s.type&&s.orient){const e=null!==(a=s.cornerRadiusEnd)&&void 0!==a?a:gU("cornerRadiusEnd",s,n);if(void 0!==e){const n="horizontal"===s.orient&&t.x2||"vertical"===s.orient&&t.y2?["cornerRadius"]:Gz[s.orient];for(const t of n)s[t]=e;void 0!==s.cornerRadiusEnd&&delete s.cornerRadiusEnd}}const c=uz(s.opacity,gU("opacity",s,n));void 0===c&&(s.opacity=jK(s.type,t));const l=s.filled;void 0===l&&(s.filled=!i&&kK(s,n));const f=null!==(o=s.cursor)&&void 0!==o?o:gU("cursor",s,n);return void 0===f&&(s.cursor=wK(s,t,n)),s}function wK(e,t,n){return t.href||e.href||gU("href",e,n)?"pointer":e.cursor}function jK(e,t){if(LR([Az,Cz,$z,Mz],e)&&!Rq(t))return.7}function kK(e,t){const n=gU("filled",e,t),i=e.type;return uz(n,i!==Az&&i!==_z&&i!==Dz)}function _K(e,t,n){switch(e){case Az:case $z:case Mz:case Sz:case Ez:case kz:return}const{x:i,y:r,x2:a,y2:o}=t;switch(e){case jz:if(GU(i)&&(Cq(i.bin)||GU(r)&&r.aggregate&&!i.aggregate))return"vertical";if(GU(r)&&(Cq(r.bin)||GU(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&GU(i)&&i.type===lI&&!Sq(i.bin))return"horizontal";if(!o&&GU(r)&&r.type===lI&&!Sq(r.bin))return"vertical"}case Dz:if(a&&o)return;case wz:if(o)return GU(r)&&Cq(r.bin)?"horizontal":"vertical";if(a)return GU(i)&&Cq(i.bin)?"vertical":"horizontal";if(e===Dz){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case _z:case Cz:{const t=GU(i)&&iq(i),a=GU(r)&&iq(r);if(t&&!a)return"tick"!==e?"horizontal":"vertical";if(!t&&a)return"tick"!==e?"vertical":"horizontal";if(t&&a){const t=i,a=r,o=t.type===dI,s=a.type===dI;return o&&!s?"tick"!==e?"vertical":"horizontal":!o&&s?"tick"!==e?"horizontal":"vertical":!t.aggregate&&a.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!a.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}const AK={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},XG(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore"})),TG("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),TG("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),eV(e))},EK={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},XG(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore"})),UG(e,"x","bar")),UG(e,"y","bar"))},DK={vgMark:"shape",encodeEntry:e=>Object.assign({},XG(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,i=Object.assign({type:"geoshape",projection:e.projectionName()},n&&GU(n)&&n.type===pI?{field:tq(n,{expr:"datum"})}:{});return[i]}},SK={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},XG(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore"})),UG(e,"x","image")),UG(e,"y","image")),AG(e,"url"))},CK={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},XG(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore"})),FG("x",e,{defaultPos:"mid"})),FG("y",e,{defaultPos:"mid"})),kG("size",e,{vgChannel:"strokeWidth"})),eV(e))},FK={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},XG(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore"})),FG("x",e,{defaultPos:"mid"})),FG("y",e,{defaultPos:"mid"})),kG("size",e)),eV(e))};function $K(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},XG(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore"})),FG("x",e,{defaultPos:"mid"})),FG("y",e,{defaultPos:"mid"})),kG("size",e)),MK(e,n,t))}function MK(e,t,n){return n?{shape:{value:n}}:kG("shape",e)}const NK={vgMark:"symbol",encodeEntry:e=>$K(e)},RK={vgMark:"symbol",encodeEntry:e=>$K(e,"circle")},zK={vgMark:"symbol",encodeEntry:e=>$K(e,"square")},TK={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},XG(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore"})),UG(e,"x","rect")),UG(e,"y","rect"))},LK={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},XG(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore"})),TG("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),TG("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),kG("size",e,{vgChannel:"strokeWidth"})):{}}},PK={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},XG(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore"})),FG("x",e,{defaultPos:"mid"})),FG("y",e,{defaultPos:"mid"})),AG(e)),kG("size",e,{vgChannel:"fontSize"})),nV("align",BK(e.markDef,n,t))),nV("baseline",IK(e.markDef,n,t)))}};function BK(e,t,n){var i;const r=null!==(i=e.align)&&void 0!==i?i:gU("align",e,n);if(void 0===r)return"center"}function IK(e,t,n){var i;const r=null!==(i=e.baseline)&&void 0!==i?i:gU("baseline",e,n);if(void 0===r)return"middle"}const UK={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r="horizontal"===i?"width":"height",a="horizontal"===i?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},XG(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore"})),FG("x",e,{defaultPos:"mid",vgChannel:"xc"})),FG("y",e,{defaultPos:"mid",vgChannel:"yc"})),kG("size",e,{defaultValue:qK(e),vgChannel:r})),{[a]:{value:uz(n.thickness,t.tick.thickness)}})}};function qK(e){const{config:t,markDef:n}=e,{orient:i}=n,r="horizontal"===i?"width":"height",a=e.getScaleComponent("horizontal"===i?"x":"y"),o=uz(n[r],n.size,gU("size",n,t,{vgChannel:r}),t.tick.bandSize);if(void 0!==o)return o;{const e=a?a.get("range"):void 0;if(e&&iU(e)&&Object(ie["E"])(e.step))return 3*e.step/4;const n=VW(t.view,r);return 3*n/4}}const WK={area:AK,bar:EK,circle:RK,geoshape:DK,image:SK,line:CK,point:NK,rect:TK,rule:LK,square:zK,text:PK,tick:UK,trail:FK};function HK(e){return LR([_z,wz,Fz],e.mark)?VK(e):LR([jz],e.mark)?YK(e):JK(e)}const GK="faceted_path_";function VK(e){const t=Uq(e.mark,e.encoding),n=JK(e,{fromPrefix:t.length>0?GK:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:GK+e.requestDataName(HH),data:e.requestDataName(HH),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}const ZK="stack_group_";function YK(e){const t=cU.some(t=>e.markDef[t]||gU(t,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t){const[t]=JK(e,{fromPrefix:ZK}),n=e.scaleName(e.stack.fieldChannel),i=(t={})=>e.vgField(e.stack.fieldChannel,t),r=(e,t)=>{const r=[i({prefix:"min",suffix:"start",expr:t}),i({prefix:"max",suffix:"start",expr:t}),i({prefix:"min",suffix:"end",expr:t}),i({prefix:"max",suffix:"end",expr:t})];return`${e}(${r.map(e=>`scale('${n}',${e})`).join(",")})`};let a,o;"x"===e.stack.fieldChannel?(a=Object.assign(Object.assign({},MR(t.encode.update,["y","yc","y2","height",...cU])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},NR(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(a=Object.assign(Object.assign({},MR(t.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},NR(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const l of cU){const n=gU(l,e.markDef,e.config);t.encode.update[l]?(a[l]=t.encode.update[l],delete t.encode.update[l]):n&&(a[l]={value:n}),n&&(t.encode.update[l]={value:0})}const s=e.fieldDef(e.stack.groupbyChannel),u=tq(s)?[tq(s)]:[];((null===s||void 0===s?void 0:s.bin)||(null===s||void 0===s?void 0:s.timeUnit))&&u.push(tq(s,{binSuffix:"end"}));const c=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return a=c.reduce((n,i)=>{if(t.encode.update[i])return Object.assign(Object.assign({},n),{[i]:t.encode.update[i]});{const t=gU(i,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[i]:{value:t}}):n}},a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(HH),name:ZK+e.requestDataName(HH),groupby:u,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}return JK(e)}function XK(e){const{encoding:t,stack:n,mark:i,markDef:r,config:a}=e,o=t.order;if(!(!Object(ie["A"])(o)&&YU(o)&&TR(o.value)||!o&&TR(r.order)||TR(gU("order",r,a)))){if((Object(ie["A"])(o)||GU(o))&&!n)return kU(o,{expr:"datum"});if(zz(i)){const n="horizontal"===r.orient?"y":"x",i=t[n];if(GU(i)){const t=i.sort;if(Object(ie["A"])(t))return{field:tq(i,{prefix:n,suffix:"sort_index",expr:"datum"})};if($U(t))return{field:tq({aggregate:Rq(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})};if(FU(t)){const n=e.fieldDef(t.encoding);return{field:tq(n,{expr:"datum"}),order:t.order}}return{field:tq(i,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}else;}}function JK(e,t={fromPrefix:""}){const n=e.mark,i=uz(e.markDef.clip,QK(e),KK(e)),r=hU(e.markDef),a=e.encoding.key,o=XK(e),s=e0(e),u=WK[n].postEncodingTransform?WK[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:WK[n].vgMark},i?{clip:!0}:{}),r?{style:r}:{}),a?{key:a.field}:{}),o?{sort:o}:{}),s||{}),{from:{data:t.fromPrefix+e.requestDataName(HH)},encode:{update:WK[n].encodeEntry(e)}}),u?{transform:u}:{})]}function QK(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}function KK(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}function e0(e){if(!e.component.selection)return null;const t=ZR(e.component.selection).length;let n=t,i=e.parent;while(i&&0===n)n=ZR(i.component.selection).length,i=i.parent;return n?{interactive:t>0}:null}class t0 extends pQ{constructor(e,t,n,i={},r,a){var o;super(e,"unit",t,n,a,r,void 0,IW(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const s=Pz(e.mark)?e.mark.type:e.mark,u=GQ(null!==(o=e.encoding)&&void 0!==o?o:{},r);this.markDef=OK(e.mark,u,a,{graticule:e.data&&WH(e.data)});const c=this.encoding=Lq(u,this.markDef);this.size=xK({encoding:c,size:IW(e)?Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):i}),this.stack=bH(s,c),this.specifiedScales=this.initScales(s,c),this.specifiedAxes=this.initAxes(c),this.specifiedLegends=this.initLegend(c),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===Nz,n=e&&qT.some(t=>GU(e[t]));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return zL.reduce((e,n)=>{let i,r;const a=t[n];return GU(a)?(i=a,r=a.scale):WU(a)&&(i=a.condition,r=a.condition["scale"]),i&&(e[n]=null!==r&&void 0!==r?r:{}),e},{})}initAxes(e){return[pT,gT].reduce((t,n)=>{const i=e[n];if(GU(i)||n===pT&&GU(e.x2)||n===gT&&GU(e.y2)){const e=GU(i)?i.axis:null;null!==e&&(t[n]=Object.assign({},e))}return t},{})}initLegend(e){return $L.reduce((t,n)=>{const i=e[n];if(i){const e=GU(i)?i.legend:WU(i)?i.condition["legend"]:null;null!==e&&!1!==e&&NL(n)&&(t[n]=Object.assign({},e))}return t},{})}parseData(){this.component.data=iK(this)}parseLayoutSize(){qQ(this)}parseSelections(){this.component.selection=bZ(this,this.selection)}parseMarkGroup(){this.component.mark=HK(this)}parseAxesAndHeaders(){this.component.axes=fK(this)}assembleSelectionTopLevelSignals(e){return UV(this,e)}assembleSignals(){return[...AZ(this),...BV(this,[])]}assembleSelectionData(e){return qV(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return uY(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&dQ(this.parent)||(t=WV(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return Nq(this.encoding,e)}fieldDef(e){const t=this.encoding[e];return vq(t)}}class n0 extends hQ{constructor(e,t,n,i,r,a){super(e,"layer",t,n,a,r,e.resolve,e.view);const o=Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map((e,t)=>{if(fH(e))return new n0(e,this,this.getName("layer_"+t),o,r,a);if(Qz(e))return new t0(e,this,this.getName("layer_"+t),o,r,a);throw new Error(uB.invalidSpec(e))})}parseData(){this.component.data=iK(this);for(const e of this.children)e.parseData()}parseLayoutSize(){TQ(this)}parseSelections(){this.component.selection={};for(const e of this.children)e.parseSelections(),ZR(e.component.selection).forEach(t=>{this.component.selection[t]=e.component.selection[t]})}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){hK(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((e,t)=>t.assembleSelectionTopLevelSignals(e),e)}assembleSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleSignals()),AZ(this))}assembleLayoutSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleLayoutSignals()),uY(this))}assembleSelectionData(e){return this.children.reduce((e,t)=>t.assembleSelectionData(e),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return HV(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,t)=>e.concat(t.assembleLegends()),QY(this))}}class i0 extends rK{constructor(e,t,n,i,r){super(e,"repeat",t,n,r,i,e.resolve),e.resolve&&e.resolve.axis&&("shared"===e.resolve.axis.x||"shared"===e.resolve.axis.y)&&hB(uB.REPEAT_CANNOT_SHARE_AXIS),this.repeat=e.repeat,this.children=this._initChildren(e,this.repeat,i,r)}_initChildren(e,t,n,i){const r=[],a=!Object(ie["A"])(t)&&t.row||[n?n.row:null],o=!Object(ie["A"])(t)&&t.column||[n?n.column:null],s=Object(ie["A"])(t)&&t||[n?n.repeat:null];for(const u of s)for(const t of a)for(const n of o){const a=(u?`__repeat_repeat_${u}`:"")+(t?`__repeat_row_${t}`:"")+(n?`__repeat_column_${n}`:""),o={repeat:u,row:t,column:n};r.push(r0(e.spec,this,this.getName("child"+a),void 0,o,i))}return r}parseLayoutSize(){LQ(this)}assembleDefaultLayout(){const{repeat:e}=this,t=Object(ie["A"])(e)?void 0:e.column?e.column.length:1;return Object.assign(Object.assign({},t?{columns:t}:{}),{bounds:"full",align:"all"})}}function r0(e,t,n,i,r,a){if(zU(e))return new QQ(e,t,n,r,a);if(fH(e))return new n0(e,t,n,i,r,a);if(Qz(e))return new t0(e,t,n,i,r,a);if(PW(e))return new i0(e,t,n,r,a);if(RW(e))return new aK(e,t,n,r,a);throw new Error(uB.invalidSpec(e))}function a0(e,t={}){t.logger&&fB(t.logger),t.fieldTitle&&cq(t.fieldTitle);try{const n=rH(Object(ie["N"])(t.config,e.config)),i=SH(e,n),r=r0(i,null,"",void 0,void 0,n);r.parse(),sJ(r.component.data,r);const a=s0(r,o0(e,i.autosize,n,r),e.datasets,e.usermeta);return{spec:a,normalized:i}}finally{t.logger&&dB(),t.fieldTitle&&lq()}}function o0(e,t,n,i){const r=i.component.layoutSize.get("width"),a=i.component.layoutSize.get("height");if(void 0===t?t={type:"pad"}:Object(ie["H"])(t)&&(t={type:t}),r&&a&&NH(t.type))if("step"===r&&"step"===a)hB(uB.droppingFit()),t.type="pad";else if("step"===r||"step"===a){const e="step"===r?"width":"height";hB(uB.droppingFit(jL(e)));const n="width"===e?"height":"width";t.type=RH(n)}return Object.assign(Object.assign(Object.assign({},1===ZR(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),TH(n)),TH(e))}function s0(e,t,n={},i){const r=e.config?uH(e.config):void 0,a=[].concat(e.assembleSelectionData([]),FQ(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),u=e.assembleGroupStyle(),c=e.assembleGroupEncodeEntry(!0);let l=e.assembleLayoutSignals();return l=l.filter(e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),s?{title:s}:{}),u?{style:u}:{}),c?{encode:{update:c}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...l,...e.assembleSelectionTopLevelSignals([])])),r?{config:r}:{}),i?{usermeta:i}:{})}class u0 extends dH{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:i}=e,{bins:r,timeUnits:a,aggregate:o,groupby:s,encoding:u}=zq(n,t),c=[...i||[],...r,...a,...0===o.length?[]:[{aggregate:o,groupby:s}]];return Object.assign(Object.assign(Object.assign({},e),c.length>0?{transform:c}:{}),{encoding:u})}return e}}const c0=new u0;function l0(e,t){return c0.map(e,{config:t})}const f0=bR.version;var d0=n("81ab"),h0=n.n(d0),p0=n("ab0f");const g0="#fff",m0="#888",v0={background:"#333",title:{color:g0},style:{"guide-label":{fill:g0},"guide-title":{fill:g0}},axis:{domainColor:g0,gridColor:m0,tickColor:g0}};var b0=v0;const y0="#4572a7",x0={background:"#fff",arc:{fill:y0},area:{fill:y0},line:{stroke:y0,strokeWidth:2},path:{stroke:y0},rect:{fill:y0},shape:{stroke:y0},symbol:{fill:y0,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}};var O0=x0;const w0="#30a2da",j0="#cbcbcb",k0="#999",_0="#333",A0="#f0f0f0",E0="#333",D0={arc:{fill:w0},area:{fill:w0},axis:{domainColor:j0,grid:!0,gridColor:j0,gridWidth:1,labelColor:k0,labelFontSize:10,titleColor:_0,tickColor:j0,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:A0,group:{fill:A0},legend:{labelColor:E0,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:E0,titleFontSize:14,titlePadding:10},line:{stroke:w0,strokeWidth:2},path:{stroke:w0,strokeWidth:.5},rect:{fill:w0},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:w0},style:{bar:{binSpacing:2,fill:w0,stroke:null}},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}};var S0=D0;const C0="#000",F0={group:{fill:"#e5e5e5"},arc:{fill:C0},area:{fill:C0},line:{stroke:C0},path:{stroke:C0},rect:{fill:C0},shape:{stroke:C0},symbol:{fill:C0,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}};var $0=F0;const M0=22,N0="normal",R0="Benton Gothic, sans-serif",z0=11.5,T0="normal",L0="#82c6df",P0="Benton Gothic Bold, sans-serif",B0="normal",I0=13,U0={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},q0={background:"#ffffff",title:{anchor:"start",color:"#000000",font:P0,fontSize:M0,fontWeight:N0},arc:{fill:L0},area:{fill:L0},line:{stroke:L0,strokeWidth:2},path:{stroke:L0},rect:{fill:L0},shape:{stroke:L0},symbol:{fill:L0,size:30},axis:{labelFont:R0,labelFontSize:z0,labelFontWeight:T0,titleFont:P0,titleFontSize:I0,titleFontWeight:B0},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:R0,labelFontSize:z0,symbolType:"square",titleFont:P0,titleFontSize:I0,titleFontWeight:B0},range:{category:U0["category-6"],diverging:U0["fireandice-6"],heatmap:U0["fire-7"],ordinal:U0["fire-7"],ramp:U0["fire-7"]}};var W0=q0;const H0="#ab5787",G0="#979797",V0={background:"#f9f9f9",arc:{fill:H0},area:{fill:H0},line:{stroke:H0},path:{stroke:H0},rect:{fill:H0},shape:{stroke:H0},symbol:{fill:H0,size:30},axis:{domainColor:G0,domainWidth:.5,gridWidth:.2,labelColor:G0,tickColor:G0,tickWidth:.2,titleColor:G0},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}};var Z0=V0;const Y0="#3e5c69",X0={background:"#fff",arc:{fill:Y0},area:{fill:Y0},line:{stroke:Y0},path:{stroke:Y0},rect:{fill:Y0},shape:{stroke:Y0},symbol:{fill:Y0},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}};var J0=X0;const Q0="#1696d2",K0="#000000",e1="#FFFFFF",t1="Lato",n1="Lato",i1="Lato",r1="#DEDDDD",a1=18,o1={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},s1={background:e1,title:{anchor:"start",fontSize:a1,font:t1},axisX:{domain:!0,domainColor:K0,domainWidth:1,grid:!1,labelFontSize:12,labelFont:n1,labelAngle:0,tickColor:K0,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:t1},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:r1,gridWidth:1,labelFontSize:12,labelFont:n1,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:t1,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:n1,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:t1,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:o1["six-groups-cat-1"],diverging:o1["diverging-colors"],heatmap:o1["diverging-colors"],ordinal:o1["six-groups-seq"],ramp:o1["shades-blue"]},area:{fill:Q0},rect:{fill:Q0},line:{color:Q0,stroke:Q0,strokeWidth:5},trail:{color:Q0,stroke:Q0,strokeWidth:0,size:1},path:{stroke:Q0,strokeWidth:.5},point:{filled:!0},text:{font:i1,color:Q0,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:Q0,stroke:null}},arc:{fill:Q0},shape:{stroke:Q0},symbol:{fill:Q0,size:30}};var u1=s1;const c1="#3366CC",l1="#ccc",f1="Arial, sans-serif",d1={arc:{fill:c1},area:{fill:c1},path:{stroke:c1},rect:{fill:c1},shape:{stroke:c1},symbol:{stroke:c1},circle:{fill:c1},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:f1,fontSize:12},"guide-title":{font:f1,fontSize:12},"group-title":{font:f1,fontSize:12}},title:{font:f1,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:l1,tickColor:l1,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}};var h1=d1;const p1=p0.version;var g1=n("de20"),m1="#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n";const v1="vg-tooltip-element",b1={offsetX:10,offsetY:10,id:v1,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:y1,maxDepth:2};function y1(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function x1(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return m1.toString().replace(v1,e)}var O1=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};function w1(e,t,n){if(Object(ie["A"])(e))return`[${e.map(e=>t(Object(ie["H"])(e)?e:k1(e,n))).join(", ")}]`;if(Object(ie["F"])(e)){let i="";const r=e,{title:a}=r,o=O1(r,["title"]);a&&(i+=`<h2>${t(a)}</h2>`);const s=Object.keys(o);if(s.length>0){i+="<table>";for(const e of s){let r=o[e];void 0!==r&&(Object(ie["F"])(r)&&(r=k1(r,n)),i+=`<tr><td class="key">${t(e)}:</td><td class="value">${t(r)}</td></tr>`)}i+="</table>"}return i||"{}"}return t(e)}function j1(e){const t=[];return function(n,i){if("object"!==typeof i||null===i)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function k1(e,t){return JSON.stringify(e,j1(t))}function _1(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let a=e.clientY+i;return a+t.height>window.innerHeight&&(a=+e.clientY-i-t.height),{x:r,y:a}}class A1{constructor(e){this.options=Object.assign(Object.assign({},b1),e);const t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const e=document.createElement("style");e.setAttribute("id",this.options.styleId),e.innerHTML=x1(t);const n=document.head;n.childNodes.length>0?n.insertBefore(e,n.childNodes[0]):n.appendChild(e)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,i){if(null==i||""===i)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=w1(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:r,y:a}=_1(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${r}px`)}}g1.version;var E1,D1=function(e,t,n){const i=e.open(t),r=1e4,a=250;let o=~~(r/a);function s(t){t.source===i&&(o=0,e.removeEventListener("message",s,!1))}function u(){o<=0||(i.postMessage(n,"*"),setTimeout(u,a),o-=1)}e.addEventListener("message",s,!1),setTimeout(u,a)},S1='.vega-embed {\n  position: relative;\n  display: inline-block; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: scroll;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n';function C1(e,...t){for(const n of t)F1(e,n);return e}function F1(e,t){for(const n of Object.keys(t))Object(ie["jb"])(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}),n.d(t,"vega",(function(){return $1})),n.d(t,"vegaLite",(function(){return M1})),n.d(t,"DEFAULT_ACTIONS",(function(){return R1})),n.d(t,"guessMode",(function(){return q1})),n.d(t,"default",(function(){return H1}));const $1=g;let M1=b;const N1="undefined"!==typeof window?window:void 0;void 0===M1&&(null===(E1=null===N1||void 0===N1?void 0:N1["vl"])||void 0===E1?void 0:E1.compile)&&(M1=N1["vl"]);const R1={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},z1={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},T1={vega:"Vega","vega-lite":"Vega-Lite"},L1={vega:$1.version,"vega-lite":M1?M1.version:"not available"},P1={vega:e=>e,"vega-lite":(e,t)=>M1.compile(e,{config:t}).spec},B1='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>';function I1(e){return"function"===typeof e}function U1(e,t,n,i){const r=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(r+e+a),o.document.title=`${T1[i]} JSON Source`}function q1(e,t){var n;if(e.$schema){const i=h0()(e.$schema);t&&t!==i.library&&console.warn(`The given visualization spec is written in ${T1[i.library]}, but mode argument sets ${null!==(n=T1[t])&&void 0!==n?n:t}.`);const r=i.library;return Object(ne["satisfies"])(L1[r],`^${i.version.slice(1)}`)||console.warn(`The input spec uses ${T1[r]} ${i.version}, but the current version of ${T1[r]} is v${L1[r]}.`),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!==t&&void 0!==t?t:"vega"}function W1(e){return!!(e&&"load"in e)}function H1(e,t,n={}){var i,r,a;return x(this,void 0,void 0,(function*(){const o=W1(n.loader)?n.loader:$1.loader(n.loader),s=Object(ie["H"])(t)?JSON.parse(yield o.load(t)):t,u=yield G1(null!==(i=s.usermeta&&s.usermeta["embedOptions"])&&void 0!==i?i:{},o),c=yield G1(n,o),l=Object.assign(Object.assign({},C1(c,u)),{config:Object(ie["N"])(null!==(r=c.config)&&void 0!==r?r:{},null!==(a=u.config)&&void 0!==a?a:{})});return yield V1(e,s,l,o)}))}function G1(e,t){var n;return x(this,void 0,void 0,(function*(){const i=Object(ie["H"])(e.config)?JSON.parse(yield t.load(e.config)):null!==(n=e.config)&&void 0!==n?n:{},r=Object(ie["H"])(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),r?{patch:r}:{}),i?{config:i}:{})}))}function V1(e,t,n={},i){var r,a,o,s,u,c;return x(this,void 0,void 0,(function*(){const l=n.theme?Object(ie["N"])(y[n.theme],null!==(r=n.config)&&void 0!==r?r:{}):n.config,f=Object(ie["B"])(n.actions)?n.actions:C1({},R1,null!==(a=n.actions)&&void 0!==a?a:{}),d=Object.assign(Object.assign({},z1),n.i18n),h=null!==(o=n.renderer)&&void 0!==o?o:"canvas",p=null!==(s=n.logLevel)&&void 0!==s?s:$1.Warn,g=null!==(u=n.downloadFileName)&&void 0!==u?u:"visualization";if(!1!==n.defaultStyle){const e="vega-embed-style";if(!document.getElementById(e)){const t=document.createElement("style");t.id=e,t.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?(null!==S1&&void 0!==S1?S1:"").toString():n.defaultStyle,document.head.appendChild(t)}}const m=q1(t,n.mode);let v=P1[m](t,l);if("vega-lite"===m&&v.$schema){const e=h0()(v.$schema);Object(ne["satisfies"])(L1.vega,`^${e.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${e.version}, but current version is v${L1.vega}.`)}const b="string"===typeof e?document.querySelector(e):e;if(!b)throw Error(`${e} does not exist`);b.classList.add("vega-embed"),f&&b.classList.add("has-actions"),b.innerHTML="";const O=n.patch;O&&(v=O instanceof Function?O(v):L(v,O,!0,!1).newDocument),n.formatLocale&&$1.formatLocale(n.formatLocale),n.timeFormatLocale&&$1.timeFormatLocale(n.timeFormatLocale);const w=$1.parse(v,"vega-lite"===m?{}:l),j=new $1.View(w,{loader:i,logLevel:p,renderer:h});if(!1!==n.tooltip){let e;e=I1(n.tooltip)?n.tooltip:new A1(!0===n.tooltip?{}:n.tooltip).call,j.tooltip(e)}let k,{hover:_}=n;if(void 0===_&&(_="vega"===m),_){const{hoverSet:e,updateSet:t}="boolean"===typeof _?{}:_;j.hover(e,t)}if(n&&(n.width&&j.width(n.width),n.height&&j.height(n.height),n.padding&&j.padding(n.padding)),yield j.initialize(e).runAsync(),!1!==f){let e=b;if(!1!==n.defaultStyle){const t=document.createElement("details");t.title=d.CLICK_TO_VIEW_ACTIONS,b.append(t),e=t;const n=document.createElement("summary");n.innerHTML=B1,t.append(n),k=e=>{t.contains(e.target)||t.removeAttribute("open")},document.addEventListener("click",k)}const i=document.createElement("div");if(e.append(i),i.classList.add("vega-actions"),!0===f||!1!==f.export)for(const t of["svg","png"])if(!0===f||!0===f.export||f.export[t]){const e=d[`${t.toUpperCase()}_ACTION`],r=document.createElement("a");r.text=e,r.href="#",r.target="_blank",r.download=`${g}.${t}`,r.addEventListener("mousedown",(function(e){return x(this,void 0,void 0,(function*(){e.preventDefault();const i=yield j.toImageURL(t,n.scaleFactor);this.href=i}))})),i.append(r)}if(!0===f||!1!==f.source){const e=document.createElement("a");e.text=d.SOURCE_ACTION,e.href="#",e.addEventListener("mousedown",(function(e){var i,r;U1(te()(t),null!==(i=n.sourceHeader)&&void 0!==i?i:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"",m),e.preventDefault()})),i.append(e)}if("vega-lite"===m&&(!0===f||!1!==f.compiled)){const e=document.createElement("a");e.text=d.COMPILED_ACTION,e.href="#",e.addEventListener("mousedown",(function(e){var t,i;U1(te()(v),null!==(t=n.sourceHeader)&&void 0!==t?t:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"","vega"),e.preventDefault()})),i.append(e)}if(!0===f||!1!==f.editor){const e=null!==(c=n.editorUrl)&&void 0!==c?c:"https://vega.github.io/editor/",r=document.createElement("a");r.text=d.EDITOR_ACTION,r.href="#",r.addEventListener("mousedown",(function(n){D1(window,e,{config:l,mode:m,renderer:h,spec:te()(t)}),n.preventDefault()})),i.append(r)}}function A(){k&&document.removeEventListener("click",k),j.finalize()}return{view:j,spec:t,vgSpec:v,finalize:A}}))}},"7d63":function(e,t,n){const i=n("3fce"),r=(e,t)=>new i(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "));e.exports=r},"81ab":function(e,t,n){"use strict";function i(e){var t=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g,n=t.exec(e).slice(1,3),i=n[0],r=n[1];return{library:i,version:r}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},"86d4":function(e,t,n){const i=n("bbfd"),r=n("3fce"),a=n("bac4"),o=(e,t)=>{e=new r(e,t);let n=new i("0.0.0");if(e.test(n))return n;if(n=new i("0.0.0-0"),e.test(n))return n;n=null;for(let r=0;r<e.set.length;++r){const t=e.set[r];t.forEach(e=>{const t=new i(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":n&&!a(n,t)||(n=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})}return n&&e.test(n)?n:null};e.exports=o},8970:function(e,t,n){const i=n("a236"),r=(e,t)=>{const n=i(e,t);return n&&n.prerelease.length?n.prerelease:null};e.exports=r},"8bd6":function(e,t,n){const i=n("38cb"),r=(e,t,n)=>i(e,t,">",n);e.exports=r},"8cb5":function(e,t,n){const{MAX_SAFE_COMPONENT_LENGTH:i}=n("b15c"),r=n("b802");t=e.exports={};const a=t.re=[],o=t.src=[],s=t.t={};let u=0;const c=(e,t,n)=>{const i=u++;r(i,t),s[e]=i,o[i]=t,a[i]=new RegExp(t,n?"g":void 0)};c("NUMERICIDENTIFIER","0|[1-9]\\d*"),c("NUMERICIDENTIFIERLOOSE","[0-9]+"),c("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),c("MAINVERSION",`(${o[s.NUMERICIDENTIFIER]})\\.`+`(${o[s.NUMERICIDENTIFIER]})\\.`+`(${o[s.NUMERICIDENTIFIER]})`),c("MAINVERSIONLOOSE",`(${o[s.NUMERICIDENTIFIERLOOSE]})\\.`+`(${o[s.NUMERICIDENTIFIERLOOSE]})\\.`+`(${o[s.NUMERICIDENTIFIERLOOSE]})`),c("PRERELEASEIDENTIFIER",`(?:${o[s.NUMERICIDENTIFIER]}|${o[s.NONNUMERICIDENTIFIER]})`),c("PRERELEASEIDENTIFIERLOOSE",`(?:${o[s.NUMERICIDENTIFIERLOOSE]}|${o[s.NONNUMERICIDENTIFIER]})`),c("PRERELEASE",`(?:-(${o[s.PRERELEASEIDENTIFIER]}(?:\\.${o[s.PRERELEASEIDENTIFIER]})*))`),c("PRERELEASELOOSE",`(?:-?(${o[s.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[s.PRERELEASEIDENTIFIERLOOSE]})*))`),c("BUILDIDENTIFIER","[0-9A-Za-z-]+"),c("BUILD",`(?:\\+(${o[s.BUILDIDENTIFIER]}(?:\\.${o[s.BUILDIDENTIFIER]})*))`),c("FULLPLAIN",`v?${o[s.MAINVERSION]}${o[s.PRERELEASE]}?${o[s.BUILD]}?`),c("FULL",`^${o[s.FULLPLAIN]}$`),c("LOOSEPLAIN",`[v=\\s]*${o[s.MAINVERSIONLOOSE]}${o[s.PRERELEASELOOSE]}?${o[s.BUILD]}?`),c("LOOSE",`^${o[s.LOOSEPLAIN]}$`),c("GTLT","((?:<|>)?=?)"),c("XRANGEIDENTIFIERLOOSE",`${o[s.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),c("XRANGEIDENTIFIER",`${o[s.NUMERICIDENTIFIER]}|x|X|\\*`),c("XRANGEPLAIN",`[v=\\s]*(${o[s.XRANGEIDENTIFIER]})`+`(?:\\.(${o[s.XRANGEIDENTIFIER]})`+`(?:\\.(${o[s.XRANGEIDENTIFIER]})`+`(?:${o[s.PRERELEASE]})?${o[s.BUILD]}?`+")?)?"),c("XRANGEPLAINLOOSE",`[v=\\s]*(${o[s.XRANGEIDENTIFIERLOOSE]})`+`(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})`+`(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})`+`(?:${o[s.PRERELEASELOOSE]})?${o[s.BUILD]}?`+")?)?"),c("XRANGE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAIN]}$`),c("XRANGELOOSE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAINLOOSE]}$`),c("COERCE",`(^|[^\\d])(\\d{1,${i}})`+`(?:\\.(\\d{1,${i}}))?`+`(?:\\.(\\d{1,${i}}))?`+"(?:$|[^\\d])"),c("COERCERTL",o[s.COERCE],!0),c("LONETILDE","(?:~>?)"),c("TILDETRIM",`(\\s*)${o[s.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",c("TILDE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAIN]}$`),c("TILDELOOSE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAINLOOSE]}$`),c("LONECARET","(?:\\^)"),c("CARETTRIM",`(\\s*)${o[s.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",c("CARET",`^${o[s.LONECARET]}${o[s.XRANGEPLAIN]}$`),c("CARETLOOSE",`^${o[s.LONECARET]}${o[s.XRANGEPLAINLOOSE]}$`),c("COMPARATORLOOSE",`^${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]})$|^$`),c("COMPARATOR",`^${o[s.GTLT]}\\s*(${o[s.FULLPLAIN]})$|^$`),c("COMPARATORTRIM",`(\\s*)${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]}|${o[s.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",c("HYPHENRANGE",`^\\s*(${o[s.XRANGEPLAIN]})`+"\\s+-\\s+"+`(${o[s.XRANGEPLAIN]})`+"\\s*$"),c("HYPHENRANGELOOSE",`^\\s*(${o[s.XRANGEPLAINLOOSE]})`+"\\s+-\\s+"+`(${o[s.XRANGEPLAINLOOSE]})`+"\\s*$"),c("STAR","(<|>)?=?\\s*\\*")},"9b0d":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var i=n("276f");function r(t){return!("function"!==typeof e||!Object(i["D"])(e.isBuffer))&&e.isBuffer(t)}function a(e,t){const n=t&&t.property?Object(i["t"])(t.property):i["x"];return Object(i["F"])(e)&&!r(e)?o(n(e)):n(JSON.parse(e))}function o(e,t){return t&&t.copy?JSON.parse(JSON.stringify(e)):e}a.responseType="json"}).call(this,n("b639").Buffer)},"9b6c":function(e,t,n){const i=n("38cb"),r=(e,t,n)=>i(e,t,"<",n);e.exports=r},a236:function(e,t,n){const{MAX_LENGTH:i}=n("b15c"),{re:r,t:a}=n("8cb5"),o=n("bbfd"),s=(e,t)=>{if(t&&"object"===typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof o)return e;if("string"!==typeof e)return null;if(e.length>i)return null;const n=t.loose?r[a.LOOSE]:r[a.FULL];if(!n.test(e))return null;try{return new o(e,t)}catch(s){return null}};e.exports=s},a2a3:function(e,t,n){const i=n("3034"),r=(e,t,n)=>i(e,t,n)>=0;e.exports=r},a87b:function(e){e.exports={name:"vega-lite",author:'Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',version:"4.5.1",collaborators:["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-Lite is a concise high-level language for interactive visualization.",main:"build/vega-lite.js",unpkg:"build/vega-lite.min.js",jsdelivr:"build/vega-lite.min.js",module:"build/src/index",types:"build/src/index.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{changelog:"conventional-changelog -p angular",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint --ext .ts .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@commitlint/cli":"^8.3.5","@commitlint/config-conventional":"^8.3.4","@rollup/plugin-commonjs":"11.0.2","@rollup/plugin-json":"^4.0.2","@rollup/plugin-node-resolve":"^7.1.1","@types/chai":"^4.2.9","@types/d3":"^5.7.2","@types/jest":"^25.1.3","@types/jest-environment-puppeteer":"^4.3.1","@types/mkdirp":"^1.0.0","@types/puppeteer":"^2.0.1","@typescript-eslint/eslint-plugin":"^2.21.0","@typescript-eslint/parser":"^2.21.0",ajv:"^6.12.0",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.6.5",concurrently:"^5.1.0","conventional-changelog-cli":"^2.0.31",d3:"^5.15.0",eslint:"^6.8.0","eslint-config-prettier":"^6.10.0","eslint-plugin-prettier":"^3.1.2","gh-pages":"^2.2.0","highlight.js":"^9.18.1","http-server":"^0.12.1",husky:"^4.2.3",jest:"^25.1.0","jest-puppeteer":"^4.4.0","lint-staged":"^10.0.8",mkdirp:"^1.0.3",prettier:"^1.19.1",puppeteer:"^2.1.1",rollup:"^1.32.0","rollup-plugin-sourcemaps":"^0.5.0","rollup-plugin-terser":"^5.2.0","svg2png-many":"^0.0.7",terser:"^4.6.4","ts-jest":"^25.2.1","ts-json-schema-generator":"0.61.1",typescript:"~3.8.3","vega-cli":"^5.9.2","vega-datasets":"^1.30.2","vega-embed":"^6.3.2","vega-tooltip":"^0.20.1","vega-typings":"~0.13.0","yaml-front-matter":"^4.1.0"},dependencies:{"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~1.11.1","vega-event-selector":"~2.0.2","vega-expression":"~2.6.3","vega-scale":"^6.0.0","vega-util":"~1.13.0",yargs:"~15.1.0"},peerDependencies:{vega:"^5.9.2"},husky:{hooks:{"pre-commit":"lint-staged","commit-msg":"commitlint -E HUSKY_GIT_PARAMS"}},"lint-staged":{"*.ts":["eslint --fix","git add"],"*.{md,css,yml}":["prettier --write","git add"]},jest:{preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1}}},ab0f:function(e){e.exports={name:"vega-themes",version:"2.7.1",description:"Themes for stylized Vega and Vega-Lite visualizations.",keywords:["vega","vega-lite","themes","style"],license:"BSD-3-Clause",author:{name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},contributors:[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],main:"build/vega-themes.js",module:"build/src/index.js",unpkg:"build/vega-themes.min.js",jsdelivr:"build/vega-themes.min.js",typings:"build/src/index.d.ts",repository:{type:"git",url:"https://github.com/vega/vega-themes.git"},scripts:{prepare:"beemo create-config --silent",clean:"rm -rf build examples/build",prettierbase:"beemo prettier 'examples/*.{html,scss,css}'",eslintbase:"beemo eslint 'src/**/*.ts'",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",prebuild:"mkdir -p build",build:"tsc && rollup -c",postbuild:"terser build/vega-themes.js -cm > build/vega-themes.min.js","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Typescript,Rollup 'yarn serve' 'tsc -w' 'rollup -c -w'"},devDependencies:{"@rollup/plugin-json":"^4.0.2","browser-sync":"^2.26.7",concurrently:"^5.1.0","gh-pages":"^2.2.0",rollup:"^1.31.0",terser:"^4.6.3",typescript:"~3.7.5",vega:"^5.9.0","vega-lite":"^4.0.0","vega-lite-dev-config":"^0.3.1"},peerDependencies:{vega:"*","vega-lite":"*"},beemo:{module:"vega-lite-dev-config",drivers:["prettier","eslint"]}}},acef:function(e,t,n){const i=n("a236"),r=(e,t)=>{const n=i(e,t);return n?n.version:null};e.exports=r},b00b:function(e,t,n){const i=n("3034"),r=(e,t)=>i(e,t,!0);e.exports=r},b15c:function(e,t){const n="2.0.0",i=256,r=Number.MAX_SAFE_INTEGER||9007199254740991,a=16;e.exports={SEMVER_SPEC_VERSION:n,MAX_LENGTH:i,MAX_SAFE_INTEGER:r,MAX_SAFE_COMPONENT_LENGTH:a}},b802:function(e,t,n){(function(t){const n="object"===typeof t&&Object({NODE_ENV:"production",VUE_APP_BASE_API:"/stage-api",BASE_URL:"/"})&&Object({NODE_ENV:"production",VUE_APP_BASE_API:"/stage-api",BASE_URL:"/"}).NODE_DEBUG&&/\bsemver\b/i.test(Object({NODE_ENV:"production",VUE_APP_BASE_API:"/stage-api",BASE_URL:"/"}).NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=n}).call(this,n("4362"))},b805:function(e,t,n){const i=n("3034"),r=(e,t,n)=>i(t,e,n);e.exports=r},bac4:function(e,t,n){const i=n("3034"),r=(e,t,n)=>i(e,t,n)>0;e.exports=r},bbfd:function(e,t,n){const i=n("b802"),{MAX_LENGTH:r,MAX_SAFE_INTEGER:a}=n("b15c"),{re:o,t:s}=n("8cb5"),{compareIdentifiers:u}=n("2cdf");class c{constructor(e,t){if(t&&"object"===typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof c){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!==typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>r)throw new TypeError(`version is longer than ${r} characters`);i("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?o[s.LOOSE]:o[s.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>a||this.major<0)throw new TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<a)return t}return e}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(i("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"===typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],r=e.prerelease[t];if(i("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return u(n,r)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{const n=this.build[t],r=e.build[t];if(i("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return u(n,r)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;while(--e>=0)"number"===typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}e.exports=c},c2d5:function(e,t,n){const i=n("bbfd"),r=(e,t)=>new i(e,t).minor;e.exports=r},c4be:function(e,t,n){const i=n("4392"),r=n("f195"),a=n("bac4"),o=n("a2a3"),s=n("38fa"),u=n("68d3"),c=(e,t,n,c)=>{switch(t){case"===":return"object"===typeof e&&(e=e.version),"object"===typeof n&&(n=n.version),e===n;case"!==":return"object"===typeof e&&(e=e.version),"object"===typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return i(e,n,c);case"!=":return r(e,n,c);case">":return a(e,n,c);case">=":return o(e,n,c);case"<":return s(e,n,c);case"<=":return u(e,n,c);default:throw new TypeError(`Invalid operator: ${t}`)}};e.exports=c},d2ef:function(e,t,n){const i=n("a236"),r=(e,t)=>{const n=i(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};e.exports=r},de20:function(e){e.exports={name:"vega-tooltip",version:"0.20.1",description:"A tooltip plugin for Vega-Lite and Vega visualizations.",main:"build/vega-tooltip.js",module:"build/src/index.js",unpkg:"build/vega-tooltip.min.js",jsdelivr:"build/vega-tooltip.min.js",typings:"build/src/index.d.ts",repository:{type:"git",url:"https://github.com/vega/vega-tooltip.git"},keywords:["vega-lite","vega","tooltip"],author:{name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},collaborators:["Dominik Moritz","Sira Horradarn","Zening Qu","Kanit Wongsuphasawat","Yuri Astrakhan","Jeffrey Heer"],license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-tooltip/issues"},homepage:"https://github.com/vega/vega-tooltip#readme",scripts:{prepare:"beemo create-config --silent","tsc:src":"tsc -b tsconfig.src.json",build:"yarn tsc:src && rollup -c",clean:"rm -rf build examples/data && rm -f src/style.ts","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && yarn copy:build && gh-pages -d examples && yarn clean",prettierbase:"beemo prettier 'examples/*.{html,scss,css}'",eslintbase:"beemo eslint '{src,test,types}/**/*.ts'",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",postbuild:"terser build/vega-tooltip.js -c -m -o build/vega-tooltip.min.js",prebuild:"mkdir -p build && yarn copy:data && ./build-style.sh",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",start:"yarn build && concurrently --kill-others -n Server,Typescript,Rollup 'browser-sync start -s -f build examples --serveStatic examples' 'yarn tsc:src -w' 'rollup -c -w'",pretest:"./build-style.sh",test:"jest"},devDependencies:{"@rollup/plugin-commonjs":"11.0.1","@rollup/plugin-json":"^4.0.1","@rollup/plugin-node-resolve":"^7.0.0","@types/jest":"^25.1.1","browser-sync":"^2.26.7",concurrently:"^5.1.0","gh-pages":"^2.2.0",jest:"^25.1.0","node-sass":"^4.13.1",path:"^0.12.7",rollup:"^1.30.1",terser:"^4.6.3","ts-jest":"^25.0.0",typescript:"^3.7.5","vega-datasets":"^1.29.0","vega-lite-dev-config":"^0.3.1","vega-typings":"^0.12.0"},dependencies:{"vega-util":"^1.12.2"},beemo:{module:"vega-lite-dev-config",drivers:["prettier","eslint"]},jest:{testURL:"http://localhost/",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["node_modules","<rootDir>/build","src"]}}},f161:function(e){e.exports={a:"5.9.2"}},f195:function(e,t,n){const i=n("3034"),r=(e,t,n)=>0!==i(e,t,n);e.exports=r},f71e:function(e,t,n){"use strict";e.exports=function(e,t){t||(t={}),"function"===typeof t&&(t={cmp:t});var n="boolean"===typeof t.cycles&&t.cycles,i=t.cmp&&function(e){return function(t){return function(n,i){var r={key:n,value:t[n]},a={key:i,value:t[i]};return e(r,a)}}}(t.cmp),r=[];return function e(t){if(t&&t.toJSON&&"function"===typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!==typeof t)return JSON.stringify(t);var a,o;if(Array.isArray(t)){for(o="[",a=0;a<t.length;a++)a&&(o+=","),o+=e(t[a])||"null";return o+"]"}if(null===t)return"null";if(-1!==r.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=r.push(t)-1,u=Object.keys(t).sort(i&&i(t));for(o="",a=0;a<u.length;a++){var c=u[a],l=e(t[c]);l&&(o&&(o+=","),o+=JSON.stringify(c)+":"+l)}return r.splice(s,1),"{"+o+"}"}}(e)}},fd907:function(e,t,n){const i=n("bbfd"),r=n("3fce"),a=(e,t,n)=>{let a=null,o=null,s=null;try{s=new r(t,n)}catch(u){return null}return e.forEach(e=>{s.test(e)&&(a&&1!==o.compare(e)||(a=e,o=new i(a,n)))}),a};e.exports=a}}]);